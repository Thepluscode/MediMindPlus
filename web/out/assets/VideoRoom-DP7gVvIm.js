import{g as Ru,e as Lu,u as xu,r as _t,l as ta,j as Ue}from"./index-w3uZbT7I.js";import{a as Mu}from"./index-xsH4HHeE.js";import{c as un}from"./createLucideIcon-BxqIYaV7.js";var Tn={exports:{}},Fe={},Ge={},pt={},xn,ra;function Au(){return ra||(ra=1,xn=(function(g){var m=g.location,_=g.URL;return[m,_].some(function(u){return!u})?function(i){return Promise.reject(new Error("Failed to import: ".concat(i,": dynamicImport is not supported")))}:(g.__twilioVideoImportedModules={},function(i){return i in g.__twilioVideoImportedModules?Promise.resolve(g.__twilioVideoImportedModules[i]):new Function("scope","return import('".concat(new _(i,m),"').then(m => scope.__twilioVideoImportedModules['").concat(i,"'] = m);"))(g)})})(globalThis)),xn}var Mn,na;function As(){if(na)return Mn;na=1;var g=function(){},m="undefined",_=typeof window!==m&&typeof window.navigator!==m&&/Trident\/|MSIE /.test(window.navigator.userAgent),u=["trace","debug","info","warn","error"];function i(d,v){var p=d[v];if(typeof p.bind=="function")return p.bind(d);try{return Function.prototype.bind.call(p,d)}catch{return function(){return Function.prototype.apply.apply(p,[d,arguments])}}}function e(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function t(d){return d==="debug"&&(d="log"),typeof console===m?!1:d==="trace"&&_?e:console[d]!==void 0?i(console,d):console.log!==void 0?i(console,"log"):g}function r(d,v){for(var p=0;p<u.length;p++){var T=u[p];this[T]=p<d?g:this.methodFactory(T,d,v)}this.log=this.debug}function n(d,v,p){return function(){typeof console!==m&&(r.call(this,v,p),this[d].apply(this,arguments))}}function a(d,v,p){return t(d)||n.apply(this,arguments)}function o(d,v,p){var T=this,M,k="loglevel";typeof d=="string"?k+=":"+d:typeof d=="symbol"&&(k=void 0);function y(h){var w=(u[h]||"silent").toUpperCase();if(!(typeof window===m||!k)){try{window.localStorage[k]=w;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+w+";"}catch{}}}function b(){var h;if(!(typeof window===m||!k)){try{h=window.localStorage[k]}catch{}if(typeof h===m)try{var w=window.document.cookie,S=w.indexOf(encodeURIComponent(k)+"=");S!==-1&&(h=/^([^;]+)/.exec(w.slice(S))[1])}catch{}return T.levels[h]===void 0&&(h=void 0),h}}T.name=d,T.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},T.methodFactory=p||a,T.getLevel=function(){return M},T.setLevel=function(h,w){if(typeof h=="string"&&T.levels[h.toUpperCase()]!==void 0&&(h=T.levels[h.toUpperCase()]),typeof h=="number"&&h>=0&&h<=T.levels.SILENT){if(M=h,w!==!1&&y(h),r.call(T,h,d),typeof console===m&&h<T.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+h},T.setDefaultLevel=function(h){b()||T.setLevel(h,!1)},T.enableAll=function(h){T.setLevel(T.levels.TRACE,h)},T.disableAll=function(h){T.setLevel(T.levels.SILENT,h)};var f=b();f==null&&(f=v??"WARN"),T.setLevel(f,!1)}var s=new o,c={};s.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var p=c[v];return p||(p=c[v]=new o(v,s.getLevel(),s.methodFactory)),p};var l=typeof window!==m?window.log:void 0;return s.noConflict=function(){return typeof window!==m&&window.log===s&&(window.log=l),s},s.getLoggers=function(){return c},s.default=s,Mn=s,Mn}var Pn={exports:{}};const Iu="twilio-video",Du="2.34.0",Is={name:Iu,version:Du};Pn.exports;var ia;function Oe(){return ia||(ia=1,(function(g){var m=Is;g.exports.SDK_NAME="".concat(m.name,".js"),g.exports.SDK_VERSION=m.version,g.exports.SDP_FORMAT="unified",g.exports.hardwareDevicePublisheriPad={hwDeviceManufacturer:"Apple",hwDeviceModel:"iPad",hwDeviceType:"tablet",platformName:"iOS"},g.exports.hardwareDevicePublisheriPhone={hwDeviceManufacturer:"Apple",hwDeviceModel:"iPhone",hwDeviceType:"mobile",platformName:"iOS"},g.exports.DEFAULT_ENVIRONMENT="prod",g.exports.DEFAULT_REALM="us1",g.exports.DEFAULT_REGION="gll",g.exports.DEFAULT_LOG_LEVEL="warn",g.exports.DEFAULT_LOGGER_NAME="twilio-video",g.exports.WS_SERVER=function(u,i){return i=i==="gll"?"global":encodeURIComponent(i),u==="prod"?"wss://".concat(i,".vss.twilio.com/signaling"):"wss://".concat(i,".vss.").concat(u,".twilio.com/signaling")},g.exports.PUBLISH_MAX_ATTEMPTS=5,g.exports.PUBLISH_BACKOFF_JITTER=10,g.exports.PUBLISH_BACKOFF_MS=20;function _(u){return["a","e","i","o","u"].includes(u.toLowerCase()[0])?"an":"a"}g.exports.typeErrors={ILLEGAL_INVOKE:function(u,i){return new TypeError("Illegal call to ".concat(u,": ").concat(i))},INVALID_TYPE:function(u,i){return new TypeError("".concat(u," must be ").concat(_(i)," ").concat(i))},INVALID_VALUE:function(u,i){return new RangeError("".concat(u," must be one of ").concat(i.join(", ")))},REQUIRED_ARGUMENT:function(u){return new TypeError("".concat(u," must be specified"))}},g.exports.DEFAULT_FRAME_RATE=24,g.exports.DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS=1e4,g.exports.DEFAULT_ICE_GATHERING_TIMEOUT_MS=15e3,g.exports.DEFAULT_SESSION_TIMEOUT_SEC=30,g.exports.DEFAULT_NQ_LEVEL_LOCAL=1,g.exports.DEFAULT_NQ_LEVEL_REMOTE=0,g.exports.MAX_NQ_LEVEL=3,g.exports.ICE_ACTIVITY_CHECK_PERIOD_MS=1e3,g.exports.ICE_INACTIVITY_THRESHOLD_MS=3e3,g.exports.iceRestartBackoffConfig={factor:1.1,min:1,max:g.exports.DEFAULT_SESSION_TIMEOUT_SEC*1e3,jitter:1},g.exports.reconnectBackoffConfig={factor:1.5,min:80,jitter:1},g.exports.subscriptionMode={MODE_COLLABORATION:"collaboration",MODE_GRID:"grid",MODE_PRESENTATION:"presentation"},g.exports.trackSwitchOffMode={MODE_DISABLED:"disabled",MODE_DETECTED:"detected",MODE_PREDICTED:"predicted"},g.exports.trackPriority={PRIORITY_HIGH:"high",PRIORITY_LOW:"low",PRIORITY_STANDARD:"standard"},g.exports.clientTrackSwitchOffControl={MODE_AUTO:"auto",MODE_MANUAL:"manual"},g.exports.videoContentPreferencesMode={MODE_AUTO:"auto",MODE_MANUAL:"manual"}})(Pn)),Pn.exports}var mt,aa;function Qe(){if(aa)return mt;aa=1;var g=mt&&mt.__read||function(v,p){var T=typeof Symbol=="function"&&v[Symbol.iterator];if(!T)return v;var M=T.call(v),k,y=[],b;try{for(;(p===void 0||p-- >0)&&!(k=M.next()).done;)y.push(k.value)}catch(f){b={error:f}}finally{try{k&&!k.done&&(T=M.return)&&T.call(M)}finally{if(b)throw b.error}}return y},m=mt&&mt.__spreadArray||function(v,p,T){if(T||arguments.length===2)for(var M=0,k=p.length,y;M<k;M++)(y||!(M in p))&&(y||(y=Array.prototype.slice.call(p,0,M)),y[M]=p[M]);return v.concat(y||Array.prototype.slice.call(p))},_=As().getLogger,u=Oe(),i=u.DEFAULT_LOG_LEVEL,e=u.DEFAULT_LOGGER_NAME,t=Oe().typeErrors,r;function n(v){if(r=r||new Map,r.has(v))return r.get(v);var p=new Set;return r.set(v,p),p}var a=(function(){function v(p,T,M,k,y){if(typeof p!="string")throw t.INVALID_TYPE("moduleName","string");if(!T)throw t.REQUIRED_ARGUMENT("component");typeof M!="object"&&(M={}),y=y||_,d(M),Object.defineProperties(this,{_component:{value:T},_logLevels:{value:M},_warnings:{value:new Set},_loggerName:{get:function(){var f=k&&typeof k=="string"?k:e;return this._logLevelsEqual||(f="".concat(f,"-").concat(p)),f}},_logger:{get:function(){var f=y(this._loggerName),h=this._logLevels[p]||i;return h=h==="off"?"silent":h,f.setDefaultLevel(h),f}},_logLevelsEqual:{get:function(){return new Set(Object.values(this._logLevels)).size===1}},logLevel:{get:function(){return v.getLevelByName(M[p]||i)}},name:{get:T.toString.bind(T)}})}return v.getLevelByName=function(p){return isNaN(p)?(p=p.toUpperCase(),l(p),v[p]):parseInt(p,10)},v.prototype.createLog=function(p,T){var M=this._loggerName;return this._logLevelsEqual||(M=M.substring(0,M.lastIndexOf("-"))),new v(p,T,this._logLevels,M)},v.prototype.setLevels=function(p){return d(p),Object.assign(this._logLevels,p),this},v.prototype.log=function(p,T){var M=v._levels[p];if(!M)throw t.INVALID_VALUE("logLevel",s);M=M.toLowerCase();var k=[new Date().toISOString(),M,this.name];return(this._logger[M]||function(){}).apply(void 0,m([],g(k.concat(T)),!1)),this},v.prototype.debug=function(){return this.log(v.DEBUG,[].slice.call(arguments))},v.prototype.deprecated=function(p){var T=n(this._component.constructor);return T.has(p)?this:(T.add(p),this.warn(p))},v.prototype.info=function(){return this.log(v.INFO,[].slice.call(arguments))},v.prototype.warn=function(){return this.log(v.WARN,[].slice.call(arguments))},v.prototype.warnOnce=function(p){return this._warnings.has(p)?this:(this._warnings.add(p),this.warn(p))},v.prototype.error=function(){return this.log(v.ERROR,[].slice.call(arguments))},v.prototype.throw=function(p,T){throw p.clone&&(p=p.clone(T)),this.log(v.ERROR,p),p},v})();Object.defineProperties(a,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:["DEBUG","INFO","WARN","ERROR","OFF"]}});var o={},s=[],c=a._levels.map(function(v,p){return o[v]=!0,s.push(p),v});function l(v){if(!(v in o))throw t.INVALID_VALUE("level",c)}function d(v){Object.keys(v).forEach(function(p){l(v[p].toUpperCase())})}return mt=a,mt}var oa;function ju(){if(oa)return pt;oa=1;var g=pt&&pt.__awaiter||function(r,n,a,o){function s(c){return c instanceof a?c:new a(function(l){l(c)})}return new(a||(a=Promise))(function(c,l){function d(T){try{p(o.next(T))}catch(M){l(M)}}function v(T){try{p(o.throw(T))}catch(M){l(M)}}function p(T){T.done?c(T.value):s(T.value).then(d,v)}p((o=o.apply(r,n||[])).next())})},m=pt&&pt.__generator||function(r,n){var a={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},o,s,c,l=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return l.next=d(0),l.throw=d(1),l.return=d(2),typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(p){return function(T){return v([p,T])}}function v(p){if(o)throw new TypeError("Generator is already executing.");for(;l&&(l=0,p[0]&&(a=0)),a;)try{if(o=1,s&&(c=p[0]&2?s.return:p[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,p[1])).done)return c;switch(s=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return a.label++,{value:p[1],done:!1};case 5:a.label++,s=p[1],p=[0];continue;case 7:p=a.ops.pop(),a.trys.pop();continue;default:if(c=a.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){a=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){a.label=p[1];break}if(p[0]===6&&a.label<c[1]){a.label=c[1],c=p;break}if(c&&a.label<c[2]){a.label=c[2],a.ops.push(p);break}c[2]&&a.ops.pop(),a.trys.pop();continue}p=n.call(r,a)}catch(T){p=[6,T],s=0}finally{o=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}};Object.defineProperty(pt,"__esModule",{value:!0}),pt.createNoiseCancellationAudioProcessor=t;var _=Au();Qe();var u={krisp:{supportedVersion:"1.0.0",pluginFile:"krispsdk.mjs"},rnnoise:{supportedVersion:"0.6.0",pluginFile:"rnnoise_sdk.mjs"}},i=function(r){var n=r.supportedVersion,a=r.plugin,o=r.log;if(!a.getVersion||!a.isSupported)throw new Error("Plugin does not export getVersion/isSupported api. Are you using old version of the plugin ?");var s=a.getVersion();o.debug("Plugin Version = ".concat(s));var c=n.split(".").map(function(p){return Number(p)}),l=s.split(".").map(function(p){return Number(p)});if(c.length!==3||l.length!==3)throw new Error("Unsupported Plugin version format: ".concat(n,", ").concat(s));if(c[0]!==l[0])throw new Error("Major version mismatch: [Plugin version ".concat(s,"],  [Supported Version ").concat(n,"]"));if(l[1]<c[1])throw new Error("Minor version mismatch: [Plugin version ".concat(s,"] < [Supported Version ").concat(n,"]"));var d=new AudioContext,v=a.isSupported(d);if(d.close(),!v)throw new Error("Noise Cancellation plugin is not supported on your browser")},e=new Map;function t(r,n){return g(this,void 0,void 0,function(){var a,o,s,c,l,d,v,p,T;return m(this,function(M){switch(M.label){case 0:if(a=e.get(r.vendor),a)return[3,6];if(o=u[r.vendor],!o)throw new Error("Unsupported NoiseCancellationOptions.vendor: ".concat(r.vendor));s=o.supportedVersion,c=o.pluginFile,l=r.sdkAssetsPath,d="".concat(l,"/").concat(c),M.label=1;case 1:return M.trys.push([1,5,,6]),n.debug("loading noise cancellation sdk: ",d),[4,_(d)];case 2:return v=M.sent(),n.debug("Loaded noise cancellation sdk:",v),p=v.default,i({supportedVersion:s,plugin:p,log:n}),p.isInitialized()?[3,4]:(n.debug("initializing noise cancellation sdk: ",l),[4,p.init({rootDir:l})]);case 3:M.sent(),n.debug("noise cancellation sdk initialized!"),M.label=4;case 4:return a={vendor:r.vendor,isInitialized:function(){return p.isInitialized()},isConnected:function(){return p.isConnected()},isEnabled:function(){return p.isEnabled()},disconnect:function(){return p.disconnect()},enable:function(){return p.enable()},disable:function(){return p.disable()},destroy:function(){return p.destroy()},setLogging:function(k){return p.setLogging(k)},connect:function(k){n.debug("connect: ",k.id),p.isConnected()&&p.disconnect();var y=p.connect(new MediaStream([k]));if(!y)throw new Error("Error connecting with noise cancellation sdk");var b=y.getAudioTracks()[0];if(!b)throw new Error("Error getting clean track from noise cancellation sdk");return p.enable(),b}},e.set(r.vendor,a),[3,6];case 5:throw T=M.sent(),n.error("Error loading noise cancellation sdk:".concat(d),T),T;case 6:return[2,a]}})})}return pt}var ca;function Nu(){if(ca)return Ge;ca=1;var g=Ge&&Ge.__awaiter||function(e,t,r,n){function a(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function c(v){try{d(n.next(v))}catch(p){s(p)}}function l(v){try{d(n.throw(v))}catch(p){s(p)}}function d(v){v.done?o(v.value):a(v.value).then(c,l)}d((n=n.apply(e,t||[])).next())})},m=Ge&&Ge.__generator||function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,a,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=c(0),s.throw=c(1),s.return=c(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(d){return function(v){return l([d,v])}}function l(d){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,d[0]&&(r=0)),r;)try{if(n=1,a&&(o=d[0]&2?a.return:d[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,d[1])).done)return o;switch(a=0,o&&(d=[d[0]&2,o.value]),d[0]){case 0:case 1:o=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,a=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!o||d[1]>o[0]&&d[1]<o[3])){r.label=d[1];break}if(d[0]===6&&r.label<o[1]){r.label=o[1],o=d;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(d);break}o[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(e,r)}catch(v){d=[6,v],a=0}finally{n=o=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.NoiseCancellationImpl=void 0,Ge.applyNoiseCancellation=i;var _=ju();Qe();var u=(function(){function e(t,r){this._processor=t,this._sourceTrack=r,this._disabledPermanent=!1}return Object.defineProperty(e.prototype,"vendor",{get:function(){return this._processor.vendor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sourceTrack",{get:function(){return this._sourceTrack},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._processor.isEnabled()},enumerable:!1,configurable:!0}),e.prototype.enable=function(){if(this._disabledPermanent)throw new Error("".concat(this.vendor," noise cancellation is disabled permanently for this track"));return this._processor.enable(),Promise.resolve()},e.prototype.disable=function(){return this._processor.disable(),Promise.resolve()},e.prototype.reacquireTrack=function(t){return g(this,void 0,void 0,function(){var r,n,a;return m(this,function(o){switch(o.label){case 0:return r=this._processor.isEnabled(),this._processor.disconnect(),[4,t()];case 1:return n=o.sent(),this._sourceTrack=n,[4,this._processor.connect(n)];case 2:return a=o.sent(),r?this._processor.enable():this._processor.disable(),[2,a]}})})},e.prototype.disablePermanently=function(){return this._disabledPermanent=!0,this.disable()},e.prototype.stop=function(){this._processor.disconnect(),this._sourceTrack.stop()},e})();Ge.NoiseCancellationImpl=u;function i(e,t,r){return g(this,void 0,void 0,function(){var n,a,o,s;return m(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,(0,_.createNoiseCancellationAudioProcessor)(t,r)];case 1:return n=c.sent(),a=n.connect(e),o=new u(n,e),[2,{cleanTrack:a,noiseCancellation:o}];case 2:return s=c.sent(),r.warn("Failed to create noise cancellation. Returning normal audio track: ".concat(s)),[2,{cleanTrack:e}];case 3:return[2]}})})}return Ge}var ye={},Ae={},sa;function je(){if(sa)return Ae;sa=1;var g=Ae&&Ae.__read||function(b,f){var h=typeof Symbol=="function"&&b[Symbol.iterator];if(!h)return b;var w=h.call(b),S,E=[],q;try{for(;(f===void 0||f-- >0)&&!(S=w.next()).done;)E.push(S.value)}catch(O){q={error:O}}finally{try{S&&!S.done&&(h=w.return)&&h.call(w)}finally{if(q)throw q.error}}return E},m=Ae&&Ae.__spreadArray||function(b,f,h){if(h||arguments.length===2)for(var w=0,S=f.length,E;w<S;w++)(E||!(w in f))&&(E||(E=Array.prototype.slice.call(f,0,w)),E[w]=f[w]);return b.concat(E||Array.prototype.slice.call(f))};function _(){var b={};return b.promise=new Promise(function(f,h){b.resolve=f,b.reject=h}),b}function u(b,f,h,w){if(!(w in f)&&!w.match(/^on[a-z]+$/)){var S=!1;try{var E=Object.getOwnPropertyDescriptor(b,w);S=E&&!!E.get}catch{}if(!S){var q;try{q=typeof b[w]}catch{}q==="function"&&(f[w]=function(){return this[h][w].apply(this[h],arguments)})}}}function i(b,f,h){for(var w in b)u(b,f,h,w)}function e(b,f){b=Array.isArray(b)?new Set(b):new Set(b.values()),f=Array.isArray(f)?new Set(f):new Set(f.values());var h=new Set;return b.forEach(function(w){f.has(w)||h.add(w)}),h}function t(b,f){var h=b instanceof Map||b instanceof Set?Array.from(b.values()):b;return h.reduce(function(w,S){return w.concat(f(S))},[])}function r(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:null}function n(b){return typeof b>"u"&&(b=r()),/Chrome|CriOS/.test(b)?"chrome":/Firefox|FxiOS/.test(b)?"firefox":/Safari|iPhone|iPad|iPod/.test(b)?"safari":null}function a(b){typeof b>"u"&&(b=r());var f={chrome:"Chrome|CriOS",firefox:"Firefox|FxiOS",safari:"Version"}[n(b)];if(!f)return null;var h=new RegExp("(".concat(f,")/([^\\s]+)")),w=g(b.match(h)||[],3),S=w[2];if(!S)return null;var E=S.split(".").map(Number);return{major:isNaN(E[0])?null:E[0],minor:isNaN(E[1])?null:E[1]}}function o(b){return typeof b>"u"&&(b=r()),/Mobi/.test(b)&&n()==="chrome"&&/iPad|iPhone|iPod/.test(b)}function s(b,f){var h=null;Object.defineProperty(b,"on"+f,{get:function(){return h},set:function(w){h&&this.removeEventListener(f,h),typeof w=="function"?(h=w,this.addEventListener(f,h)):h=null}})}function c(b,f,h){return f?b.then(f,h):b}function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var f=Math.random()*16|0,h=b==="x"?f:f&3|8;return h.toString(16)})}function d(b,f,h){Object.getOwnPropertyNames(b).forEach(function(w){v(b,f,h,w)})}function v(b,f,h,w){if(!(w in f)){if(w.match(/^on[a-z]+$/)){Object.defineProperty(f,w,{value:null,writable:!0}),h.addEventListener(w.slice(2),function(){for(var S=[],E=0;E<arguments.length;E++)S[E]=arguments[E];return f.dispatchEvent.apply(f,m([],g(S),!1))});return}Object.defineProperty(f,w,{enumerable:!0,get:function(){return h[w]}})}}function p(){return typeof navigator=="object"&&typeof navigator.mediaDevices=="object"&&typeof navigator.mediaDevices.getUserMedia=="function"&&typeof RTCPeerConnection=="function"}function T(b){if(typeof RTCRtpSender<"u"&&typeof RTCRtpSender.getCapabilities=="function")return Promise.resolve(new Set(RTCRtpSender.getCapabilities(b).codecs.map(function(h){var w=h.mimeType;return w.split("/")[1].toLowerCase()})));if(typeof RTCPeerConnection>"u"||typeof RTCPeerConnection.prototype>"u"||typeof RTCPeerConnection.prototype.addTransceiver!="function"||typeof RTCPeerConnection.prototype.close!="function"||typeof RTCPeerConnection.prototype.createOffer!="function")return Promise.resolve(new Set);var f=new RTCPeerConnection;return f.addTransceiver(b),f.createOffer().then(function(h){var w=h.sdp;return f.close(),new Set((w.match(/^a=rtpmap:.+$/gm)||[]).map(function(S){return S.match(/^a=rtpmap:.+ ([^/]+)/)[1].toLowerCase()}))},function(){return f.close(),new Set})}var M=new Map;function k(b,f){var h=M.get(f);return h?Promise.resolve(h.has(b.toLowerCase())):T(f).then(function(w){return M.set(f,w),w.has(b.toLowerCase())})}function y(){M.clear()}return Ae.clearCachedSupportedCodecs=y,Ae.defer=_,Ae.delegateMethods=i,Ae.difference=e,Ae.flatMap=t,Ae.guessBrowser=n,Ae.guessBrowserVersion=a,Ae.isCodecSupported=k,Ae.isIOSChrome=o,Ae.interceptEvent=s,Ae.legacyPromise=c,Ae.makeUUID=l,Ae.proxyProperties=d,Ae.support=p,Ae}var _n={},ua;function Ds(){if(ua)return _n;ua=1;var g="1234567890abcdef",m=32;function _(u){for(var i="",e=0;e<m;e++)i+=g.charAt(Math.floor(Math.random()*g.length));return"".concat(u).concat(i)}return _n.sessionSID=_("SS"),_n.createSID=_,_n}var An,la;function js(){if(la)return An;la=1;var g={recordingMediaLost:"recording-media-lost"};return An=g,An}var da;function Ee(){if(da)return ye;da=1;var g=ye&&ye.__extends||(function(){var L=function(P,N){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(X,ee){X.__proto__=ee}||function(X,ee){for(var ae in ee)Object.prototype.hasOwnProperty.call(ee,ae)&&(X[ae]=ee[ae])},L(P,N)};return function(P,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");L(P,N);function X(){this.constructor=P}P.prototype=N===null?Object.create(N):(X.prototype=N.prototype,new X)}})(),m=ye&&ye.__read||function(L,P){var N=typeof Symbol=="function"&&L[Symbol.iterator];if(!N)return L;var X=N.call(L),ee,ae=[],ue;try{for(;(P===void 0||P-- >0)&&!(ee=X.next()).done;)ae.push(ee.value)}catch(fe){ue={error:fe}}finally{try{ee&&!ee.done&&(N=X.return)&&N.call(X)}finally{if(ue)throw ue.error}}return ae},_=ye&&ye.__spreadArray||function(L,P,N){if(N||arguments.length===2)for(var X=0,ee=P.length,ae;X<ee;X++)(ae||!(X in P))&&(ae||(ae=Array.prototype.slice.call(P,0,X)),ae[X]=P[X]);return L.concat(ae||Array.prototype.slice.call(P))},u=Oe(),i=u.typeErrors,e=u.trackPriority,t=je(),r=Ds().sessionSID,n=js();function a(L,P){if(L instanceof P.LocalAudioTrack||L instanceof P.LocalVideoTrack||L instanceof P.LocalDataTrack)return L;if(L instanceof P.MediaStreamTrack)return L.kind==="audio"?new P.LocalAudioTrack(L,P):new P.LocalVideoTrack(L,P);throw i.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")}function o(L,P,N,X){var ee={audio:X.LocalAudioTrackPublication,video:X.LocalVideoTrackPublication,data:X.LocalDataTrackPublication}[L.kind];return new ee(P,L,N,X)}function s(L){return L[0].toUpperCase()+L.slice(1)}function c(L,P,N,X){var ee=new Set;P.on("newListener",function ae(ue){N.has(ue)&&!ee.has(ue)&&(X.deprecated("".concat(L,"#").concat(ue," has been deprecated and scheduled for removal in twilio-video.js@2.0.0.").concat(N.get(ue)?" Use ".concat(L,"#").concat(N.get(ue)," instead."):"")),ee.add(ue)),ee.size>=N.size&&P.removeListener("newListener",ae)})}function l(L,P){L=Array.isArray(L)?new Set(L):new Set(L.values()),P=Array.isArray(P)?new Set(P):new Set(P.values());var N=new Set;return L.forEach(function(X){P.has(X)||N.add(X)}),N}function d(L,P){return Object.keys(L).reduce(function(N,X){return L[X]!==P&&(N[X]=L[X]),N},{})}function v(L,P){var N=L instanceof Map||L instanceof Set?Array.from(L.values()):L;return P=P||function(ee){return ee},N.reduce(function(X,ee){var ae=P(ee);return X.concat(ae)},[])}function p(){return typeof navigator<"u"&&navigator.userAgent?navigator.userAgent:"Unknown"}function T(){var L=p(),P=m(L.match(/\(([^)]+)\)/)||[],2),N=P[1],X=N===void 0?"unknown":N,ee=m(X.split(";").map(function(ue){return ue.trim()}),1),ae=ee[0];return ae.toLowerCase()}function M(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(L){var P=Math.random()*16|0,N=L==="x"?P:P&3|8;return N.toString(16)})}function k(L){var P=null;function N(){P=null,L()}return function(){P&&clearTimeout(P),P=setTimeout(N)}}function y(L,P,N,X){return new Promise(function(ee,ae){function ue(){var ve=[].slice.call(arguments);X&&P.removeListener(X,fe),ee.apply(void 0,_([],m(ve),!1))}function fe(){var ve=[].slice.call(arguments);P.removeListener(N,ue),ae.apply(void 0,_([],m(ve),!1))}P.once(N,ue),X&&P.once(X,fe),L()})}function b(L,P){return P.split(".").reduce(function(N,X){return N?N[X]:null},L)}function f(){var L={};return L.promise=new Promise(function(P,N){L.resolve=P,L.reject=N}),L}function h(L,P,N,X){if(!(X in P)&&!X.match(/^on[a-z]+$/)){var ee;try{ee=typeof L[X]}catch{}ee==="function"&&(P[X]=function(){for(var ae,ue=[],fe=0;fe<arguments.length;fe++)ue[fe]=arguments[fe];return(ae=this[N])[X].apply(ae,_([],m(ue),!1))})}}function w(L,P,N){for(var X in L)h(L,P,N,X)}function S(L,P){if(L===P)return!0;if(typeof L!=typeof P)return!1;if(L===null)return P===null;if(P===null)return!1;if(Array.isArray(L))return Array.isArray(P)&&L.length===P.length&&L.every(function(ee,ae){return S(ee,P[ae])});if(typeof L=="object"){var N=Object.keys(L).sort(),X=Object.keys(P).sort();return!Array.isArray(P)&&S(N,X)&&N.every(function(ee){return S(L[ee],P[ee])})}return!1}function E(L){return typeof L=="object"&&!Array.isArray(L)}function q(L,P,N){Object.getOwnPropertyNames(L).forEach(function(X){O(L,P,N,X)})}function O(L,P,N,X){if(!(X in P)){if(X.match(/^on[a-z]+$/)){Object.defineProperty(P,X,{value:null,writable:!0}),N.addEventListener(X.slice(2),function(){for(var ee=[],ae=0;ae<arguments.length;ae++)ee[ae]=arguments[ae];P.dispatchEvent.apply(P,_([],m(ee),!1))});return}Object.defineProperty(P,X,{enumerable:!0,get:function(){return N[X]}})}}function C(L,P,N){return P?L.then(function(X){P(X)},function(X){N(X)}):L}function I(L){return typeof L=="string"?{default:L,media:L,signaling:L,webrtc:L}:L}function x(L,P){return P=P?"Local":"","".concat(P+(L.kind||"").replace(/\w{1}/,function(N){return N.toUpperCase()}),"Track")}function A(L,P){return P=P?"Local":"","".concat(P+(L.kind||"").replace(/\w{1}/,function(N){return N.toUpperCase()}),"TrackPublication")}function R(L){Object.getOwnPropertyNames(L).forEach(function(P){P.startsWith("_")&&V(L,P)})}function F(L,P){return(function(N){g(X,N);function X(){for(var ee=[],ae=0;ae<arguments.length;ae++)ee[ae]=arguments[ae];var ue=N.apply(this,_([],m(ee),!1))||this;return R(ue),U(ue,P),ue}return X})(L)}function V(L,P){var N=Object.getOwnPropertyDescriptor(L,P);N.enumerable=!1,Object.defineProperty(L,P,N)}function U(L,P){P===void 0&&(P=[]),P.forEach(function(N){L.hasOwnProperty(N)&&V(L,N)})}function j(L){return L.map(re)}function D(L){return j(_([],m(L),!1))}function H(L){return _([],m(L.entries()),!1).reduce(function(P,N){var X,ee=m(N,2),ae=ee[0],ue=ee[1];return Object.assign((X={},X[ae]=re(ue),X),P)},{})}function $(L){return Object.entries(L).reduce(function(P,N){var X,ee=m(N,2),ae=ee[0],ue=ee[1];return Object.assign((X={},X[ae]=re(ue),X),P)},{})}function re(L){return Array.isArray(L)?j(L):L instanceof Set?D(L):L instanceof Map?H(L):L&&typeof L=="object"?$(L):L}function Y(L){return L?"true":"false"}function Z(L){var P={sessionSID:r,iceServers:(L.iceServers||[]).length,audioTracks:(L.tracks||[]).filter(function(ee){return ee.kind==="audio"}).length,videoTracks:(L.tracks||[]).filter(function(ee){return ee.kind==="video"}).length,dataTracks:(L.tracks||[]).filter(function(ee){return ee.kind==="data"}).length};if([["audio"],["automaticSubscription"],["enableDscp"],["eventListener"],["preflight"],["video"],["dominantSpeaker","enableDominantSpeaker"]].forEach(function(ee){var ae=m(ee,2),ue=ae[0],fe=ae[1];fe=fe||ue,P[fe]=Y(!!L[ue])}),[["maxVideoBitrate"],["maxAudioBitrate"]].forEach(function(ee){var ae=m(ee,2),ue=ae[0],fe=ae[1];fe=fe||ue,typeof L[ue]=="number"?P[fe]=L[ue]:isNaN(Number(L[ue]))||(P[fe]=Number(L[ue]))}),[["iceTransportPolicy"],["region"],["name","roomName"]].forEach(function(ee){var ae=m(ee,2),ue=ae[0],fe=ae[1];fe=fe||ue,typeof L[ue]=="string"?P[fe]=L[ue]:typeof L[ue]=="number"&&ue==="name"&&(P[fe]=L[ue].toString())}),["preferredAudioCodecs","preferredVideoCodecs"].forEach(function(ee){ee in L&&(P[ee]=JSON.stringify(L[ee]))}),"networkQuality"in L&&(P.networkQualityConfiguration={},E(L.networkQuality)?["local","remote"].forEach(function(ee){typeof L.networkQuality[ee]=="number"&&(P.networkQualityConfiguration[ee]=L.networkQuality[ee])}):(P.networkQualityConfiguration.remote=0,P.networkQualityConfiguration.local=L.networkQuality?1:0)),L.bandwidthProfile&&L.bandwidthProfile.video){var N=L.bandwidthProfile.video||{};P.bandwidthProfileOptions={},["mode","maxTracks","trackSwitchOffMode","dominantSpeakerPriority","maxSubscriptionBitrate","renderDimensions","contentPreferencesMode","clientTrackSwitchOffControl"].forEach(function(ee){typeof N[ee]=="number"||typeof N[ee]=="string"?P.bandwidthProfileOptions[ee]=N[ee]:typeof N[ee]=="boolean"?P.bandwidthProfileOptions[ee]=Y(N[ee]):typeof N[ee]=="object"&&(P.bandwidthProfileOptions[ee]=JSON.stringify(N[ee]))})}var X={RTCPeerConnection:"customRTCPeerConnectionImpl",MediaStream:"customMediaStreamImpl",getUserMedia:"customGetUserMediaImpl",enumerateDevices:"customEnumerateDevicesImpl"};return Object.entries(X).forEach(function(ee){var ae=m(ee,2),ue=ae[0],fe=ae[1];P[fe]=Y(typeof L[ue]<"u")}),{group:"room",name:"connecting",level:"info",payload:P}}function ne(){return{group:"room",name:"connected",level:"info"}}function ie(L){return ge(L,[{prop:"video",type:"object",transform:be}])}function be(L){return ge(L,[{prop:"dominantSpeakerPriority",type:"string",payloadProp:"active_speaker_priority"},{prop:"maxSubscriptionBitrate",type:"number",payloadProp:"max_subscription_bandwidth"},{prop:"maxTracks",type:"number",payloadProp:"max_tracks"},{prop:"mode",type:"string"},{prop:"renderDimensions",type:"object",payloadProp:"render_dimensions",transform:Te},{prop:"trackSwitchOffMode",type:"string",payloadProp:"track_switch_off"}])}function ce(L,P,N,X,ee,ae,ue){var fe={transports:[{type:"data-channel"}]};return Object.assign(L?{active_speaker:fe}:{},P?{network_quality:fe}:{},ae?{render_hints:fe}:{},ee?{publisher_hints:fe}:{},N?{track_priority:fe}:{},X?{track_switch_off:fe}:{},ue?{extension_transcriptions:fe}:{})}function pe(L){return ge(L,[{prop:"height",type:"number"},{prop:"width",type:"number"}])}function Te(L){var P=e.PRIORITY_HIGH,N=e.PRIORITY_LOW,X=e.PRIORITY_STANDARD;return ge(L,[{prop:P,type:"object",transform:pe},{prop:N,type:"object",transform:pe},{prop:X,type:"object",transform:pe}])}function ge(L,P){return P.reduce(function(N,X){var ee,ae=X.prop,ue=X.type,fe=X.payloadProp,ve=fe===void 0?ae:fe,Ie=X.transform,qe=Ie===void 0?function(te){return te}:Ie;return typeof L[ae]===ue?Object.assign((ee={},ee[ve]=qe(L[ae]),ee),N):N},{})}function _e(L){return{rules:[{type:L?"include":"exclude",all:!0}],revision:1}}function he(L){var P,N=(P={},P[n.recordingMediaLost]="recordings",P);return L.map(function(X){return N[X]}).filter(function(X){return!!X})}function le(L,P){var N=Math.random();return L-P+Math.floor(2*P*N+.5)}function z(L,P,N){return P<=L&&L<=N}function ke(L){return t.guessBrowser()==="chrome"&&L.kind==="video"&&"displaySurface"in L.getSettings()}function se(L){return L===void 0&&(L=10),new Promise(function(P){return setTimeout(P,L)})}function me(L,P){return new Promise(function(N){L.addEventListener(P,function X(ee){L.removeEventListener(P,X),N(ee)})})}return ye.constants=u,ye.createBandwidthProfilePayload=ie,ye.createMediaSignalingPayload=ce,ye.createMediaWarningsPayload=he,ye.createRoomConnectingEventPayload=Z,ye.createRoomConnectedEventPayload=ne,ye.boolToString=Y,ye.createSubscribePayload=_e,ye.asLocalTrack=a,ye.asLocalTrackPublication=o,ye.capitalize=s,ye.deprecateEvents=c,ye.difference=l,ye.filterObject=d,ye.flatMap=v,ye.getPlatform=T,ye.getUserAgent=p,ye.hidePrivateProperties=R,ye.hidePrivateAndCertainPublicPropertiesInClass=F,ye.isDeepEqual=S,ye.isNonArrayObject=E,ye.inRange=z,ye.makeUUID=M,ye.oncePerTick=k,ye.promiseFromEvents=y,ye.getOrNull=b,ye.defer=f,ye.delegateMethods=w,ye.proxyProperties=q,ye.legacyPromise=C,ye.buildLogLevels=I,ye.trackClass=x,ye.trackPublicationClass=A,ye.valueToJSON=re,ye.withJitter=le,ye.isChromeScreenShareTrack=ke,ye.waitForSometime=se,ye.waitForEvent=me,ye}var He={},fa;function ln(){if(fa)return He;fa=1;var g=je(),m=g.flatMap,_=g.guessBrowser,u=null;function i(){if(typeof u=="boolean")return u;if(typeof RTCPeerConnection>"u")return u=!1,u;try{new RTCPeerConnection({sdpSemantics:"foo"}),u=!1}catch{u=!0}return u}var e=null;function t(){e=null}function r(){if(!e)if(typeof RTCPeerConnection<"u"&&"addTransceiver"in RTCPeerConnection.prototype){var S=new RTCPeerConnection;try{S.addTransceiver("audio"),e="unified"}catch{e="planb"}S.close()}else e="planb";return e}function n(S){return!S||!i()?r():{"plan-b":"planb","unified-plan":"unified"}[S]}function a(){return typeof RTCRtpTransceiver<"u"&&"currentDirection"in RTCRtpTransceiver.prototype?"unified":"planb"}function o(S){return{chrome:n(S),firefox:"unified",safari:a()}[_()]||null}function s(S,E){var q=E.match(new RegExp(S,"gm"))||[];return q.reduce(function(O,C){var I=C.match(new RegExp(S));return I?O.add(I[1]):O},new Set)}function c(S,E){return s(S,E)}function l(S){return c("^a=ssrc:[0-9]+ +msid:.+ +(.+) *$",S)}function d(S){return c("^a=msid:.+ +(.+) *$",S)}function v(S,E){var q="^a=ssrc:([0-9]+) +msid:[^ ]+ +".concat(E," *$");return s(q,S)}function p(S,E,q){return E===void 0&&(E=".*"),q===void 0&&(q=".*"),S.split(`\r
m=`).slice(1).map(function(O){return"m=".concat(O)}).filter(function(O){var C=new RegExp("m=".concat(E),"gm"),I=new RegExp("a=".concat(q),"gm");return C.test(O)&&I.test(O)})}function T(S){return Array.from(s("^a=ssrc:([0-9]+) +.*$",S))}function M(S,E){var q=p(S),O=new RegExp("^a=msid:[^ ]+ +".concat(E," *$"),"gm"),C=q.filter(function(I){return I.match(O)});return new Set(m(C,T))}function k(S,E,q){return new Map(Array.from(S(q)).map(function(O){return[O,E(q,O)]}))}function y(S){return k(l,v,S)}function b(S){return k(d,M,S)}function f(S,E,q){var O=S(q),C=new Map;O.forEach(function(A,R){if(!E.has(R)){E.set(R,A);return}var F=Array.from(E.get(R)),V=Array.from(A);F.forEach(function(U,j){var D=V[j];C.set(D,U);var H="^a=ssrc:".concat(D," (.*)$"),$="a=ssrc:".concat(U," $1");q=q.replace(new RegExp(H,"gm"),$)})});var I="^(a=ssrc-group:[^ ]+ +)(.*)$",x=q.match(new RegExp(I,"gm"))||[];return x.forEach(function(A){var R=A.match(new RegExp(I));if(R){var F=R[1],V=R[2],U=V.split(" ").map(function(j){var D=C.get(j);return D||j}).join(" ");q=q.replace(R[0],F+U)}}),q}function h(S,E){return f(y,S,E)}function w(S,E){return f(b,S,E)}return He.clearChromeCachedSdpFormat=t,He.getSdpFormat=o,He.getMediaSections=p,He.getPlanBTrackIds=l,He.getUnifiedPlanTrackIds=d,He.getPlanBSSRCs=v,He.getUnifiedPlanSSRCs=M,He.updatePlanBTrackIdsToSSRCs=h,He.updateUnifiedPlanTrackIdsToSSRCs=w,He}var yt,pa;function qu(){if(pa)return yt;pa=1;var g=yt&&yt.__values||function(C){var I=typeof Symbol=="function"&&Symbol.iterator,x=I&&C[I],A=0;if(x)return x.call(C);if(C&&typeof C.length=="number")return{next:function(){return C&&A>=C.length&&(C=void 0),{value:C&&C[A++],done:!C}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")},m=yt&&yt.__read||function(C,I){var x=typeof Symbol=="function"&&C[Symbol.iterator];if(!x)return C;var A=x.call(C),R,F=[],V;try{for(;(I===void 0||I-- >0)&&!(R=A.next()).done;)F.push(R.value)}catch(U){V={error:U}}finally{try{R&&!R.done&&(x=A.return)&&x.call(A)}finally{if(V)throw V.error}}return F},_=je(),u=_.flatMap,i=_.guessBrowser,e=_.guessBrowserVersion,t=ln().getSdpFormat,r=i(),n=e(),a=r==="chrome",o=r==="firefox",s=r==="safari",c=a?n.major:null,l=32767;function d(C,I){return typeof C.get=="function"?C.get(I):C.find(function(x){return x.id===I})}function v(C,I,x){var A,R,F,V,U,j,D,H,$,re,Y,Z,ne,ie,be,ce,pe,Te,ge,_e,he,le;x===void 0&&(x=!1);var z;if(Array.isArray(C))z=new Map(C.map(function(Le){return[Le.id||String(Math.random()),Le]}));else if(C instanceof Map)z=C;else if(typeof C=="object"&&C!==null){var ke=new Map;Object.keys(C).forEach(function(Le){ke.set(Le,C[Le])}),z=ke}else return new Map;if(!z||!I)return new Map;var se=new Map,me=I.id,L=I.kind,P=null,N=null,X=null;try{for(var ee=g(z),ae=ee.next();!ae.done;ae=ee.next()){var ue=m(ae.value,2),fe=ue[0],ve=ue[1];if(x&&ve.type==="inbound-rtp"&&ve.trackIdentifier===me){P=ve,N=fe,X=ve.ssrc;break}else if(!x&&ve.type==="media-source"&&ve.trackIdentifier===me){P=ve,N=fe;break}else ve.type==="track"&&ve.trackIdentifier===me&&(P||(P=ve,N=fe))}}catch(Le){A={error:Le}}finally{try{ae&&!ae.done&&(R=ee.return)&&R.call(ee)}finally{if(A)throw A.error}}if(!P)if(x){var Ie=[];try{for(var qe=g(z),te=qe.next();!te.done;te=qe.next()){var K=m(te.value,2),fe=K[0],ve=K[1];ve.type==="inbound-rtp"&&(ve.kind===L||ve.mediaType===L)&&Ie.push({id:fe,stat:ve})}}catch(Le){F={error:Le}}finally{try{te&&!te.done&&(V=qe.return)&&V.call(qe)}finally{if(F)throw F.error}}(Ie.length===1||Ie.length>1)&&(P=Ie[0].stat,N=Ie[0].id,X=P.ssrc)}else try{for(var B=g(z),W=B.next();!W.done;W=B.next()){var G=m(W.value,2),fe=G[0],ve=G[1];if(ve.type==="media-source"&&ve.kind===L){P=ve,N=fe;break}}}catch(Le){U={error:Le}}finally{try{W&&!W.done&&(j=B.return)&&j.call(B)}finally{if(U)throw U.error}}if(!P)return se;se.set(N,P);var Q=new Set;if(x){if(P.codecId&&Q.add(P.codecId),P.transportId&&Q.add(P.transportId),P.remoteId&&Q.add(P.remoteId),X)try{for(var J=g(z),oe=J.next();!oe.done;oe=J.next()){var Se=m(oe.value,2),fe=Se[0],ve=Se[1];ve.type==="remote-outbound-rtp"&&ve.ssrc===X&&Q.add(fe)}}catch(Le){D={error:Le}}finally{try{oe&&!oe.done&&(H=J.return)&&H.call(J)}finally{if(D)throw D.error}}try{for(var Ce=g(Q),xe=Ce.next();!xe.done;xe=Ce.next()){var Pe=xe.value;z.has(Pe)&&se.set(Pe,z.get(Pe))}}catch(Le){$={error:Le}}finally{try{xe&&!xe.done&&(re=Ce.return)&&re.call(Ce)}finally{if($)throw $.error}}try{for(var Re=g(z),we=Re.next();!we.done;we=Re.next()){var Me=m(we.value,2),fe=Me[0],ve=Me[1];ve.type==="track"&&ve.trackIdentifier===me&&se.set(fe,ve)}}catch(Le){Y={error:Le}}finally{try{we&&!we.done&&(Z=Re.return)&&Z.call(Re)}finally{if(Y)throw Y.error}}}else{try{for(var Ve=g(z),Ke=Ve.next();!Ke.done;Ke=Ve.next()){var Xi=m(Ke.value,2),fe=Xi[0],ve=Xi[1];if(ve.type==="outbound-rtp"&&ve.mediaSourceId===N){se.set(fe,ve),ve.codecId&&Q.add(ve.codecId),ve.transportId&&Q.add(ve.transportId);var Eu=fe;try{for(var fn=(be=void 0,g(z)),Nt=fn.next();!Nt.done;Nt=fn.next()){var Zi=m(Nt.value,2),Cu=Zi[0],Rn=Zi[1];Rn.type==="remote-inbound-rtp"&&Rn.localId===Eu&&se.set(Cu,Rn)}}catch(Ou){be={error:Ou}}finally{try{Nt&&!Nt.done&&(ce=fn.return)&&ce.call(fn)}finally{if(be)throw be.error}}}}}catch(Le){ne={error:Le}}finally{try{Ke&&!Ke.done&&(ie=Ve.return)&&ie.call(Ve)}finally{if(ne)throw ne.error}}try{for(var pn=g(Q),qt=pn.next();!qt.done;qt=pn.next()){var Pe=qt.value;z.has(Pe)&&se.set(Pe,z.get(Pe))}}catch(Le){pe={error:Le}}finally{try{qt&&!qt.done&&(Te=pn.return)&&Te.call(pn)}finally{if(pe)throw pe.error}}}var Vt=null,ea=new Set;try{for(var vn=g(se.values()),Ft=vn.next();!Ft.done;Ft=vn.next()){var ve=Ft.value;ve.transportId&&ea.add(ve.transportId)}}catch(Le){ge={error:Le}}finally{try{Ft&&!Ft.done&&(_e=vn.return)&&_e.call(vn)}finally{if(ge)throw ge.error}}try{for(var hn=g(ea),Bt=hn.next();!Bt.done;Bt=hn.next()){var Ln=Bt.value;if(z.has(Ln)){var We=z.get(Ln);se.set(Ln,We),We.selectedCandidatePairId&&(Vt=We.selectedCandidatePairId),We.localCertificateId&&z.has(We.localCertificateId)&&se.set(We.localCertificateId,z.get(We.localCertificateId)),We.remoteCertificateId&&z.has(We.remoteCertificateId)&&se.set(We.remoteCertificateId,z.get(We.remoteCertificateId))}}}catch(Le){he={error:Le}}finally{try{Bt&&!Bt.done&&(le=hn.return)&&le.call(hn)}finally{if(he)throw he.error}}if(Vt&&z.has(Vt)){var Ye=z.get(Vt);se.set(Vt,Ye),Ye.localCandidateId&&z.has(Ye.localCandidateId)&&se.set(Ye.localCandidateId,z.get(Ye.localCandidateId)),Ye.remoteCandidateId&&z.has(Ye.remoteCandidateId)&&se.set(Ye.remoteCandidateId,z.get(Ye.remoteCandidateId))}return se}function p(C,I){return C&&typeof C.getStats=="function"?T(C,I):Promise.reject(new Error("Given PeerConnection does not support getStats"))}function T(C,I){var x=b(C,"audio","local"),A=b(C,"video","local"),R=b(C,"audio"),F=b(C,"video"),V={activeIceCandidatePair:null,localAudioTrackStats:[],localVideoTrackStats:[],remoteAudioTrackStats:[],remoteVideoTrackStats:[]},U=u([[x,"localAudioTrackStats",!1],[A,"localVideoTrackStats",!1],[R,"remoteAudioTrackStats",!0],[F,"remoteVideoTrackStats",!0]],function(j){var D=m(j,3),H=D[0],$=D[1],re=D[2];return H.map(function(Y){return h(C,Y,Object.assign({isRemote:re},I)).then(function(Z){Z.forEach(function(ne){ne.trackId=Y.id,V[$].push(ne)})})})});return Promise.all(U).then(function(){return M(C,I)}).then(function(j){return V.activeIceCandidatePair=j,V})}function M(C,I){return I===void 0&&(I={}),typeof I.testForChrome<"u"||a||typeof I.testForSafari<"u"||s?C.getStats().then(k):typeof I.testForFirefox<"u"||o?C.getStats().then(y):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}function k(C){var I=Array.from(C.values()).find(function(j){var D=j.nominated,H=j.type;return H==="candidate-pair"&&D});if(!I)return null;var x=d(C,I.localCandidateId),A=d(C,I.remoteCandidateId),R=[{key:"candidateType",type:"string"},{key:"ip",type:"string"},{key:"port",type:"number"},{key:"priority",type:"number"},{key:"protocol",type:"string"},{key:"url",type:"string"}],F=R.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"},{key:"networkType",type:"string"}]),V=x?F.reduce(function(j,D){var H=D.key,$=D.type;return j[H]=typeof x[H]===$?x[H]:H==="deleted"?!1:null,j},{}):null,U=A?R.reduce(function(j,D){var H=D.key,$=D.type;return j[H]=typeof A[H]===$?A[H]:null,j},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string",fixup:function(j){return j==="inprogress"?"in-progress":j}},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(j,D){var H=D.key,$=D.type,re=D.fixup;return j[H]=typeof I[H]===$?re?re(I[H]):I[H]:null,j},{localCandidate:V,remoteCandidate:U})}function y(C){var I=Array.from(C.values()).find(function(D){var H=D.nominated,$=D.type;return $==="candidate-pair"&&H});if(!I)return null;var x=d(C,I.localCandidateId),A=d(C,I.remoteCandidateId),R=[{key:"candidateType",type:"string"},{key:"ip",ffKeys:["address","ipAddress"],type:"string"},{key:"port",ffKeys:["portNumber"],type:"number"},{key:"priority",type:"number"},{key:"protocol",ffKeys:["transport"],type:"string"},{key:"url",type:"string"}],F=R.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),V={host:"host",peerreflexive:"prflx",relayed:"relay",serverreflexive:"srflx"},U=x?F.reduce(function(D,H){var $=H.ffKeys,re=H.key,Y=H.type,Z=$&&$.find(function(ne){return ne in x})||re;return D[re]=typeof x[Z]===Y?Z==="candidateType"&&V[x[Z]]||x[Z]:Z==="deleted"?!1:null,D},{}):null,j=A?R.reduce(function(D,H){var $=H.ffKeys,re=H.key,Y=H.type,Z=$&&$.find(function(ne){return ne in A})||re;return D[re]=typeof A[Z]===Y?Z==="candidateType"&&V[A[Z]]||A[Z]:null,D},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string"},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(D,H){var $=H.key,re=H.type;return D[$]=typeof I[$]===re?I[$]:null,D},{localCandidate:U,remoteCandidate:j})}function b(C,I,x){var A=x==="local"?"getSenders":"getReceivers";if(C[A])return C[A]().map(function(V){var U=V.track;return U}).filter(function(V){return V&&V.kind===I});var R=x==="local"?"getLocalStreams":"getRemoteStreams",F=I==="audio"?"getAudioTracks":"getVideoTracks";return u(C[R](),function(V){return V[F]()})}function f(C,I){var x,A,R,F,V,U;if(!C||!I)return!1;if(C.getReceivers){var j=C.getReceivers();try{for(var D=g(j),H=D.next();!H.done;H=D.next()){var $=H.value;if($.track&&$.track.id===I.id)return!0}}catch(Te){x={error:Te}}finally{try{H&&!H.done&&(A=D.return)&&A.call(D)}finally{if(x)throw x.error}}}if(C.getRemoteStreams){var re=C.getRemoteStreams();try{for(var Y=g(re),Z=Y.next();!Z.done;Z=Y.next()){var ne=Z.value,ie=ne.getTracks();try{for(var be=(V=void 0,g(ie)),ce=be.next();!ce.done;ce=be.next()){var pe=ce.value;if(pe.id===I.id)return!0}}catch(Te){V={error:Te}}finally{try{ce&&!ce.done&&(U=be.return)&&U.call(be)}finally{if(V)throw V.error}}}}catch(Te){R={error:Te}}finally{try{Z&&!Z.done&&(F=Y.return)&&F.call(Y)}finally{if(R)throw R.error}}}return!1}function h(C,I,x){return x===void 0&&(x={}),typeof x.testForChrome<"u"||a?w(C,I,x):typeof x.testForFirefox<"u"||o?S(C,I,x):typeof x.testForSafari<"u"||s?typeof x.testForSafari<"u"||t()==="unified"?w(C,I,x):Promise.reject(new Error(["getStats() is not supported on this version of Safari","due to this bug: https://bugs.webkit.org/show_bug.cgi?id=192601"].join(" "))):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}function w(C,I,x){var A=x.log;return c&&c<67?new Promise(function(R,F){C.getStats(function(V){R([E(V,I)])},null,F)}):C.getStats(I).then(function(R){return A.info("getStats by track successful"),q(R,x)}).catch(function(){return A.warn("getStats by track failed. Getting default stats"),C.getStats().then(function(R){A.info("getStats by default successful");var F=f(C,I);A.info("Starting filtering stats for ".concat(F?"remote":"local"," track"));var V=v(R,I,F);return A.info("Completed filtering stats for ".concat(F?"remote":"local"," track")),q(V,x)})})}function S(C,I,x){return C.getStats(I).then(function(A){return[O(A,x)]})}function E(C,I){var x=C.result().find(function(R){return R.type==="ssrc"&&R.stat("googTrackId")===I.id}),A={};return x&&(A.timestamp=Math.round(Number(x.timestamp)),A=x.names().reduce(function(R,F){switch(F){case"googCodecName":R.codecName=x.stat(F);break;case"googRtt":R.roundTripTime=Number(x.stat(F));break;case"googJitterReceived":R.jitter=Number(x.stat(F));break;case"googFrameWidthInput":R.frameWidthInput=Number(x.stat(F));break;case"googFrameHeightInput":R.frameHeightInput=Number(x.stat(F));break;case"googFrameWidthSent":R.frameWidthSent=Number(x.stat(F));break;case"googFrameHeightSent":R.frameHeightSent=Number(x.stat(F));break;case"googFrameWidthReceived":R.frameWidthReceived=Number(x.stat(F));break;case"googFrameHeightReceived":R.frameHeightReceived=Number(x.stat(F));break;case"googFrameRateInput":R.frameRateInput=Number(x.stat(F));break;case"googFrameRateSent":R.frameRateSent=Number(x.stat(F));break;case"googFrameRateReceived":R.frameRateReceived=Number(x.stat(F));break;case"ssrc":R[F]=x.stat(F);break;case"bytesReceived":case"bytesSent":case"packetsLost":case"packetsReceived":case"packetsSent":case"audioInputLevel":case"audioOutputLevel":R[F]=Number(x.stat(F));break}return R},A)),A}function q(C,I){var x=I.simulateExceptionWhileStandardizingStats,A=x===void 0?!1:x;if(A)throw new Error("Error while gathering stats");var R=null,F=[],V=null,U=null,j=null,D=null,H=null;C.forEach(function(ne){var ie=ne.type;switch(ie){case"inbound-rtp":R=ne;break;case"outbound-rtp":F.push(ne);break;case"media-source":H=ne;break;case"track":j=ne;break;case"codec":D=ne;break;case"remote-inbound-rtp":V=ne;break;case"remote-outbound-rtp":U=ne;break}});var $=j?j.remoteSource:!H,re=$?[R]:F,Y=[],Z=$?U:V;return re.forEach(function(ne){var ie={},be=[ne,H,j,D,Z&&Z.ssrc===ne.ssrc?Z:null];function ce(W){var G=be.find(function(Q){return Q&&typeof Q[W]<"u"})||null;return G?G[W]:null}var pe=ce("ssrc");typeof pe=="number"&&(ie.ssrc=String(pe));var Te=ce("timestamp");ie.timestamp=Math.round(Te);var ge=ce("mimeType");typeof ge=="string"&&(ge=ge.split("/"),ie.codecName=ge[ge.length-1]);var _e=ce("roundTripTime");typeof _e=="number"&&(ie.roundTripTime=Math.round(_e*1e3));var he=ce("jitter");typeof he=="number"&&(ie.jitter=Math.round(he*1e3));var le=ce("frameWidth");typeof le=="number"&&($?ie.frameWidthReceived=le:(ie.frameWidthSent=le,ie.frameWidthInput=j?j.frameWidth:H.width));var z=ce("frameHeight");typeof z=="number"&&($?ie.frameHeightReceived=z:(ie.frameHeightSent=z,ie.frameHeightInput=j?j.frameHeight:H.height));var ke=ce("framesPerSecond");(typeof ke=="number"||ke===null)&&(ie[$?"frameRateReceived":"frameRateSent"]=ke);var se=ce("qualityLimitationReason");typeof se=="string"&&(ie.qualityLimitationReason=se);var me=ce("bytesReceived");typeof me=="number"&&(ie.bytesReceived=me);var L=ce("bytesSent");typeof L=="number"&&(ie.bytesSent=L);var P=ce("packetsLost");typeof P=="number"&&(ie.packetsLost=P);var N=ce("packetsReceived");typeof N=="number"&&(ie.packetsReceived=N);var X=ce("packetsSent");typeof X=="number"&&(ie.packetsSent=X);var ee=ce("audioLevel");typeof ee=="number"&&(ee=Math.round(ee*l),$?ie.audioOutputLevel=ee:ie.audioInputLevel=ee);var ae=ce("totalPacketSendDelay");typeof ae=="number"&&(ie.totalPacketSendDelay=ae);var ue=ce("totalEncodeTime");typeof ue=="number"&&(ie.totalEncodeTime=ue);var fe=ce("framesEncoded");typeof fe=="number"&&(ie.framesEncoded=fe);var ve=ce("estimatedPlayoutTimestamp");typeof ve=="number"&&(ie.estimatedPlayoutTimestamp=ve);var Ie=ce("totalDecodeTime");typeof Ie=="number"&&(ie.totalDecodeTime=Ie);var qe=ce("framesDecoded");typeof qe=="number"&&(ie.framesDecoded=qe);var te=ce("jitterBufferDelay");typeof te=="number"&&(ie.jitterBufferDelay=te);var K=ce("jitterBufferEmittedCount");typeof K=="number"&&(ie.jitterBufferEmittedCount=K);var B=ce("freezeCount");typeof B=="number"&&(ie.freezeCount=B),Y.push(ie)}),Y}function O(C,I){C===void 0&&(C=new Map);var x=I.isRemote,A=I.simulateExceptionWhileStandardizingStats,R=A===void 0?!1:A;if(R)throw new Error("Error while gathering stats");var F=null,V=null;C.forEach(function(N){var X=N.isRemote,ee=N.remoteId,ae=N.type;if(!X)switch(ae){case"inbound-rtp":F=N,V=d(C,ee);break;case"outbound-rtp":V=N,F=d(C,ee);break}});var U=x?F:V,j=x?V:F;function D(N){return U&&typeof U[N]<"u"?U[N]:j&&typeof j[N]<"u"?j[N]:null}var H={},$=D("timestamp");H.timestamp=Math.round($);var re=D("ssrc");typeof re=="number"&&(H.ssrc=String(re));var Y=D("bytesSent");typeof Y=="number"&&(H.bytesSent=Y);var Z=D("packetsLost");typeof Z=="number"&&(H.packetsLost=Z);var ne=D("packetsSent");typeof ne=="number"&&(H.packetsSent=ne);var ie=D("roundTripTime");typeof ie=="number"&&(H.roundTripTime=Math.round(ie*1e3));var be=D("jitter");typeof be=="number"&&(H.jitter=Math.round(be*1e3));var ce=D("framesPerSecond");(typeof ce=="number"||ce===null)&&(H.frameRateSent=ce);var pe=D("bytesReceived");typeof pe=="number"&&(H.bytesReceived=pe);var Te=D("packetsReceived");typeof Te=="number"&&(H.packetsReceived=Te);var ge=D("framesPerSecond");(typeof ge=="number"||ge===null)&&(H.frameRateReceived=ge);var _e=D("totalPacketSendDelay");typeof _e=="number"&&(H.totalPacketSendDelay=_e);var he=D("totalEncodeTime");typeof he=="number"&&(H.totalEncodeTime=he);var le=D("framesEncoded");typeof le=="number"&&(H.framesEncoded=le);var z=D("estimatedPlayoutTimestamp");typeof z=="number"&&(H.estimatedPlayoutTimestamp=z);var ke=D("totalDecodeTime");typeof ke=="number"&&(H.totalDecodeTime=ke);var se=D("framesDecoded");typeof se=="number"&&(H.framesDecoded=se);var me=D("jitterBufferDelay");typeof me=="number"&&(H.jitterBufferDelay=me);var L=D("jitterBufferEmittedCount");typeof L=="number"&&(H.jitterBufferEmittedCount=L);var P=D("freezeCount");return typeof P=="number"&&(H.freezeCount=P),H}return yt=p,yt}var In,va;function Vu(){if(va)return In;va=1;function g(m){return m===void 0&&(m={audio:!0,video:!0}),typeof navigator=="object"&&typeof navigator.mediaDevices=="object"&&typeof navigator.mediaDevices.getUserMedia=="function"?navigator.mediaDevices.getUserMedia(m):Promise.reject(new Error("getUserMedia is not supported"))}return In=g,In}var mn={exports:{}},ha;function Ns(){return ha||(ha=1,typeof MediaStream=="function"?mn.exports=MediaStream:mn.exports=function(){throw new Error("MediaStream is not supported")}),mn.exports}var yn={exports:{}},_a;function Fu(){return _a||(_a=1,typeof MediaStreamTrack=="function"?yn.exports=MediaStreamTrack:yn.exports=function(){throw new Error("MediaStreamTrack is not supported")}),yn.exports}var gn={exports:{}},ma;function Bu(){return ma||(ma=1,typeof RTCIceCandidate=="function"?gn.exports=RTCIceCandidate:gn.exports=function(){throw new Error("RTCIceCandidate is not supported")}),gn.exports}var gt={exports:{}},Dn,ya;function qs(){if(ya)return Dn;ya=1;var g=(function(){function m(_){this.descriptionInitDict=_;var u=_&&_.type==="rollback"?null:new RTCSessionDescription(_);Object.defineProperties(this,{_description:{get:function(){return u}}})}return Object.defineProperty(m.prototype,"sdp",{get:function(){return this._description?this._description.sdp:this.descriptionInitDict.sdp},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"type",{get:function(){return this._description?this._description.type:this.descriptionInitDict.type},enumerable:!1,configurable:!0}),m})();return Dn=g,Dn}var bn={exports:{}},ga;function Ne(){if(ga)return bn.exports;ga=1;var g=typeof Reflect=="object"?Reflect:null,m=g&&typeof g.apply=="function"?g.apply:function(b,f,h){return Function.prototype.apply.call(b,f,h)},_;g&&typeof g.ownKeys=="function"?_=g.ownKeys:Object.getOwnPropertySymbols?_=function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:_=function(b){return Object.getOwnPropertyNames(b)};function u(y){console&&console.warn&&console.warn(y)}var i=Number.isNaN||function(b){return b!==b};function e(){e.init.call(this)}bn.exports=e,bn.exports.once=T,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._eventsCount=0,e.prototype._maxListeners=void 0;var t=10;function r(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}Object.defineProperty(e,"defaultMaxListeners",{enumerable:!0,get:function(){return t},set:function(y){if(typeof y!="number"||y<0||i(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");t=y}}),e.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},e.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||i(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this};function n(y){return y._maxListeners===void 0?e.defaultMaxListeners:y._maxListeners}e.prototype.getMaxListeners=function(){return n(this)},e.prototype.emit=function(b){for(var f=[],h=1;h<arguments.length;h++)f.push(arguments[h]);var w=b==="error",S=this._events;if(S!==void 0)w=w&&S.error===void 0;else if(!w)return!1;if(w){var E;if(f.length>0&&(E=f[0]),E instanceof Error)throw E;var q=new Error("Unhandled error."+(E?" ("+E.message+")":""));throw q.context=E,q}var O=S[b];if(O===void 0)return!1;if(typeof O=="function")m(O,this,f);else for(var C=O.length,I=d(O,C),h=0;h<C;++h)m(I[h],this,f);return!0};function a(y,b,f,h){var w,S,E;if(r(f),S=y._events,S===void 0?(S=y._events=Object.create(null),y._eventsCount=0):(S.newListener!==void 0&&(y.emit("newListener",b,f.listener?f.listener:f),S=y._events),E=S[b]),E===void 0)E=S[b]=f,++y._eventsCount;else if(typeof E=="function"?E=S[b]=h?[f,E]:[E,f]:h?E.unshift(f):E.push(f),w=n(y),w>0&&E.length>w&&!E.warned){E.warned=!0;var q=new Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");q.name="MaxListenersExceededWarning",q.emitter=y,q.type=b,q.count=E.length,u(q)}return y}e.prototype.addListener=function(b,f){return a(this,b,f,!1)},e.prototype.on=e.prototype.addListener,e.prototype.prependListener=function(b,f){return a(this,b,f,!0)};function o(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function s(y,b,f){var h={fired:!1,wrapFn:void 0,target:y,type:b,listener:f},w=o.bind(h);return w.listener=f,h.wrapFn=w,w}e.prototype.once=function(b,f){return r(f),this.on(b,s(this,b,f)),this},e.prototype.prependOnceListener=function(b,f){return r(f),this.prependListener(b,s(this,b,f)),this},e.prototype.removeListener=function(b,f){var h,w,S,E,q;if(r(f),w=this._events,w===void 0)return this;if(h=w[b],h===void 0)return this;if(h===f||h.listener===f)--this._eventsCount===0?this._events=Object.create(null):(delete w[b],w.removeListener&&this.emit("removeListener",b,h.listener||f));else if(typeof h!="function"){for(S=-1,E=h.length-1;E>=0;E--)if(h[E]===f||h[E].listener===f){q=h[E].listener,S=E;break}if(S<0)return this;S===0?h.shift():v(h,S),h.length===1&&(w[b]=h[0]),w.removeListener!==void 0&&this.emit("removeListener",b,q||f)}return this},e.prototype.off=e.prototype.removeListener,e.prototype.removeAllListeners=function(b){var f,h,w;if(h=this._events,h===void 0)return this;if(h.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):h[b]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete h[b]),this;if(arguments.length===0){var S=Object.keys(h),E;for(w=0;w<S.length;++w)E=S[w],E!=="removeListener"&&this.removeAllListeners(E);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(f=h[b],typeof f=="function")this.removeListener(b,f);else if(f!==void 0)for(w=f.length-1;w>=0;w--)this.removeListener(b,f[w]);return this};function c(y,b,f){var h=y._events;if(h===void 0)return[];var w=h[b];return w===void 0?[]:typeof w=="function"?f?[w.listener||w]:[w]:f?p(w):d(w,w.length)}e.prototype.listeners=function(b){return c(this,b,!0)},e.prototype.rawListeners=function(b){return c(this,b,!1)},e.listenerCount=function(y,b){return typeof y.listenerCount=="function"?y.listenerCount(b):l.call(y,b)},e.prototype.listenerCount=l;function l(y){var b=this._events;if(b!==void 0){var f=b[y];if(typeof f=="function")return 1;if(f!==void 0)return f.length}return 0}e.prototype.eventNames=function(){return this._eventsCount>0?_(this._events):[]};function d(y,b){for(var f=new Array(b),h=0;h<b;++h)f[h]=y[h];return f}function v(y,b){for(;b+1<y.length;b++)y[b]=y[b+1];y.pop()}function p(y){for(var b=new Array(y.length),f=0;f<b.length;++f)b[f]=y[f].listener||y[f];return b}function T(y,b){return new Promise(function(f,h){function w(E){y.removeListener(b,S),h(E)}function S(){typeof y.removeListener=="function"&&y.removeListener("error",w),f([].slice.call(arguments))}k(y,b,S,{once:!0}),b!=="error"&&M(y,w,{once:!0})})}function M(y,b,f){typeof y.on=="function"&&k(y,"error",b,f)}function k(y,b,f,h){if(typeof y.on=="function")h.once?y.once(b,f):y.on(b,f);else if(typeof y.addEventListener=="function")y.addEventListener(b,function w(S){h.once&&y.removeEventListener(b,w),f(S)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y)}return bn.exports}var bt,ba;function Hi(){if(ba)return bt;ba=1;var g=bt&&bt.__read||function(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var r=t.call(i),n,a=[],o;try{for(;(e===void 0||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return a},m=bt&&bt.__spreadArray||function(i,e,t){if(t||arguments.length===2)for(var r=0,n=e.length,a;r<n;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return i.concat(a||Array.prototype.slice.call(e))},_=Ne().EventEmitter,u=(function(){function i(){Object.defineProperties(this,{_eventEmitter:{value:new _}})}return i.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},i.prototype.addEventListener=function(){var e;return(e=this._eventEmitter).addListener.apply(e,m([],g(arguments),!1))},i.prototype.removeEventListener=function(){var e;return(e=this._eventEmitter).removeListener.apply(e,m([],g(arguments),!1))},i})();return bt=u,bt}var jn,wa;function Vs(){if(wa)return jn;wa=1;var g=je().defer,m={high:new Set(["low"]),low:new Set(["high"])},_=(function(){function i(e){e===void 0&&(e="low");var t=e;Object.defineProperties(this,{_state:{set:function(r){var n=this;if(t!==r){t=r;var a=this._whenDeferreds.get(t);a.forEach(function(o){return o.resolve(n)}),a.clear()}},get:function(){return t}},_whenDeferreds:{value:new Map([["high",new Set],["low",new Set]])}})}return Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),i.prototype.lower=function(){return this.transition("low")},i.prototype.raise=function(){return this.transition("high")},i.prototype.transition=function(e){if(!m[this.state].has(e))throw u(this.state,e);return this._state=e,this},i.prototype.when=function(e){if(this.state===e)return Promise.resolve(this);if(!m[this.state].has(e))return Promise.reject(u(this.state,e));var t=g();return this._whenDeferreds.get(e).add(t),t.promise},i})();function u(i,e){return new Error('Cannot transition from "'.concat(i,'" to "').concat(e,'"'))}return jn=_,jn}var Nn,ka;function Uu(){if(ka)return Nn;ka=1;var g=(function(){function m(_){Object.defineProperties(this,{track:{enumerable:!0,value:_,writable:!0}})}return m})();return Nn=g,Nn}var Je,Sa;function Wu(){if(Sa)return Je;Sa=1;var g=Je&&Je.__extends||(function(){var O=function(C,I){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,A){x.__proto__=A}||function(x,A){for(var R in A)Object.prototype.hasOwnProperty.call(A,R)&&(x[R]=A[R])},O(C,I)};return function(C,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");O(C,I);function x(){this.constructor=C}C.prototype=I===null?Object.create(I):(x.prototype=I.prototype,new x)}})(),m=Je&&Je.__read||function(O,C){var I=typeof Symbol=="function"&&O[Symbol.iterator];if(!I)return O;var x=I.call(O),A,R=[],F;try{for(;(C===void 0||C-- >0)&&!(A=x.next()).done;)R.push(A.value)}catch(V){F={error:V}}finally{try{A&&!A.done&&(I=x.return)&&I.call(x)}finally{if(F)throw F.error}}return R},_=Je&&Je.__spreadArray||function(O,C,I){if(I||arguments.length===2)for(var x=0,A=C.length,R;x<A;x++)(R||!(x in C))&&(R||(R=Array.prototype.slice.call(C,0,x)),R[x]=C[x]);return O.concat(R||Array.prototype.slice.call(C))},u=qs(),i=Hi(),e=Vs(),t=Ns(),r=Uu(),n=ln(),a=n.getSdpFormat,o=n.updatePlanBTrackIdsToSSRCs,s=n.updateUnifiedPlanTrackIdsToSSRCs,c=je(),l=c.delegateMethods,d=c.interceptEvent,v=c.isIOSChrome,p=c.legacyPromise,T=c.proxyProperties,M=a()==="unified",k=(function(O){g(C,O);function C(I,x){I===void 0&&(I={}),x===void 0&&(x={});var A=O.call(this)||this,R=x.chromeSpecificConstraints,F=Object.assign(I.iceTransportPolicy?{iceTransports:I.iceTransportPolicy}:{},I);d(A,"datachannel"),d(A,"signalingstatechange");var V=a(F.sdpSemantics),U=new RTCPeerConnection(F,R);return Object.defineProperties(A,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_applyCodecPreferences:{value:x.applyCodecPreferences||(function(){})},_audioTransceiver:{value:null,writable:!0},_localStream:{value:new t},_peerConnection:{value:U},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_sdpFormat:{value:V},_senders:{value:new Map},_signalingStateLatch:{value:new e},_tracksToSSRCs:{value:new Map,writable:!0},_videoTransceiver:{value:null,writable:!0}}),U.addEventListener("datachannel",function(j){E(j.channel),A.dispatchEvent(j)}),U.addEventListener("signalingstatechange",function(){for(var j=[],D=0;D<arguments.length;D++)j[D]=arguments[D];U.signalingState==="stable"&&(A._appliedTracksToSSRCs=new Map(A._tracksToSSRCs)),!A._pendingLocalOffer&&!A._pendingRemoteOffer&&A.dispatchEvent.apply(A,_([],m(j),!1))}),U.ontrack=function(){},typeof U.addTrack!="function"&&U.addStream(A._localStream),T(RTCPeerConnection.prototype,A,U),A}return Object.defineProperty(C.prototype,"localDescription",{get:function(){return this._pendingLocalOffer?this._pendingLocalOffer:this._peerConnection.localDescription},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"remoteDescription",{get:function(){return this._pendingRemoteOffer?this._pendingRemoteOffer:this._peerConnection.remoteDescription},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"signalingState",{get:function(){return this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),C.prototype.addTrack=function(I){for(var x,A=[],R=1;R<arguments.length;R++)A[R-1]=arguments[R];if(typeof this._peerConnection.addTrack=="function")return(x=this._peerConnection).addTrack.apply(x,_([I],m(A),!1));if(this._peerConnection.signalingState==="closed")throw new Error("Cannot add MediaStreamTrack [".concat(I.id,`, 
        `).concat(I.kind,"]: RTCPeerConnection is closed"));var F=this._senders.get(I);if(F&&F.track)throw new Error("Cannot add MediaStreamTrack ['".concat(I.id,`, 
        `).concat(I.kind,"]: RTCPeerConnection already has it"));return this._peerConnection.removeStream(this._localStream),this._localStream.addTrack(I),this._peerConnection.addStream(this._localStream),F=new r(I),this._senders.set(I,F),F},C.prototype.removeTrack=function(I){if(this._peerConnection.signalingState==="closed")throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");if(typeof this._peerConnection.addTrack=="function")try{return this._peerConnection.removeTrack(I)}catch{}else{var x=I.track;if(!x)return;I=this._senders.get(x),I&&I.track&&(I.track=null,this._peerConnection.removeStream(this._localStream),this._localStream.removeTrack(x),this._peerConnection.addStream(this._localStream))}},C.prototype.getSenders=function(){return typeof this._peerConnection.addTrack=="function"?this._peerConnection.getSenders():Array.from(this._senders.values())},C.prototype.addIceCandidate=function(I){for(var x=this,A=[],R=1;R<arguments.length;R++)A[R-1]=arguments[R];var F;return this.signalingState==="have-remote-offer"?F=this._signalingStateLatch.when("low").then(function(){return x._peerConnection.addIceCandidate(I)}):F=this._peerConnection.addIceCandidate(I),A.length>0?p.apply(void 0,_([F],m(A),!1)):F},C.prototype.close=function(){this.signalingState!=="closed"&&(this._pendingLocalOffer=null,this._pendingRemoteOffer=null,this._peerConnection.close())},C.prototype.createAnswer=function(){for(var I=this,x=[],A=0;A<arguments.length;A++)x[A]=arguments[A];var R;return this._pendingRemoteOffer?R=this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return I._signalingStateLatch.lower(),I._peerConnection.createAnswer()}).then(function(F){return I._pendingRemoteOffer=null,I._rolledBackTracksToSSRCs.clear(),new u({type:"answer",sdp:q(I._sdpFormat,I._tracksToSSRCs,F.sdp)})},function(F){throw I._pendingRemoteOffer=null,F}):R=this._peerConnection.createAnswer().then(function(F){return I._rolledBackTracksToSSRCs.clear(),new u({type:"answer",sdp:q(I._sdpFormat,I._tracksToSSRCs,F.sdp)})}),x.length>1?p.apply(void 0,_([R],m(x),!1)):R},C.prototype.createOffer=function(){for(var I=this,x=[],A=0;A<arguments.length;A++)x[A]=arguments[A];var R=m(x,3),F=R[0],V=R[1],U=R[2],j=U||F||{};if(v()){if(j.offerToReceiveVideo&&!this._audioTransceiver&&!(M&&f(this,"audio"))){delete j.offerToReceiveAudio;try{this._audioTransceiver=M?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio"),this._applyCodecPreferences(this._audioTransceiver)}catch(H){return Promise.reject(H)}}if(j.offerToReceiveVideo&&!this._videoTransceiver&&!(M&&f(this,"video"))){delete j.offerToReceiveVideo;try{this._videoTransceiver=M?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video"),this._applyCodecPreferences(this._videoTransceiver)}catch(H){return Promise.reject(H)}}}var D=this._peerConnection.createOffer(j).then(function(H){return I._rolledBackTracksToSSRCs.clear(),new u({type:H.type,sdp:q(I._sdpFormat,I._tracksToSSRCs,H.sdp)})});return x.length>1?p(D,F,V):D},C.prototype.createDataChannel=function(I,x){x=S(x);var A=this._peerConnection.createDataChannel(I,x);return E(A),A},C.prototype.setLocalDescription=function(){for(var I=[],x=0;x<arguments.length;x++)I[x]=arguments[x];var A=m(I,3),R=A[0],F=A[1],V=A[2];this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear());var U=y(this,!0,R);return I.length>1?p(U,F,V):U},C.prototype.setRemoteDescription=function(){for(var I=[],x=0;x<arguments.length;x++)I[x]=arguments[x];var A=m(I,3),R=A[0],F=A[1],V=A[2];this._rolledBackTracksToSSRCs.clear();var U=y(this,!1,R);return I.length>1?p(U,F,V):U},C})(i);l(RTCPeerConnection.prototype,k.prototype,"_peerConnection");function y(O,C,I){function x(H){C?O._pendingLocalOffer=H:O._pendingRemoteOffer=H}function A(){C?O._pendingLocalOffer=null:O._pendingRemoteOffer=null}var R=C?O._pendingLocalOffer:O._pendingRemoteOffer,F=C?O._pendingRemoteOffer:O._pendingLocalOffer,V=C?"have-local-offer":"have-remote-offer",U=C?"setLocalDescription":"setRemoteDescription",j;if(!C&&F&&I.type==="answer")j=b(O,I);else if(I.type==="offer"){if(O.signalingState!==V&&O.signalingState!=="stable")return Promise.reject(new Error("Cannot set ".concat(C?"local":"remote"," offer in state ").concat(O.signalingState)));!R&&O._signalingStateLatch.state==="low"&&O._signalingStateLatch.raise();var D=O.signalingState;x(h(I)),j=Promise.resolve(),O.signalingState!==D&&j.then(function(){return O.dispatchEvent(new Event("signalingstatechange"))})}else I.type==="rollback"&&(O.signalingState!==V?j=Promise.reject(new Error("Cannot rollback ".concat(C?"local":"remote"," description in ").concat(O.signalingState))):(A(),O._rolledBackTracksToSSRCs=new Map(O._tracksToSSRCs),O._tracksToSSRCs=new Map(O._appliedTracksToSSRCs),j=Promise.resolve(),j.then(function(){return O.dispatchEvent(new Event("signalingstatechange"))})));return j||O._peerConnection[U](h(I))}function b(O,C){var I=O._pendingLocalOffer;return O._peerConnection.setLocalDescription(I).then(function(){return O._pendingLocalOffer=null,O.setRemoteDescription(C)}).then(function(){O._signalingStateLatch.lower()})}function f(O,C){return!!O.getTransceivers().find(function(I){var x=I.receiver,A=x===void 0?{}:x,R=A.track,F=R===void 0?{}:R;return F.kind===C})}function h(O){return O instanceof u&&O._description?O._description:new RTCSessionDescription(O)}function w(){return"maxRetransmitTime"in RTCDataChannel.prototype&&!("maxPacketLifeTime"in RTCDataChannel.prototype)}function S(O){return O=Object.assign({},O),w()&&"maxPacketLifeTime"in O&&(O.maxRetransmitTime=O.maxPacketLifeTime),O}function E(O){return Object.defineProperty(O,"maxRetransmits",{value:O.maxRetransmits===65535?null:O.maxRetransmits}),w()&&Object.defineProperty(O,"maxPacketLifeTime",{value:O.maxRetransmitTime===65535?null:O.maxRetransmitTime}),O}function q(O,C,I){return O==="unified"?s(C,I):o(C,I)}return Je=k,Je}var qn,Ta;function Fs(){return Ta||(Ta=1,qn=RTCSessionDescription),qn}var Xe,Pa;function Hu(){if(Pa)return Xe;Pa=1;var g=Xe&&Xe.__extends||(function(){var v=function(p,T){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,k){M.__proto__=k}||function(M,k){for(var y in k)Object.prototype.hasOwnProperty.call(k,y)&&(M[y]=k[y])},v(p,T)};return function(p,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");v(p,T);function M(){this.constructor=p}p.prototype=T===null?Object.create(T):(M.prototype=T.prototype,new M)}})(),m=Xe&&Xe.__read||function(v,p){var T=typeof Symbol=="function"&&v[Symbol.iterator];if(!T)return v;var M=T.call(v),k,y=[],b;try{for(;(p===void 0||p-- >0)&&!(k=M.next()).done;)y.push(k.value)}catch(f){b={error:f}}finally{try{k&&!k.done&&(T=M.return)&&T.call(M)}finally{if(b)throw b.error}}return y},_=Xe&&Xe.__spreadArray||function(v,p,T){if(T||arguments.length===2)for(var M=0,k=p.length,y;M<k;M++)(y||!(M in p))&&(y||(y=Array.prototype.slice.call(p,0,M)),y[M]=p[M]);return v.concat(y||Array.prototype.slice.call(p))},u=Hi(),i=Fs(),e=ln().updateUnifiedPlanTrackIdsToSSRCs,t=je(),r=t.delegateMethods,n=t.interceptEvent,a=t.legacyPromise,o=t.proxyProperties,s=(function(v){g(p,v);function p(T){var M=v.call(this)||this;n(M,"signalingstatechange");var k=new RTCPeerConnection(T);Object.defineProperties(M,{_initiallyNegotiatedDtlsRole:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:k},_rollingBack:{value:!1,writable:!0},_tracksToSSRCs:{value:new Map},peerIdentity:{enumerable:!0,value:Promise.resolve({idp:"",name:""})}});var y;return k.addEventListener("signalingstatechange",function(){for(var b=[],f=0;f<arguments.length;f++)b[f]=arguments[f];!M._rollingBack&&M.signalingState!==y&&(y=M.signalingState,M._isClosed?setTimeout(function(){return M.dispatchEvent.apply(M,_([],m(b),!1))}):M.dispatchEvent.apply(M,_([],m(b),!1)))}),o(RTCPeerConnection.prototype,M,k),M}return Object.defineProperty(p.prototype,"iceGatheringState",{get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"localDescription",{get:function(){return d(this._peerConnection.localDescription,this._initiallyNegotiatedDtlsRole)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"signalingState",{get:function(){return this._isClosed?"closed":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),p.prototype.createAnswer=function(){for(var T=this,M=[],k=0;k<arguments.length;k++)M[k]=arguments[k];var y;return y=this._peerConnection.createAnswer().then(function(b){return l(T,b),d(b,T._initiallyNegotiatedDtlsRole)}),typeof M[0]=="function"?a.apply(void 0,_([y],m(M),!1)):y},p.prototype.createOffer=function(){for(var T=this,M=[],k=0;k<arguments.length;k++)M[k]=arguments[k];var y=m(M,3),b=y[0],f=y[1],h=y[2],w=h||b||{},S;if(this.signalingState==="have-local-offer"||this.signalingState==="have-remote-offer"){var E=this.signalingState==="have-local-offer";S=c(this,E,function(){return T.createOffer(w)})}else S=this._peerConnection.createOffer(w);return S=S.then(function(q){return new i({type:q.type,sdp:e(T._tracksToSSRCs,q.sdp)})}),M.length>1?a(S,b,f):S},p.prototype.setLocalDescription=function(){for(var T,M=[],k=0;k<arguments.length;k++)M[k]=arguments[k];var y=m(M),b=y[0],f=y.slice(1),h;return b&&b.type==="answer"&&this.signalingState==="have-local-offer"&&(h=Promise.reject(new Error("Cannot set local answer in state have-local-offer"))),h?M.length>1?a.apply(void 0,_([h],m(f),!1)):h:(T=this._peerConnection).setLocalDescription.apply(T,_([],m(M),!1))},p.prototype.setRemoteDescription=function(){for(var T=this,M=[],k=0;k<arguments.length;k++)M[k]=arguments[k];var y=m(M),b=y[0],f=y.slice(1),h;return b&&this.signalingState==="have-remote-offer"&&(b.type==="answer"?h=Promise.reject(new Error("Cannot set remote answer in state have-remote-offer")):b.type==="offer"&&(h=c(this,!1,function(){return T._peerConnection.setRemoteDescription(b)}))),h||(h=this._peerConnection.setRemoteDescription(b)),h=h.then(function(){return l(T,b,!0)}),M.length>1?a.apply(void 0,_([h],m(f),!1)):h},p.prototype.close=function(){this.signalingState!=="closed"&&(this._isClosed=!0,this._peerConnection.close())},p})(u);r(RTCPeerConnection.prototype,s.prototype,"_peerConnection");function c(v,p,T){var M=p?"setLocalDescription":"setRemoteDescription";return v._rollingBack=!0,v._peerConnection[M](new i({type:"rollback"})).then(T).then(function(k){return v._rollingBack=!1,k},function(k){throw v._rollingBack=!1,k})}function l(v,p,T){if(!(v._initiallyNegotiatedDtlsRole||p.type==="offer")){var M=p.sdp.match(/a=setup:([a-z]+)/);if(M){var k=M[1];v._initiallyNegotiatedDtlsRole=T?{active:"passive",passive:"active"}[k]:k}}}function d(v,p){return v&&v.type==="answer"&&p?new i({type:v.type,sdp:v.sdp.replace(/a=setup:[a-z]+/g,"a=setup:"+p)}):v}return Xe=s,Xe}var Ze,Ea;function Qu(){if(Ea)return Ze;Ea=1;var g=Ze&&Ze.__extends||(function(){var y=function(b,f){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,w){h.__proto__=w}||function(h,w){for(var S in w)Object.prototype.hasOwnProperty.call(w,S)&&(h[S]=w[S])},y(b,f)};return function(b,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");y(b,f);function h(){this.constructor=b}b.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)}})(),m=Ze&&Ze.__read||function(y,b){var f=typeof Symbol=="function"&&y[Symbol.iterator];if(!f)return y;var h=f.call(y),w,S=[],E;try{for(;(b===void 0||b-- >0)&&!(w=h.next()).done;)S.push(w.value)}catch(q){E={error:q}}finally{try{w&&!w.done&&(f=h.return)&&f.call(h)}finally{if(E)throw E.error}}return S},_=Ze&&Ze.__spreadArray||function(y,b,f){if(f||arguments.length===2)for(var h=0,w=b.length,S;h<w;h++)(S||!(h in b))&&(S||(S=Array.prototype.slice.call(b,0,h)),S[h]=b[h]);return y.concat(S||Array.prototype.slice.call(b))},u=Hi(),i=Vs(),e=ln(),t=e.getSdpFormat,r=e.updatePlanBTrackIdsToSSRCs,n=e.updateUnifiedPlanTrackIdsToSSRCs,a=je(),o=a.delegateMethods,s=a.interceptEvent,c=a.proxyProperties,l=t()==="unified",d=l?n:r,v=(function(y){g(b,y);function b(f,h){h===void 0&&(h={});var w=y.call(this)||this;s(w,"datachannel"),s(w,"iceconnectionstatechange"),s(w,"signalingstatechange"),s(w,"track");var S=new RTCPeerConnection(f);return Object.defineProperties(w,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_applyCodecPreferences:{value:h.applyCodecPreferences||(function(){})},_audioTransceiver:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:S},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_signalingStateLatch:{value:new i},_tracksToSSRCs:{value:new Map,writable:!0},_videoTransceiver:{value:null,writable:!0}}),S.addEventListener("datachannel",function(E){k(E.channel),w.dispatchEvent(E)}),S.addEventListener("iceconnectionstatechange",function(){for(var E=[],q=0;q<arguments.length;q++)E[q]=arguments[q];w._isClosed||w.dispatchEvent.apply(w,_([],m(E),!1))}),S.addEventListener("signalingstatechange",function(){for(var E=[],q=0;q<arguments.length;q++)E[q]=arguments[q];w._isClosed||(S.signalingState==="stable"&&(w._appliedTracksToSSRCs=new Map(w._tracksToSSRCs)),!w._pendingLocalOffer&&!w._pendingRemoteOffer&&w.dispatchEvent.apply(w,_([],m(E),!1)))}),S.addEventListener("track",function(E){w._pendingRemoteOffer=null,w.dispatchEvent(E)}),c(RTCPeerConnection.prototype,w,S),w}return Object.defineProperty(b.prototype,"localDescription",{get:function(){return this._pendingLocalOffer||this._peerConnection.localDescription},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"iceConnectionState",{get:function(){return this._isClosed?"closed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"iceGatheringState",{get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"remoteDescription",{get:function(){return this._pendingRemoteOffer||this._peerConnection.remoteDescription},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"signalingState",{get:function(){return this._isClosed?"closed":this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),b.prototype.addIceCandidate=function(f){var h=this;return this.signalingState==="have-remote-offer"?this._signalingStateLatch.when("low").then(function(){return h._peerConnection.addIceCandidate(f)}):this._peerConnection.addIceCandidate(f)},b.prototype.createOffer=function(f){var h=this;if(f=Object.assign({},f),f.offerToReceiveVideo&&!this._audioTransceiver&&!(l&&M(this,"audio"))){delete f.offerToReceiveAudio;try{this._audioTransceiver=l?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio"),this._applyCodecPreferences(this._audioTransceiver)}catch(w){return Promise.reject(w)}}if(f.offerToReceiveVideo&&!this._videoTransceiver&&!(l&&M(this,"video"))){delete f.offerToReceiveVideo;try{this._videoTransceiver=l?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video"),this._applyCodecPreferences(this._videoTransceiver)}catch(w){return Promise.reject(w)}}return this._peerConnection.createOffer(f).then(function(w){return h._rolledBackTracksToSSRCs.clear(),new RTCSessionDescription({type:w.type,sdp:d(h._tracksToSSRCs,w.sdp)})})},b.prototype.createAnswer=function(f){var h=this;return this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return h._signalingStateLatch.lower(),h._peerConnection.createAnswer()}).then(function(w){return h._pendingRemoteOffer=null,h._rolledBackTracksToSSRCs.clear(),l?new RTCSessionDescription({type:w.type,sdp:d(h._tracksToSSRCs,w.sdp)}):w},function(w){throw h._pendingRemoteOffer=null,w}):this._peerConnection.createAnswer(f).then(function(w){return h._rolledBackTracksToSSRCs.clear(),l?new RTCSessionDescription({type:w.type,sdp:d(h._tracksToSSRCs,w.sdp)}):w})},b.prototype.createDataChannel=function(f,h){var w=this._peerConnection.createDataChannel(f,h);return k(w),w},b.prototype.removeTrack=function(f){f.replaceTrack(null),this._peerConnection.removeTrack(f)},b.prototype.setLocalDescription=function(f){return this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear()),p(this,!0,f)},b.prototype.setRemoteDescription=function(f){return this._rolledBackTracksToSSRCs.clear(),p(this,!1,f)},b.prototype.close=function(){this._isClosed||(this._isClosed=!0,this._peerConnection.close())},b})(u);o(RTCPeerConnection.prototype,v.prototype,"_peerConnection");function p(y,b,f){function h(I){b?y._pendingLocalOffer=I:y._pendingRemoteOffer=I}function w(){b?y._pendingLocalOffer=null:y._pendingRemoteOffer=null}var S=b?y._pendingLocalOffer:y._pendingRemoteOffer,E=b?y._pendingRemoteOffer:y._pendingLocalOffer,q=b?"have-local-offer":"have-remote-offer",O=b?"setLocalDescription":"setRemoteDescription";if(!b&&E&&f.type==="answer")return T(y,f);if(f.type==="offer"){if(y.signalingState!==q&&y.signalingState!=="stable")return Promise.reject(new Error("Cannot set ".concat(b?"local":"remote",`
        offer in state `).concat(y.signalingState)));!S&&y._signalingStateLatch.state==="low"&&y._signalingStateLatch.raise();var C=y.signalingState;return h(f),y.signalingState!==C?Promise.resolve().then(function(){return y.dispatchEvent(new Event("signalingstatechange"))}):Promise.resolve()}else if(f.type==="rollback")return y.signalingState!==q?Promise.reject(new Error(`Cannot rollback 
        `.concat(b?"local":"remote"," description in ").concat(y.signalingState))):(w(),y._rolledBackTracksToSSRCs=new Map(y._tracksToSSRCs),y._tracksToSSRCs=new Map(y._appliedTracksToSSRCs),Promise.resolve().then(function(){return y.dispatchEvent(new Event("signalingstatechange"))}));return y._peerConnection[O](f)}function T(y,b){var f=y._pendingLocalOffer;return y._peerConnection.setLocalDescription(f).then(function(){return y._pendingLocalOffer=null,y.setRemoteDescription(b)}).then(function(){return y._signalingStateLatch.lower()})}function M(y,b){return!!y.getTransceivers().find(function(f){var h=f.receiver,w=h===void 0?{}:h,S=w.track,E=S===void 0?{}:S;return E.kind===b})}function k(y){return Object.defineProperties(y,{maxPacketLifeTime:{value:y.maxPacketLifeTime===65535?null:y.maxPacketLifeTime},maxRetransmits:{value:y.maxRetransmits===65535?null:y.maxRetransmits}})}return Ze=v,Ze}var Ca;function Gu(){if(Ca)return gt.exports;if(Ca=1,typeof RTCPeerConnection=="function"){var g=je().guessBrowser;switch(g()){case"chrome":gt.exports=Wu();break;case"firefox":gt.exports=Hu();break;case"safari":gt.exports=Qu();break;default:gt.exports=RTCPeerConnection;break}}else gt.exports=function(){throw new Error("RTCPeerConnection is not supported")};return gt.exports}var It={exports:{}},Oa;function $u(){if(Oa)return It.exports;if(Oa=1,typeof RTCSessionDescription=="function"){var g=je().guessBrowser;switch(g()){case"chrome":It.exports=qs();break;case"firefox":It.exports=Fs();break;default:It.exports=RTCSessionDescription;break}}else It.exports=function(){throw new Error("RTCSessionDescription is not supported")};return It.exports}var Vn,Ra;function Lt(){if(Ra)return Vn;Ra=1;var g={};return Object.defineProperties(g,{getStats:{enumerable:!0,value:qu()},getUserMedia:{enumerable:!0,value:Vu()},MediaStream:{enumerable:!0,value:Ns()},MediaStreamTrack:{enumerable:!0,value:Fu()},RTCIceCandidate:{enumerable:!0,value:Bu()},RTCPeerConnection:{enumerable:!0,value:Gu()},RTCSessionDescription:{enumerable:!0,value:$u()}}),Vn=g,Vn}var Fn,La;function Qi(){return La||(La=1,Fn=function(m,_){if(m&&_)if(m.super_=_,typeof Object.create=="function")m.prototype=Object.create(_.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}});else{var u=(function(){function i(){}return i})();u.prototype=_.prototype,m.prototype=new u,m.prototype.constructor=m}}),Fn}var Ut,xa;function xt(){if(xa)return Ut;xa=1;var g=Ut&&Ut.__read||function(s,c){var l=typeof Symbol=="function"&&s[Symbol.iterator];if(!l)return s;var d=l.call(s),v,p=[],T;try{for(;(c===void 0||c-- >0)&&!(v=d.next()).done;)p.push(v.value)}catch(M){T={error:M}}finally{try{v&&!v.done&&(l=d.return)&&l.call(d)}finally{if(T)throw T.error}}return p};function m(){return/Android/.test(navigator.userAgent)}function _(){return!!(navigator&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2)}function u(){return _()&&window.screen.width>=744&&(/Macintosh/i.test(navigator.userAgent)||/iPad/.test(navigator.userAgent)||/iPad/.test(navigator.platform))}function i(){return _()&&window.screen.width<=476&&(/Macintosh/i.test(navigator.userAgent)||/iPhone/.test(navigator.userAgent)||/iPhone/.test(navigator.platform))}function e(){return u()||i()}function t(){return/Mobi/.test(navigator.userAgent)}function r(s){return s==="chrome"&&/Edge/.test(navigator.userAgent)&&(typeof chrome>"u"||typeof chrome.runtime>"u")}function n(s){if(s!=="chrome")return null;if("brave"in navigator)return"brave";var c=o(navigator.userAgent),l=c.reduce(function(T,M){return T.replace(M,"")},navigator.userAgent),d=l.match(/[^\s]+/g)||[],v=g(d.map(function(T){return T.split("/")[0].toLowerCase()})),p=v.slice(2);return p.find(function(T){return!["chrome","mobile","safari"].includes(T)})||null}function a(s){return s!=="safari"?null:"brave"in navigator?"brave":["edge","edg"].find(function(c){return navigator.userAgent.toLowerCase().includes(c)})||null}function o(s){for(var c=[],l=[],d=0;d<s.length;d++)if(s[d]==="(")c.push(d);else if(s[d]===")"&&c.length>0){var v=c.pop();c.length===0&&l.push(s.substring(v,d+1))}return l}return Ut={isAndroid:m,isIOS:e,isIpad:u,isIphone:i,isMobile:t,isNonChromiumEdge:r,mobileWebKitBrowser:a,rebrandedChromeBrowser:n},Ut}var Bn,Ma;function Bs(){if(Ma)return Bn;Ma=1;function g(_){return _=typeof _=="number"?_:0,new Promise(function(u){return setTimeout(u,_)})}function m(_,u,i){i=typeof i=="number"?i:250;var e=_.createMediaStreamSource(u),t=_.createAnalyser();t.fftSize=2048,e.connect(t);var r=new Uint8Array(t.fftSize),n=!1;setTimeout(function(){n=!0},i);function a(){return n?Promise.resolve(!0):(t.getByteTimeDomainData(r),r.some(function(o){return o!==128&&o!==0})?Promise.resolve(!1):g().then(a))}return a().then(function(o){return e.disconnect(),o},function(o){throw e.disconnect(),o})}return Bn=m,Bn}var Un,Aa;function Cn(){if(Aa)return Un;Aa=1;var g=typeof AudioContext<"u"?AudioContext:typeof webkitAudioContext<"u"?webkitAudioContext:null,m=(function(){function _(u){u=Object.assign({AudioContext:g},u),Object.defineProperties(this,{_AudioContext:{value:u.AudioContext},_audioContext:{value:null,writable:!0},_holders:{value:new Set},AudioContextFactory:{enumerable:!0,value:_}})}return _.prototype.getOrCreate=function(u){if(!this._holders.has(u)&&(this._holders.add(u),this._AudioContext&&!this._audioContext))try{this._audioContext=new this._AudioContext}catch{}return this._audioContext},_.prototype.release=function(u){this._holders.has(u)&&(this._holders.delete(u),!this._holders.size&&this._audioContext&&(this._audioContext.close(),this._audioContext=null))},_})();return Un=new m,Un}var Wn,Ia;function Us(){if(Ia)return Wn;Ia=1;var g=Bs(),m=3,_=250;function u(i){var e=Cn(),t={},r=e.getOrCreate(t),n=m;function a(){return n--,g(r,i.srcObject,_).then(function(o){return o?n>0?a():!0:!1}).catch(function(){return!0})}return a().finally(function(){e.release(t)})}return Wn=u,Wn}var Hn,Da;function Ws(){if(Da)return Hn;Da=1;var g=Ee().defer,m=(function(){function _(){Object.defineProperties(this,{_audio:{value:g(),writable:!0},_video:{value:g(),writable:!0}}),this._audio.resolve(),this._video.resolve()}return _.prototype.resolveDeferred=function(u){u==="audio"?this._audio.resolve():this._video.resolve()},_.prototype.startDeferred=function(u){u==="audio"?this._audio=g():this._video=g()},_.prototype.whenResolved=function(u){return u==="audio"?this._audio.promise:this._video.promise},_})();return Hn=new m,Hn}var Qn,ja;function dn(){if(ja)return Qn;ja=1;var g=Ne().EventEmitter,m=Ee().hidePrivateAndCertainPublicPropertiesInClass;return Qn=m(g,["domain"]),Qn}var Wt,Na;function Gi(){if(Na)return Wt;Na=1;var g=Wt&&Wt.__extends||(function(){var a=function(o,s){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,l){c.__proto__=l}||function(c,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(c[d]=l[d])},a(o,s)};return function(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");a(o,s);function c(){this.constructor=o}o.prototype=s===null?Object.create(s):(c.prototype=s.prototype,new c)}})(),m=dn(),_=Ee(),u=_.buildLogLevels,i=_.valueToJSON,e=Oe().DEFAULT_LOG_LEVEL,t=Qe(),r=0,n=(function(a){g(o,a);function o(s,c,l){var d=this;l=Object.assign({name:s,log:null,logLevel:e},l),d=a.call(this)||this;var v=String(l.name),p=u(l.logLevel),T=l.log?l.log.createLog("media",d):new t("media",d,p,l.loggerName);return Object.defineProperties(d,{_instanceId:{value:++r},_log:{value:T},kind:{enumerable:!0,value:c},name:{enumerable:!0,value:v}}),d}return o.prototype.toJSON=function(){return i(this)},o})(m);return Wt=n,Wt}var Ht,qa;function Hs(){if(qa)return Ht;qa=1;var g=Ht&&Ht.__extends||(function(){var s=function(c,l){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,v){d.__proto__=v}||function(d,v){for(var p in v)Object.prototype.hasOwnProperty.call(v,p)&&(d[p]=v[p])},s(c,l)};return function(c,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");s(c,l);function d(){this.constructor=c}c.prototype=l===null?Object.create(l):(d.prototype=l.prototype,new d)}})(),m=xt().isIOS,_=Lt().MediaStream,u=Ee(),i=u.waitForEvent,e=u.waitForSometime,t=Ws(),r=Gi(),n=(function(s){g(c,s);function c(l,d){var v=this;d=Object.assign({playPausedElementsIfNotBackgrounded:m()&&typeof document=="object"&&typeof document.addEventListener=="function"&&typeof document.visibilityState=="string"},d),v=s.call(this,l.id,l.kind,d)||this;var p=!1;if(d=Object.assign({MediaStream:_},d),typeof d.MediaStream!="function")throw new Error("MediaTrack received an invalid MediaStream constructor: "+d.MediaStream);return Object.defineProperties(v,{_attachments:{value:new Set},_dummyEl:{value:null,writable:!0},_elShims:{value:new WeakMap},_isStarted:{get:function(){return p},set:function(T){p=T}},_playPausedElementsIfNotBackgrounded:{value:d.playPausedElementsIfNotBackgrounded},_shouldShimAttachedElements:{value:d.workaroundWebKitBug212780||d.playPausedElementsIfNotBackgrounded},_unprocessedTrack:{value:null,writable:!0},_MediaStream:{value:d.MediaStream},_mapMediaElement:{value:d.mapMediaElement},_disposeMediaElement:{value:d.disposeMediaElement},isStarted:{enumerable:!0,get:function(){return p}},mediaStreamTrack:{enumerable:!0,get:function(){return this._unprocessedTrack||l.track}},processedTrack:{enumerable:!0,value:null,writable:!0}}),v._initialize(),v}return c.prototype._start=function(){this._log.debug("Started"),this._isStarted=!0,this._dummyEl&&(this._dummyEl.oncanplay=null),this.emit("started",this)},c.prototype._initialize=function(){var l=this;this._log.debug("Initializing"),this._dummyEl=this._createElement(),this.mediaStreamTrack&&this.mediaStreamTrack.addEventListener?this.mediaStreamTrack.addEventListener("ended",function d(){l._end(),l.mediaStreamTrack.removeEventListener("ended",d)}):this.mediaStreamTrack&&(this.mediaStreamTrack.onended=function(){l._end(),l.mediaStreamTrack.onended=null}),this._dummyEl&&(this._dummyEl.muted=!0,this._dummyEl.oncanplay=this._start.bind(this,this._dummyEl),this._attach(this._dummyEl,this.mediaStreamTrack),this._attachments.delete(this._dummyEl))},c.prototype._end=function(){this._log.debug("Ended"),this._dummyEl&&(this._dummyEl.remove(),this._disposeMediaElement?this._disposeMediaElement(this._dummyEl):this._dummyEl.srcObject=null,this._dummyEl.oncanplay=null,this._dummyEl=null)},c.prototype.attach=function(l){var d=this;if(typeof l=="string"?l=this._selectElement(l):l||(l=this._createElement()),this._log.debug("Attempting to attach to element:",l),l=this._attach(l),this._shouldShimAttachedElements&&!this._elShims.has(l)){var v=this._playPausedElementsIfNotBackgrounded?function(){return a(l,d._log)}:null;this._elShims.set(l,o(l,v))}return l},c.prototype._attach=function(l,d){d===void 0&&(d=this.processedTrack||this.mediaStreamTrack);var v=l.srcObject;v instanceof this._MediaStream||(v=new this._MediaStream);var p=d.kind==="audio"?"getAudioTracks":"getVideoTracks";return v[p]().forEach(function(T){v.removeTrack(T)}),v.addTrack(d),this._mapMediaElement&&(this._log.debug("Mapping element using mapMediaElement before attaching media to element"),this._mapMediaElement(l)),l.srcObject=v,l.autoplay=!0,l.playsInline=!0,this._attachments.has(l)||this._attachments.add(l),l},c.prototype._selectElement=function(l){var d=document.querySelector(l);if(!d)throw new Error("Selector matched no element: ".concat(l));return d},c.prototype._updateElementsMediaStreamTrack=function(){var l=this;this._log.debug("Reattaching all elements to update mediaStreamTrack"),this._getAllAttachedElements().forEach(function(d){return l._attach(d)})},c.prototype._createElement=function(){return typeof document<"u"?document.createElement(this.kind):null},c.prototype.detach=function(l){var d;return typeof l=="string"?d=[this._selectElement(l)]:l?d=[l]:d=this._getAllAttachedElements(),this._log.debug("Attempting to detach from elements:",d),this._detachElements(d),l?d[0]:d},c.prototype._detachElements=function(l){return l.map(this._detachElement.bind(this))},c.prototype._detachElement=function(l){if(!this._attachments.has(l))return l;var d=l.srcObject;if(d instanceof this._MediaStream&&d.removeTrack(this.processedTrack||this.mediaStreamTrack),this._disposeMediaElement&&(this._log.debug("Disposing element using disposeMediaElement after removing media from element"),this._disposeMediaElement(l)),this._attachments.delete(l),this._shouldShimAttachedElements&&this._elShims.has(l)){var v=this._elShims.get(l);v.unShim(),this._elShims.delete(l)}return l},c.prototype._getAllAttachedElements=function(){var l=[];return this._attachments.forEach(function(d){l.push(d)}),l},c})(r);function a(s,c){var l=s.tagName.toLowerCase();c.warn("Unintentionally paused:",s),Promise.race([i(document,"visibilitychange"),e(1e3)]).then(function(){document.visibilityState==="visible"&&t.whenResolved("audio").then(function(){return c.info("Playing unintentionally paused <".concat(l,"> element")),c.debug("Element:",s),s.play()}).then(function(){c.info("Successfully played unintentionally paused <".concat(l,"> element")),c.debug("Element:",s)}).catch(function(d){c.warn("Error while playing unintentionally paused <".concat(l,"> element:"),{error:d,el:s})})})}function o(s,c){c===void 0&&(c=null);var l=s.pause,d=s.play,v=!1;s.pause=function(){return v=!0,l.call(s)},s.play=function(){return v=!1,d.call(s)};var p=c?function(){v||c()}:null;return p&&s.addEventListener("pause",p),{pausedIntentionally:function(){return v},unShim:function(){s.pause=l,s.play=d,p&&s.removeEventListener("pause",p)}}}return Ht=n,Ht}var Qt,Va;function Qs(){if(Va)return Qt;Va=1;var g=Qt&&Qt.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Hs(),_=(function(u){g(i,u);function i(e,t){return u.call(this,e,t)||this}return i.prototype.attach=function(){return u.prototype.attach.apply(this,arguments)},i.prototype.detach=function(){return u.prototype.detach.apply(this,arguments)},i})(m);return Qt=_,Qt}var Gn,Fa;function Gs(){if(Fa)return Gn;Fa=1;var g=null,m=3,_=50,u=250,i=50;function e(r){try{var n=g.getContext("2d");n.drawImage(r,0,0,i,_);var a=n.getImageData(0,0,i,_),o=a.data.filter(function(c,l){return(l+1)%4}),s=Math.max.apply(Math,o);return s===0}catch(c){return console.log("Error checking silence: ",c),!1}}function t(r){return g=g||document.createElement("canvas"),new Promise(function(n){var a=m;setTimeout(function o(){return a--,e(r)?a>0?setTimeout(o,u):n(!0):n(!1)},u)})}return Gn=t,Gn}var $n,Ba;function On(){if(Ba)return $n;Ba=1;var g=(function(){function m(_){_===void 0&&(_=1);var u=this;Object.defineProperties(this,{_listeners:{value:[]},_onVisibilityChange:{value:function(){u._emitVisible(document.visibilityState==="visible")}}});for(var i=0;i<_;i++)this._listeners.push([])}return m.prototype.clear=function(){for(var _=this._listeners.length,u=0;u<_;u++)this._listeners[u]=[]},m.prototype._listenerCount=function(){return this._listeners.reduce(function(_,u){return _+u.length},0)},m.prototype._emitVisible=function(_){for(var u=this,i=Promise.resolve(),e=function(r){i=i.then(function(){return u._emitVisiblePhase(r,_)})},t=1;t<=this._listeners.length;t++)e(t);return i},m.prototype._emitVisiblePhase=function(_,u){var i=this._listeners[_-1];return Promise.all(i.map(function(e){var t=e(u);return t instanceof Promise?t:Promise.resolve(t)}))},m.prototype._start=function(){document.addEventListener("visibilitychange",this._onVisibilityChange)},m.prototype._stop=function(){document.removeEventListener("visibilitychange",this._onVisibilityChange)},m.prototype.onVisibilityChange=function(_,u){if(typeof _!="number"||_<=0||_>this._listeners.length)throw new Error("invalid phase: ",_);var i=this._listeners[_-1];return i.push(u),this._listenerCount()===1&&this._start(),this},m.prototype.offVisibilityChange=function(_,u){if(typeof _!="number"||_<=0||_>this._listeners.length)throw new Error("invalid phase: ",_);var i=this._listeners[_-1],e=i.indexOf(u);return e!==-1&&(i.splice(e,1),this._listenerCount()===0&&this._stop()),this},m})();return $n=new g(2),$n}var zn,Ua;function $s(){if(Ua)return zn;Ua=1;var g=Bs();function m(_,u,i,e,t){e=typeof e=="number"?e:3;var r=0,n=Cn(),a={},o=n.getOrCreate(a);function s(){return u(i).then(function(c){var l=i.audio?g(o,c,t).catch(function(d){return _.warn("Encountered an error while detecting silence",d),!0}):Promise.resolve(!1);return l.then(function(d){if(d){if(e<=0)return _.warn("Got a silent audio MediaStreamTrack. Normally we would try 	to get a new one, but we've run out of retries; returning it anyway."),c}else return _.info("Got a non-silent audio MediaStreamTrack; returning it."),c;return _.warn("Got a silent audio MediaStreamTrack. Stopping all MediaStreamTracks and calling getUserMedia again. This is retry #".concat(++r,".")),c.getTracks().forEach(function(v){return v.stop()}),e--,s()})})}return s().then(function(c){return n.release(a),c},function(c){throw n.release(a),c})}return zn=m,zn}var et,Wa;function zs(){if(Wa)return et;Wa=1;var g=et&&et.__extends||(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),m=et&&et.__read||function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(c){s={error:c}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},_=et&&et.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},u=Ne().EventEmitter,i=(function(e){g(t,e);function t(){var r=e.call(this)||this;return Object.defineProperties(r,{_queuedEvents:{value:new Map}}),r}return t.prototype.dequeue=function(r){var n=this,a=!0;if(!r)return this._queuedEvents.forEach(function(s,c){a=this.dequeue(c)&&a},this),a;var o=this._queuedEvents.get(r)||[];return this._queuedEvents.delete(r),o.reduce(function(s,c){return n.emit.apply(n,_([],m([r].concat(c)),!1))&&s},a)},t.prototype.queue=function(){var r=[].slice.call(arguments);if(this.emit.apply(this,_([],m(r),!1)))return!0;var n=r[0];return this._queuedEvents.has(n)||this._queuedEvents.set(n,[]),this._queuedEvents.get(n).push(r.slice(1)),!1},t})(u);return et=i,et}var Gt,Ha;function Ks(){if(Ha)return Gt;Ha=1;var g=Gt&&Gt.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=zs(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this)||this;return Object.defineProperties(r,{id:{enumerable:!0,value:e},kind:{enumerable:!0,value:t}}),r}return i.prototype.stop=function(){this.emit("stopped")},i})(m);return Gt=_,Gt}var $t,Qa;function Ys(){if(Qa)return $t;Qa=1;var g=$t&&$t.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ks(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this,e,t.kind)||this;return Object.defineProperties(r,{_track:{value:t,writable:!0},enabled:{enumerable:!0,get:function(){return this._track.enabled}},readyState:{enumerable:!0,get:function(){return this._track.readyState}},track:{enumerable:!0,get:function(){return this._track}}}),r}return i.prototype.stop=function(){this.track.stop(),u.prototype.stop.call(this)},i})(m);return $t=_,$t}var wt,Ga;function Js(){if(Ga)return wt;Ga=1;var g=wt&&wt.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=wt&&wt.__read||function(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var r=t.call(i),n,a=[],o;try{for(;(e===void 0||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return a},_=Ys(),u=(function(i){g(e,i);function e(t){var r=i.call(this,t.id,t)||this;return Object.defineProperties(r,{_clones:{value:new Set},_eventsToReemitters:{value:new Map([["mute",function(){return r.queue("muted")}],["unmute",function(){return r.queue("unmuted")}]])},_senders:{value:new Set},_senderToPublisherHintCallbacks:{value:new Map},isPublishing:{enumerable:!0,get:function(){return!!this._clones.size}},muted:{enumerable:!0,get:function(){return this._track.muted}}}),r._reemitMediaStreamTrackEvents(),r}return e.prototype._reemitMediaStreamTrackEvents=function(t){t===void 0&&(t=this._track);var r=this,n=r._eventsToReemitters,a=r._track;if(t.addEventListener?n.forEach(function(s,c){return t.addEventListener(c,s)}):n.forEach(function(s,c){t["on".concat(c)]=s}),a!==t&&(n.forEach(function(s,c){return a.removeEventListener(c,s)}),a.muted!==t.muted)){var o=n.get(t.muted?"mute":"unmute");o()}},e.prototype.clone=function(){var t=new e(this.track.clone());return this._clones.add(t),t},e.prototype.removeClone=function(t){this._clones.delete(t)},e.prototype.setMediaStreamTrack=function(t){var r=this,n=Array.from(this._clones),a=Array.from(this._senders);return Promise.all(n.map(function(o){return o.setMediaStreamTrack(t.clone())}).concat(a.map(function(o){return r._replaceTrack(o,t)}))).finally(function(){r._reemitMediaStreamTrackEvents(t),r._track=t})},e.prototype.addSender=function(t,r){return this._senders.add(t),r&&this._senderToPublisherHintCallbacks.set(t,r),this},e.prototype.removeSender=function(t){return this._senders.delete(t),this._senderToPublisherHintCallbacks.delete(t),this},e.prototype.setPublisherHint=function(t){var r=m(Array.from(this._senderToPublisherHintCallbacks.values()),1),n=r[0];return n?n(t):Promise.resolve("COULD_NOT_APPLY_HINT")},e.prototype._replaceTrack=function(t,r){var n=this;return t.replaceTrack(r).then(function(a){return n.setPublisherHint(null).catch(function(){}),n.emit("replaced"),a})},e})(_);return wt=u,wt}var zt,$a;function Xs(){if($a)return zt;$a=1;var g=zt&&zt.__extends||(function(){var T=function(M,k){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,b){y.__proto__=b}||function(y,b){for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&(y[f]=b[f])},T(M,k)};return function(M,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");T(M,k);function y(){this.constructor=M}M.prototype=k===null?Object.create(k):(y.prototype=k.prototype,new y)}})(),m=Lt().getUserMedia,_=xt().isIOS,u=Ee(),i=u.capitalize,e=u.defer,t=u.waitForSometime,r=u.waitForEvent,n=Oe().typeErrors.ILLEGAL_INVOKE,a=Us(),o=Gs(),s=On(),c=Ws(),l=$s(),d=Js();function v(T){return(function(M){g(k,M);function k(y,b){var f=this,h=_()&&typeof document=="object"&&typeof document.addEventListener=="function"&&typeof document.visibilityState=="string";b=Object.assign({getUserMedia:m,isCreatedByCreateLocalTracks:!1,workaroundWebKitBug1208516:h,gUMSilentTrackWorkaround:l},b);var w=new d(y),S=w.kind;return f=M.call(this,w,b)||this,Object.defineProperties(f,{_constraints:{value:typeof b[S]=="object"?b[S]:{},writable:!0},_getUserMedia:{value:b.getUserMedia},_gUMSilentTrackWorkaround:{value:b.gUMSilentTrackWorkaround},_eventsToReemitters:{value:new Map([["muted",function(){return f.emit("muted",f)}],["unmuted",function(){return f.emit("unmuted",f)}]])},_workaroundWebKitBug1208516:{value:b.workaroundWebKitBug1208516},_workaroundWebKitBug1208516Cleanup:{value:null,writable:!0},_didCallEnd:{value:!1,writable:!0},_isCreatedByCreateLocalTracks:{value:b.isCreatedByCreateLocalTracks},_noiseCancellation:{value:b.noiseCancellation||null},_trackSender:{value:w},id:{enumerable:!0,value:w.id},isEnabled:{enumerable:!0,get:function(){return w.enabled}},isMuted:{enumerable:!0,get:function(){return w.muted}},isStopped:{enumerable:!0,get:function(){return w.readyState==="ended"}}}),f._workaroundWebKitBug1208516&&(f._workaroundWebKitBug1208516Cleanup=p(f)),f._reemitTrackSenderEvents(),f}return k.prototype._end=function(){var y=this;this._didCallEnd||(M.prototype._end.call(this),this._didCallEnd=!0,this._eventsToReemitters.forEach(function(b,f){return y._trackSender.removeListener(f,b)}),this.emit("stopped",this))},k.prototype._initialize=function(){this._didCallEnd&&(this._didCallEnd=!1),this._eventsToReemitters&&this._reemitTrackSenderEvents(),M.prototype._initialize.call(this)},k.prototype._reacquireTrack=function(y){var b,f=this,h=f._getUserMedia,w=f._gUMSilentTrackWorkaround,S=f._log,E=f.mediaStreamTrack.kind;S.info("Re-acquiring the MediaStreamTrack"),S.debug("Constraints:",y);var q=Object.assign({audio:!1,video:!1},(b={},b[E]=y,b)),O=this._workaroundWebKitBug1208516Cleanup?w(S,h,q):h(q);return O.then(function(C){return C.getTracks()[0]})},k.prototype._reemitTrackSenderEvents=function(){var y=this;this._eventsToReemitters.forEach(function(b,f){return y._trackSender.on(f,b)}),this._trackSender.dequeue("muted"),this._trackSender.dequeue("unmuted")},k.prototype._restart=function(y){var b=this,f=this._log;return y=y||this._constraints,this._stop(),this._reacquireTrack(y).catch(function(h){throw f.error("Failed to re-acquire the MediaStreamTrack:",{error:h,constraints:y}),h}).then(function(h){return f.info("Re-acquired the MediaStreamTrack"),f.debug("MediaStreamTrack:",h),b._constraints=Object.assign({},y),b._setMediaStreamTrack(h)})},k.prototype._setMediaStreamTrack=function(y){var b=this;return y.enabled=this.mediaStreamTrack.enabled,this._stop(),(this._unprocessedTrack?Promise.resolve().then(function(){b._unprocessedTrack=y}):this._trackSender.setMediaStreamTrack(y).catch(function(f){b._log.warn("setMediaStreamTrack failed:",{error:f,mediaStreamTrack:y})})).then(function(){b._initialize(),b._getAllAttachedElements().forEach(function(f){return b._attach(f)})})},k.prototype._stop=function(){return this.mediaStreamTrack.stop(),this._end(),this},k.prototype.enable=function(y){return y=typeof y=="boolean"?y:!0,y!==this.mediaStreamTrack.enabled&&(this._log.info("".concat(y?"En":"Dis","abling")),this.mediaStreamTrack.enabled=y,this.emit(y?"enabled":"disabled",this)),this},k.prototype.disable=function(){return this.enable(!1)},k.prototype.restart=function(y){var b=this,f=this.kind;if(!this._isCreatedByCreateLocalTracks)return Promise.reject(n("restart","can only be called on a"+" Local".concat(i(f),"Track that is created using createLocalTracks")+" or createLocal".concat(i(f),"Track.")));this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null);var h=this._restart(y);return this._workaroundWebKitBug1208516&&(h=h.finally(function(){b._workaroundWebKitBug1208516Cleanup=p(b)})),h},k.prototype.stop=function(){return this._log.info("Stopping"),this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null),this._stop()},k})(T)}function p(T){var M=T._log,k=T.kind,y=T._noiseCancellation,b={audio:a,video:o}[k],f=function(){return y?y.sourceTrack:T.mediaStreamTrack},h=T._dummyEl,w=f(),S=null;function E(){return h.play().then(function(){return b(h)}).then(function(R){return R?M.warn("Silence detected"):M.info("Non-silence detected"),R}).catch(function(R){M.warn("Failed to detect silence:",R)}).finally(function(){T.processedTrack||h.pause()})}function q(){var R=T._workaroundWebKitBug1208516Cleanup,F=T.isStopped,V=F&&!!R,U=f().muted;return Promise.resolve().then(function(){return document.visibilityState==="visible"&&!S&&(U||V||E())})}function O(){return Promise.race([r(w,"unmute"),t(50)]).then(function(){return q()}).then(function(R){R&&!S&&(S=e(),T._restart().finally(function(){h=T._dummyEl,x(),w=f(),I(),S.resolve(),S=null}).catch(function(V){M.error("failed to restart track: ",V)}));var F=S&&S.promise||Promise.resolve();return F.finally(function(){return c.resolveDeferred(k)})}).catch(function(R){M.error("error in maybeRestart: ".concat(R.message))})}function C(){var R=T._log,F=T.kind;R.info("Muted"),R.debug("LocalMediaTrack:",T),c.startDeferred(F)}function I(){w.addEventListener?(w.addEventListener("ended",O),w.addEventListener("mute",C),w.addEventListener("unmute",O)):(w.onended=O,w.onmute=C,w.onunmute=O)}function x(){w.removeEventListener?(w.removeEventListener("ended",O),w.removeEventListener("mute",C),w.removeEventListener("unmute",O)):(w.onended=null,w.onmute=null,w.onunmute=null)}var A=function(R){return R?O():!1};return s.onVisibilityChange(1,A),I(),function(){s.offVisibilityChange(1,A),x()}}return zt=v,zt}var Kt,za;function zu(){if(za)return Kt;za=1;var g=Kt&&Kt.__extends||(function(){var n=function(a,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(s[l]=c[l])},n(a,o)};return function(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(a,o);function s(){this.constructor=a}a.prototype=o===null?Object.create(o):(s.prototype=o.prototype,new s)}})(),m=xt().isIOS,_=Us(),u=je().isIOSChrome,i=Qs(),e=Xs(),t=e(i),r=(function(n){g(a,n);function a(o,s){var c=this,l=s?.noiseCancellation||null;c=n.call(this,o,s)||this;var d=c._log,v=o.label,p=v===void 0?"":v,T=o.getSettings(),M=T.deviceId,k=M===void 0?"":M,y=T.groupId,b=y===void 0?"":y;return Object.defineProperties(c,{_currentDefaultDeviceInfo:{value:{deviceId:k,groupId:b,label:p},writable:!0},_enumerateDevices:{value:typeof s?.enumerateDevices=="function"?s.enumerateDevices:navigator.mediaDevices.enumerateDevices},_defaultDeviceCaptureMode:{value:(!m()||l)&&c._isCreatedByCreateLocalTracks&&typeof navigator=="object"&&typeof navigator.mediaDevices=="object"&&typeof navigator.mediaDevices.addEventListener=="function"&&(typeof s?.enumerateDevices=="function"||typeof navigator.mediaDevices.enumerateDevices=="function")?s?.defaultDeviceCaptureMode||"auto":"manual"},_onDeviceChange:{value:function(){c._enumerateDevices().then(function(f){var h=f.find(function(w){var S=w.deviceId,E=w.kind;return E==="audioinput"&&S!=="default"});h&&["deviceId","groupId"].some(function(w){return h[w]!==c._currentDefaultDeviceInfo[w]})&&(d.info("Default device changed, restarting the LocalAudioTrack"),d.debug('Old default device: "'.concat(c._currentDefaultDeviceInfo.deviceId,'" => "').concat(c._currentDefaultDeviceInfo.label,'"')),d.debug('New default device: "'.concat(h.deviceId,'" => "').concat(h.label,'"')),c._currentDefaultDeviceInfo=h,c._restartDefaultDevice().catch(function(w){return d.warn("Failed to restart: ".concat(w.message))}))},function(f){d.warn("Failed to run enumerateDevices(): ".concat(f.message))})}},_restartOnDefaultDeviceChangeCleanup:{value:null,writable:!0},noiseCancellation:{enumerable:!0,value:l,writable:!1}}),d.debug("defaultDeviceCaptureMode:",c._defaultDeviceCaptureMode),c._maybeRestartOnDefaultDeviceChange(),c}return a.prototype.toString=function(){return"[LocalAudioTrack #".concat(this._instanceId,": ").concat(this.id,"]")},a.prototype.attach=function(o){return o=n.prototype.attach.call(this,o),o.muted=!0,o},a.prototype._end=function(){return n.prototype._end.apply(this,arguments)},a.prototype._maybeRestartOnDefaultDeviceChange=function(){var o=this,s=this,c=s._constraints,l=s._defaultDeviceCaptureMode,d=s._log,v=this.noiseCancellation?this.noiseCancellation.sourceTrack:this.mediaStreamTrack,p=v.getSettings().deviceId,T=function(k){return k!==p||k==="default"},M=(function k(y){return y===void 0&&(y={}),typeof y=="string"?T(y):Array.isArray(y)?y.every(T):y.exact?k(y.exact):y.ideal?k(y.ideal):!0})(c.deviceId);l==="auto"&&M?this._restartOnDefaultDeviceChangeCleanup||(d.info("LocalAudioTrack will be restarted if the default device changes"),navigator.mediaDevices.addEventListener("devicechange",this._onDeviceChange),this._restartOnDefaultDeviceChangeCleanup=function(){d.info("Cleaning up the listener to restart the LocalAudioTrack if the default device changes"),navigator.mediaDevices.removeEventListener("devicechange",o._onDeviceChange),o._restartOnDefaultDeviceChangeCleanup=null}):(d.info("LocalAudioTrack will NOT be restarted if the default device changes"),this._restartOnDefaultDeviceChangeCleanup&&this._restartOnDefaultDeviceChangeCleanup())},a.prototype._reacquireTrack=function(o){var s=this;return this._log.debug("_reacquireTrack: ",o),this.noiseCancellation?this.noiseCancellation.reacquireTrack(function(){return n.prototype._reacquireTrack.call(s,o)}):n.prototype._reacquireTrack.call(this,o)},a.prototype._restartDefaultDevice=function(){var o=this,s=Object.assign({},this._constraints),c=Object.assign({},s,{deviceId:this._currentDefaultDeviceInfo.deviceId});return this.restart(c).then(function(){o._constraints=s,o._maybeRestartOnDefaultDeviceChange()})},a.prototype._setMediaStreamTrack=function(o){var s=this,c=this,l=c._log,d=c.noiseCancellation,v=n.prototype._setMediaStreamTrack.call(this,o);return u()&&d&&(l.debug("iOS Chrome detected, checking if the restarted Krisp audio is silent"),v=v.then(function(){return _(s._dummyEl)}).then(function(p){return l.debug("Krisp audio is ".concat(p?"silent, using source audio":"not silent")),p&&d.disablePermanently().then(function(){return n.prototype._setMediaStreamTrack.call(s,d.sourceTrack)})})),v},a.prototype.disable=function(){return n.prototype.disable.apply(this,arguments)},a.prototype.enable=function(){return n.prototype.enable.apply(this,arguments)},a.prototype.restart=function(){return n.prototype.restart.apply(this,arguments)},a.prototype.stop=function(){return this.noiseCancellation&&this.noiseCancellation.stop(),this._restartOnDefaultDeviceChangeCleanup&&this._restartOnDefaultDeviceChangeCleanup(),n.prototype.stop.apply(this,arguments)},a})(t);return Kt=r,Kt}var Kn,Ka;function Ku(){if(Ka)return Kn;Ka=1;var g=Qi(),m=zu();function _(u,i){var e=new m(u,i);return Object.setPrototypeOf(e,_.prototype),e}return g(_,m),Kn=_,Kn}var Yt,Ya;function Yu(){if(Ya)return Yt;Ya=1;var g=Yt&&Yt.__read||function(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var r=t.call(i),n,a=[],o;try{for(;(e===void 0||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return a},m=Oe().DEFAULT_FRAME_RATE;function _(i,e){var t=g(i.srcObject.getVideoTracks(),1),r=t[0],n=r.getSettings().frameRate,a=n===void 0?m:n,o,s=new ReadableStream({start:function(l){o=setInterval(function(){return l.enqueue()},1e3/a)}}),c=new TransformStream({transform:function(){return e()}});return s.pipeThrough(c).pipeTo(new WritableStream).then(function(){}),function(){clearInterval(o)}}function u(i,e,t){var r=g(i.srcObject.getVideoTracks(),1),n=r[0],a=new MediaStreamTrackProcessor({track:n}).readable,o=new MediaStreamTrackGenerator({kind:"video"}),s=!1,c=new TransformStream({transform:function(l,d){var v=t==="videoframe"?e(l):Promise.resolve(l.close()).then(e);return v.finally(function(){s&&d.terminate()})}});return a.pipeThrough(c).pipeTo(o.writable).then(function(){}),function(){s=!0}}return Yt=typeof MediaStreamTrackGenerator=="function"&&typeof MediaStreamTrackProcessor=="function"?u:_,Yt}var Jt,Ja;function Ju(){if(Ja)return Jt;Ja=1;var g=Jt&&Jt.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=Ne().EventEmitter,_=Oe().DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS,u=(function(i){g(e,i);function e(t){var r=i.call(this)||this;return Object.defineProperties(r,{_lastStatsSaveTime:{value:null,writable:!0},_lastStatsPublishTime:{value:null,writable:!0},_log:{value:t},_processorInfo:{value:null,writable:!0},_stats:{value:null,writable:!0}}),r.on("add",function(n){r._lastStatsSaveTime=Date.now(),r._lastStatsPublishTime=Date.now(),r._processorInfo=n,r._stats=[],r._reemitEvent("add",r._getEventData())}),r.on("remove",function(){var n=r._getEventData();r._lastStatsSaveTime=null,r._lastStatsPublishTime=null,r._processorInfo=null,r._stats=null,r._reemitEvent("remove",n)}),r.on("start",function(){r._reemitEvent("start",r._getEventData())}),r.on("stop",function(n){r._reemitEvent("stop",Object.assign({message:n},r._getEventData()))}),r.on("stats",function(){return r._maybeEmitStats()}),r}return e.prototype._getEventData=function(){if(!this._processorInfo)return{};var t=this._processorInfo,r=t.processor,n=t.captureHeight,a=t.captureWidth,o=t.inputFrameRate,s=t.isRemoteVideoTrack,c=t.inputFrameBufferType,l=t.outputFrameBufferContextType,d={captureHeight:n,captureWidth:a,inputFrameRate:o,isRemoteVideoTrack:s,inputFrameBufferType:c,outputFrameBufferContextType:l};return d.name=r._name||"VideoProcessor",["assetsPath","blurFilterRadius","debounce","fitType","isSimdEnabled","maskBlurRadius","pipeline","version"].forEach(function(v){var p=r["_".concat(v)];typeof p<"u"&&(d[v]=p)}),Object.keys(d).forEach(function(v){var p=d[v];typeof p=="boolean"&&(d[v]=p?"true":"false")}),d},e.prototype._maybeEmitStats=function(){if(!(!this._stats||!this._processorInfo)){var t=this._processorInfo.processor._benchmark;if(t){var r=Date.now();if(!(r-this._lastStatsSaveTime<1e3)){var n={outputFrameRate:t.getRate("totalProcessingDelay")};if(["captureFrameDelay","imageCompositionDelay","inputImageResizeDelay","processFrameDelay","segmentationDelay"].forEach(function(s){n[s]=t.getAverageDelay(s)}),this._lastStatsSaveTime=r,this._stats.push(n),!(r-this._lastStatsPublishTime<_)){this._lastStatsPublishTime=r;var a=this._stats.splice(0),o=a.reduce(function(s,c,l){return Object.keys(n).forEach(function(d){s[d]||(s[d]=0),s[d]=(s[d]*l+c[d])/(l+1)}),s},{});Object.keys(o).forEach(function(s){o[s]=parseFloat(o[s].toFixed(2))}),this._reemitEvent("stats",Object.assign({},o,this._getEventData()))}}}}},e.prototype._reemitEvent=function(t,r){this._log.debug("VideoProcessor:".concat(t),r),this.emit("event",{name:t,data:r})},e})(m);return Jt=u,Jt}var Xt,Xa;function Zs(){if(Xa)return Xt;Xa=1;var g=Xt&&Xt.__extends||(function(){var o=function(s,c){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(l[v]=d[v])},o(s,c)};return function(s,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");o(s,c);function l(){this.constructor=s}s.prototype=c===null?Object.create(c):(l.prototype=c.prototype,new l)}})(),m=Hs(),_=Yu(),u=Ju(),i=Oe().DEFAULT_FRAME_RATE,e=(function(o){g(s,o);function s(c,l){var d=o.call(this,c,l)||this;return Object.defineProperties(d,{_isCapturing:{value:!1,writable:!0},_inputFrame:{value:null,writable:!0},_outputFrame:{value:null,writable:!0},_processorEventObserver:{value:null,writable:!0},_processorOptions:{value:{},writable:!0},_stopCapture:{value:function(){},writable:!0},_unmuteHandler:{value:null,writable:!0},dimensions:{enumerable:!0,value:{width:null,height:null}},processor:{enumerable:!0,value:null,writable:!0},_documentPipWindow:{value:null,writable:!0},_documentPipEnterListener:{value:null,writable:!0},_documentPipExitListener:{value:null,writable:!0}}),d._processorEventObserver=new(l.VideoProcessorEventObserver||u)(d._log),d}return s.prototype._checkIfCanCaptureFrames=function(c){c===void 0&&(c=!1);var l=!0,d="",v=this.mediaStreamTrack,p=v.enabled,T=v.readyState;return p||(l=!1,d="MediaStreamTrack is disabled"),T==="ended"&&(l=!1,d="MediaStreamTrack is ended"),this.processor||(l=!1,d="VideoProcessor not detected."),!this._attachments.size&&!c&&(l=!1,d="VideoTrack is not publishing and there is no attached element."),d&&this._log.debug(d),{canCaptureFrames:l,message:d}},s.prototype._captureFrames=function(){var c=this;if(this._isCapturing){this._log.debug("Ignoring captureFrames call. Capture is already in progress");return}if(!this._checkIfCanCaptureFrames().canCaptureFrames){this._isCapturing=!1,this._log.debug("Cannot capture frames. Ignoring captureFrames call.");return}this._isCapturing=!0,this._processorEventObserver.emit("start"),this._log.debug("Start capturing frames");var l=this._processorOptions.inputFrameBufferType;this._dummyEl.play().then(function(){var d=function(v){var p=c._checkIfCanCaptureFrames();if(!p.canCaptureFrames)return v&&v.close(),c._isCapturing=!1,c._stopCapture(),c._processorEventObserver.emit("stop",p.message),c._log.debug("Cannot capture frames. Stopping capturing frames."),Promise.resolve();var T=c.mediaStreamTrack.getSettings(),M=T.width,k=M===void 0?0:M,y=T.height,b=y===void 0?0:y;c._outputFrame&&c._outputFrame.width!==k&&(c._outputFrame.width=k,c._outputFrame.height=b),c._inputFrame&&(c._inputFrame.width!==k&&(c._inputFrame.width=k,c._inputFrame.height=b),c._inputFrame.getContext("2d").drawImage(c._dummyEl,0,0,k,b));var f=v||(["video","videoframe"].includes(l)?c._dummyEl:c._inputFrame),h=null;try{h=c.processor.processFrame(f,c._outputFrame)}catch(w){c._log.debug("Exception detected after calling processFrame.",w)}return(h instanceof Promise?h:Promise.resolve(h)).then(function(){c._outputFrame&&(typeof c.processedTrack.requestFrame=="function"&&c.processedTrack.requestFrame(),c._processorEventObserver.emit("stats"))})};c._stopCapture=_(c._dummyEl,d,l)}).catch(function(d){return c._log.error("Video element cannot be played",{error:d,track:c})})},s.prototype._initialize=function(){var c=this;o.prototype._initialize.call(this),this._dummyEl&&(this._dummyEl.onloadedmetadata=function(){t(c,c._dummyEl)&&(c.dimensions.width=c._dummyEl.videoWidth,c.dimensions.height=c._dummyEl.videoHeight)},this._dummyEl.onresize=function(){t(c,c._dummyEl)&&(c.dimensions.width=c._dummyEl.videoWidth,c.dimensions.height=c._dummyEl.videoHeight,c.isStarted&&(c._log.debug("Dimensions changed:",c.dimensions),c.emit(s.DIMENSIONS_CHANGED,c)))})},s.prototype._restartProcessor=function(){var c=this.processor;if(c){var l=Object.assign({},this._processorOptions);this.removeProcessor(c),this.addProcessor(c,l)}},s.prototype._start=function(c){return this.dimensions.width=c.videoWidth,this.dimensions.height=c.videoHeight,this._log.debug("Dimensions:",this.dimensions),this.emit(s.DIMENSIONS_CHANGED,this),o.prototype._start.call(this,c)},s.prototype.addProcessor=function(c,l){var d=this;if(!c||typeof c.processFrame!="function")throw new Error("Received an invalid VideoProcessor from addProcessor.");if(this.processor)throw new Error("A VideoProcessor has already been added.");if(!this._dummyEl)throw new Error("VideoTrack has not been initialized.");this._log.debug("Adding VideoProcessor to the VideoTrack",c),this._unmuteHandler||(this._unmuteHandler=function(){d._log.debug("mediaStreamTrack unmuted"),d.processedTrack.muted&&(d._log.debug("mediaStreamTrack is unmuted but processedTrack is muted. Restarting processor."),d._restartProcessor())},this.mediaStreamTrack.addEventListener?this.mediaStreamTrack.addEventListener("unmute",this._unmuteHandler):this.mediaStreamTrack.onunmute=this._unmuteHandler.bind(this)),this._processorOptions=l||{};var v=this._processorOptions,p=v.inputFrameBufferType,T=v.outputFrameBufferContextType;if(typeof OffscreenCanvas>"u"&&p==="offscreencanvas")throw new Error("OffscreenCanvas is not supported by this browser.");if(p&&p!=="videoframe"&&p!=="video"&&p!=="canvas"&&p!=="offscreencanvas")throw new Error("Invalid inputFrameBufferType of ".concat(p));p||(p=typeof OffscreenCanvas>"u"?"canvas":"offscreencanvas");var M=this.mediaStreamTrack.getSettings(),k=M.width,y=k===void 0?0:k,b=M.height,f=b===void 0?0:b,h=M.frameRate,w=h===void 0?i:h;p==="offscreencanvas"&&(this._inputFrame=new OffscreenCanvas(y,f)),p==="canvas"&&(this._inputFrame=document.createElement("canvas")),this._inputFrame&&(this._inputFrame.width=y,this._inputFrame.height=f),this._outputFrame=document.createElement("canvas"),this._outputFrame.width=y,this._outputFrame.height=f,T=T||"2d";var S=this._outputFrame.getContext(T);if(!S)throw new Error("Cannot get outputFrameBufferContextType: ".concat(T,"."));var E=typeof CanvasCaptureMediaStreamTrack<"u"&&CanvasCaptureMediaStreamTrack.prototype&&typeof CanvasCaptureMediaStreamTrack.prototype.requestFrame=="function"?0:void 0;return this.processedTrack=this._outputFrame.captureStream(E).getTracks()[0],this.processedTrack.enabled=this.mediaStreamTrack.enabled,this.processor=c,this._processorEventObserver.emit("add",{processor:c,captureHeight:f,captureWidth:y,inputFrameRate:w,isRemoteVideoTrack:this.toString().includes("RemoteVideoTrack"),inputFrameBufferType:p,outputFrameBufferContextType:T}),this._updateElementsMediaStreamTrack(),this._captureFrames(),this},s.prototype.attach=function(){var c=o.prototype.attach.apply(this,arguments);return this._attachments.size===1&&r(this),this.processor&&this._captureFrames(),c},s.prototype.detach=function(){var c=o.prototype.detach.apply(this,arguments);return this._attachments.size===0&&n(this),c},s.prototype.removeProcessor=function(c){if(!c)throw new Error("Received an invalid VideoProcessor from removeProcessor.");if(!this.processor)throw new Error("No existing VideoProcessor detected.");if(c!==this.processor)throw new Error("The provided VideoProcessor is different than the existing one.");return this._processorEventObserver.emit("remove"),this._log.debug("Removing VideoProcessor from the VideoTrack",c),this._stopCapture(),this._stopCapture=function(){},this.mediaStreamTrack.removeEventListener("unmute",this._unmuteHandler),this._processorOptions={},this._unmuteHandler=null,this._isCapturing=!1,this.processor=null,this.processedTrack=null,this._inputFrame=null,this._outputFrame=null,this._updateElementsMediaStreamTrack(),this},s})(m);e.DIMENSIONS_CHANGED="dimensionsChanged";function t(o,s){return o.dimensions.width!==s.videoWidth||o.dimensions.height!==s.videoHeight}function r(o){!o._documentPipEnterListener&&"documentPictureInPicture"in globalThis&&globalThis.documentPictureInPicture&&typeof globalThis.documentPictureInPicture.addEventListener=="function"&&(o._documentPipEnterListener=function(s){o._log.debug("document pip entered"),o._documentPipWindow=s.window,o._documentPipExitListener=function(){o._log.debug("document pip exited"),o._documentPipWindow=null,typeof o._onDocumentPipExit=="function"&&o._onDocumentPipExit()},s.window&&typeof s.window.addEventListener=="function"&&s.window.addEventListener("pagehide",o._documentPipExitListener),a(o),typeof o._onDocumentPipEnter=="function"&&o._onDocumentPipEnter(s)},globalThis.documentPictureInPicture.addEventListener("enter",o._documentPipEnterListener))}function n(o){o._documentPipEnterListener&&(globalThis.documentPictureInPicture&&typeof globalThis.documentPictureInPicture.removeEventListener=="function"&&globalThis.documentPictureInPicture.removeEventListener("enter",o._documentPipEnterListener),o._documentPipWindow&&o._documentPipExitListener&&typeof o._documentPipWindow.removeEventListener=="function"&&o._documentPipWindow.removeEventListener("pagehide",o._documentPipExitListener),o._documentPipEnterListener=null,o._documentPipExitListener=null,o._documentPipWindow=null)}function a(o){if(o._documentPipWindow)try{var s=new WeakSet(o._documentPipWindow.document.querySelectorAll("video"));o._attachments.forEach(function(c){s.has(c)&&c.paused&&c.play().then(function(){o._log.debug("Successfully played inadvertently paused video element in document PiP window")}).catch(function(l){o._log.debug("Failed to play inadvertently paused video element in document PiP window",l)})})}catch(c){o._log.debug("Error checking document PiP video playback:",c)}}return e._ensureDocumentPipVideosPlaying=a,Xt=e,Xt}var Zt,Za;function Xu(){if(Za)return Zt;Za=1;var g=Zt&&Zt.__extends||(function(){var n=function(a,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(s[l]=c[l])},n(a,o)};return function(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(a,o);function s(){this.constructor=a}a.prototype=o===null?Object.create(o):(s.prototype=o.prototype,new s)}})(),m=xt().isIOS,_=Gs(),u=Xs(),i=Zs(),e=u(i),t=(function(n){g(a,n);function a(o,s){var c=this;return s=Object.assign({workaroundSilentLocalVideo:m()&&typeof document<"u"&&typeof document.createElement=="function"},s),c=n.call(this,o,s)||this,Object.defineProperties(c,{_workaroundSilentLocalVideo:{value:s.workaroundSilentLocalVideo?r:null},_workaroundSilentLocalVideoCleanup:{value:null,writable:!0},_pipIntersectionObserver:{value:null,writable:!0}}),c._workaroundSilentLocalVideo&&(c._workaroundSilentLocalVideoCleanup=c._workaroundSilentLocalVideo(c,document)),c}return a.prototype.toString=function(){return"[LocalVideoTrack #".concat(this._instanceId,": ").concat(this.id,"]")},a.prototype._onDocumentPipEnter=function(){this._log.debug("LocalVideoTrack: Setting up PiP intersection observer"),this._setupPipIntersectionObserver()},a.prototype._onDocumentPipExit=function(){this._log.debug("LocalVideoTrack: Cleaning up PiP intersection observer"),this._cleanupPipIntersectionObserver()},a.prototype._setupPipIntersectionObserver=function(){var o=this;!this._pipIntersectionObserver&&this._documentPipWindow&&(this._log.debug("LocalVideoTrack: Creating PiP intersection observer"),this._pipIntersectionObserver=new IntersectionObserver(function(s){var c=s.some(function(l){return l.isIntersecting});c&&(o._log.debug("LocalVideoTrack: Element visible in PiP, ensuring videos are playing"),i._ensureDocumentPipVideosPlaying(o))},{threshold:.25}),this._attachments.forEach(function(s){o._log.debug("LocalVideoTrack: Observing element for PiP visibility"),o._pipIntersectionObserver.observe(s)}))},a.prototype._cleanupPipIntersectionObserver=function(){this._pipIntersectionObserver&&(this._log.debug("LocalVideoTrack: Disconnecting PiP intersection observer"),this._pipIntersectionObserver.disconnect(),this._pipIntersectionObserver=null)},a.prototype.attach=function(){var o=n.prototype.attach.apply(this,arguments);return this._pipIntersectionObserver&&(this._log.debug("LocalVideoTrack: Observing newly attached element for PiP visibility"),this._pipIntersectionObserver.observe(o)),o},a.prototype.detach=function(){var o=this,s=n.prototype.detach.apply(this,arguments),c=Array.isArray(s)?s:[s];return this._pipIntersectionObserver&&c.forEach(function(l){o._log.debug("LocalVideoTrack: Unobserving detached element from PiP visibility"),o._pipIntersectionObserver.unobserve(l)}),s},a.prototype._checkIfCanCaptureFrames=function(){return n.prototype._checkIfCanCaptureFrames.call(this,this._trackSender.isPublishing)},a.prototype._end=function(){return n.prototype._end.apply(this,arguments)},a.prototype._setSenderMediaStreamTrack=function(o){var s=this,c=this.mediaStreamTrack,l=o?this.processedTrack:c;return this._trackSender.setMediaStreamTrack(l).catch(function(d){return s._log.warn("setMediaStreamTrack failed on LocalVideoTrack RTCRtpSender",{error:d,mediaStreamTrack:l})}).then(function(){s._unprocessedTrack=o?c:null})},a.prototype.addProcessor=function(){this._log.debug("Adding VideoProcessor to the LocalVideoTrack");var o=n.prototype.addProcessor.apply(this,arguments);return this.processedTrack?(this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0),o):this._log.warn("Unable to add a VideoProcessor to the LocalVideoTrack")},a.prototype.removeProcessor=function(){var o=this;this._log.debug("Removing VideoProcessor from the LocalVideoTrack");var s=n.prototype.removeProcessor.apply(this,arguments);return this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the original MediaStreamTrack"),this._setSenderMediaStreamTrack().then(function(){return o._updateElementsMediaStreamTrack()}),s},a.prototype.disable=function(){var o=n.prototype.disable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=!1),o},a.prototype.enable=function(o){o===void 0&&(o=!0);var s=n.prototype.enable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=o,o&&(this._captureFrames(),this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0))),s},a.prototype.restart=function(){var o=this;this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null);var s=n.prototype.restart.apply(this,arguments);return this.processor&&(s=s.then(function(){return o._restartProcessor()})),this._workaroundSilentLocalVideo&&s.finally(function(){o._workaroundSilentLocalVideoCleanup=o._workaroundSilentLocalVideo(o,document)}),s},a.prototype._restartProcessor=function(){var o=this.processor,s=Object.assign({},this._processorOptions);return n.prototype.removeProcessor.apply(this,[o]),n.prototype.addProcessor.apply(this,[o,s]),this._setSenderMediaStreamTrack(!0)},a.prototype.stop=function(){return this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null),this._cleanupPipIntersectionObserver(),n.prototype.stop.apply(this,arguments)},a})(e);function r(n,a){var o=n._log,s=n._dummyEl,c=n.mediaStreamTrack;function l(){n.isEnabled&&(o.info("Unmuted, checking silence"),s.play().then(function(){return _(s,a)}).then(function(d){if(!d){o.info("Non-silent frames detected, so no need to restart");return}return o.warn("Silence detected, restarting"),n._stop(),n._restart()}).catch(function(d){o.warn("Failed to detect silence and restart:",d)}).finally(function(){s=n._dummyEl,s&&!s.paused&&!n.processedTrack&&s.pause(),c.removeEventListener("unmute",l),c=n.mediaStreamTrack,c.addEventListener?c.addEventListener("unmute",l):c.onunmute=l}))}return c.addEventListener?c.addEventListener("unmute",l):c.onunmute=l,function(){c.removeEventListener?c.removeEventListener("unmute",l):c.onunmute=null}}return Zt=t,Zt}var Yn,eo;function Zu(){if(eo)return Yn;eo=1;var g=Qi(),m=Xu();function _(u,i){var e=new m(u,i);return Object.setPrototypeOf(e,_.prototype),e}return g(_,m),Yn=_,Yn}var er,to;function eu(){if(to)return er;to=1;var g=er&&er.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ks(),_=(function(u){g(i,u);function i(e,t,r,n){var a=u.call(this,e,"data")||this;return Object.defineProperties(a,{maxPacketLifeTime:{enumerable:!0,value:t},maxRetransmits:{enumerable:!0,value:r},ordered:{enumerable:!0,value:n}}),a}return i})(m);return er=_,er}var tr,ro;function el(){if(ro)return tr;ro=1;var g=tr&&tr.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=eu(),_=Ee().makeUUID,u=(function(i){g(e,i);function e(t,r,n){var a=i.call(this,_(),t,r,n)||this;return Object.defineProperties(a,{_clones:{value:new Set},_dataChannels:{value:new Set}}),a}return e.prototype._addClone=function(t){this._clones.add(t)},e.prototype.removeClone=function(t){this._clones.delete(t)},e.prototype.addDataChannel=function(t){return this._dataChannels.add(t),this},e.prototype.clone=function(){var t=this,r=new e(this.maxPacketLifeTime,this.maxRetransmits,this.ordered);return this._addClone(r),r.once("stopped",function(){return t.removeClone(r)}),r},e.prototype.removeDataChannel=function(t){return this._dataChannels.delete(t),this},e.prototype.send=function(t){return this._dataChannels.forEach(function(r){try{r.send(t)}catch{}}),this._clones.forEach(function(r){try{r.send(t)}catch{}}),this},e.prototype.stop=function(){this._dataChannels.forEach(function(t){return t.close()}),this._clones.forEach(function(t){return t.stop()}),i.prototype.stop.call(this)},e})(m);return tr=u,tr}var rr,no;function tl(){if(no)return rr;no=1;var g=rr&&rr.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=Gi(),_=el(),u=(function(i){g(e,i);function e(t){var r=this;t=Object.assign({DataTrackSender:_,maxPacketLifeTime:null,maxRetransmits:null,ordered:!0},t);var n=t.DataTrackSender,a=new n(t.maxPacketLifeTime,t.maxRetransmits,t.ordered);return r=i.call(this,a.id,"data",t)||this,Object.defineProperties(r,{_trackSender:{value:a},id:{enumerable:!0,value:a.id},maxPacketLifeTime:{enumerable:!0,value:t.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:t.maxRetransmits},ordered:{enumerable:!0,value:t.ordered},reliable:{enumerable:!0,value:t.maxPacketLifeTime===null&&t.maxRetransmits===null}}),r}return e.prototype.send=function(t){this._trackSender.send(t)},e})(m);return rr=u,rr}var Jn,io;function rl(){if(io)return Jn;io=1;var g=Qi(),m=tl();function _(u){var i=new m(u);return Object.setPrototypeOf(i,_.prototype),i}return g(_,m),Jn=_,Jn}var Xn,ao;function Dt(){return ao||(ao=1,Xn={LocalAudioTrack:Ku(),LocalVideoTrack:Zu(),LocalDataTrack:rl()}),Xn}var Zn,oo;function nl(){if(oo)return Zn;oo=1;var g=(function(){function m(_){this._telemetry=_}return m.prototype.typeChanged=function(_){this._telemetry.info({group:"network",name:"network-type-changed",payload:{networkType:_}})},m.prototype.informationChanged=function(_){var u=_.downlink,i=_.downlinkMax,e=_.effectiveType,t=_.rtt,r=_.saveData,n=_.type;this._telemetry.info({group:"network",name:"network-information-changed",payload:{downlink:u,downlinkMax:i,effectiveType:e,rtt:t,saveData:r,type:n}})},m})();return Zn=g,Zn}var ei,co;function il(){if(co)return ei;co=1;var g=(function(){function m(_){this._telemetry=_}return m.prototype.succeeded=function(){this._telemetry.info({group:"get-user-media",name:"succeeded"})},m.prototype.denied=function(){this._telemetry.info({group:"get-user-media",name:"denied"})},m.prototype.failed=function(_){this._telemetry.info({group:"get-user-media",name:"failed",payload:{name:_.name,message:_.message}})},m})();return ei=g,ei}var ti,so;function al(){if(so)return ti;so=1;var g=(function(){function m(_){this._telemetry=_}return m.prototype.limitationChanged=function(_,u){this._telemetry.info({group:"quality",name:"quality-limitation-state-changed",payload:{trackSid:_,qualityLimitationReason:u}})},m.prototype.statsReport=function(_){this._telemetry.info({group:"quality",name:"stats-report",payload:_})},m.prototype.iceCandidatePair=function(_){this._telemetry.info({group:"quality",name:"active-ice-candidate-pair",payload:_})},m})();return ti=g,ti}var ri,uo;function ol(){if(uo)return ri;uo=1;var g=(function(){function m(_){this._telemetry=_}return m.prototype.stalled=function(_,u,i,e){e===void 0&&(e="video"),this._telemetry.warning({group:"track-warning-raised",name:"track-stalled",payload:{trackSid:_,frameRate:u,threshold:i,trackType:e}})},m.prototype.resumed=function(_,u,i,e){e===void 0&&(e="video"),this._telemetry.info({group:"track-warning-cleared",name:"track-stalled",payload:{trackSid:_,frameRate:u,threshold:i,trackType:e}})},m})();return ri=g,ri}var ni,lo;function cl(){if(lo)return ni;lo=1;var g=(function(){function m(_){this._telemetry=_}return m.prototype.resumed=function(){this._telemetry.info({group:"application",name:"resumed"})},m.prototype.backgrounded=function(){this._telemetry.info({group:"application",name:"backgrounded"})},m.prototype.terminated=function(){this._telemetry.info({group:"application",name:"terminated"})},m})();return ni=g,ni}var ii,fo;function sl(){if(fo)return ii;fo=1;var g=(function(){function m(_){this._telemetry=_}return m.prototype.cpuPressureChanged=function(_){this._telemetry.info({group:"system",name:"cpu-pressure-changed",payload:{resourceType:"cpu",pressure:_}})},m})();return ii=g,ii}var nr,po;function ul(){if(po)return nr;po=1;var g=nr&&nr.__assign||function(){return g=Object.assign||function(u){for(var i,e=1,t=arguments.length;e<t;e++){i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(u[r]=i[r])}return u},g.apply(this,arguments)},m=Ee().filterObject,_=(function(){function u(i){this._telemetry=i}return u.prototype.connectionState=function(i,e){this._telemetry.debug({group:"pc-connection-state",name:e,payload:{peerConnectionId:i}})},u.prototype.signalingState=function(i,e){this._telemetry.debug({group:"pc-signaling-state",name:e,payload:{peerConnectionId:i}})},u.prototype.iceGatheringState=function(i,e){this._telemetry.debug({group:"ice-gathering-state",name:e,payload:{peerConnectionId:i}})},u.prototype.iceConnectionState=function(i,e){var t=e==="failed"?"error":"debug";this._telemetry[t]({group:"ice-connection-state",name:e,payload:{peerConnectionId:i}})},u.prototype.dtlsTransportState=function(i,e){var t=e==="failed"?"error":"debug";this._telemetry[t]({group:"dtls-transport-state",name:e,payload:{peerConnectionId:i}})},u.prototype.iceCandidate=function(i,e,t){t===void 0&&(t=!1),this._telemetry.debug({group:"ice-candidate",name:"ice-candidate",payload:g({peerConnectionId:i,isRemote:t?"true":"false"},this._toIceCandidatePayload(e))})},u.prototype.selectedCandidatePair=function(i,e){this._telemetry.debug({group:"ice-candidate",name:"selected-ice-candidate-pair",payload:m({peerConnectionId:i,localCandidate:e.local?this._toIceCandidatePayload(e.local):null,remoteCandidate:e.remote?this._toIceCandidatePayload(e.remote):null},null)})},u.prototype._toIceCandidatePayload=function(i){var e,t=(e=i.candidate)===null||e===void 0?void 0:e.match(/network-cost\s+(\d+)/),r=t?parseInt(t[1],10):null;return m({candidateType:i.type,ip:i.address,port:i.port,priority:i.priority,protocol:i.protocol,relatedAddress:i.relatedAddress,relatedPort:i.relatedPort,tcpType:i.tcpType,transportId:i.sdpMid,networkCost:r},null)},u})();return nr=_,nr}var de={},tt,vo;function ll(){if(vo)return tt;vo=1;var g=tt&&tt.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=tt&&tt.__read||function(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var r=t.call(i),n,a=[],o;try{for(;(e===void 0||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return a},_=tt&&tt.__spreadArray||function(i,e,t){if(t||arguments.length===2)for(var r=0,n=e.length,a;r<n;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return i.concat(a||Array.prototype.slice.call(e))},u=(function(i){g(e,i);function e(t){var r=this,n=[].slice.call(arguments,1);r=i.apply(this,_([],m(n),!1))||this,Object.setPrototypeOf(r,e.prototype);var a=Error.apply(r,n);return a.name="TwilioError",Object.defineProperty(r,"code",{value:t,enumerable:!0}),Object.getOwnPropertyNames(a).forEach(function(o){Object.defineProperty(this,o,{value:a[o],enumerable:!0})},r),r}return e.prototype.toString=function(){var t=this.message?": ".concat(this.message):"";return"".concat(this.name," ").concat(this.code).concat(t)},e})(Error);return tt=u,tt}var ho;function ze(){if(ho)return de;ho=1;var g=de&&de.__extends||(function(){var L=function(P,N){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(X,ee){X.__proto__=ee}||function(X,ee){for(var ae in ee)Object.prototype.hasOwnProperty.call(ee,ae)&&(X[ae]=ee[ae])},L(P,N)};return function(P,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");L(P,N);function X(){this.constructor=P}P.prototype=N===null?Object.create(N):(X.prototype=N.prototype,new X)}})(),m=ll(),_={};de.createTwilioError=function(P,N){return P=typeof P=="number"?P:0,N=typeof N=="string"&&N?N:"Unknown error",_[P]?new _[P]:new m(P,N)};var u=(function(L){g(P,L);function P(){var N=L.call(this,20101,"Invalid Access Token")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.AccessTokenInvalidError=u,Object.defineProperty(_,20101,{value:u});var i=(function(L){g(P,L);function P(){var N=L.call(this,20102,"Invalid Access Token header")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.AccessTokenHeaderInvalidError=i,Object.defineProperty(_,20102,{value:i});var e=(function(L){g(P,L);function P(){var N=L.call(this,20103,"Invalid Access Token issuer/subject")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.AccessTokenIssuerInvalidError=e,Object.defineProperty(_,20103,{value:e});var t=(function(L){g(P,L);function P(){var N=L.call(this,20104,"Access Token expired or expiration date invalid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.AccessTokenExpiredError=t,Object.defineProperty(_,20104,{value:t});var r=(function(L){g(P,L);function P(){var N=L.call(this,20105,"Access Token not yet valid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.AccessTokenNotYetValidError=r,Object.defineProperty(_,20105,{value:r});var n=(function(L){g(P,L);function P(){var N=L.call(this,20106,"Invalid Access Token grants")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.AccessTokenGrantsInvalidError=n,Object.defineProperty(_,20106,{value:n});var a=(function(L){g(P,L);function P(){var N=L.call(this,20107,"Invalid Access Token signature")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.AccessTokenSignatureInvalidError=a,Object.defineProperty(_,20107,{value:a});var o=(function(L){g(P,L);function P(){var N=L.call(this,53e3,"Signaling connection error")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.SignalingConnectionError=o,Object.defineProperty(_,53e3,{value:o});var s=(function(L){g(P,L);function P(){var N=L.call(this,53001,"Signaling connection disconnected")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.SignalingConnectionDisconnectedError=s,Object.defineProperty(_,53001,{value:s});var c=(function(L){g(P,L);function P(){var N=L.call(this,53002,"Signaling connection timed out")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.SignalingConnectionTimeoutError=c,Object.defineProperty(_,53002,{value:c});var l=(function(L){g(P,L);function P(){var N=L.call(this,53003,"Client received an invalid signaling message")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.SignalingIncomingMessageInvalidError=l,Object.defineProperty(_,53003,{value:l});var d=(function(L){g(P,L);function P(){var N=L.call(this,53004,"Client sent an invalid signaling message")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.SignalingOutgoingMessageInvalidError=d,Object.defineProperty(_,53004,{value:d});var v=(function(L){g(P,L);function P(){var N=L.call(this,53006,"Video server is busy")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.SignalingServerBusyError=v,Object.defineProperty(_,53006,{value:v});var p=(function(L){g(P,L);function P(){var N=L.call(this,53100,"Room name is invalid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomNameInvalidError=p,Object.defineProperty(_,53100,{value:p});var T=(function(L){g(P,L);function P(){var N=L.call(this,53101,"Room name is too long")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomNameTooLongError=T,Object.defineProperty(_,53101,{value:T});var M=(function(L){g(P,L);function P(){var N=L.call(this,53102,"Room name contains invalid characters")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomNameCharsInvalidError=M,Object.defineProperty(_,53102,{value:M});var k=(function(L){g(P,L);function P(){var N=L.call(this,53103,"Unable to create Room")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomCreateFailedError=k,Object.defineProperty(_,53103,{value:k});var y=(function(L){g(P,L);function P(){var N=L.call(this,53104,"Unable to connect to Room")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomConnectFailedError=y,Object.defineProperty(_,53104,{value:y});var b=(function(L){g(P,L);function P(){var N=L.call(this,53105,"Room contains too many Participants")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomMaxParticipantsExceededError=b,Object.defineProperty(_,53105,{value:b});var f=(function(L){g(P,L);function P(){var N=L.call(this,53106,"Room not found")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomNotFoundError=f,Object.defineProperty(_,53106,{value:f});var h=(function(L){g(P,L);function P(){var N=L.call(this,53107,"MaxParticipants is out of range")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomMaxParticipantsOutOfRangeError=h,Object.defineProperty(_,53107,{value:h});var w=(function(L){g(P,L);function P(){var N=L.call(this,53108,"RoomType is not valid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomTypeInvalidError=w,Object.defineProperty(_,53108,{value:w});var S=(function(L){g(P,L);function P(){var N=L.call(this,53109,"Timeout is out of range")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomTimeoutOutOfRangeError=S,Object.defineProperty(_,53109,{value:S});var E=(function(L){g(P,L);function P(){var N=L.call(this,53110,"StatusCallbackMethod is invalid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomStatusCallbackMethodInvalidError=E,Object.defineProperty(_,53110,{value:E});var q=(function(L){g(P,L);function P(){var N=L.call(this,53111,"StatusCallback is invalid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomStatusCallbackInvalidError=q,Object.defineProperty(_,53111,{value:q});var O=(function(L){g(P,L);function P(){var N=L.call(this,53112,"Status is invalid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomStatusInvalidError=O,Object.defineProperty(_,53112,{value:O});var C=(function(L){g(P,L);function P(){var N=L.call(this,53113,"Room exists")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomRoomExistsError=C,Object.defineProperty(_,53113,{value:C});var I=(function(L){g(P,L);function P(){var N=L.call(this,53114,"Room creation parameter(s) incompatible with the Room type")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomInvalidParametersError=I,Object.defineProperty(_,53114,{value:I});var x=(function(L){g(P,L);function P(){var N=L.call(this,53115,"MediaRegion is invalid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomMediaRegionInvalidError=x,Object.defineProperty(_,53115,{value:x});var A=(function(L){g(P,L);function P(){var N=L.call(this,53116,"There are no media servers available in the MediaRegion")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomMediaRegionUnavailableError=A,Object.defineProperty(_,53116,{value:A});var R=(function(L){g(P,L);function P(){var N=L.call(this,53117,"The subscription operation requested is not supported for the Room type")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomSubscriptionOperationNotSupportedError=R,Object.defineProperty(_,53117,{value:R});var F=(function(L){g(P,L);function P(){var N=L.call(this,53118,"Room completed")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomCompletedError=F,Object.defineProperty(_,53118,{value:F});var V=(function(L){g(P,L);function P(){var N=L.call(this,53124,"The AudioOnly flag is not supported for the Room type")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomAudioOnlyFlagNotSupportedError=V,Object.defineProperty(_,53124,{value:V});var U=(function(L){g(P,L);function P(){var N=L.call(this,53125,"The track kind is not supported by the Room")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.RoomTrackKindNotSupportedError=U,Object.defineProperty(_,53125,{value:U});var j=(function(L){g(P,L);function P(){var N=L.call(this,53200,"Participant identity is invalid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.ParticipantIdentityInvalidError=j,Object.defineProperty(_,53200,{value:j});var D=(function(L){g(P,L);function P(){var N=L.call(this,53201,"Participant identity is too long")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.ParticipantIdentityTooLongError=D,Object.defineProperty(_,53201,{value:D});var H=(function(L){g(P,L);function P(){var N=L.call(this,53202,"Participant identity contains invalid characters")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.ParticipantIdentityCharsInvalidError=H,Object.defineProperty(_,53202,{value:H});var $=(function(L){g(P,L);function P(){var N=L.call(this,53203,"The maximum number of published tracks allowed in the Room at the same time has been reached")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.ParticipantMaxTracksExceededError=$,Object.defineProperty(_,53203,{value:$});var re=(function(L){g(P,L);function P(){var N=L.call(this,53204,"Participant not found")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.ParticipantNotFoundError=re,Object.defineProperty(_,53204,{value:re});var Y=(function(L){g(P,L);function P(){var N=L.call(this,53205,"Participant disconnected because of duplicate identity")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.ParticipantDuplicateIdentityError=Y,Object.defineProperty(_,53205,{value:Y});var Z=(function(L){g(P,L);function P(){var N=L.call(this,53300,"Track is invalid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.TrackInvalidError=Z,Object.defineProperty(_,53300,{value:Z});var ne=(function(L){g(P,L);function P(){var N=L.call(this,53301,"Track name is invalid")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.TrackNameInvalidError=ne,Object.defineProperty(_,53301,{value:ne});var ie=(function(L){g(P,L);function P(){var N=L.call(this,53302,"Track name is too long")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.TrackNameTooLongError=ie,Object.defineProperty(_,53302,{value:ie});var be=(function(L){g(P,L);function P(){var N=L.call(this,53303,"Track name contains invalid characters")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.TrackNameCharsInvalidError=be,Object.defineProperty(_,53303,{value:be});var ce=(function(L){g(P,L);function P(){var N=L.call(this,53304,"Track name is duplicated")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.TrackNameIsDuplicatedError=ce,Object.defineProperty(_,53304,{value:ce});var pe=(function(L){g(P,L);function P(){var N=L.call(this,53305,"The server has reached capacity and cannot fulfill this request")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.TrackServerTrackCapacityReachedError=pe,Object.defineProperty(_,53305,{value:pe});var Te=(function(L){g(P,L);function P(){var N=L.call(this,53400,"Client is unable to create or apply a local media description")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.MediaClientLocalDescFailedError=Te,Object.defineProperty(_,53400,{value:Te});var ge=(function(L){g(P,L);function P(){var N=L.call(this,53401,"Server is unable to create or apply a local media description")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.MediaServerLocalDescFailedError=ge,Object.defineProperty(_,53401,{value:ge});var _e=(function(L){g(P,L);function P(){var N=L.call(this,53402,"Client is unable to apply a remote media description")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.MediaClientRemoteDescFailedError=_e,Object.defineProperty(_,53402,{value:_e});var he=(function(L){g(P,L);function P(){var N=L.call(this,53403,"Server is unable to apply a remote media description")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.MediaServerRemoteDescFailedError=he,Object.defineProperty(_,53403,{value:he});var le=(function(L){g(P,L);function P(){var N=L.call(this,53404,"No supported codec")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.MediaNoSupportedCodecError=le,Object.defineProperty(_,53404,{value:le});var z=(function(L){g(P,L);function P(){var N=L.call(this,53405,"Media connection failed or Media activity ceased")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.MediaConnectionError=z,Object.defineProperty(_,53405,{value:z});var ke=(function(L){g(P,L);function P(){var N=L.call(this,53407,"Media connection failed due to DTLS handshake failure")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.MediaDTLSTransportFailedError=ke,Object.defineProperty(_,53407,{value:ke});var se=(function(L){g(P,L);function P(){var N=L.call(this,53500,"Unable to acquire configuration")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);de.ConfigurationAcquireFailedError=se,Object.defineProperty(_,53500,{value:se});var me=(function(L){g(P,L);function P(){var N=L.call(this,53501,"Unable to acquire TURN credentials")||this;return Object.setPrototypeOf(N,P.prototype),N}return P})(m);return de.ConfigurationAcquireTurnFailedError=me,Object.defineProperty(_,53501,{value:me}),de}var ai,_o;function dl(){if(_o)return ai;_o=1;var g=ze().MediaConnectionError,m=(function(){function _(u){this._telemetry=u}return _.prototype.reconnecting=function(u){var i=u instanceof g?"media":"signaling";this._telemetry.info({group:"room",name:"reconnecting",payload:{reason:i}})},_.prototype.reconnected=function(){this._telemetry.info({group:"room",name:"reconnected"})},_.prototype.disconnected=function(){this._telemetry.info({group:"room",name:"disconnected"})},_})();return ai=m,ai}var oi,mo;function ht(){if(mo)return oi;mo=1;var g=nl(),m=il(),_=al(),u=ol(),i=cl(),e=sl(),t=ul(),r=dl(),n=(function(){function a(){this._publisher=null,this._connectTimestamp=null,this._log=null,this._isConfigured=!1,this.network=new g(this),this.getUserMedia=new m(this),this.quality=new _(this),this.track=new u(this),this.application=new i(this),this.system=new e(this),this.pc=new t(this),this.room=new r(this)}return a.prototype.configure=function(o){var s=this,c=o.publisher,l=o.log,d=o.connectTimestamp;if(!c||!l||typeof d!="number")throw new Error("Telemetry.configure requires publisher, log, and connectTimestamp");return this._publisher=c,this._log=l,this._connectTimestamp=d,this._isConfigured=!0,this._publisher.on("connected",function(){s._log.debug("Telemetry publisher connected.")}),this._publisher.on("reconnecting",function(){s._log.warn("Telemetry publisher reconnecting...")}),this},a.prototype._emit=function(o,s,c,l){if(this._isConfigured){var d=Date.now(),v=d-this._connectTimestamp,p=Object.assign({elapsedTime:v,level:c},l||{}),T=this._publisher.publish(o,s,p);if(!T){this._log.warn('Telemetry event "'.concat(o,":").concat(s,'" dropped - publisher unavailable.'));return}var M=Object.assign({elapsedTime:v,group:o,level:c,name:s,timestamp:d},l?{payload:l}:{}),k={debug:"debug",error:"error",info:"info",warning:"warn"}[c];this._log[k]("telemetry",M)}},a.prototype.info=function(o){var s=o.group,c=o.name,l=o.payload;return this._emit(s,c,"info",l)},a.prototype.warning=function(o){var s=o.group,c=o.name,l=o.payload;return this._emit(s,c,"warning",l)},a.prototype.error=function(o){var s=o.group,c=o.name,l=o.payload;return this._emit(s,c,"error",l)},a.prototype.debug=function(o){var s=o.group,c=o.name,l=o.payload;return this._emit(s,c,"debug",l)},a})();return oi=new n,oi}var yo;function fl(){if(yo)return Fe;yo=1;var g=Fe&&Fe.__assign||function(){return g=Object.assign||function(h){for(var w,S=1,E=arguments.length;S<E;S++){w=arguments[S];for(var q in w)Object.prototype.hasOwnProperty.call(w,q)&&(h[q]=w[q])}return h},g.apply(this,arguments)},m=Fe&&Fe.__awaiter||function(h,w,S,E){function q(O){return O instanceof S?O:new S(function(C){C(O)})}return new(S||(S=Promise))(function(O,C){function I(R){try{A(E.next(R))}catch(F){C(F)}}function x(R){try{A(E.throw(R))}catch(F){C(F)}}function A(R){R.done?O(R.value):q(R.value).then(I,x)}A((E=E.apply(h,w||[])).next())})},_=Fe&&Fe.__generator||function(h,w){var S={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},E,q,O,C=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return C.next=I(0),C.throw=I(1),C.return=I(2),typeof Symbol=="function"&&(C[Symbol.iterator]=function(){return this}),C;function I(A){return function(R){return x([A,R])}}function x(A){if(E)throw new TypeError("Generator is already executing.");for(;C&&(C=0,A[0]&&(S=0)),S;)try{if(E=1,q&&(O=A[0]&2?q.return:A[0]?q.throw||((O=q.return)&&O.call(q),0):q.next)&&!(O=O.call(q,A[1])).done)return O;switch(q=0,O&&(A=[A[0]&2,O.value]),A[0]){case 0:case 1:O=A;break;case 4:return S.label++,{value:A[1],done:!1};case 5:S.label++,q=A[1],A=[0];continue;case 7:A=S.ops.pop(),S.trys.pop();continue;default:if(O=S.trys,!(O=O.length>0&&O[O.length-1])&&(A[0]===6||A[0]===2)){S=0;continue}if(A[0]===3&&(!O||A[1]>O[0]&&A[1]<O[3])){S.label=A[1];break}if(A[0]===6&&S.label<O[1]){S.label=O[1],O=A;break}if(O&&S.label<O[2]){S.label=O[2],S.ops.push(A);break}O[2]&&S.ops.pop(),S.trys.pop();continue}A=w.call(h,S)}catch(R){A=[6,R],q=0}finally{E=O=0}if(A[0]&5)throw A[1];return{value:A[0]?A[1]:void 0,done:!0}}},u=Fe&&Fe.__read||function(h,w){var S=typeof Symbol=="function"&&h[Symbol.iterator];if(!S)return h;var E=S.call(h),q,O=[],C;try{for(;(w===void 0||w-- >0)&&!(q=E.next()).done;)O.push(q.value)}catch(I){C={error:I}}finally{try{q&&!q.done&&(S=E.return)&&S.call(E)}finally{if(C)throw C.error}}return O},i=Fe&&Fe.__spreadArray||function(h,w,S){if(S||arguments.length===2)for(var E=0,q=w.length,O;E<q;E++)(O||!(E in w))&&(O||(O=Array.prototype.slice.call(w,0,E)),O[E]=w[E]);return h.concat(O||Array.prototype.slice.call(w))};Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.createLocalTracks=f;var e=Nu(),t=Ee().buildLogLevels,r=Lt(),n=r.getUserMedia,a=r.MediaStreamTrack,o=Dt(),s=o.LocalAudioTrack,c=o.LocalDataTrack,l=o.LocalVideoTrack,d=Qe(),v=Oe(),p=v.DEFAULT_LOG_LEVEL,T=v.DEFAULT_LOGGER_NAME,M=v.typeErrors.INVALID_VALUE,k=$s(),y=ht(),b=0;function f(h){return m(this,void 0,void 0,function(){var w,S,E,q,O,C,I,x,A,R,F,V,U,j=this;return _(this,function(D){switch(D.label){case 0:if(w=!(h&&("audio"in h||"video"in h)),S=g({audio:w,getUserMedia:n,loggerName:T,logLevel:p,LocalAudioTrack:s,LocalDataTrack:c,LocalVideoTrack:l,MediaStreamTrack:a,Log:d,video:w},h),E="[createLocalTracks #".concat(++b,"]"),q=t(S.logLevel),O=new S.Log("default",E,q,S.loggerName),C=Object.assign({log:O},S),delete C.name,S.audio===!1&&S.video===!1)return O.info("Neither audio nor video requested, so returning empty LocalTracks"),[2,[]];if(S.tracks)return O.info("Adding user-provided LocalTracks"),O.debug("LocalTracks:",S.tracks),[2,S.tracks];if(I={audio:typeof S.audio=="object"&&S.audio.name?{name:S.audio.name}:{defaultDeviceCaptureMode:"auto"},video:typeof S.video=="object"&&S.video.name?{name:S.video.name}:{}},I.audio.isCreatedByCreateLocalTracks=!0,I.video.isCreatedByCreateLocalTracks=!0,typeof S.audio=="object")if(typeof S.audio.workaroundWebKitBug1208516=="boolean"&&(I.audio.workaroundWebKitBug1208516=S.audio.workaroundWebKitBug1208516),"noiseCancellationOptions"in S.audio&&(x=S.audio.noiseCancellationOptions,delete S.audio.noiseCancellationOptions),!("defaultDeviceCaptureMode"in S.audio))I.audio.defaultDeviceCaptureMode="auto";else{if(["auto","manual"].every(function(H){return H!==S.audio.defaultDeviceCaptureMode}))throw M("CreateLocalAudioTrackOptions.defaultDeviceCaptureMode",["auto","manual"]);I.audio.defaultDeviceCaptureMode=S.audio.defaultDeviceCaptureMode}typeof S.video=="object"&&typeof S.video.workaroundWebKitBug1208516=="boolean"&&(I.video.workaroundWebKitBug1208516=S.video.workaroundWebKitBug1208516),typeof S.audio=="object"&&delete S.audio.name,typeof S.video=="object"&&delete S.video.name,A={audio:S.audio,video:S.video},R=typeof S.audio=="object"&&S.audio.workaroundWebKitBug180748,D.label=1;case 1:return D.trys.push([1,4,,5]),[4,R?k(O,S.getUserMedia,A):S.getUserMedia(A)];case 2:return F=D.sent(),y.getUserMedia.succeeded(),V=i(i([],u(F.getAudioTracks()),!1),u(F.getVideoTracks()),!1),O.info("Call to getUserMedia successful; got tracks:",V),[4,Promise.all(V.map(function(H){return m(j,void 0,void 0,function(){var $,re,Y;return _(this,function(Z){switch(Z.label){case 0:return H.kind==="audio"&&x?[4,(0,e.applyNoiseCancellation)(H,x,O)]:[3,2];case 1:return $=Z.sent(),re=$.cleanTrack,Y=$.noiseCancellation,[2,new C.LocalAudioTrack(re,g(g(g({},I.audio),C),{noiseCancellation:Y}))];case 2:if(H.kind==="audio")return[2,new C.LocalAudioTrack(H,g(g({},I.audio),C))];Z.label=3;case 3:return[2,new C.LocalVideoTrack(H,g(g({},I.video),C))]}})})}))];case 3:return[2,D.sent()];case 4:throw U=D.sent(),U.name==="NotAllowedError"||U.name==="PermissionDeniedError"?y.getUserMedia.denied():y.getUserMedia.failed(U),O.warn("Call to getUserMedia failed:",U),U;case 5:return[2]}})})}return Fe}var Be={},ir={},go;function pl(){if(go)return ir;go=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.Timer=void 0;var g=(function(){function m(){this._end=void 0,this.start()}return m.prototype.start=function(){return this._start=Date.now(),this},m.prototype.stop=function(){return this._end=Date.now(),this},m.prototype.getTimeMeasurement=function(){return{start:this._start,end:this._end,duration:this._end===void 0?void 0:this._end-this._start}},m})();return ir.Timer=g,ir}var ar={},bo;function vl(){if(bo)return ar;bo=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.calculateMOS=m,ar.mosToScore=_;var g=94.768;function m(u,i,e){var t=u+i*2+10,r=0;switch(!0){case t<160:r=g-t/40;break;case t<1e3:r=g-(t-120)/10;break}!0===e<=r/2.5?r=Math.max(r-e*2.5,6.52):r=0;var n=1+.035*r+7e-6*r*(r-60)*(100-r);return n}function _(u){var i=0;return u?u>4.2?i=5:u>4?i=4:u>3.6?i=3:u>3?i=2:i=1:i=0,i}return ar}var $e={},wo;function hl(){if(wo)return $e;wo=1;var g=$e&&$e.__awaiter||function(r,n,a,o){function s(c){return c instanceof a?c:new a(function(l){l(c)})}return new(a||(a=Promise))(function(c,l){function d(T){try{p(o.next(T))}catch(M){l(M)}}function v(T){try{p(o.throw(T))}catch(M){l(M)}}function p(T){T.done?c(T.value):s(T.value).then(d,v)}p((o=o.apply(r,n||[])).next())})},m=$e&&$e.__generator||function(r,n){var a={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},o,s,c,l=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return l.next=d(0),l.throw=d(1),l.return=d(2),typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(p){return function(T){return v([p,T])}}function v(p){if(o)throw new TypeError("Generator is already executing.");for(;l&&(l=0,p[0]&&(a=0)),a;)try{if(o=1,s&&(c=p[0]&2?s.return:p[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,p[1])).done)return c;switch(s=0,c&&(p=[p[0]&2,c.value]),p[0]){case 0:case 1:c=p;break;case 4:return a.label++,{value:p[1],done:!1};case 5:a.label++,s=p[1],p=[0];continue;case 7:p=a.ops.pop(),a.trys.pop();continue;default:if(c=a.trys,!(c=c.length>0&&c[c.length-1])&&(p[0]===6||p[0]===2)){a=0;continue}if(p[0]===3&&(!c||p[1]>c[0]&&p[1]<c[3])){a.label=p[1];break}if(p[0]===6&&a.label<c[1]){a.label=c[1],c=p;break}if(c&&a.label<c[2]){a.label=c[2],a.ops.push(p);break}c[2]&&a.ops.pop(),a.trys.pop();continue}p=n.call(r,a)}catch(T){p=[6,T],s=0}finally{o=c=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},_=$e&&$e.__read||function(r,n){var a=typeof Symbol=="function"&&r[Symbol.iterator];if(!a)return r;var o=a.call(r),s,c=[],l;try{for(;(n===void 0||n-- >0)&&!(s=o.next()).done;)c.push(s.value)}catch(d){l={error:d}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(l)throw l.error}}return c};Object.defineProperty($e,"__esModule",{value:!0}),$e.getCombinedConnectionStats=i;function u(r,n,a,o){var s=[];return r.forEach(function(c){(o.length===0||o.includes(c.type))&&(a.length===0||a.includes(c.kind))&&typeof c[n]=="number"&&s.push(c[n])}),s}function i(r){return g(this,arguments,void 0,function(n){var a,o,s,c,l,d,v,p,T,M,k,y,b,f,h,w=n.publisher,S=n.subscriber;return m(this,function(E){switch(E.label){case 0:return[4,Promise.all([w,S].map(function(q){return q.getStats()}))];case 1:return a=_.apply(void 0,[E.sent(),2]),o=a[0],s=a[1],c=u(s,"timestamp",["audio"],["inbound-rtp"]),l=c.length>0?c[0]:0,d=u(s,"jitter",["audio"],["inbound-rtp"]).reduce(function(q,O){return Math.max(q,O)},0),v=u(s,"packetsReceived",["audio","video"],["inbound-rtp"]).reduce(function(q,O){return q+O},0),p=u(s,"packetsLost",["audio","video"],["inbound-rtp"]).reduce(function(q,O){return q+O},0),T=u(o,"roundTripTime",["audio","video"],["remote-inbound-rtp"]).reduce(function(q,O){return Math.max(q,O)},0),M=u(s,"currentRoundTripTime",[],["candidate-pair"]).reduce(function(q,O){return Math.max(q,O)},0),k=(M||T)*1e3,y=u(o,"bytesSent",[],["candidate-pair"]).reduce(function(q,O){return q+O},0),b=u(s,"bytesReceived",[],["candidate-pair"]).reduce(function(q,O){return q+O},0),f=t(s),h=[],s.forEach(function(q){(q.type==="local-candidate"||q.type==="remote-candidate")&&h.push(e(q))}),[2,{timestamp:l,jitter:d,packets:v,packetsLost:p,roundTripTime:k,bytesSent:y,bytesReceived:b,selectedIceCandidatePairStats:f,iceCandidateStats:h}]}})})}function e(r){var n=[{key:"transportId",type:"string"},{key:"candidateType",type:"string"},{key:"port",altKeys:["portNumber"],type:"number"},{key:"address",altKeys:["ip","ipAddress"],type:"string"},{key:"priority",type:"number"},{key:"protocol",altKeys:["transport"],type:"string"},{key:"url",type:"string"},{key:"relayProtocol",type:"string"}];return n.reduce(function(a,o){var s=[o.key];o.altKeys&&(s=s.concat(o.altKeys));var c=s.find(function(l){return l in r});return c&&typeof r[c]===o.type&&(a[o.key]=r[c]),a},{})}function t(r){var n=null,a=[];r.forEach(function(d){d.type==="transport"&&d.selectedCandidatePairId?n=d.selectedCandidatePairId:d.type==="candidate-pair"&&a.push(d)});var o=a.find(function(d){return d.selected||n&&d.id===n});if(!o)return null;var s=o,c=r.get(s.localCandidateId),l=r.get(s.remoteCandidateId);return!c||!l?null:{localCandidate:e(c),remoteCandidate:e(l)}}return $e}var wn={},rt,ko;function jt(){if(ko)return rt;ko=1;var g=rt&&rt.__extends||(function(){var c=function(l,d){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,p){v.__proto__=p}||function(v,p){for(var T in p)Object.prototype.hasOwnProperty.call(p,T)&&(v[T]=p[T])},c(l,d)};return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");c(l,d);function v(){this.constructor=l}l.prototype=d===null?Object.create(d):(v.prototype=d.prototype,new v)}})(),m=rt&&rt.__read||function(c,l){var d=typeof Symbol=="function"&&c[Symbol.iterator];if(!d)return c;var v=d.call(c),p,T=[],M;try{for(;(l===void 0||l-- >0)&&!(p=v.next()).done;)T.push(p.value)}catch(k){M={error:k}}finally{try{p&&!p.done&&(d=v.return)&&d.call(v)}finally{if(M)throw M.error}}return T},_=rt&&rt.__spreadArray||function(c,l,d){if(d||arguments.length===2)for(var v=0,p=l.length,T;v<p;v++)(T||!(v in l))&&(T||(T=Array.prototype.slice.call(l,0,v)),T[v]=l[v]);return c.concat(T||Array.prototype.slice.call(l))},u=Ne().EventEmitter,i=Ee(),e=(function(c){g(l,c);function l(d,v){var p=c.call(this)||this,T=null,M=d;return v=o(v),Object.defineProperties(p,{_lock:{get:function(){return T},set:function(k){T=k}},_reachableStates:{value:n(v)},_state:{get:function(){return M},set:function(k){M=k}},_states:{value:v},_whenDeferreds:{value:new Set},isLocked:{enumerable:!0,get:function(){return T!==null}},state:{enumerable:!0,get:function(){return M}}}),p.on("stateChanged",function(k){p._whenDeferreds.forEach(function(y){y.when(k,y.resolve,y.reject)})}),p}return l.prototype._whenPromise=function(d){var v=this;if(typeof d!="function")return Promise.reject(new Error("when() executor must be a function"));var p=i.defer();return p.when=d,this._whenDeferreds.add(p),p.promise.then(function(T){return v._whenDeferreds.delete(p),T},function(T){throw v._whenDeferreds.delete(p),T})},l.prototype.bracket=function(d,v){var p,T=this;function M(k){if(T.hasLock(p)&&T.releaseLockCompletely(p),k)throw k}return this.takeLock(d).then(function(y){return p=y,v(p)}).then(function(y){return M(),y},M)},l.prototype.hasLock=function(d){return this._lock===d},l.prototype.preempt=function(d,v,p){if(!t(this._states,this.state,d))throw new Error('Cannot transition from "'.concat(this.state,'" to "').concat(d,'"'));var T;this.isLocked&&(T=this._lock,this._lock=null);var M=null;v&&(M=this.takeLockSync(v));var k=M?null:this.takeLockSync("preemption");return this.transition(d,M||k,p),T&&T.resolve(),k&&this.releaseLock(k),M},l.prototype.releaseLock=function(d){if(this.isLocked){if(!this.hasLock(d))throw new Error("Could not release the lock for ".concat(d.name," because ").concat(this._lock.name," has the lock"))}else throw new Error("Could not release the lock for ".concat(d.name," because the StateMachine is not locked"));d.depth===0?(this._lock=null,d.resolve()):d.depth--},l.prototype.releaseLockCompletely=function(d){if(this.isLocked){if(!this.hasLock(d))throw new Error("Could not release the lock for ".concat(d.name," because ").concat(this._lock.name," has the lock"))}else throw new Error("Could not release the lock for ".concat(d.name," because the StateMachine is not locked"));d.depth=0,this._lock=null,d.resolve()},l.prototype.takeLock=function(d){var v=this;if(typeof d=="object"){var p=d;return new Promise(function(k){k(v.takeLockSync(p))})}var T=d;if(this.isLocked){var M=this.takeLock.bind(this,T);return this._lock.promise.then(M)}return Promise.resolve(this.takeLockSync(T))},l.prototype.takeLockSync=function(d){var v=typeof d=="string"?null:d,p=v?v.name:d;if(v&&!this.hasLock(v)||!v&&this.isLocked)throw new Error("Could not take the lock for ".concat(p," because the lock for ").concat(this._lock.name," was not released"));if(v)return v.depth++,v;var T=r(p);return this._lock=T,T},l.prototype.transition=function(d,v,p){if(p=p||[],this.isLocked)if(v){if(!this.hasLock(v))throw new Error("Could not transition using the key for ".concat(v.name," because ").concat(this._lock.name," has the lock"))}else throw new Error("You must provide the key in order to transition");else if(v)throw new Error("Key provided for ".concat(v.name,", but the StateMachine was not locked (possibly due to preemption)"));if(!t(this._states,this.state,d))throw new Error('Cannot transition from "'.concat(this.state,'" to "').concat(d,'"'));this._state=d,this.emit.apply(this,_([],m(["stateChanged",d].concat(p)),!1))},l.prototype.tryTransition=function(d,v,p){try{this.transition(d,v,p)}catch{return!1}return!0},l.prototype.when=function(d){var v=this;return this.state===d?Promise.resolve(this):t(this._reachableStates,this.state,d)?this._whenPromise(function(p,T,M){p===d?T(v):t(v._reachableStates,p,d)||M(s(p,d))}):Promise.reject(s(this.state,d))},l})(u);function t(c,l,d){return c.get(l).has(d)}function r(c){var l=i.defer();return l.name=c,l.depth=0,l}function n(c){return Array.from(c.keys()).reduce(function(l,d){return l.set(d,a(c,d))},new Map)}function a(c,l,d){return d=d||new Set,c.get(l).forEach(function(v){d.has(v)||(d.add(v),a(c,v,d).forEach(d.add,d))}),d}function o(c){var l=new Map;for(var d in c)l.set(d,new Set(c[d]));return l}function s(c,l){return new Error('"'.concat(l,'" cannot be reached from "').concat(c,'"'))}return rt=e,rt}var ci,So;function _l(){if(So)return ci;So=1;var g=(function(){function m(_,u){var i=this;u=Object.assign({navigator,window},u);var e=u.navigator,t=e.connection||{type:null},r=t.type,n=t.type?{_events:{value:["change","typechange"]},_listener:{value:function(){var c=r!==i.type&&i.isOnline;r=i.type,c&&_()}},_target:{value:t}}:{_events:{value:["online"]},_listener:{value:_},_target:{value:u.window}},a=n._events,o=n._listener,s=n._target;Object.defineProperties(this,{isOnline:{enumerable:!0,get:function(){return typeof e.onLine=="boolean"?e.onLine:!0}},type:{enumerable:!0,get:function(){return t.type||null}},_listener:o,_events:a,_target:s})}return m.prototype.start=function(){var _=this;this._events.forEach(function(u){_._target.addEventListener(u,_._listener)})},m.prototype.stop=function(){var _=this;this._events.forEach(function(u){_._target.removeEventListener(u,_._listener)})},m})();return ci=g,ci}var si,To;function Mt(){if(To)return si;To=1;var g=(function(){function m(_,u,i){i===void 0&&(i=!0),Object.defineProperties(this,{_delay:{value:u,writable:!0},_fn:{value:_},_timeout:{value:null,writable:!0}}),i&&this.start()}return Object.defineProperty(m.prototype,"delay",{get:function(){return this._delay},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isSet",{get:function(){return!!this._timeout},enumerable:!1,configurable:!0}),m.prototype.setDelay=function(_){this._delay=_},m.prototype.start=function(){var _=this;this.isSet||(this._timeout=setTimeout(function(){var u=_._fn;_.clear(),u()},this._delay))},m.prototype.clear=function(){clearTimeout(this._timeout),this._timeout=null},m.prototype.reset=function(){this.clear(),this.start()},m})();return si=g,si}var ui,Po;function tu(){return Po||(Po=1,ui=WebSocket),ui}var nt,Eo;function ru(){if(Eo)return nt;Eo=1;var g=nt&&nt.__extends||(function(){var F=function(V,U){return F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,D){j.__proto__=D}||function(j,D){for(var H in D)Object.prototype.hasOwnProperty.call(D,H)&&(j[H]=D[H])},F(V,U)};return function(V,U){if(typeof U!="function"&&U!==null)throw new TypeError("Class extends value "+String(U)+" is not a constructor or null");F(V,U);function j(){this.constructor=V}V.prototype=U===null?Object.create(U):(j.prototype=U.prototype,new j)}})(),m=nt&&nt.__read||function(F,V){var U=typeof Symbol=="function"&&F[Symbol.iterator];if(!U)return F;var j=U.call(F),D,H=[],$;try{for(;(V===void 0||V-- >0)&&!(D=j.next()).done;)H.push(D.value)}catch(re){$={error:re}}finally{try{D&&!D.done&&(U=j.return)&&U.call(j)}finally{if($)throw $.error}}return H},_=nt&&nt.__spreadArray||function(F,V,U){if(U||arguments.length===2)for(var j=0,D=V.length,H;j<D;j++)(H||!(j in V))&&(H||(H=Array.prototype.slice.call(V,0,j)),H[j]=V[j]);return F.concat(H||Array.prototype.slice.call(V))},u=jt(),i=Ee(),e=i.buildLogLevels,t=i.makeUUID,r=Qe(),n=_l(),a=Mt(),o=0,s={closed:[],connecting:["closed","open","waiting"],early:["closed","connecting"],open:["closed"],waiting:["closed","connecting","early","open"]},c={closed:"close",open:"open",waiting:"waiting"},l=2,d=3,v=3,p=5e3,T=15e3,M=5e3,k=200,y=1e3,b=3e3,f=3001,h=3002,w=3003,S=3004,E=3005,q=3006,O=3007,C=globalThis,I=C.WebSocket?C.WebSocket:tu(),x={BUSY:"busy",FAILED:"failed",LOCAL:"local",REMOTE:"remote",TIMEOUT:"timeout"},A=new Map([[b,x.TIMEOUT],[f,x.TIMEOUT],[h,x.FAILED],[w,x.FAILED],[S,x.TIMEOUT],[q,x.BUSY],[O,x.TIMEOUT]]),R=(function(F){g(V,F);function V(U,j){var D=F.call(this,"early",s)||this;j=Object.assign({helloBody:null,maxConsecutiveFailedHellos:v,maxConsecutiveMissedHeartbeats:d,requestedHeartbeatTimeout:p,openTimeout:T,welcomeTimeout:M,Log:r,WebSocket:I},j);var H=e(j.logLevel),$=new j.Log("default",D,H,j.loggerName),re=j.networkMonitor?new n(function(){var Z=re.type,ne="Network changed".concat(Z?" to ".concat(Z):"");$.debug(ne),D._close({code:S,reason:ne})}):null;Object.defineProperties(D,{_busyWaitTimeout:{value:null,writable:!0},_consecutiveHeartbeatsMissed:{value:0,writable:!0},_cookie:{value:null,writable:!0},_eventObserver:{value:j.eventObserver},_heartbeatTimeout:{value:null,writable:!0},_hellosLeft:{value:j.maxConsecutiveFailedHellos,writable:!0},_instanceId:{value:++o},_log:{value:$},_messageQueue:{value:[]},_networkMonitor:{value:re},_options:{value:j},_openTimeout:{value:null,writable:!0},_sendHeartbeatTimeout:{value:null,writable:!0},_serverUrl:{value:U},_welcomeTimeout:{value:null,writable:!0},_ws:{value:null,writable:!0}});var Y={connecting:"info",early:"info",open:"info",waiting:"warning",closed:"info"};return D.on("stateChanged",function(Z){for(var ne=[],ie=1;ie<arguments.length;ie++)ne[ie-1]=arguments[ie];Z in c&&D.emit.apply(D,_([c[Z]],m(ne),!1));var be={name:Z,group:"signaling",level:Y[D.state]};if(Z==="closed"){var ce=m(ne,1),pe=ce[0];be.payload={reason:pe},be.level=pe===x.LOCAL?"info":"error"}D._eventObserver.emit("event",be)}),D._eventObserver.emit("event",{name:D.state,group:"signaling",level:Y[D.state]}),D._connect(),D}return V.prototype.toString=function(){return"[TwilioConnection #".concat(this._instanceId,": ").concat(this._ws.url,"]")},V.prototype._close=function(U){var j=U.code,D=U.reason;if(this.state!=="closed"){this._openTimeout&&this._openTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear(),this._heartbeatTimeout&&this._heartbeatTimeout.clear(),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.clear(),this._networkMonitor&&this._networkMonitor.stop(),this._busyWaitTimeout&&j!==E&&this._busyWaitTimeout.clear(),this._messageQueue.splice(0);var H=this._log;j===y?(H.debug("Closed"),this.transition("closed",null,[x.LOCAL])):(H.warn("Closed: ".concat(j," - ").concat(D)),j!==E&&this.transition("closed",null,[A.get(j)||x.REMOTE]));var $=this._ws.readyState,re=this._options.WebSocket;$!==re.CLOSING&&$!==re.CLOSED&&this._ws.close(j,D)}},V.prototype._connect=function(){var U=this,j=this._log;if(this.state==="waiting")this.transition("early");else if(this.state!=="early"){j.warn('Unexpected state "'.concat(this.state,'" for connecting to the')+" TCMP server.");return}this._ws=new this._options.WebSocket(this._serverUrl);var D=this._ws;j.debug("Created a new WebSocket:",D),D.addEventListener("close",function($){return U._close($)});var H=this._options.openTimeout;this._openTimeout=new a(function(){var $="Failed to open in ".concat(H," ms");U._close({code:O,reason:$})},H),D.addEventListener("open",function(){j.debug("WebSocket opened:",D),U._openTimeout.clear(),U._startHandshake(),U._networkMonitor&&U._networkMonitor.start()}),D.addEventListener("message",function($){j.debug("Incoming: ".concat($.data));try{$=JSON.parse($.data)}catch(re){U.emit("error",re);return}switch($.type){case"bad":U._handleBad($);break;case"busy":U._handleBusy($);break;case"bye":break;case"msg":U._handleMessage($);case"heartbeat":U._handleHeartbeat();break;case"welcome":U._handleWelcome($);break;default:U._log.debug("Unknown message type: ".concat($.type)),U.emit("error",new Error("Unknown message type: ".concat($.type)));break}})},V.prototype._handleBad=function(U){var j=U.reason,D=this._log;if(!["connecting","open"].includes(this.state)){D.warn('Unexpected state "'.concat(this.state,'" for handling a "bad" message')+" from the TCMP server.");return}if(this.state==="connecting"){D.warn("Closing: ".concat(h," - ").concat(j)),this._close({code:h,reason:j});return}D.debug("Error: ".concat(j)),this.emit("error",new Error(j))},V.prototype._handleBusy=function(U){var j=this,D=U.cookie,H=U.keepAlive,$=U.retryAfter,re=this._log;if(!["connecting","waiting"].includes(this.state)){re.warn('Unexpected state "'.concat(this.state,'" for handling a "busy" message')+" from the TCMP server.");return}this._busyWaitTimeout&&this._busyWaitTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear();var Y=$<0?'Received terminal "busy" message':'Received "busy" message, retrying after '.concat($," ms");if($<0){re.warn("Closing: ".concat(q," - ").concat(Y)),this._close({code:q,reason:Y});return}var Z=this._options.maxConsecutiveFailedHellos;this._hellosLeft=Z,this._cookie=D||null,H?(re.warn(Y),this._busyWaitTimeout=new a(function(){return j._startHandshake()},$)):(re.warn("Closing: ".concat(E," - ").concat(Y)),this._close({code:E,reason:Y}),this._busyWaitTimeout=new a(function(){return j._connect()},$)),this.transition("waiting",null,[H,$])},V.prototype._handleHeartbeat=function(){if(this.state!=="open"){this._log.warn('Unexpected state "'.concat(this.state,'" for handling a "heartbeat"')+" message from the TCMP server.");return}this._heartbeatTimeout.reset()},V.prototype._handleHeartbeatTimeout=function(){if(this.state==="open"){var U=this._log,j=this._options.maxConsecutiveMissedHeartbeats;U.debug("Consecutive heartbeats missed: ".concat(j));var D="Missed ".concat(j,' "heartbeat" messages');U.warn("Closing: ".concat(f," - ").concat(D)),this._close({code:f,reason:D})}},V.prototype._handleMessage=function(U){var j=U.body;if(this.state!=="open"){this._log.warn('Unexpected state "'.concat(this.state,'" for handling a "msg" message')+" from the TCMP server.");return}this.emit("message",j)},V.prototype._handleWelcome=function(U){var j=this,D=U.negotiatedTimeout,H=this._log;if(!["connecting","waiting"].includes(this.state)){H.warn('Unexpected state "'.concat(this.state,'" for handling a "welcome"')+" message from the TCMP server.");return}this.state==="waiting"&&(H.debug('Received "welcome" message, no need to retry connection.'),this._busyWaitTimeout.clear());var $=this._options.maxConsecutiveMissedHeartbeats,re=D*$,Y=D-k;this._welcomeTimeout.clear(),this._heartbeatTimeout=new a(function(){return j._handleHeartbeatTimeout()},re),this._messageQueue.splice(0).forEach(function(Z){return j._send(Z)}),this._sendHeartbeatTimeout=new a(function(){return j._sendHeartbeat()},Y),this.transition("open")},V.prototype._handleWelcomeTimeout=function(){if(this.state==="connecting"){var U=this._log;if(this._hellosLeft<=0){var j="All handshake attempts failed";U.warn("Closing: ".concat(b," - ").concat(j)),this._close({code:b,reason:j});return}var D=this._options.maxConsecutiveFailedHellos;U.warn("Handshake attempt ".concat(D-this._hellosLeft," failed")),this._startHandshake()}},V.prototype._send=function(U){var j=this._ws.readyState,D=this._options.WebSocket;if(j===D.OPEN){var H=JSON.stringify(U);this._log.debug("Outgoing: ".concat(H));try{this._ws.send(H),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.reset()}catch{var $="Failed to send message";this._log.warn("Closing: ".concat(w," - ").concat($)),this._close({code:w,reason:$})}}},V.prototype._sendHeartbeat=function(){this.state!=="closed"&&this._send({type:"heartbeat"})},V.prototype._sendHello=function(){var U=this._options,j=U.helloBody,D=U.requestedHeartbeatTimeout,H={id:t(),timeout:D,type:"hello",version:l};this._cookie&&(H.cookie=this._cookie),j&&(H.body=j),this._send(H)},V.prototype._sendOrEnqueue=function(U){var j=this;if(this.state!=="closed"){var D=this.state==="open"?function(H){return j._send(H)}:function(H){return j._messageQueue.push(H)};D(U)}},V.prototype._startHandshake=function(){var U=this;if(["early","waiting"].includes(this.state)&&this.transition("connecting"),this.state==="connecting"){this._hellosLeft--,this._sendHello();var j=this._options.welcomeTimeout;this._welcomeTimeout=new a(function(){return U._handleWelcomeTimeout()},j)}},V.prototype.close=function(){this.state!=="closed"&&(this._sendOrEnqueue({type:"bye"}),this._close({code:y,reason:"Normal"}))},V.prototype.sendMessage=function(U){this._sendOrEnqueue({body:U,type:"msg"})},V})(u);return R.CloseReason=x,nt=R,nt}var Co;function ml(){if(Co)return wn;Co=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.getTurnCredentials=t;var g=ru(),m=Oe().ICE_VERSION,_=ze(),u=_.createTwilioError,i=_.SignalingConnectionError,e=Ne();function t(r,n){return new Promise(function(a,o){var s=new e.EventEmitter,c={networkMonitor:null,eventObserver:s,helloBody:{edge:"roaming",preflight:!0,token:r,type:"ice",version:m}},l=new g(n,c),d=!1;l.once("close",function(){d||(d=!0,o(new i))}),l.on("message",function(v){var p=v.code,T=v.message,M=v.ice_servers,k=v.type;(k==="iced"||k==="error")&&!d&&(d=!0,k==="iced"?a(M):o(u(p,T)),l.close())})})}return wn}var vt={},Oo;function yl(){if(Oo)return vt;Oo=1;var g=vt&&vt.__read||function(u,i){var e=typeof Symbol=="function"&&u[Symbol.iterator];if(!e)return u;var t=e.call(u),r,n=[],a;try{for(;(i===void 0||i-- >0)&&!(r=t.next()).done;)n.push(r.value)}catch(o){a={error:o}}finally{try{r&&!r.done&&(e=t.return)&&e.call(t)}finally{if(a)throw a.error}}return n},m=vt&&vt.__spreadArray||function(u,i,e){if(e||arguments.length===2)for(var t=0,r=i.length,n;t<r;t++)(n||!(t in i))&&(n||(n=Array.prototype.slice.call(i,0,t)),n[t]=i[t]);return u.concat(n||Array.prototype.slice.call(i))};Object.defineProperty(vt,"__esModule",{value:!0}),vt.makeStat=_;function _(u){if(u&&u.length){var i=Math.min.apply(Math,m([],g(u),!1)),e=Math.max.apply(Math,m([],g(u),!1)),t=u.reduce(function(r,n){return r+n},0)/u.length;return{min:i,max:e,average:t}}return null}return vt}var kn={},Ro;function gl(){if(Ro)return kn;Ro=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.syntheticAudio=g;function g(){var m=Cn(),_={},u=m.getOrCreate(_),i=u.createOscillator(),e=i.connect(u.createMediaStreamDestination());i.start();var t=e.stream.getAudioTracks()[0],r=t.stop;return t.stop=function(){r.call(t),m.release(_)},t}return kn}var Sn={},Lo;function bl(){if(Lo)return Sn;Lo=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.syntheticVideo=g;function g(m){var _=m===void 0?{}:m,u=_.width,i=u===void 0?640:u,e=_.height,t=e===void 0?480:e,r=Object.assign(document.createElement("canvas"),{width:i,height:t}),n=r.getContext("2d");n.fillStyle="green",n.fillRect(0,0,r.width,r.height);var a=!1;requestAnimationFrame(function l(){if(!a){var d=Math.round(Math.random()*255),v=Math.round(Math.random()*255),p=Math.round(Math.random()*255),T=Math.round(Math.random()*255);n.fillStyle="rgba(".concat(d,", ").concat(v,", ").concat(p,", ").concat(T,")"),n.fillRect(Math.random()*i,Math.random()*t,50,50),requestAnimationFrame(l)}});var o=r.captureStream(30),s=o.getTracks()[0],c=s.stop;return s.stop=function(){a=!0,c.call(s)},s}return Sn}var li,xo;function nu(){if(xo)return li;xo=1;var g=(function(){function m(){Object.defineProperties(this,{_samples:{value:[{denominator:0,numerator:0},{denominator:0,numerator:0}]}})}return m.prototype.get=function(){var _=this._samples,u=_[1].denominator-_[0].denominator||1/0,i=_[1].numerator-_[0].numerator;return i/u},m.prototype.putSample=function(_,u){var i=this._samples;i.shift(),i.push({denominator:u,numerator:_})},m})();return li=g,li}var or,Mo;function iu(){if(Mo)return or;Mo=1;var g=or&&or.__extends||(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),m=Ne().EventEmitter,_=["signaling","room","media","quality","video-processor","preflight"],u=["debug","error","info","warning"],i=(function(e){g(t,e);function t(r,n,a,o){o===void 0&&(o=null);var s=e.call(this)||this;return s.on("event",function(c){var l=c.name,d=c.group,v=c.level,p=c.payload;if(typeof l!="string")throw a.error("Unexpected name: ",l),new Error("Unexpected name: ",l);if(!_.includes(d))throw a.error("Unexpected group: ",d),new Error("Unexpected group: ",d);if(!u.includes(v))throw a.error("Unexpected level: ",v),new Error("Unexpected level: ",v);var T=Date.now(),M=T-n,k=Object.assign({elapsedTime:M,level:v},p||{});r.publish(d,l,k);var y=Object.assign({elapsedTime:M,group:d,level:v,name:l,timestamp:T},p?{payload:p}:{}),b={debug:"debug",error:"error",info:"info",warning:"warn"}[v];a[b]("event",y),o&&d==="signaling"&&o.emit("event",y)}),s}return t})(m);return or=i,or}var kt,Ao;function au(){if(Ao)return kt;Ao=1;var g=kt&&kt.__extends||(function(){var k=function(y,b){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var w in h)Object.prototype.hasOwnProperty.call(h,w)&&(f[w]=h[w])},k(y,b)};return function(y,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");k(y,b);function f(){this.constructor=y}y.prototype=b===null?Object.create(b):(f.prototype=b.prototype,new f)}})(),m=kt&&kt.__assign||function(){return m=Object.assign||function(k){for(var y,b=1,f=arguments.length;b<f;b++){y=arguments[b];for(var h in y)Object.prototype.hasOwnProperty.call(y,h)&&(k[h]=y[h])}return k},m.apply(this,arguments)},_=Ne().EventEmitter,u=Ee().getUserAgent,i=5,e=50,t=1e3,r=globalThis,n=r.WebSocket?r.WebSocket:tu(),a=Oe(),o=a.hardwareDevicePublisheriPad,s=a.hardwareDevicePublisheriPhone,c=Ee(),l=xt(),d=(function(k){g(y,k);function y(b,f,h,w,S,E){var q=k.call(this)||this;return E=Object.assign({gateway:"".concat(p(w,S),"/v1/VideoEvents"),maxReconnectAttempts:i,reconnectIntervalMs:e,userAgent:u(),WebSocket:n},E),Object.defineProperties(q,{_connectTimestamp:{value:0,writable:!0},_eventQueue:{value:[]},_readyToConnect:{value:c.defer()},_reconnectAttemptsLeft:{value:E.maxReconnectAttempts,writable:!0},_ws:{value:null,writable:!0},_WebSocket:{value:E.WebSocket}}),q._readyToConnect.promise.then(function(O){var C=O.roomSid,I=O.participantSid,x=q;q.on("disconnected",function A(R){if(x._session=null,R&&x._reconnectAttemptsLeft>0){x.emit("reconnecting"),M(x,b,f,h,C,I,E);return}x.removeListener("disconnected",A)}),v(q,b,f,h,C,I,E)}).catch(function(){}),q}return y.prototype.connect=function(b,f){this._readyToConnect.resolve({roomSid:b,participantSid:f})},y.prototype._publish=function(b){b.session=this._session,this._ws.send(JSON.stringify(b))},y.prototype.disconnect=function(){if(this._ws===null||this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED)return!1;try{this._ws.close()}catch{}return this.emit("disconnected"),!0},y.prototype.publish=function(b,f,h){if(this._ws!==null&&(this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED))return!1;var w=typeof this._session=="string"?this._publish.bind(this):this._eventQueue.push.bind(this._eventQueue);return w({group:b,name:f,payload:h,timestamp:Date.now(),type:"event",version:1}),!0},y})(_);function v(k,y,b,f,h,w,S){k._connectTimestamp=Date.now(),k._reconnectAttemptsLeft--,k._ws=new S.WebSocket(S.gateway);var E=k._ws;E.addEventListener("close",function(q){if(q.code===t){k.emit("disconnected");return}k.emit("disconnected",new Error("WebSocket Error ".concat(q.code,": ").concat(q.reason)))}),E.addEventListener("message",function(q){T(k,JSON.parse(q.data),S)}),E.addEventListener("open",function(){var q={type:"connect",token:y,version:1};q.publisher={name:b,sdkVersion:f,userAgent:S.userAgent,participantSid:w,roomSid:h},l.isIpad()?q.publisher=m(m({},q.publisher),o):l.isIphone()&&(q.publisher=m(m({},q.publisher),s)),E.send(JSON.stringify(q))})}function p(k,y){return k==="prod"?"wss://sdkgw.".concat(y,".twilio.com"):"wss://sdkgw.".concat(k,"-").concat(y,".twilio.com")}function T(k,y,b){switch(y.type){case"connected":k._session=y.session,k._reconnectAttemptsLeft=b.maxReconnectAttempts,k._eventQueue.splice(0).forEach(k._publish,k),k.emit("connected");break;case"error":k._ws.close(),k.emit("disconnected",new Error(y.message));break}}function M(k,y,b,f,h,w,S){var E=Date.now()-k._connectTimestamp,q=S.reconnectIntervalMs-E;if(q>0){setTimeout(function(){v(k,y,b,f,h,w,S)},q);return}v(k,y,b,f,h,w,S)}return kt=d,kt}var Io;function wl(){if(Io)return Be;Io=1;var g=Be&&Be.__extends||(function(){var R=function(F,V){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(U,j){U.__proto__=j}||function(U,j){for(var D in j)Object.prototype.hasOwnProperty.call(j,D)&&(U[D]=j[D])},R(F,V)};return function(F,V){if(typeof V!="function"&&V!==null)throw new TypeError("Class extends value "+String(V)+" is not a constructor or null");R(F,V);function U(){this.constructor=F}F.prototype=V===null?Object.create(V):(U.prototype=V.prototype,new U)}})(),m=Be&&Be.__assign||function(){return m=Object.assign||function(R){for(var F,V=1,U=arguments.length;V<U;V++){F=arguments[V];for(var j in F)Object.prototype.hasOwnProperty.call(F,j)&&(R[j]=F[j])}return R},m.apply(this,arguments)},_=Be&&Be.__awaiter||function(R,F,V,U){function j(D){return D instanceof V?D:new V(function(H){H(D)})}return new(V||(V=Promise))(function(D,H){function $(Z){try{Y(U.next(Z))}catch(ne){H(ne)}}function re(Z){try{Y(U.throw(Z))}catch(ne){H(ne)}}function Y(Z){Z.done?D(Z.value):j(Z.value).then($,re)}Y((U=U.apply(R,F||[])).next())})},u=Be&&Be.__generator||function(R,F){var V={label:0,sent:function(){if(D[0]&1)throw D[1];return D[1]},trys:[],ops:[]},U,j,D,H=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return H.next=$(0),H.throw=$(1),H.return=$(2),typeof Symbol=="function"&&(H[Symbol.iterator]=function(){return this}),H;function $(Y){return function(Z){return re([Y,Z])}}function re(Y){if(U)throw new TypeError("Generator is already executing.");for(;H&&(H=0,Y[0]&&(V=0)),V;)try{if(U=1,j&&(D=Y[0]&2?j.return:Y[0]?j.throw||((D=j.return)&&D.call(j),0):j.next)&&!(D=D.call(j,Y[1])).done)return D;switch(j=0,D&&(Y=[Y[0]&2,D.value]),Y[0]){case 0:case 1:D=Y;break;case 4:return V.label++,{value:Y[1],done:!1};case 5:V.label++,j=Y[1],Y=[0];continue;case 7:Y=V.ops.pop(),V.trys.pop();continue;default:if(D=V.trys,!(D=D.length>0&&D[D.length-1])&&(Y[0]===6||Y[0]===2)){V=0;continue}if(Y[0]===3&&(!D||Y[1]>D[0]&&Y[1]<D[3])){V.label=Y[1];break}if(Y[0]===6&&V.label<D[1]){V.label=D[1],D=Y;break}if(D&&V.label<D[2]){V.label=D[2],V.ops.push(Y);break}D[2]&&V.ops.pop(),V.trys.pop();continue}Y=F.call(R,V)}catch(Z){Y=[6,Z],j=0}finally{U=D=0}if(Y[0]&5)throw Y[1];return{value:Y[0]?Y[1]:void 0,done:!0}}};Object.defineProperty(Be,"__esModule",{value:!0}),Be.PreflightTest=void 0,Be.runPreflight=A;var i=Oe(),e=pl(),t=vl(),r=hl(),n=ml(),a=yl(),o=gl(),s=bl(),c=Ee(),l=Oe().WS_SERVER,d=Qe(),v=dn(),p=nu(),T=iu(),M=au(),k=Ds(),y=k.createSID,b=k.sessionSID,f=ze(),h=f.SignalingConnectionTimeoutError,w=f.MediaConnectionError,S=1e3,E=10*S,q={mediaAcquired:"mediaAcquired",connected:"connected",mediaSubscribed:"mediaSubscribed",mediaStarted:"mediaStarted",dtlsConnected:"dtlsConnected",peerConnectionConnected:"peerConnectionConnected",iceConnected:"iceConnected"};function O(R){return R!==null&&typeof R<"u"}var C=0,I=(function(R){g(F,R);function F(V,U){var j=R.call(this)||this;j._testTiming=new e.Timer,j._dtlsTiming=new e.Timer,j._iceTiming=new e.Timer,j._peerConnectionTiming=new e.Timer,j._mediaTiming=new e.Timer,j._connectTiming=new e.Timer,j._sentBytesMovingAverage=new p,j._packetLossMovingAverage=new p,j._progressEvents=[],j._receivedBytesMovingAverage=new p;var D=U,H=D.environment,$=H===void 0?"prod":H,re=D.region,Y=re===void 0?"gll":re,Z=D.duration,ne=Z===void 0?E:Z,ie=D.wsServer||l($,Y);return j._log=new d("default",j,i.DEFAULT_LOG_LEVEL,i.DEFAULT_LOGGER_NAME),j._testDuration=ne,j._instanceId=C++,j._testTiming.start(),j._runPreflightTest(V,$,ie),j}return F.prototype.toString=function(){return"[Preflight #".concat(this._instanceId,"]")},F.prototype.stop=function(){this._stopped=!0},F.prototype._generatePreflightReport=function(V){return this._testTiming.stop(),{testTiming:this._testTiming.getTimeMeasurement(),networkTiming:{dtls:this._dtlsTiming.getTimeMeasurement(),ice:this._iceTiming.getTimeMeasurement(),peerConnection:this._peerConnectionTiming.getTimeMeasurement(),connect:this._connectTiming.getTimeMeasurement(),media:this._mediaTiming.getTimeMeasurement()},stats:{jitter:(0,a.makeStat)(V?.jitter),rtt:(0,a.makeStat)(V?.rtt),packetLoss:(0,a.makeStat)(V?.packetLoss)},selectedIceCandidatePairStats:V?V.selectedIceCandidatePairStats:null,iceCandidateStats:V?V.iceCandidateStats:[],progressEvents:this._progressEvents,mos:(0,a.makeStat)(V?.mos)}},F.prototype._executePreflightStep=function(V,U,j){return _(this,void 0,void 0,function(){var D,H,$,re,Y;return u(this,function(Z){switch(Z.label){case 0:if(this._log.debug("Executing step: ",V),D=this._testDuration+10*S,this._stopped)throw new Error("stopped");H=Promise.resolve().then(U),$=null,re=new Promise(function(ne,ie){$=setTimeout(function(){ie(j||new Error("".concat(V," timeout.")))},D)}),Z.label=1;case 1:return Z.trys.push([1,,3,4]),[4,Promise.race([re,H])];case 2:return Y=Z.sent(),[2,Y];case 3:return $!==null&&clearTimeout($),[7];case 4:return[2]}})})},F.prototype._collectNetworkTimings=function(V){var U=this;return new Promise(function(j){var D;V.addEventListener("iceconnectionstatechange",function(){V.iceConnectionState==="checking"&&U._iceTiming.start(),V.iceConnectionState==="connected"&&(U._iceTiming.stop(),U._updateProgress(q.iceConnected),(!D||D&&D.state==="connected")&&j())}),V.addEventListener("connectionstatechange",function(){V.connectionState==="connecting"&&U._peerConnectionTiming.start(),V.connectionState==="connected"&&(U._peerConnectionTiming.stop(),U._updateProgress(q.peerConnectionConnected))});var H=V.getSenders(),$=H.map(function(re){return re.transport}).find(O);typeof $<"u"&&(D=$,D.addEventListener("statechange",function(){D.state==="connecting"&&U._dtlsTiming.start(),D.state==="connected"&&(U._dtlsTiming.stop(),U._updateProgress(q.dtlsConnected),V.iceConnectionState==="connected"&&j())}))})},F.prototype._setupInsights=function(V){var U=V.token,j=V.environment,D=j===void 0?i.DEFAULT_ENVIRONMENT:j,H=V.realm,$=H===void 0?i.DEFAULT_REALM:H,re={},Y=new M(U,i.SDK_NAME,i.SDK_VERSION,D,$,re);Y.connect("PREFLIGHT_ROOM_SID","PREFLIGHT_PARTICIPANT");var Z=new T(Y,Date.now(),this._log),ne=void 0;return{reportToInsights:function(ie){var be,ce,pe=ie.report,Te=pe.stats.jitter||ne,ge=pe.stats.rtt||ne,_e=pe.stats.packetLoss||ne,he=pe.mos||ne,le=new Map;pe.iceCandidateStats.forEach(function(se){if(se.candidateType&&se.protocol){var me=le.get(se.candidateType)||[];me.indexOf(se.protocol)<0&&me.push(se.protocol),le.set(se.candidateType,me)}});var z=JSON.stringify(Object.fromEntries(le)),ke={name:"report",group:"preflight",level:pe.error?"error":"info",payload:{sessionSID:b,preflightSID:y("PF"),progressEvents:JSON.stringify(pe.progressEvents),testTiming:pe.testTiming,dtlsTiming:pe.networkTiming.dtls,iceTiming:pe.networkTiming.ice,peerConnectionTiming:pe.networkTiming.peerConnection,connectTiming:pe.networkTiming.connect,mediaTiming:pe.networkTiming.media,selectedLocalCandidate:(be=pe.selectedIceCandidatePairStats)===null||be===void 0?void 0:be.localCandidate,selectedRemoteCandidate:(ce=pe.selectedIceCandidatePairStats)===null||ce===void 0?void 0:ce.remoteCandidate,iceCandidateStats:z,jitterStats:Te,rttStats:ge,packetLossStats:_e,mosStats:he,error:pe.error}};Z.emit("event",ke),setTimeout(function(){return Y.disconnect()},2e3)}}},F.prototype._runPreflightTest=function(V,U,j){return _(this,void 0,void 0,function(){var D,H,$,re,Y,Z,ne,ie,be,ce,pe,Te,ge=this;return u(this,function(_e){switch(_e.label){case 0:D=[],H=[],$=this._setupInsights({token:V,environment:U}).reportToInsights,_e.label=1;case 1:return _e.trys.push([1,8,9,10]),re=[],[4,this._executePreflightStep("Acquire media",function(){return[(0,o.syntheticAudio)(),(0,s.syntheticVideo)({width:640,height:480})]})];case 2:return D=_e.sent(),this._updateProgress(q.mediaAcquired),this.emit("debug",{localTracks:D}),this._connectTiming.start(),[4,this._executePreflightStep("Get turn credentials",function(){return(0,n.getTurnCredentials)(V,j)},new h)];case 3:return Y=_e.sent(),this._connectTiming.stop(),this._updateProgress(q.connected),Z=new RTCPeerConnection({iceServers:Y,iceTransportPolicy:"relay",bundlePolicy:"max-bundle"}),ne=new RTCPeerConnection({iceServers:Y,bundlePolicy:"max-bundle"}),H.push(Z),H.push(ne),this._mediaTiming.start(),[4,this._executePreflightStep("Setup Peer Connections",function(){return _(ge,void 0,void 0,function(){var he,le,z,ke;return u(this,function(se){switch(se.label){case 0:return Z.addEventListener("icecandidate",function(me){return me.candidate&&ne.addIceCandidate(me.candidate)}),ne.addEventListener("icecandidate",function(me){return me.candidate&&Z.addIceCandidate(me.candidate)}),D.forEach(function(me){return Z.addTrack(me)}),he=new Promise(function(me){var L=[];ne.addEventListener("track",function(P){L.push(P.track),L.length===D.length&&me(L)})}),[4,Z.createOffer()];case 1:return le=se.sent(),z=le,[4,Z.setLocalDescription(z)];case 2:return se.sent(),[4,ne.setRemoteDescription(z)];case 3:return se.sent(),[4,ne.createAnswer()];case 4:return ke=se.sent(),[4,ne.setLocalDescription(ke)];case 5:return se.sent(),[4,Z.setRemoteDescription(ke)];case 6:return se.sent(),[4,this._collectNetworkTimings(Z)];case 7:return se.sent(),[2,he]}})})},new w)];case 4:return ie=_e.sent(),this.emit("debug",{remoteTracks:ie}),ie.forEach(function(he){he.addEventListener("ended",function(){return ge._log.warn(he.kind+":ended")}),he.addEventListener("mute",function(){return ge._log.warn(he.kind+":muted")}),he.addEventListener("unmute",function(){return ge._log.warn(he.kind+":unmuted")})}),this._updateProgress(q.mediaSubscribed),[4,this._executePreflightStep("Wait for tracks to start",function(){return new Promise(function(he){var le=document.createElement("video");le.autoplay=!0,le.playsInline=!0,le.muted=!0,le.srcObject=new MediaStream(ie),re.push(le),ge.emit("debugElement",le),le.oncanplay=he})},new w)];case 5:return _e.sent(),this._mediaTiming.stop(),this._updateProgress(q.mediaStarted),[4,this._executePreflightStep("Collect stats for duration",function(){return ge._collectRTCStatsForDuration(ge._testDuration,x(),Z,ne)})];case 6:return be=_e.sent(),[4,this._executePreflightStep("Generate report",function(){return ge._generatePreflightReport(be)})];case 7:return ce=_e.sent(),$({report:ce}),this.emit("completed",ce),[3,10];case 8:return pe=_e.sent(),Te=this._generatePreflightReport(),$({report:m(m({},Te),{error:pe?.toString()})}),this.emit("failed",pe,Te),[3,10];case 9:return H.forEach(function(he){return he.close()}),D.forEach(function(he){return he.stop()}),[7];case 10:return[2]}})})},F.prototype._collectRTCStats=function(V,U,j){return _(this,void 0,void 0,function(){var D,H,$,re,Y,Z,ne,ie,be,ce,pe,Te,ge,_e;return u(this,function(he){switch(he.label){case 0:return[4,(0,r.getCombinedConnectionStats)({publisher:U,subscriber:j})];case 1:return D=he.sent(),H=D.timestamp,$=D.bytesSent,re=D.bytesReceived,Y=D.packets,Z=D.packetsLost,ne=D.roundTripTime,ie=D.jitter,be=D.selectedIceCandidatePairStats,ce=D.iceCandidateStats,pe=V.jitter.length>0,V.jitter.push(ie),V.rtt.push(ne),this._sentBytesMovingAverage.putSample($,H),this._receivedBytesMovingAverage.putSample(re,H),this._packetLossMovingAverage.putSample(Z,Y),pe&&(V.outgoingBitrate.push(this._sentBytesMovingAverage.get()*1e3*8),V.incomingBitrate.push(this._receivedBytesMovingAverage.get()*1e3*8),Te=this._packetLossMovingAverage.get(),ge=Math.min(100,Te*100),V.packetLoss.push(ge),_e=(0,t.calculateMOS)(ne,ie,Te),V.mos.push(_e)),V.selectedIceCandidatePairStats||(V.selectedIceCandidatePairStats=be),V.iceCandidateStats.length===0&&(V.iceCandidateStats=ce),[2]}})})},F.prototype._collectRTCStatsForDuration=function(V,U,j,D){return _(this,void 0,void 0,function(){var H,$,re;return u(this,function(Y){switch(Y.label){case 0:return H=Date.now(),$=Math.min(1e3,V),[4,(0,c.waitForSometime)($)];case 1:return Y.sent(),[4,this._collectRTCStats(U,j,D)];case 2:return Y.sent(),re=V-(Date.now()-H),re>0?[4,this._collectRTCStatsForDuration(re,U,j,D)]:[3,4];case 3:U=Y.sent(),Y.label=4;case 4:return[2,U]}})})},F.prototype._updateProgress=function(V){var U=Date.now()-this._testTiming.getTimeMeasurement().start;this._progressEvents.push({duration:U,name:V}),this.emit("progress",V)},F})(v);Be.PreflightTest=I;function x(){return{mos:[],jitter:[],rtt:[],outgoingBitrate:[],incomingBitrate:[],packetLoss:[],selectedIceCandidatePairStats:null,iceCandidateStats:[]}}function A(R,F){F===void 0&&(F={});var V=new I(R,F);return V}return Be}var St,Do;function $i(){if(Do)return St;Do=1;var g=St&&St.__read||function(u,i){var e=typeof Symbol=="function"&&u[Symbol.iterator];if(!e)return u;var t=e.call(u),r,n=[],a;try{for(;(i===void 0||i-- >0)&&!(r=t.next()).done;)n.push(r.value)}catch(o){a={error:o}}finally{try{r&&!r.done&&(e=t.return)&&e.call(t)}finally{if(a)throw a.error}}return n},m=St&&St.__spreadArray||function(u,i,e){if(e||arguments.length===2)for(var t=0,r=i.length,n;t<r;t++)(n||!(t in i))&&(n||(n=Array.prototype.slice.call(i,0,t)),n[t]=i[t]);return u.concat(n||Array.prototype.slice.call(i))},_=(function(){function u(i,e){var t=this;Object.defineProperties(this,{_isCancelable:{writable:!0,value:!0},_isCanceled:{writable:!0,value:!1},_onCancel:{value:e}}),Object.defineProperty(this,"_promise",{value:new Promise(function(r,n){i(function(a){t._isCancelable=!1,r(a)},function(a){t._isCancelable=!1,n(a)},function(){return t._isCanceled})})})}return u.reject=function(i){return new u(function(t,r){r(i)},function(){})},u.resolve=function(i){return new u(function(t){t(i)},function(){})},u.prototype.cancel=function(){return this._isCancelable&&(this._isCanceled=!0,this._onCancel()),this},u.prototype.catch=function(){var i=[].slice.call(arguments),e=this._promise;return new u(function(r,n){e.catch.apply(e,m([],g(i),!1)).then(r,n)},this._onCancel)},u.prototype.then=function(){var i=[].slice.call(arguments),e=this._promise;return new u(function(r,n){e.then.apply(e,m([],g(i),!1)).then(r,n)},this._onCancel)},u.prototype.finally=function(){var i=[].slice.call(arguments),e=this._promise;return new u(function(r,n){e.finally.apply(e,m([],g(i),!1)).then(r,n)},this._onCancel)},u})();return St=_,St}var di,jo;function kl(){if(jo)return di;jo=1;var g=$i();function m(_,u,i,e){var t,r=new Error("Canceled");return new g(function(a,o,s){var c;_(function(d){return s()?g.reject(r):(c=u(d),i(c).then(function(p){if(s())throw r;return t=p(),t}))}).then(function(d){if(s())throw d.disconnect(),r;a(e(c,d))}).catch(function(d){o(d)})},function(){t&&t.cancel()})}return di=m,di}var cr,No;function Sl(){if(No)return cr;No=1;var g=cr&&cr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ne().EventEmitter,_=(function(u){g(i,u);function i(e,t){var r=u.call(this)||this;return e=Object.assign({maxAudioBitrate:null,maxVideoBitrate:null},e),Object.defineProperties(r,{maxAudioBitrate:{value:e.maxAudioBitrate,writable:!0},maxVideoBitrate:{value:e.maxVideoBitrate,writable:!0},adaptiveSimulcast:{value:t}}),r}return i.prototype.toJSON=function(){return{maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate}},i.prototype.update=function(e){var t=this;e=Object.assign({maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate},e);var r=["maxAudioBitrate","maxVideoBitrate"].reduce(function(n,a){return t[a]!==e[a]&&(t[a]=e[a],n=!0),n},!1);r&&this.emit("changed")},i})(m);return cr=_,cr}var sr={},qo;function ou(){if(qo)return sr;qo=1;var g=Ee().isNonArrayObject,m=Oe(),_=m.typeErrors,u=m.clientTrackSwitchOffControl,i=m.videoContentPreferencesMode,e=m.subscriptionMode,t=m.trackPriority,r=m.trackSwitchOffMode;function n(c){var l=o(c,"options.bandwidthProfile");return!c||l||(l=o(c.video,"options.bandwidthProfile.video",[{prop:"contentPreferencesMode",values:Object.values(i)},{prop:"dominantSpeakerPriority",values:Object.values(t)},{prop:"maxSubscriptionBitrate",type:"number"},{prop:"maxTracks",type:"number"},{prop:"mode",values:Object.values(e)},{prop:"clientTrackSwitchOffControl",values:Object.values(u)},{prop:"trackSwitchOffMode",values:Object.values(r)}]),l)?l:c.video?"maxTracks"in c.video&&"clientTrackSwitchOffControl"in c.video?new TypeError("options.bandwidthProfile.video.maxTracks is deprecated. Use options.bandwidthProfile.video.clientTrackSwitchOffControl instead."):"renderDimensions"in c.video&&"contentPreferencesMode"in c.video?new TypeError("options.bandwidthProfile.video.renderDimensions is deprecated. Use options.bandwidthProfile.video.contentPreferencesMode instead."):s(c.video.renderDimensions):null}function a(c,l){if(!(c instanceof l.LocalAudioTrack||c instanceof l.LocalDataTrack||c instanceof l.LocalVideoTrack||c instanceof l.MediaStreamTrack))throw _.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")}function o(c,l,d){return d===void 0&&(d=[]),typeof c>"u"?null:c===null||!g(c)?_.INVALID_TYPE(l,"object"):d.reduce(function(v,p){var T=p.prop,M=p.type,k=p.values;if(v||!(T in c))return v;var y=c[T];return M&&typeof y!==M||M==="number"&&isNaN(y)?_.INVALID_TYPE("".concat(l,".").concat(T),M):Array.isArray(k)&&!k.includes(y)?_.INVALID_VALUE("".concat(l,".").concat(T),k):v},null)}function s(c){var l="options.bandwidthProfile.video.renderDimensions",d=o(c,l);return c?d||Object.values(t).reduce(function(v,p){return v||o(c[p],"".concat(l,".").concat(p),[{prop:"height",type:"number"},{prop:"width",type:"number"}])},null):d}return sr.validateBandwidthProfile=n,sr.validateLocalTrack=a,sr.validateObject=o,sr}var ur,Vo;function cu(){if(Vo)return ur;Vo=1;var g=ur&&ur.__extends||(function(){var a=function(o,s){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,l){c.__proto__=l}||function(c,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(c[d]=l[d])},a(o,s)};return function(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");a(o,s);function c(){this.constructor=o}o.prototype=s===null?Object.create(s):(c.prototype=s.prototype,new c)}})(),m=dn(),_=Ee(),u=_.buildLogLevels,i=_.valueToJSON,e=Oe().DEFAULT_LOG_LEVEL,t=Qe(),r=0,n=(function(a){g(o,a);function o(s,c,l){var d=a.call(this)||this;l=Object.assign({logLevel:e},l);var v=u(l.logLevel);return Object.defineProperties(d,{_instanceId:{value:r++},_log:{value:l.log?l.log.createLog("default",d):new t("default",d,v,l.loggerName)},trackName:{enumerable:!0,value:s},trackSid:{enumerable:!0,value:c}}),d}return o.prototype.toJSON=function(){return i(this)},o.prototype.toString=function(){return"[TrackPublication #".concat(this._instanceId,": ").concat(this.trackSid,"]")},o})(m);return ur=n,ur}var it,Fo;function zi(){if(Fo)return it;Fo=1;var g=it&&it.__extends||(function(){var n=function(a,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(s[l]=c[l])},n(a,o)};return function(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(a,o);function s(){this.constructor=a}a.prototype=o===null?Object.create(o):(s.prototype=o.prototype,new s)}})(),m=it&&it.__read||function(n,a){var o=typeof Symbol=="function"&&n[Symbol.iterator];if(!o)return n;var s=o.call(n),c,l=[],d;try{for(;(a===void 0||a-- >0)&&!(c=s.next()).done;)l.push(c.value)}catch(v){d={error:v}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(d)throw d.error}}return l},_=it&&it.__spreadArray||function(n,a,o){if(o||arguments.length===2)for(var s=0,c=a.length,l;s<c;s++)(l||!(s in a))&&(l||(l=Array.prototype.slice.call(a,0,s)),l[s]=a[s]);return n.concat(l||Array.prototype.slice.call(a))},u=cu(),i=Oe(),e=i.typeErrors,t=i.trackPriority,r=(function(n){g(a,n);function a(o,s,c,l){var d=n.call(this,s.name,o.sid,l)||this;return Object.defineProperties(d,{_reemitSignalingEvent:{value:function(){for(var v=[],p=0;p<arguments.length;p++)v[p]=arguments[p];return d.emit.apply(d,_([v&&v.length?"warning":"warningsCleared"],m(v),!1))}},_reemitTrackEvent:{value:function(){return d.emit(d.isTrackEnabled?"trackEnabled":"trackDisabled")}},_signaling:{value:o},_unpublish:{value:c},isTrackEnabled:{enumerable:!0,get:function(){return this.track.kind==="data"?!0:this.track.isEnabled}},kind:{enumerable:!0,value:s.kind},priority:{enumerable:!0,get:function(){return o.updatedPriority}},track:{enumerable:!0,value:s}}),["disabled","enabled"].forEach(function(v){return s.on(v,d._reemitTrackEvent)}),["warning","warningsCleared"].forEach(function(v){return o.on(v,d._reemitSignalingEvent)}),d}return a.prototype.toString=function(){return"[LocalTrackPublication #".concat(this._instanceId,": ").concat(this.trackSid,"]")},a.prototype.setPriority=function(o){var s=Object.values(t);if(!s.includes(o))throw e.INVALID_VALUE("priority",s);return this._signaling.setPriority(o),this},a.prototype.unpublish=function(){var o=this;return["disabled","enabled"].forEach(function(s){return o.track.removeListener(s,o._reemitTrackEvent)}),["warning","warningsCleared"].forEach(function(s){return o._signaling.removeListener(s,o._reemitSignalingEvent)}),this._unpublish(this),this},a})(u);return it=r,it}var lr,Bo;function Tl(){if(Bo)return lr;Bo=1;var g=lr&&lr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=zi(),_=(function(u){g(i,u);function i(e,t,r,n){return u.call(this,e,t,r,n)||this}return i.prototype.toString=function(){return"[LocalAudioTrackPublication #".concat(this._instanceId,": ").concat(this.trackSid,"]")},i})(m);return lr=_,lr}var dr,Uo;function Pl(){if(Uo)return dr;Uo=1;var g=dr&&dr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=zi(),_=(function(u){g(i,u);function i(e,t,r,n){return u.call(this,e,t,r,n)||this}return i.prototype.toString=function(){return"[LocalDataTrackPublication #".concat(this._instanceId,": ").concat(this.trackSid,"]")},i})(m);return dr=_,dr}var fr,Wo;function El(){if(Wo)return fr;Wo=1;var g=fr&&fr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=zi(),_=(function(u){g(i,u);function i(e,t,r,n){return u.call(this,e,t,r,n)||this}return i.prototype.toString=function(){return"[LocalVideoTrackPublication #".concat(this._instanceId,": ").concat(this.trackSid,"]")},i})(m);return fr=_,fr}var at,Ho;function su(){if(Ho)return at;Ho=1;var g=at&&at.__extends||(function(){var o=function(s,c){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(l[v]=d[v])},o(s,c)};return function(s,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");o(s,c);function l(){this.constructor=s}s.prototype=c===null?Object.create(c):(l.prototype=c.prototype,new l)}})(),m=at&&at.__read||function(o,s){var c=typeof Symbol=="function"&&o[Symbol.iterator];if(!c)return o;var l=c.call(o),d,v=[],p;try{for(;(s===void 0||s-- >0)&&!(d=l.next()).done;)v.push(d.value)}catch(T){p={error:T}}finally{try{d&&!d.done&&(c=l.return)&&c.call(l)}finally{if(p)throw p.error}}return v},_=at&&at.__spreadArray||function(o,s,c){if(c||arguments.length===2)for(var l=0,d=s.length,v;l<d;l++)(v||!(l in s))&&(v||(v=Array.prototype.slice.call(s,0,l)),v[l]=s[l]);return o.concat(v||Array.prototype.slice.call(s))},u=Oe(),i=u.typeErrors,e=u.trackPriority,t=xt().isIOS,r=On();function n(o){return(function(s){g(c,s);function c(l,d,v,p,T,M,k){var y=this;return k=Object.assign({workaroundWebKitBug212780:t()&&typeof document=="object"&&typeof document.addEventListener=="function"&&typeof document.visibilityState=="string"},k),y=s.call(this,d,k)||this,Object.defineProperties(y,{_isEnabled:{value:v,writable:!0},_isSwitchedOff:{value:p,writable:!0},_priority:{value:null,writable:!0},_setPriority:{value:T},_setRenderHint:{value:function(b){y._log.debug("updating render hint:",b),M(b)}},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},priority:{enumerable:!0,get:function(){return this._priority}},sid:{enumerable:!0,value:l},_workaroundWebKitBug212780:{value:k.workaroundWebKitBug212780},_workaroundWebKitBug212780Cleanup:{value:null,writable:!0}}),y}return c.prototype.setPriority=function(l){var d=_([null],m(Object.values(e)),!1);if(!d.includes(l))throw i.INVALID_VALUE("priority",d);return this._priority!==l&&(this._priority=l,this._setPriority(l)),this},c.prototype._setEnabled=function(l){this._isEnabled!==l&&(this._isEnabled=l,this.emit(this._isEnabled?"enabled":"disabled",this))},c.prototype._setSwitchedOff=function(l){this._isSwitchedOff!==l&&(this._isSwitchedOff=l,this.emit(l?"switchedOff":"switchedOn",this))},c.prototype.attach=function(l){var d=s.prototype.attach.call(this,l);return this.mediaStreamTrack.enabled!==!0&&(this.mediaStreamTrack.enabled=!0,this.processedTrack&&(this.processedTrack.enabled=!0),this.processor&&this._captureFrames()),this._workaroundWebKitBug212780&&(this._workaroundWebKitBug212780Cleanup=this._workaroundWebKitBug212780Cleanup||a(this)),d},c.prototype.detach=function(l){var d=s.prototype.detach.call(this,l);return this._attachments.size===0&&(this.mediaStreamTrack.enabled=!1,this.processedTrack&&(this.processedTrack.enabled=!1),this._workaroundWebKitBug212780Cleanup&&(this._workaroundWebKitBug212780Cleanup(),this._workaroundWebKitBug212780Cleanup=null)),d},c})(o)}function a(o){var s=o._log,c=o.kind;function l(d){d&&o._attachments.forEach(function(v){var p=o._elShims.get(v),T=v.paused&&p&&!p.pausedIntentionally();T&&(s.info("Playing inadvertently paused <".concat(c,"> element")),s.debug("Element:",v),s.debug("RemoteMediaTrack:",o),v.play().then(function(){s.info("Successfully played inadvertently paused <".concat(c,"> element")),s.debug("Element:",v),s.debug("RemoteMediaTrack:",o)}).catch(function(M){s.warn("Error while playing inadvertently paused <".concat(c,"> element:"),{err:M,el:v,remoteMediaTrack:o})}))})}return r.onVisibilityChange(2,l),function(){r.offVisibilityChange(2,l)}}return at=n,at}var pr,Qo;function Cl(){if(Qo)return pr;Qo=1;var g=pr&&pr.__extends||(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),m=Qs(),_=su(),u=_(m),i=(function(e){g(t,e);function t(r,n,a,o,s,c,l){return e.call(this,r,n,a,o,s,c,l)||this}return t.prototype.toString=function(){return"[RemoteAudioTrack #".concat(this._instanceId,": ").concat(this.sid,"]")},t.prototype._start=function(){e.prototype._start.call(this),this._dummyEl&&(this._disposeMediaElement?this._disposeMediaElement(this._dummyEl):this._dummyEl.srcObject=null,this._dummyEl=null)},t.prototype.setPriority=function(r){return e.prototype.setPriority.call(this,r)},t})(u);return pr=i,pr}var vr,Go;function Ki(){if(Go)return vr;Go=1;var g=vr&&vr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=cu(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this,e.name,e.sid,t)||this;Object.defineProperties(r,{_signaling:{value:e},_track:{value:null,writable:!0},isSubscribed:{enumerable:!0,get:function(){return!!this._track}},isTrackEnabled:{enumerable:!0,get:function(){return e.isEnabled}},kind:{enumerable:!0,value:e.kind},publishPriority:{enumerable:!0,get:function(){return e.priority}},track:{enumerable:!0,get:function(){return this._track}}});var n=e.error,a=e.isEnabled,o=e.isSwitchedOff,s=e.priority;return e.on("updated",function(){if(n!==e.error){n=e.error,r.emit("subscriptionFailed",e.error);return}a!==e.isEnabled&&(a=e.isEnabled,r.track&&r.track._setEnabled(e.isEnabled),r.emit(e.isEnabled?"trackEnabled":"trackDisabled")),o!==e.isSwitchedOff&&(r._log.debug("".concat(r.trackSid,": ").concat(o?"OFF":"ON"," => ").concat(e.isSwitchedOff?"OFF":"ON")),o=e.isSwitchedOff,r.track?(r.track._setSwitchedOff(e.isSwitchedOff),r.emit(o?"trackSwitchedOff":"trackSwitchedOn",r.track)):o&&r._log.warn("Track was not subscribed when switched Off.")),s!==e.priority&&(s=e.priority,r.emit("publishPriorityChanged",s))}),r}return i.prototype.toString=function(){return"[RemoteTrackPublication #".concat(this._instanceId,": ").concat(this.trackSid,"]")},i.prototype._subscribed=function(e){!this._track&&e&&(this._track=e,this.emit("subscribed",e))},i.prototype._unsubscribe=function(){if(this._track){var e=this._track;this._track=null,this.emit("unsubscribed",e)}},i})(m);return vr=_,vr}var hr,$o;function Ol(){if($o)return hr;$o=1;var g=hr&&hr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ki(),_=(function(u){g(i,u);function i(e,t){return u.call(this,e,t)||this}return i.prototype.toString=function(){return"[RemoteAudioTrackPublication #".concat(this._instanceId,": ").concat(this.trackSid,"]")},i})(m);return hr=_,hr}var ot,zo;function Rl(){if(zo)return ot;zo=1;var g=ot&&ot.__extends||(function(){var n=function(a,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(s[l]=c[l])},n(a,o)};return function(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(a,o);function s(){this.constructor=a}a.prototype=o===null?Object.create(o):(s.prototype=o.prototype,new s)}})(),m=ot&&ot.__read||function(n,a){var o=typeof Symbol=="function"&&n[Symbol.iterator];if(!o)return n;var s=o.call(n),c,l=[],d;try{for(;(a===void 0||a-- >0)&&!(c=s.next()).done;)l.push(c.value)}catch(v){d={error:v}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(d)throw d.error}}return l},_=ot&&ot.__spreadArray||function(n,a,o){if(o||arguments.length===2)for(var s=0,c=a.length,l;s<c;s++)(l||!(s in a))&&(l||(l=Array.prototype.slice.call(a,0,s)),l[s]=a[s]);return n.concat(l||Array.prototype.slice.call(a))},u=Gi(),i=Oe(),e=i.typeErrors,t=i.trackPriority,r=(function(n){g(a,n);function a(o,s,c){var l=n.call(this,s.id,"data",c)||this;return Object.defineProperties(l,{_isSwitchedOff:{value:!1,writable:!0},_priority:{value:null,writable:!0},isEnabled:{enumerable:!0,value:!0},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},maxPacketLifeTime:{enumerable:!0,value:s.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:s.maxRetransmits},ordered:{enumerable:!0,value:s.ordered},priority:{enumerable:!0,get:function(){return this._priority}},reliable:{enumerable:!0,value:s.maxPacketLifeTime===null&&s.maxRetransmits===null},sid:{enumerable:!0,value:o}}),s.on("message",function(d){l.emit("message",d,l)}),l}return a.prototype.setPriority=function(o){var s=_([null],m(Object.values(t)),!1);if(!s.includes(o))throw e.INVALID_VALUE("priority",s);return this._priority=o,this},a.prototype._setEnabled=function(){},a.prototype._setSwitchedOff=function(o){this._isSwitchedOff!==o&&(this._isSwitchedOff=o,this.emit(o?"switchedOff":"switchedOn",this))},a})(u);return ot=r,ot}var _r,Ko;function Ll(){if(Ko)return _r;Ko=1;var g=_r&&_r.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ki(),_=(function(u){g(i,u);function i(e,t){return u.call(this,e,t)||this}return i.prototype.toString=function(){return"[RemoteDataTrackPublication #".concat(this._instanceId,": ").concat(this.trackSid,"]")},i})(m);return _r=_,_r}var mr,Yo;function xl(){if(Yo)return mr;Yo=1;var g=mr&&mr.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=(function(){function i(e){Object.defineProperties(this,{_callback:{value:e}})}return i.prototype.observe=function(){},i.prototype.unobserve=function(){},i.prototype.makeVisible=function(e){var t=this._makeFakeEntry(e,!0);this._callback([t])},i.prototype.makeInvisible=function(e){var t=this._makeFakeEntry(e,!1);this._callback([t])},i.prototype._makeFakeEntry=function(e,t){return{target:e,isIntersecting:t}},i})(),_=(function(i){g(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e})(m),u=(function(i){g(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.resize=function(t){var r=this._makeFakeEntry(t,!0);this._callback([r])},e})(m);return mr={NullIntersectionObserver:_,NullResizeObserver:u,NullObserver:m},mr}var Tt,Jo;function Ml(){if(Jo)return Tt;Jo=1;var g=Tt&&Tt.__extends||(function(){var d=function(v,p){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,M){T.__proto__=M}||function(T,M){for(var k in M)Object.prototype.hasOwnProperty.call(M,k)&&(T[k]=M[k])},d(v,p)};return function(v,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");d(v,p);function T(){this.constructor=v}v.prototype=p===null?Object.create(p):(T.prototype=p.prototype,new T)}})(),m=Tt&&Tt.__read||function(d,v){var p=typeof Symbol=="function"&&d[Symbol.iterator];if(!p)return d;var T=p.call(d),M,k=[],y;try{for(;(v===void 0||v-- >0)&&!(M=T.next()).done;)k.push(M.value)}catch(b){y={error:b}}finally{try{M&&!M.done&&(p=T.return)&&p.call(T)}finally{if(y)throw y.error}}return k},_=su(),u=Zs(),i=On(),e=xl().NullObserver,t=Mt(),r=_(u),n=50,a=(function(d){g(v,d);function v(p,T,M,k,y,b,f){var h=this;return f=Object.assign({clientTrackSwitchOffControl:"auto",contentPreferencesMode:"auto",enableDocumentVisibilityTurnOff:!0},f),f=Object.assign({IntersectionObserver:typeof IntersectionObserver>"u"||f.clientTrackSwitchOffControl!=="auto"?e:IntersectionObserver,ResizeObserver:typeof ResizeObserver>"u"||f.contentPreferencesMode!=="auto"?e:ResizeObserver},f),h=d.call(this,p,T,M,k,y,b,f)||this,Object.defineProperties(h,{_enableDocumentVisibilityTurnOff:{value:f.enableDocumentVisibilityTurnOff===!0&&f.clientTrackSwitchOffControl==="auto"},_documentVisibilityTurnOffCleanup:{value:null,writable:!0},_clientTrackSwitchOffControl:{value:f.clientTrackSwitchOffControl},_contentPreferencesMode:{value:f.contentPreferencesMode},_invisibleElements:{value:new WeakSet},_elToPipCallbacks:{value:new WeakMap},_elToPipWindows:{value:new WeakMap},_turnOffTimer:{value:new t(function(){h._setRenderHint({enabled:!1})},n,!1)},_resizeObserver:{value:new f.ResizeObserver(function(w){var S=w.find(function(E){return!h._invisibleElements.has(E.target)});S&&c(h)})},_intersectionObserver:{value:new f.IntersectionObserver(function(w){var S=!1;w.forEach(function(E){var q=!h._invisibleElements.has(E.target);q!==E.isIntersecting&&(E.isIntersecting?(h._log.debug("intersectionObserver detected: Off => On"),h._invisibleElements.delete(E.target)):(h._log.debug("intersectionObserver detected: On => Off"),h._invisibleElements.add(E.target)),S=!0)}),S&&(s(h),c(h))},{threshold:.25})}}),h}return v.prototype._start=function(p){var T=d.prototype._start.call(this,p);return s(this),T},v.prototype.switchOn=function(){if(this._clientTrackSwitchOffControl!=="manual")throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!0}),this},v.prototype.switchOff=function(){if(this._clientTrackSwitchOffControl!=="manual")throw new Error('Invalid state. You can call switchOff only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!1}),this},v.prototype.setContentPreferences=function(p){if(this._contentPreferencesMode!=="manual")throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.contentPreferencesMode is set to "manual"');return p.renderDimensions&&this._setRenderHint({renderDimensions:p.renderDimensions}),this},v.prototype._unObservePip=function(p){var T=this._elToPipCallbacks.get(p);T&&(p.removeEventListener("enterpictureinpicture",T.onEnterPip),p.removeEventListener("leavepictureinpicture",T.onLeavePip),this._elToPipCallbacks.delete(p))},v.prototype._observePip=function(p){var T=this,M=this._elToPipCallbacks.get(p);if(!M){var k=function(f){return T._onEnterPip(f,p)},y=function(f){return T._onLeavePip(f,p)},b=function(f){return T._onResizePip(f,p)};p.addEventListener("enterpictureinpicture",k),p.addEventListener("leavepictureinpicture",y),this._elToPipCallbacks.set(p,{onEnterPip:k,onLeavePip:y,onResizePip:b})}},v.prototype._onEnterPip=function(p,T){this._log.debug("onEnterPip");var M=p.pictureInPictureWindow;this._elToPipWindows.set(T,M);var k=this._elToPipCallbacks.get(T).onResizePip;M.addEventListener("resize",k),s(this)},v.prototype._onLeavePip=function(p,T){this._log.debug("onLeavePip"),this._elToPipWindows.delete(T);var M=this._elToPipCallbacks.get(T).onResizePip,k=p.pictureInPictureWindow;k.removeEventListener("resize",M),s(this)},v.prototype._onResizePip=function(){c(this)},v.prototype.attach=function(p){var T=d.prototype.attach.call(this,p);return this._clientTrackSwitchOffControl==="auto"&&this._invisibleElements.add(T),this._intersectionObserver.observe(T),this._resizeObserver.observe(T),this._enableDocumentVisibilityTurnOff&&(this._documentVisibilityTurnOffCleanup=this._documentVisibilityTurnOffCleanup||l(this)),this._observePip(T),T},v.prototype.detach=function(p){var T=this,M=d.prototype.detach.call(this,p),k=Array.isArray(M)?M:[M];return k.forEach(function(y){T._intersectionObserver.unobserve(y),T._resizeObserver.unobserve(y),T._invisibleElements.delete(y),T._unObservePip(y)}),this._attachments.size===0&&this._documentVisibilityTurnOffCleanup&&(this._documentVisibilityTurnOffCleanup(),this._documentVisibilityTurnOffCleanup=null),s(this),c(this),M},v.prototype.addProcessor=function(){return d.prototype.addProcessor.apply(this,arguments)},v.prototype.removeProcessor=function(){return d.prototype.removeProcessor.apply(this,arguments)},v.prototype.toString=function(){return"[RemoteVideoTrack #".concat(this._instanceId,": ").concat(this.sid,"]")},v.prototype.setPriority=function(p){return d.prototype.setPriority.call(this,p)},v})(r);function o(d){if(!("documentPictureInPicture"in globalThis))return!1;var v=globalThis.documentPictureInPicture.window;if(!v)return!1;var p=new WeakSet(v.document.querySelectorAll("video"));return d._getAllAttachedElements().some(function(T){return p.has(T)})}function s(d){if(d._clientTrackSwitchOffControl==="auto"){var v=d._getAllAttachedElements().filter(function(M){return!d._invisibleElements.has(M)}),p=d._getAllAttachedElements().filter(function(M){return d._elToPipWindows.has(M)}),T=p.length>0||o(d)||document.visibilityState==="visible"&&v.length>0;T===!0?(d._turnOffTimer.clear(),d._setRenderHint({enabled:!0}),u._ensureDocumentPipVideosPlaying(d)):d._turnOffTimer.isSet||d._turnOffTimer.start()}}function c(d){if(d._contentPreferencesMode==="auto"){var v=d._getAllAttachedElements().filter(function(h){return!d._invisibleElements.has(h)}),p=d._getAllAttachedElements().map(function(h){var w=d._elToPipWindows.get(h);return w?{clientHeight:w.height,clientWidth:w.width}:{clientHeight:0,clientWidth:0}}),T=v.concat(p);if(T.length>0){var M=m(T.sort(function(h,w){return w.clientHeight+w.clientWidth-h.clientHeight-h.clientWidth-1}),1),k=M[0],y=k.clientHeight,b=k.clientWidth,f={height:y,width:b};d._setRenderHint({renderDimensions:f})}}}function l(d){function v(){s(d)}return i.onVisibilityChange(1,v),function(){i.offVisibilityChange(1,v)}}return Tt=a,Tt}var yr,Xo;function Al(){if(Xo)return yr;Xo=1;var g=yr&&yr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ki(),_=(function(u){g(i,u);function i(e,t){return u.call(this,e,t)||this}return i.prototype.toString=function(){return"[RemoteVideoTrackPublication #".concat(this._instanceId,": ").concat(this.trackSid,"]")},i})(m);return yr=_,yr}var ct,Zo;function uu(){if(Zo)return ct;Zo=1;var g=ct&&ct.__extends||(function(){var T=function(M,k){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,b){y.__proto__=b}||function(y,b){for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&(y[f]=b[f])},T(M,k)};return function(M,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");T(M,k);function y(){this.constructor=M}M.prototype=k===null?Object.create(k):(y.prototype=k.prototype,new y)}})(),m=ct&&ct.__read||function(T,M){var k=typeof Symbol=="function"&&T[Symbol.iterator];if(!k)return T;var y=k.call(T),b,f=[],h;try{for(;(M===void 0||M-- >0)&&!(b=y.next()).done;)f.push(b.value)}catch(w){h={error:w}}finally{try{b&&!b.done&&(k=y.return)&&k.call(y)}finally{if(h)throw h.error}}return f},_=ct&&ct.__spreadArray||function(T,M,k){if(k||arguments.length===2)for(var y=0,b=M.length,f;y<b;y++)(f||!(y in M))&&(f||(f=Array.prototype.slice.call(M,0,y)),f[y]=M[y]);return T.concat(f||Array.prototype.slice.call(M))},u=dn(),i=Cl(),e=Ol(),t=Rl(),r=Ll(),n=Ml(),a=Al(),o=Ee(),s=0,c=(function(T){g(M,T);function M(k,y){var b=T.call(this)||this;y=Object.assign({RemoteAudioTrack:i,RemoteAudioTrackPublication:e,RemoteDataTrack:t,RemoteDataTrackPublication:r,RemoteVideoTrack:n,RemoteVideoTrackPublication:a,tracks:[]},y);var f=l(y.tracks),h=y.log.createLog("default",b),w=new Map(f.audioTracks),S=new Map(f.dataTracks),E=new Map(f.tracks),q=new Map(f.videoTracks);return Object.defineProperties(b,{_RemoteAudioTrack:{value:y.RemoteAudioTrack},_RemoteAudioTrackPublication:{value:y.RemoteAudioTrackPublication},_RemoteDataTrack:{value:y.RemoteDataTrack},_RemoteDataTrackPublication:{value:y.RemoteDataTrackPublication},_RemoteVideoTrack:{value:y.RemoteVideoTrack},_RemoteVideoTrackPublication:{value:y.RemoteVideoTrackPublication},_audioTracks:{value:w},_dataTracks:{value:S},_instanceId:{value:++s},_clientTrackSwitchOffControl:{value:y.clientTrackSwitchOffControl},_contentPreferencesMode:{value:y.contentPreferencesMode},_log:{value:h},_signaling:{value:k},_tracks:{value:E},_trackEventReemitters:{value:new Map},_trackPublicationEventReemitters:{value:new Map},_trackSignalingUpdatedEventCallbacks:{value:new Map},_videoTracks:{value:q},audioTracks:{enumerable:!0,value:new Map},dataTracks:{enumerable:!0,value:new Map},identity:{enumerable:!0,get:function(){return k.identity}},networkQualityLevel:{enumerable:!0,get:function(){return k.networkQualityLevel}},networkQualityStats:{enumerable:!0,get:function(){return k.networkQualityStats}},sid:{enumerable:!0,get:function(){return k.sid}},state:{enumerable:!0,get:function(){return k.state}},tracks:{enumerable:!0,value:new Map},videoTracks:{enumerable:!0,value:new Map},_MediaStream:{value:y.MediaStream},_mapMediaElement:{value:y.mapMediaElement},_disposeMediaElement:{value:y.disposeMediaElement}}),b._tracks.forEach(v.bind(null,b)),k.on("networkQualityLevelChanged",function(){return b.emit("networkQualityLevelChanged",b.networkQualityLevel,b.networkQualityStats&&(b.networkQualityStats.audio||b.networkQualityStats.video)?b.networkQualityStats:null)}),d(b,k),h.info("Created a new Participant".concat(b.identity?": ".concat(b.identity):"")),b}return M.prototype._getTrackEvents=function(){return[["dimensionsChanged","trackDimensionsChanged"],["message","trackMessage"],["started","trackStarted"]]},M.prototype._getTrackPublicationEvents=function(){return[]},M.prototype.toString=function(){return"[Participant #".concat(this._instanceId,": ").concat(this.sid,"]")},M.prototype._addTrack=function(k,y){var b=this._log;if(this._tracks.has(y))return null;this._tracks.set(y,k);var f={audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[k.kind];return f.set(y,k),v(this,k,y),b.info("Added a new ".concat(o.trackClass(k),":"),y),b.debug("".concat(o.trackClass(k),":"),k),k},M.prototype._addTrackPublication=function(k){var y=this._log;if(this.tracks.has(k.trackSid))return null;this.tracks.set(k.trackSid,k);var b={audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[k.kind];return b.set(k.trackSid,k),p(this,k),y.info("Added a new ".concat(o.trackPublicationClass(k),":"),k.trackSid),y.debug("".concat(o.trackPublicationClass(k),":"),k),k},M.prototype._handleTrackSignalingEvents=function(){var k=this,y=k._log,b=k._clientTrackSwitchOffControl,f=k._contentPreferencesMode,h=k._MediaStream,w=k._mapMediaElement,S=k._disposeMediaElement,E=this;if(this.state==="disconnected")return;var q=this._RemoteAudioTrack,O=this._RemoteAudioTrackPublication,C=this._RemoteVideoTrack,I=this._RemoteVideoTrackPublication,x=this._RemoteDataTrack,A=this._RemoteDataTrackPublication,R=this._signaling;function F(D){var H={audio:O,data:A,video:I}[D.kind],$=new H(D,{log:y});E._addTrackPublication($);var re=D.isSubscribed;re&&U(D),E._trackSignalingUpdatedEventCallbacks.set(D.sid,function(){if(re!==D.isSubscribed){if(re=D.isSubscribed,re){U(D);return}j(D)}}),D.on("updated",E._trackSignalingUpdatedEventCallbacks.get(D.sid))}function V(D){D.isSubscribed&&D.setTrackTransceiver(null);var H=E._trackSignalingUpdatedEventCallbacks.get(D.sid);H&&(D.removeListener("updated",H),E._trackSignalingUpdatedEventCallbacks.delete(D.sid));var $=E.tracks.get(D.sid);$&&E._removeTrackPublication($)}function U(D){var H=D.isEnabled,$=D.name,re=D.kind,Y=D.sid,Z=D.trackTransceiver,ne=D.isSwitchedOff,ie={audio:q,video:C,data:x}[re],be=E.tracks.get(Y);if(!(!ie||re!==Z.kind)){var ce={log:y,name:$,clientTrackSwitchOffControl:b,contentPreferencesMode:f,mapMediaElement:w,disposeMediaElement:S};h&&(ce.MediaStream=h);var pe=function(_e){return R.updateSubscriberTrackPriority(Y,_e)},Te=function(_e){D.isSubscribed&&R.updateTrackRenderHint(Y,_e)},ge=re==="data"?new ie(Y,Z,ce):new ie(Y,Z,H,ne,pe,Te,ce);E._addTrack(ge,be,Z.id)}}function j(D){var H=m(Array.from(E._tracks.entries()).find(function(Z){var ne=m(Z,2),ie=ne[1];return ie.sid===D.sid}),2),$=H[0],re=H[1],Y=E.tracks.get(D.sid);re&&E._removeTrack(re,Y,$)}R.on("trackAdded",F),R.on("trackRemoved",V),R.tracks.forEach(F),R.on("stateChanged",function D(H){H==="disconnected"?(y.debug("Removing event listeners"),R.removeListener("stateChanged",D),R.removeListener("trackAdded",F),R.removeListener("trackRemoved",V)):H==="connected"&&(y.info("reconnected"),setTimeout(function(){return E.emit("reconnected")},0))})},M.prototype._removeTrack=function(k,y){if(!this._tracks.has(y))return null;this._tracks.delete(y);var b={audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[k.kind];b.delete(y);var f=this._trackEventReemitters.get(y)||new Map;f.forEach(function(w,S){k.removeListener(S,w)});var h=this._log;return h.info("Removed a ".concat(o.trackClass(k),":"),y),h.debug("".concat(o.trackClass(k),":"),k),k},M.prototype._removeTrackPublication=function(k){if(k=this.tracks.get(k.trackSid),!k)return null;this.tracks.delete(k.trackSid);var y={audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[k.kind];y.delete(k.trackSid);var b=this._trackPublicationEventReemitters.get(k.trackSid)||new Map;b.forEach(function(h,w){k.removeListener(w,h)});var f=this._log;return f.info("Removed a ".concat(o.trackPublicationClass(k),":"),k.trackSid),f.debug("".concat(o.trackPublicationClass(k),":"),k),k},M.prototype.toJSON=function(){return o.valueToJSON(this)},M})(u);function l(T){var M=T.map(function(f){return[f.id,f]}),k=M.filter(function(f){return f[1].kind==="audio"}),y=M.filter(function(f){return f[1].kind==="video"}),b=M.filter(function(f){return f[1].kind==="data"});return{audioTracks:k,dataTracks:b,tracks:M,videoTracks:y}}function d(T,M){var k=T._log;T.state!=="disconnected"&&M.on("stateChanged",function y(b){k.debug("Transitioned to state:",b),T.emit(b,T),b==="disconnected"&&(k.debug("Removing Track event reemitters"),M.removeListener("stateChanged",y),T._tracks.forEach(function(f){var h=T._trackEventReemitters.get(f.id);f&&h&&h.forEach(function(w,S){f.removeListener(S,w)})}),M.tracks.forEach(function(f){var h=T._tracks.get(f.id),w=T._trackEventReemitters.get(f.id);h&&w&&w.forEach(function(S,E){h.removeListener(E,S)})}),T._trackEventReemitters.clear(),T.tracks.forEach(function(f){T._trackPublicationEventReemitters.get(f.trackSid).forEach(function(h,w){f.removeListener(w,h)})}),T._trackPublicationEventReemitters.clear())})}function v(T,M,k){var y=new Map;T.state!=="disconnected"&&(T._getTrackEvents().forEach(function(b){var f=b[0],h=b[1];y.set(f,function(){var w=[h].concat([].slice.call(arguments));return T.emit.apply(T,_([],m(w),!1))}),M.on(f,y.get(f))}),T._trackEventReemitters.set(k,y))}function p(T,M){var k=new Map;T.state!=="disconnected"&&(T._getTrackPublicationEvents().forEach(function(y){var b=m(y,2),f=b[0],h=b[1];k.set(f,function(){for(var w=[],S=0;S<arguments.length;S++)w[S]=arguments[S];T.emit.apply(T,_(_([h],m(w),!1),[M],!1))}),M.on(f,k.get(f))}),T._trackPublicationEventReemitters.set(M.trackSid,k))}return ct=c,ct}var gr,ec;function Il(){if(ec)return gr;ec=1;var g=gr&&gr.__extends||(function(){var y=function(b,f){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,w){h.__proto__=w}||function(h,w){for(var S in w)Object.prototype.hasOwnProperty.call(w,S)&&(h[S]=w[S])},y(b,f)};return function(b,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");y(b,f);function h(){this.constructor=b}b.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)}})(),m=Lt().MediaStreamTrack,_=Ee(),u=_.asLocalTrack,i=_.asLocalTrackPublication,e=_.trackClass,t=Oe(),r=t.typeErrors,n=t.trackPriority,a=ou().validateLocalTrack,o=Dt(),s=o.LocalAudioTrack,c=o.LocalDataTrack,l=o.LocalVideoTrack,d=Tl(),v=Pl(),p=El(),T=uu(),M=(function(y){g(b,y);function b(f,h,w){var S=this;w=Object.assign({LocalAudioTrack:s,LocalVideoTrack:l,LocalDataTrack:c,MediaStreamTrack:m,LocalAudioTrackPublication:d,LocalVideoTrackPublication:p,LocalDataTrackPublication:v,shouldStopLocalTracks:!1,tracks:h},w);var E=w.shouldStopLocalTracks?new Set(h.filter(function(q){return q.kind!=="data"})):new Set;return S=y.call(this,f,w)||this,Object.defineProperties(S,{_eventObserver:{value:w.eventObserver},_LocalAudioTrack:{value:w.LocalAudioTrack},_LocalDataTrack:{value:w.LocalDataTrack},_LocalVideoTrack:{value:w.LocalVideoTrack},_MediaStreamTrack:{value:w.MediaStreamTrack},_LocalAudioTrackPublication:{value:w.LocalAudioTrackPublication},_LocalDataTrackPublication:{value:w.LocalDataTrackPublication},_LocalVideoTrackPublication:{value:w.LocalVideoTrackPublication},_tracksToStop:{value:E},signalingRegion:{enumerable:!0,get:function(){return f.signalingRegion}}}),S._handleTrackSignalingEvents(),S}return b.prototype._addTrack=function(f,h,w){var S=y.prototype._addTrack.call(this,f,h);return S&&this.state!=="disconnected"&&this._addLocalTrack(f,w),S},b.prototype._addLocalTrack=function(f,h){var w,S=(w=f.noiseCancellation)===null||w===void 0?void 0:w.vendor;this._signaling.addTrack(f._trackSender,f.name,h,S),this._log.info("Added a new ".concat(e(f,!0),":"),f.id),this._log.debug("".concat(e(f,!0),":"),f)},b.prototype._removeTrack=function(f,h){var w=y.prototype._removeTrack.call(this,f,h);return w&&this.state!=="disconnected"&&(this._signaling.removeTrack(f._trackSender),this._log.info("Removed a ".concat(e(f,!0),":"),f.id),this._log.debug("".concat(e(f,!0),":"),f)),w},b.prototype._getTrackEvents=function(){return y.prototype._getTrackEvents.call(this).concat([["disabled","trackDisabled"],["enabled","trackEnabled"],["stopped","trackStopped"]])},b.prototype.toString=function(){return"[LocalParticipant #".concat(this._instanceId).concat(this.sid?": ".concat(this.sid):"","]")},b.prototype._handleTrackSignalingEvents=function(){var f=this,h=this._log;if(this.state!=="disconnected"){var w=function(O){var C=f._signaling.getPublication(O._trackSender);C&&(C.disable(),h.debug("Disabled the ".concat(e(O,!0),":"),O.id))},S=function(O){var C=f._signaling.getPublication(O._trackSender);C&&(C.enable(),h.debug("Enabled the ".concat(e(O,!0),":"),O.id))},E=function(O){var C=f._signaling.getPublication(O._trackSender);return C&&C.stop(),C},q=function(O){h.debug("Transitioned to state:",O),O==="disconnected"?(h.debug("Removing LocalTrack event listeners"),f._signaling.removeListener("stateChanged",q),f.removeListener("trackDisabled",w),f.removeListener("trackEnabled",S),f.removeListener("trackStopped",E),f._tracks.forEach(function(C){var I=E(C);I&&C._trackSender.removeClone(I._trackTransceiver)}),h.info("LocalParticipant disconnected. Stopping ".concat(f._tracksToStop.size," automatically-acquired LocalTracks")),f._tracksToStop.forEach(function(C){C.stop()})):O==="connected"&&(h.info("reconnected"),setTimeout(function(){return f.emit("reconnected")},0))};this.on("trackDisabled",w),this.on("trackEnabled",S),this.on("trackStopped",E),this._signaling.on("stateChanged",q),this._tracks.forEach(function(O){f._addLocalTrack(O,n.PRIORITY_STANDARD),f._getOrCreateLocalTrackPublication(O).catch(function(C){h.warn("Failed to get or create LocalTrackPublication for ".concat(O,":"),C)})})}},b.prototype._getOrCreateLocalTrackPublication=function(f){var h=k(this.tracks,f);if(h)return Promise.resolve(h);var w=this._log,S=this,E=this._signaling.getPublication(f._trackSender);return E?new Promise(function(q,O){function C(){var I=E.error;if(I){E.removeListener("updated",C),w.warn("Failed to publish the ".concat(e(f,!0),": ").concat(I.message)),S._removeTrack(f,f.id),setTimeout(function(){S.emit("trackPublicationFailed",I,f)}),O(I);return}if(!S._tracks.has(f.id)){E.removeListener("updated",C),O(new Error("The ".concat(f," was unpublished")));return}var x=E.sid;if(x){E.removeListener("updated",C);var A={log:w,LocalAudioTrackPublication:S._LocalAudioTrackPublication,LocalDataTrackPublication:S._LocalDataTrackPublication,LocalVideoTrackPublication:S._LocalVideoTrackPublication};h=k(S.tracks,f);var R=function(j){return S.emit("trackWarning",j,h)},F=function(){return S.emit("trackWarningsCleared",h)},V=function(j){h.removeListener("trackWarning",R),h.removeListener("trackWarningsCleared",F),S.unpublishTrack(j.track)};h||(h=i(f,E,V,A),S._addTrackPublication(h)),h.on("warning",R),h.on("warningsCleared",F);var U=S._signaling.state;(U==="connected"||U==="connecting")&&(f._processorEventObserver&&f._processorEventObserver.on("event",function(j){S._eventObserver.emit("event",{name:j.name,payload:j.data,group:"video-processor",level:"info"})}),f.processedTrack&&(f._captureFrames(),f._setSenderMediaStreamTrack(!0))),U==="connected"&&setTimeout(function(){S.emit("trackPublished",h)}),q(h)}}E.on("updated",C)}):Promise.reject(new Error("Unexpected error: The ".concat(f," cannot be published")))},b.prototype.publishTrack=function(f,h){var w=k(this.tracks,f);if(w)return Promise.resolve(w);h=Object.assign({log:this._log,priority:n.PRIORITY_STANDARD,LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack},h);var S;try{S=u(f,h)}catch(I){return Promise.reject(I)}var E=S.noiseCancellation,q=this._signaling.audioProcessors;E&&!q.includes(E.vendor)&&(this._log.warn("".concat(E.vendor," is not supported in this room. disabling it permanently")),E.disablePermanently());var O=Object.values(n);if(!O.includes(h.priority))return Promise.reject(r.INVALID_VALUE("LocalTrackPublishOptions.priority",O));var C=this._addTrack(S,S.id,h.priority)||this._tracks.get(S.id);return this._getOrCreateLocalTrackPublication(C)},b.prototype.publishTracks=function(f){if(!Array.isArray(f))throw r.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return Promise.all(f.map(this.publishTrack,this))},b.prototype.setBandwidthProfile=function(){this._log.warn("setBandwidthProfile is not implemented yet and may be available in future versions of twilio-video.js")},b.prototype.setNetworkQualityConfiguration=function(f){if(typeof f!="object"||f===null)throw r.INVALID_TYPE("networkQualityConfiguration","NetworkQualityConfiguration");return["local","remote"].forEach(function(h){if(h in f&&(typeof f[h]!="number"||isNaN(f[h])))throw r.INVALID_TYPE("networkQualityConfiguration.".concat(h),"number")}),this._signaling.setNetworkQualityConfiguration(f),this},b.prototype.setParameters=function(f){if(typeof f<"u"&&typeof f!="object")throw r.INVALID_TYPE("encodingParameters","EncodingParameters, null or undefined");if(f){if(this._signaling.getParameters().adaptiveSimulcast&&f.maxVideoBitrate)throw r.INVALID_TYPE("encodingParameters",'encodingParameters.maxVideoBitrate is not compatible with "preferredVideoCodecs=auto"');["maxAudioBitrate","maxVideoBitrate"].forEach(function(h){if(typeof f[h]<"u"&&typeof f[h]!="number"&&f[h]!==null)throw r.INVALID_TYPE("encodingParameters.".concat(h),"number, null or undefined")})}else f===null&&(f={maxAudioBitrate:null,maxVideoBitrate:null});return this._signaling.setParameters(f),this},b.prototype.unpublishTrack=function(f){a(f,{LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack});var h=this._tracks.get(f.id);if(!h)return null;var w=this._signaling.getPublication(h._trackSender);if(w.publishFailed(new Error("The ".concat(h," was unpublished"))),h=this._removeTrack(h,h.id),!h)return null;var S=k(this.tracks,h);return S&&this._removeTrackPublication(S),S},b.prototype.unpublishTracks=function(f){var h=this;if(!Array.isArray(f))throw r.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return f.reduce(function(w,S){var E=h.unpublishTrack(S);return E?w.concat(E):w},[])},b})(T);function k(y,b){return Array.from(y.values()).find(function(f){return f.track===b||f.track.mediaStreamTrack===b})||null}return gr=M,gr}var fi,tc;function Dl(){if(tc)return fi;tc=1;var g=(function(){function m(){Object.defineProperties(this,{_connected:{writable:!0,value:!0}})}return m.prototype.connect=function(){},m.prototype.disconnect=function(){return this._connected?(this._connected=!1,!0):!1},m.prototype.publish=function(){return this._connected},m})();return fi=g,fi}var Pt,rc;function jl(){if(rc)return Pt;rc=1;var g=Pt&&Pt.__extends||(function(){var a=function(o,s){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,l){c.__proto__=l}||function(c,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(c[d]=l[d])},a(o,s)};return function(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");a(o,s);function c(){this.constructor=o}o.prototype=s===null?Object.create(s):(c.prototype=s.prototype,new c)}})(),m=Pt&&Pt.__read||function(a,o){var s=typeof Symbol=="function"&&a[Symbol.iterator];if(!s)return a;var c=s.call(a),l,d=[],v;try{for(;(o===void 0||o-- >0)&&!(l=c.next()).done;)d.push(l.value)}catch(p){v={error:p}}finally{try{l&&!l.done&&(s=c.return)&&s.call(c)}finally{if(v)throw v.error}}return d},_=Ne().EventEmitter,u=Oe(),i=u.DEFAULT_NQ_LEVEL_LOCAL,e=u.DEFAULT_NQ_LEVEL_REMOTE,t=u.MAX_NQ_LEVEL,r=Ee().inRange,n=(function(a){g(o,a);function o(s){var c=a.call(this)||this;return s=Object.assign({local:i,remote:e},s),Object.defineProperties(c,{local:{value:r(s.local,i,t)?s.local:i,writable:!0},remote:{value:r(s.remote,e,t)?s.remote:e,writable:!0}}),c}return o.prototype.update=function(s){var c=this;s=Object.assign({local:this.local,remote:this.remote},s),[["local",i,3],["remote",e,3]].forEach(function(l){var d=m(l,3),v=d[0],p=d[1],T=d[2];c[v]=typeof s[v]=="number"&&r(s[v],p,T)?s[v]:p})},o})(_);return Pt=n,Pt}var st,nc;function Nl(){if(nc)return st;nc=1;var g=st&&st.__extends||(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),m=st&&st.__read||function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(c){s={error:c}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},_=st&&st.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},u=uu(),i=(function(e){g(t,e);function t(r,n){var a=e.call(this,r,n)||this;return a._handleTrackSignalingEvents(),a.once("disconnected",a._unsubscribeTracks.bind(a)),a}return t.prototype.toString=function(){return"[RemoteParticipant #".concat(this._instanceId).concat(this.sid?": ".concat(this.sid):"","]")},t.prototype._addTrack=function(r,n,a){return e.prototype._addTrack.call(this,r,a)?(n._subscribed(r),this.emit("trackSubscribed",r,n),r):null},t.prototype._addTrackPublication=function(r){var n=e.prototype._addTrackPublication.call(this,r);return n?(this.emit("trackPublished",n),n):null},t.prototype._getTrackPublicationEvents=function(){return _(_([],m(e.prototype._getTrackPublicationEvents.call(this)),!1),[["subscriptionFailed","trackSubscriptionFailed"],["trackDisabled","trackDisabled"],["trackEnabled","trackEnabled"],["publishPriorityChanged","trackPublishPriorityChanged"],["trackSwitchedOff","trackSwitchedOff"],["trackSwitchedOn","trackSwitchedOn"]],!1)},t.prototype._unsubscribeTracks=function(){var r=this;this.tracks.forEach(function(n){if(n.isSubscribed){var a=n.track;n._unsubscribe(),r.emit("trackUnsubscribed",a,n)}})},t.prototype._removeTrack=function(r,n,a){var o=this._tracks.get(a);return o?(e.prototype._removeTrack.call(this,o,a),n._unsubscribe(),this.emit("trackUnsubscribed",o,n),o):null},t.prototype._removeTrackPublication=function(r){this._signaling.clearTrackHint(r.trackSid);var n=e.prototype._removeTrackPublication.call(this,r);return n?(this.emit("trackUnpublished",n),n):null},t})(u);return st=i,st}var pi,ic;function lu(){if(ic)return pi;ic=1;var g=(function(){function m(_,u){if(typeof _!="string")throw new Error("Track id must be a string");Object.defineProperties(this,{trackId:{value:_,enumerable:!0},trackSid:{value:u.trackSid,enumerable:!0},timestamp:{value:u.timestamp,enumerable:!0},ssrc:{value:u.ssrc,enumerable:!0},packetsLost:{value:typeof u.packetsLost=="number"?u.packetsLost:null,enumerable:!0},codec:{value:typeof u.codecName=="string"?u.codecName:null,enumerable:!0}})}return m})();return pi=g,pi}var br,ac;function du(){if(ac)return br;ac=1;var g=br&&br.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=lu(),_=(function(u){g(i,u);function i(e,t,r){var n=u.call(this,e,t)||this;return Object.defineProperties(n,{bytesSent:{value:typeof t.bytesSent=="number"?t.bytesSent:r?0:null,enumerable:!0},packetsSent:{value:typeof t.packetsSent=="number"?t.packetsSent:r?0:null,enumerable:!0},roundTripTime:{value:typeof t.roundTripTime=="number"?t.roundTripTime:r?0:null,enumerable:!0}}),n}return i})(m);return br=_,br}var wr,oc;function ql(){if(oc)return wr;oc=1;var g=wr&&wr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=du(),_=(function(u){g(i,u);function i(e,t,r){var n=u.call(this,e,t,r)||this;return Object.defineProperties(n,{audioLevel:{value:typeof t.audioInputLevel=="number"?t.audioInputLevel:null,enumerable:!0},jitter:{value:typeof t.jitter=="number"?t.jitter:null,enumerable:!0}}),n}return i})(m);return wr=_,wr}var kr,cc;function Vl(){if(cc)return kr;cc=1;var g=kr&&kr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=du(),_=(function(u){g(i,u);function i(e,t,r){var n=u.call(this,e,t,r)||this,a=null;typeof t.frameWidthInput=="number"&&typeof t.frameHeightInput=="number"&&(a={},Object.defineProperties(a,{width:{value:t.frameWidthInput,enumerable:!0},height:{value:t.frameHeightInput,enumerable:!0}}));var o=null;return typeof t.frameWidthSent=="number"&&typeof t.frameHeightSent=="number"&&(o={},Object.defineProperties(o,{width:{value:t.frameWidthSent,enumerable:!0},height:{value:t.frameHeightSent,enumerable:!0}})),Object.defineProperties(n,{captureDimensions:{value:a,enumerable:!0},dimensions:{value:o,enumerable:!0},captureFrameRate:{value:typeof t.frameRateInput=="number"?t.frameRateInput:null,enumerable:!0},frameRate:{value:typeof t.frameRateSent=="number"?t.frameRateSent:null,enumerable:!0},qualityLimitationReason:{value:["none","bandwidth","cpu","other"].find(function(s){return s===t.qualityLimitationReason})||null,enumerable:!0}}),n}return i})(m);return kr=_,kr}var Sr,sc;function fu(){if(sc)return Sr;sc=1;var g=Sr&&Sr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=lu(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this,e,t)||this;return Object.defineProperties(r,{bytesReceived:{value:typeof t.bytesReceived=="number"?t.bytesReceived:null,enumerable:!0},packetsReceived:{value:typeof t.packetsReceived=="number"?t.packetsReceived:null,enumerable:!0},jitter:{value:typeof t.jitter=="number"?t.jitter:null,enumerable:!0}}),r}return i})(m);return Sr=_,Sr}var Tr,uc;function Fl(){if(uc)return Tr;uc=1;var g=Tr&&Tr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=fu(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this,e,t)||this;return Object.defineProperties(r,{audioLevel:{value:typeof t.audioOutputLevel=="number"?t.audioOutputLevel:null,enumerable:!0}}),r}return i})(m);return Tr=_,Tr}var Pr,lc;function Bl(){if(lc)return Pr;lc=1;var g=Pr&&Pr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=fu(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this,e,t)||this,n=null;return typeof t.frameWidthReceived=="number"&&typeof t.frameHeightReceived=="number"&&(n={},Object.defineProperties(n,{width:{value:t.frameWidthReceived,enumerable:!0},height:{value:t.frameHeightReceived,enumerable:!0}})),Object.defineProperties(r,{dimensions:{value:n,enumerable:!0},frameRate:{value:typeof t.frameRateReceived=="number"?t.frameRateReceived:null,enumerable:!0},freezeCount:{value:typeof t.freezeCount=="number"?t.freezeCount:null,enumerable:!0}}),r}return i})(m);return Pr=_,Pr}var vi,dc;function pu(){if(dc)return vi;dc=1;var g=ql(),m=Vl(),_=Fl(),u=Bl(),i=(function(){function e(t,r,n){if(typeof t!="string")throw new Error("RTCPeerConnection id must be a string");Object.defineProperties(this,{peerConnectionId:{value:t,enumerable:!0},localAudioTrackStats:{value:r.localAudioTrackStats.map(function(a){return new g(a.trackId,a,n)}),enumerable:!0},localVideoTrackStats:{value:r.localVideoTrackStats.map(function(a){return new m(a.trackId,a,n)}),enumerable:!0},remoteAudioTrackStats:{value:r.remoteAudioTrackStats.map(function(a){return new _(a.trackId,a)}),enumerable:!0},remoteVideoTrackStats:{value:r.remoteVideoTrackStats.map(function(a){return new u(a.trackId,a)}),enumerable:!0}})}return e})();return vi=i,vi}var hi,fc;function Ul(){if(fc)return hi;fc=1;var g=On(),m=ht(),_=(function(){function u(i){if(!i)throw new Error("ApplicationMonitor requires a log instance");this._log=i,this._visibilityChangeHandler=null,this._boundHandleBeforeUnload=this._handleBeforeUnload.bind(this),this._setupVisibilityMonitoring(),this._setupBeforeUnloadMonitoring()}return u.prototype._setupVisibilityMonitoring=function(){var i=this;if(typeof window>"u"||typeof document>"u"){this._log.debug("Not in browser environment, skipping setup of ApplicationMonitor");return}this._visibilityChangeHandler=function(e){return i._handleVisibilityChange(e)};try{g.onVisibilityChange(1,this._visibilityChangeHandler),this._log.debug("ApplicationMonitor visibility monitoring initialized")}catch(e){this._log.error("Error initializing ApplicationMonitor visibility monitoring:",e)}},u.prototype._setupBeforeUnloadMonitoring=function(){try{window.addEventListener("beforeunload",this._boundHandleBeforeUnload),this._log.debug("ApplicationMonitor beforeunload monitoring initialized")}catch(i){this._log.error("Error initializing ApplicationMonitor beforeunload monitoring:",i)}},u.prototype.cleanup=function(){this._log.debug("Cleaning up application event monitors"),this._visibilityChangeHandler&&(g.offVisibilityChange(1,this._visibilityChangeHandler),this._visibilityChangeHandler=null),typeof window<"u"&&this._boundHandleBeforeUnload&&window.removeEventListener("beforeunload",this._boundHandleBeforeUnload)},u.prototype._handleVisibilityChange=function(i){i?m.application.resumed():m.application.backgrounded()},u.prototype._handleBeforeUnload=function(){m.application.terminated()},u})();return hi=_,hi}var _i,pc;function Wl(){if(pc)return _i;pc=1;var g=Ee().boolToString,m=ht(),_=(function(){function u(i){if(!i)throw new Error("NetworkMonitor requires a log instance");this._log=i,this._networkInformationHandler=null,this._setupNetworkInformationAPI()}return u.prototype._setupNetworkInformationAPI=function(){if(typeof globalThis.navigator>"u"||!globalThis.navigator.connection){this._log.debug("Network Information API not supported");return}var i=function(){var t=navigator.connection;m.network.informationChanged({downlink:t.downlink,downlinkMax:t.downlinkMax,effectiveType:t.effectiveType,rtt:t.rtt,saveData:typeof t.saveData=="boolean"?g(t.saveData):void 0,type:t.type})};try{var e=navigator.connection;["change","typechange"].forEach(function(t){e.addEventListener(t,i)}),this._networkInformationHandler={stop:function(){["change","typechange"].forEach(function(t){e.removeEventListener(t,i)})}},this._log.debug("Network Information API monitoring initialized")}catch(t){this._log.error("Error initializing Network Information API monitoring:",t)}},u.prototype.cleanup=function(){this._log.debug("Cleaning up network monitoring"),this._networkInformationHandler&&(this._networkInformationHandler.stop(),this._networkInformationHandler=null)},u})();return _i=_,_i}var Et,vc;function Hl(){if(vc)return Et;vc=1;var g=Et&&Et.__awaiter||function(i,e,t,r){function n(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function s(d){try{l(r.next(d))}catch(v){o(v)}}function c(d){try{l(r.throw(d))}catch(v){o(v)}}function l(d){d.done?a(d.value):n(d.value).then(s,c)}l((r=r.apply(i,e||[])).next())})},m=Et&&Et.__generator||function(i,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,n,a,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(d){return c([l,d])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(t=0)),t;)try{if(r=1,n&&(a=l[0]&2?n.return:l[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,n=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){t.label=l[1];break}if(l[0]===6&&t.label<a[1]){t.label=a[1],a=l;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(l);break}a[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(i,t)}catch(d){l=[6,d],n=0}finally{r=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};function _(){return typeof globalThis<"u"&&typeof globalThis.PressureObserver=="function"?globalThis.PressureObserver:null}var u=(function(){function i(){this._lastCpuPressure=null,this._cpuPressureObserver=null,this._sampleInterval=2e3,this._cpuPressureChangeListeners=[]}return i.prototype.watchCpuPressure=function(e){return g(this,void 0,void 0,function(){var t,r=this;return m(this,function(n){switch(n.label){case 0:if(typeof e!="function")throw new Error("The CPU pressure change callback must be a function");if(t=_(),!t)throw new Error("PressureObserver is not supported in this environment");return this._cpuPressureChangeListeners.push(e),this._cpuPressureObserver?[3,2]:(this._cpuPressureObserver=new t(function(a){return r._handleCpuPressureRecords(a)}),[4,this._cpuPressureObserver.observe("cpu",{sampleInterval:this._sampleInterval})]);case 1:n.sent(),n.label=2;case 2:return[2]}})})},i.prototype.isSupported=function(){return!!_()},i.prototype.unwatchCpuPressure=function(e){this._cpuPressureChangeListeners=this._cpuPressureChangeListeners.filter(function(t){return t!==e}),this._cpuPressureChangeListeners.length===0&&this.cleanup()},i.prototype._handleCpuPressureRecords=function(e){if(!(!Array.isArray(e)||e.length===0)){var t=e[e.length-1];if(t){var r=t.state!==this._lastCpuPressure;r&&(this._lastCpuPressure=t.state,this._cpuPressureChangeListeners.forEach(function(n){return n(t)}))}}},i.prototype.cleanup=function(){this._cpuPressureObserver&&(this._cpuPressureObserver.disconnect(),this._cpuPressureObserver=null),this._cpuPressureChangeListeners=[],this._lastCpuPressure=null},i})();return Et=new u,Et}var mi,hc;function Ql(){if(hc)return mi;hc=1;var g=Hl(),m=ht(),_=(function(){function u(i){if(!i)throw new Error("ResourceMonitor requires a log instance");this._log=i,this._cpuPressureHandler=null,this._setupCPUMonitoring()}return u.prototype._setupCPUMonitoring=function(){var i=this;if(!g.isSupported()){this._log.debug("CPU pressure monitoring not supported");return}this._cpuPressureHandler=function(e){i._log.debug("CPU pressure changed:",e),m.system.cpuPressureChanged(e.state)},g.watchCpuPressure(this._cpuPressureHandler).then(function(){i._log.debug("CPU pressure monitoring initialized")}).catch(function(e){i._log.error("Error initializing CPU pressure monitoring:",e)})},u.prototype.cleanup=function(){this._log.debug("Cleaning up resource monitors"),this._cpuPressureHandler&&(g.unwatchCpuPressure(this._cpuPressureHandler),this._cpuPressureHandler=null)},u})();return mi=_,mi}var yi,_c;function Gl(){if(_c)return yi;_c=1;var g=Ul(),m=Wl(),_=Ql(),u=(function(){function i(e){if(!e)throw new Error("MonitorRegistry requires a log instance");this._log=e,this._monitors=[new g(e),new m(e),new _(e)]}return i.prototype.cleanup=function(){var e=this;this._monitors.forEach(function(t){try{t.cleanup()}catch(r){e._log.warn("Failed to cleanup monitor:",r)}})},i})();return yi=u,yi}var ut,mc;function $l(){if(mc)return ut;mc=1;var g=ut&&ut.__extends||(function(){var k=function(y,b){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var w in h)Object.prototype.hasOwnProperty.call(h,w)&&(f[w]=h[w])},k(y,b)};return function(y,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");k(y,b);function f(){this.constructor=y}y.prototype=b===null?Object.create(b):(f.prototype=b.prototype,new f)}})(),m=ut&&ut.__read||function(k,y){var b=typeof Symbol=="function"&&k[Symbol.iterator];if(!b)return k;var f=b.call(k),h,w=[],S;try{for(;(y===void 0||y-- >0)&&!(h=f.next()).done;)w.push(h.value)}catch(E){S={error:E}}finally{try{h&&!h.done&&(b=f.return)&&b.call(f)}finally{if(S)throw S.error}}return w},_=ut&&ut.__spreadArray||function(k,y,b){if(b||arguments.length===2)for(var f=0,h=y.length,w;f<h;f++)(w||!(f in y))&&(w||(w=Array.prototype.slice.call(y,0,f)),w[f]=y[f]);return k.concat(w||Array.prototype.slice.call(y))},u=dn(),i=Nl(),e=pu(),t=Gl(),r=ht(),n=Ee(),a=n.flatMap,o=n.valueToJSON,s=0,c=(function(k){g(y,k);function y(b,f,h){var w=k.call(this)||this,S=h.log.createLog("default",w),E=new Map;return Object.defineProperties(w,{_log:{value:S},_clientTrackSwitchOffControl:{value:h.clientTrackSwitchOffControl||"disabled"},_contentPreferencesMode:{value:h.contentPreferencesMode||"disabled"},_instanceId:{value:++s},_options:{value:h},_participants:{value:E},_signaling:{value:f},_insightsMonitors:{value:h.eventObserver&&h.insights?new t(S):null},dominantSpeaker:{enumerable:!0,get:function(){return this.participants.get(f.dominantSpeakerSid)||null}},isRecording:{enumerable:!0,get:function(){return f.recording.isEnabled||!1}},localParticipant:{enumerable:!0,value:b},name:{enumerable:!0,value:f.name},participants:{enumerable:!0,value:E},sid:{enumerable:!0,value:f.sid},state:{enumerable:!0,get:function(){return f.state}},mediaRegion:{enumerable:!0,value:f.mediaRegion}}),p(w,b),T(w,f.recording),M(w,f),l(w),S.info("Created a new Room:",w.name),S.debug("Initial RemoteParticipants:",Array.from(w._participants.values())),w}return y.prototype.toString=function(){return this._instanceId?"[Room #".concat(this._instanceId,": ").concat(this.sid,"]"):"[Room (uninitialized)]"},y.prototype.disconnect=function(){return this._log.info("Disconnecting"),this._signaling.disconnect(),this},y.prototype.getStats=function(){var b=this;return this._signaling.getStats().then(function(f){return Array.from(f).map(function(h){var w=m(h,2),S=w[0],E=w[1];return new e(S,Object.assign({},E,{localAudioTrackStats:d(b,E.localAudioTrackStats),localVideoTrackStats:d(b,E.localVideoTrackStats)}))})})},y.prototype.refreshInactiveMedia=function(){var b=this.localParticipant.tracks,f=Array.from(b.values()).filter(function(q){var O=q.track.kind;return O!=="data"}).map(function(q){var O=q.track;return O}),h=a(this.participants,function(q){return Array.from(q.tracks.values())}).filter(function(q){var O=q.track;return O&&O.kind!=="data"}).map(function(q){var O=q.track;return O}),w=f.concat(h),S=new Event("unmute");f.forEach(function(q){var O=q.isMuted,C=q.mediaStreamTrack;O&&C.dispatchEvent(S)});var E=new Event("pause");return w.forEach(function(q){var O=q._attachments,C=q._elShims;return O.forEach(function(I){var x=C.get(I),A=I.paused&&x&&!x.pausedIntentionally();A&&I.dispatchEvent(E)})}),this},y.prototype.toJSON=function(){return o(this)},y})(u);function l(k){var y=k.localParticipant._signaling.audioProcessors;k.localParticipant.audioTracks.forEach(function(b){var f=b.track,h=f.noiseCancellation;h&&!y.includes(h.vendor)&&(k._log.warn("".concat(h.vendor," is not supported in this room. disabling it permanently")),h.disablePermanently())})}function d(k,y){var b=k.localParticipant._signaling;return y.reduce(function(f,h){var w=b.tracks.get(h.trackId),S=b.getSender(w);return S?[Object.assign({},h,{trackId:S.id})].concat(f):f},[])}function v(k,y){var b=k._log,f=k._clientTrackSwitchOffControl,h=k._contentPreferencesMode,w=k._options,S=w.MediaStream,E=w.mapMediaElement,q=w.disposeMediaElement,O=new i(y,{log:b,clientTrackSwitchOffControl:f,contentPreferencesMode:h,MediaStream:S,mapMediaElement:E,disposeMediaElement:q});b.info("A new RemoteParticipant connected:",O),k._participants.set(O.sid,O),k.emit("participantConnected",O);var C=[["reconnected","participantReconnected"],["reconnecting","participantReconnecting"],"trackDimensionsChanged","trackDisabled","trackEnabled","trackMessage","trackPublished","trackPublishPriorityChanged","trackStarted","trackSubscribed","trackSubscriptionFailed","trackSwitchedOff","trackSwitchedOn","trackUnpublished","trackUnsubscribed"].map(function(I){var x=m(Array.isArray(I)?I:[I,I],2),A=x[0],R=x[1];function F(){var V=[].slice.call(arguments);V.unshift(R),V.push(O),k.emit.apply(k,_([],m(V),!1))}return O.on(A,F),[A,F]});O.once("disconnected",function(){var x=k.dominantSpeaker;b.info("RemoteParticipant disconnected:",O),k._participants.delete(O.sid),C.forEach(function(A){O.removeListener(A[0],A[1])}),k.emit("participantDisconnected",O),O===x&&k.emit("dominantSpeakerChanged",k.dominantSpeaker)})}function p(k,y){var b=["trackWarning","trackWarningsCleared"].map(function(f){return{eventName:f,handler:function(){for(var h=[],w=0;w<arguments.length;w++)h[w]=arguments[w];return k.emit.apply(k,_([f],m(_(_([],m(h),!1),[y],!1)),!1))}}});b.forEach(function(f){var h=f.eventName,w=f.handler;return y.on(h,w)}),k.once("disconnected",function(){return b.forEach(function(f){var h=f.eventName,w=f.handler;return y.removeListener(h,w)})})}function T(k,y){y.on("updated",function(){var f=y.isEnabled;k._log.info("Recording ".concat(f?"started":"stopped")),k.emit("recording".concat(f?"Started":"Stopped"))})}function M(k,y){var b=k._log;b.debug("Creating a new RemoteParticipant for each ParticipantSignaling in the RoomSignaling"),y.participants.forEach(v.bind(null,k)),b.debug("Setting up RemoteParticipant creation for all subsequent ParticipantSignalings that connect to the RoomSignaling"),y.on("participantConnected",v.bind(null,k)),y.on("dominantSpeakerChanged",function(){return k.emit("dominantSpeakerChanged",k.dominantSpeaker)}),y.on("transcription",function(f){return k.emit("transcription",f)}),y.on("stateChanged",function f(h,w){switch(b.info("Transitioned to state:",h),h){case"disconnected":r.room.disconnected(),k.participants.forEach(function(S){S._unsubscribeTracks()}),k.emit(h,k,w),k.localParticipant.tracks.forEach(function(S){S.unpublish()}),k._insightsMonitors&&k._insightsMonitors.cleanup(),y.removeListener("stateChanged",f);break;case"reconnecting":r.room.reconnecting(w),setTimeout(function(){return k.emit("reconnecting",w)},0);break;default:r.room.reconnected(),setTimeout(function(){return k.emit("reconnected")},0)}})}return ut=c,ut}var gi,yc;function vu(){if(yc)return gi;yc=1;var g=(function(){function m(_){Object.defineProperties(this,{_min:{value:_.min||100},_max:{value:_.max||1e4},_jitter:{value:_.jitter>0&&_.jitter<=1?_.jitter:0},_factor:{value:_.factor||2},_attempts:{value:0,writable:!0},_duration:{enumerable:!1,get:function(){var u=this._min*Math.pow(this._factor,this._attempts);if(this._jitter){var i=Math.random(),e=Math.floor(i*this._jitter*u);u=(Math.floor(i*10)&1)===0?u-e:u+e}return Math.min(u,this._max)|0}},_timeoutID:{value:null,writable:!0}})}return m.prototype.backoff=function(_){var u=this,i=this._duration;this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null),this._timeoutID=setTimeout(function(){u._attempts++,_()},i)},m.prototype.reset=function(){this._attempts=0,this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},m})();return gi=g,gi}var De={},Er,gc;function zl(){if(gc)return Er;gc=1;var g=Er&&Er.__read||function(l,d){var v=typeof Symbol=="function"&&l[Symbol.iterator];if(!v)return l;var p=v.call(l),T,M=[],k;try{for(;(d===void 0||d-- >0)&&!(T=p.next()).done;)M.push(T.value)}catch(y){k={error:y}}finally{try{T&&!T.done&&(v=p.return)&&v.call(p)}finally{if(k)throw k.error}}return M},m=Ee(),_=m.difference,u=m.flatMap;function i(){var l=4294967295;return String(Math.floor(Math.random()*l))}var e=(function(){function l(d,v,p){Object.defineProperties(this,{cName:{enumerable:!0,value:p},isSimulcastEnabled:{enumerable:!0,value:!1,writable:!0},primarySSRCs:{enumerable:!0,value:new Set},rtxPairs:{enumerable:!0,value:new Map},streamId:{enumerable:!0,value:v},trackId:{enumerable:!0,value:d}})}return l.prototype.addSimulcastSSRCs=function(){if(!this.isSimulcastEnabled){var d=[i(),i()];d.forEach(function(v){this.primarySSRCs.add(v)},this),this.rtxPairs.size&&d.forEach(function(v){this.rtxPairs.set(i(),v)},this)}},l.prototype.addSSRC=function(d,v,p){v?this.rtxPairs.set(d,v):this.primarySSRCs.add(d),this.isSimulcastEnabled=this.isSimulcastEnabled||p},l.prototype.toSdpLines=function(d){var v=this,p=d?[]:Array.from(this.rtxPairs.entries()).map(function(f){return f.reverse()}),T=Array.from(this.primarySSRCs.values()),M=p.length?u(p):T,k=u(M,function(f){return["a=ssrc:".concat(f," cname:").concat(v.cName),"a=ssrc:".concat(f," msid:").concat(v.streamId," ").concat(v.trackId)]}),y=p.map(function(f){return"a=ssrc-group:FID ".concat(f.join(" "))}),b=["a=ssrc-group:SIM ".concat(T.join(" "))];return y.concat(k).concat(b)},l})();function t(l,d){var v=l.match(new RegExp(d,"gm"))||[];return v.map(function(p){var T=p.match(new RegExp(d))||[];return T.slice(1)})}function r(l){var d="^a=ssrc-group:SIM ([0-9]+) ([0-9]+) ([0-9]+)$";return new Set(u(t(l,d)))}function n(l,d,v){var p="a=ssrc:".concat(d," ").concat(v,":(.+)");return l.match(new RegExp(p))[1]}function a(l){var d="^a=ssrc-group:FID ([0-9]+) ([0-9]+)$";return new Map(t(l,d).map(function(v){return v.reverse()}))}function o(l){var d=g(u(t(l,"^a=msid:(.+) (.+)$")),2),v=d[0],p=d[1],T=u(t(l,"^a=ssrc:(.+) cname:.+$"));return T.map(function(M){return[M,v,p]})}function s(l){var d=r(l),v=a(l),p=o(l);return p.reduce(function(T,M){var k=M[0],y=M[1],b=M[2],f=T.get(b)||new e(b,y,n(l,k,"cname")),h=v.get(k)||null;return f.addSSRC(k,h,d.has(k)),T.set(b,f)},new Map)}function c(l,d){var v=s(l),p=Array.from(v.keys()),T=Array.from(d.keys()),M=_(p,T),k=_(T,p),y=u(M,function(q){return v.get(q)});y.forEach(function(q){q.addSimulcastSSRCs(),d.set(q.trackId,q)}),T=Array.from(d.keys());var b=_(T,k),f=u(b,function(q){return d.get(q)}),h=!l.match(/a=rtpmap:[0-9]+ rtx/),w=u(f,function(q){return q.toSdpLines(h)}),S=u(new Set(l.split(`\r
`).concat(w))),E="a=x-google-flag:conference";return l.match(E)||S.push(E),S.join(`\r
`)}return Er=c,Er}var bc;function Yi(){if(bc)return De;bc=1;var g=De&&De.__read||function(S,E){var q=typeof Symbol=="function"&&S[Symbol.iterator];if(!q)return S;var O=q.call(S),C,I=[],x;try{for(;(E===void 0||E-- >0)&&!(C=O.next()).done;)I.push(C.value)}catch(A){x={error:A}}finally{try{C&&!C.done&&(q=O.return)&&q.call(O)}finally{if(x)throw x.error}}return I},m=Ee(),_=m.difference,u=m.flatMap,i=zl(),e={0:"PCMU",8:"PCMA"};function t(S){return Array.from(n(S)).reduce(function(E,q){var O=q[0],C=q[1],I=E.get(C)||[];return E.set(C,I.concat(O))},new Map)}function r(S){return s(S).reduce(function(E,q){var O=o(q);return O?E.set(O,q):E},new Map)}function n(S){return c(S).reduce(function(E,q){if(E.has(q))return E;var O=new RegExp("a=rtpmap:".concat(q," ([^/]+)")),C=S.match(O),I=C?C[1].toLowerCase():e[q]?e[q].toLowerCase():"";return E.set(q,I)},new Map)}function a(S,E){var q=new RegExp("^a=fmtp:".concat(S," (.+)$"),"m"),O=E.match(q);return O&&O[1].split(";").reduce(function(C,I){var x=g(I.split("="),2),A=x[0],R=x[1];return C[A]=isNaN(R)?R:parseInt(R,10),C},{})}function o(S){var E=S.match(/^a=mid:(.+)$/m);return E&&E[1]}function s(S,E,q){return S.replace(/\r\n\r\n$/,`\r
`).split(`\r
m=`).slice(1).map(function(O){return"m=".concat(O)}).filter(function(O){var C=new RegExp("m=".concat(E||".*"),"gm"),I=new RegExp("a=".concat(q||".*"),"gm");return C.test(O)&&I.test(O)})}function c(S){var E=S.split(`\r
`)[0],q=E.match(/([0-9]+)/g);return q?q.slice(1).map(function(O){return parseInt(O,10)}):[]}function l(S,E){var q=E.split(`\r
`),O=q[0],C=q.slice(1);return O=O.replace(/([0-9]+\s?)+$/,S.join(" ")),[O].concat(C).join(`\r
`)}function d(S,E){var q=s(S),O=S.split(`\r
m=`)[0];return[O].concat(q.map(function(C){if(C=C.replace(/\r\n$/,""),!/^m=video/.test(C))return C;var I=t(C),x=c(C),A=new Set(I.get("vp8")||[]),R=x.some(function(F){return A.has(F)});return R?i(C,E):C})).concat("").join(`\r
`)}function v(S,E,q,O){O===void 0&&(O=!1);var C=r(q),I=r(E),x=s(S),A=S.split(`\r
m=`)[0];return[A].concat(x.map(function(R){if(R=R.replace(/\r\n$/,""),!/^m=video/.test(R))return R;var F=R.match(/^a=mid:(.+)$/m),V=F&&F[1];if(!V)return R;var U=C.get(V),j=n(U),D=c(U),H=D.length&&j.get(D[0])==="vp8",$=O||!H;return $?I.get(V).replace(/\r\n$/,""):R})).concat("").join(`\r
`)}function p(S,E,q){var O=Array.from(q).reduce(function(C,I){var x=g(I,2),A=x[0],R=x[1],F=s(S,A,"send(only|recv)"),V=F.map(o).filter(function(U){return!E.has(U)});return V.forEach(function(U,j){return C.set(U,R[j])}),C},new Map);return T(S,O)}function T(S,E){var q=s(S),O=S.split(`\r
m=`)[0];return[O].concat(q.map(function(C){if(!/^m=(audio|video)/.test(C))return C;var I=o(C);if(!I)return C;var x=E.get(I);if(!x)return C;var A=(C.match(/^a=msid:(.+)$/m)||[])[1];if(!A)return C;var R=g(A.split(" "),2),F=R[0],V=R[1],U=new RegExp("msid:".concat(F).concat(V?" ".concat(V):"","$"),"gm");return C.replace(U,"msid:".concat(F," ").concat(x))})).join(`\r
`)}function M(S,E){return S.split(`\r
`).filter(function(q){return!E.find(function(O){return new RegExp("a=ssrc:.*"+O+":","g").test(q)})}).join(`\r
`)}function k(S){var E=s(S),q=S.split(`\r
m=`)[0];return[q].concat(E.map(function(O){if(!/^m=video/.test(O))return O;var C=t(O),I=C.get("rtx");if(!I)return O;var x=new Set(c(O));I.forEach(function(V){return x.delete(V)});var A=O.match(/a=ssrc-group:FID [0-9]+ ([0-9]+)/),R=A&&A[1],F=[/^a=fmtp:.+ apt=.+$/,/^a=rtpmap:.+ rtx\/.+$/,/^a=ssrc-group:.+$/].concat(R?[new RegExp("^a=ssrc:".concat(R," .+$"))]:[]);return O=O.split(`\r
`).filter(function(V){return F.every(function(U){return!U.test(V)})}).join(`\r
`),l(Array.from(x),O)})).join(`\r
`)}function y(S,E){var q=Object.entries(E).map(function(O){var C=g(O,2),I=C[0],x=C[1];return"".concat(I,"=").concat(x)}).join(";");return"a=fmtp:".concat(S," ").concat(q)}function b(S){var E=s(S),q=S.split(`\r
m=`)[0];return[q].concat(E.map(function(O){if(!/^m=(audio|video)/.test(O))return O;var C=new Set(c(O));return O.split(`\r
`).filter(function(I){var x=I.match(/^a=(fmtp|rtpmap|rtcp-fb):(\d+)/);if(!x)return!0;var A=parseInt(x[2],10);return C.has(A)}).join(`\r
`)})).join(`\r
`)}function f(S,E){var q=s(S),O=S.split(`\r
m=`)[0];return E=E||q.filter(function(C){return/^m=audio/.test(C)}).map(o),[O].concat(q.map(function(C){if(!/^m=audio/.test(C))return C;var I=t(C),x=I.get("opus");if(!x)return C;var A=a(x,C);if(!A)return C;var R=y(x,A),F=new RegExp(R),V=o(C);E.includes(V)?A.usedtx=1:delete A.usedtx;var U=y(x,A);return C.replace(F,U)})).join(`\r
`)}function h(S,E){E=E.map(function(I){var x=I.codec;return x.toLowerCase()});var q=u(E,function(I){return S.get(I)||[]}),O=_(Array.from(S.keys()),E),C=u(O,function(I){return S.get(I)});return q.concat(C)}function w(S,E,q){var O=s(S),C=S.split(`\r
m=`)[0];return[C].concat(O.map(function(I){if(!/^m=(audio|video)/.test(I))return I;var x=I.match(/^m=(audio|video)/)[1],A=t(I),R=x==="audio"?E:q,F=h(A,R),V=l(F,I),U=A.get("pcma")||[],j=A.get("pcmu")||[],D=x==="audio"?new Set(U.concat(j)):new Set;return D.has(F[0])?V.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):V})).join(`\r
`)}return De.addOrRewriteNewTrackIds=p,De.addOrRewriteTrackIds=T,De.createCodecMapForMediaSection=t,De.createPtToCodecName=n,De.disableRtx=k,De.enableDtxForOpus=f,De.getMediaSections=s,De.removeUnreferencedCodecAttributes=b,De.removeSSRCAttributes=M,De.revertSimulcast=v,De.setCodecPreferences=w,De.setSimulcast=d,De}var bi,wc;function Kl(){if(wc)return bi;wc=1;var g=(function(){function m(_){_=Object.assign({getKey:function(i){return i},getValue:function(i){return i},isLessThanOrEqualTo:function(i,e){return i<=e}},_),Object.defineProperties(this,{_getKey:{value:_.getKey},_getValue:{value:_.getValue},_isLessThanOrEqualTo:{value:_.isLessThanOrEqualTo},_map:{value:new Map}})}return m.prototype.toMap=function(){return new Map(this._map)},m.prototype.updateAndFilter=function(_){return _.filter(this.update,this)},m.prototype.update=function(_){var u=this._getKey(_),i=this._getValue(_);return this._map.has(u)&&this._isLessThanOrEqualTo(i,this._map.get(u))?!1:(this._map.set(u,i),!0)},m})();return bi=g,bi}var wi,kc;function Yl(){if(kc)return wi;kc=1;var g=Kl(),m=(function(){function _(){Object.defineProperties(this,{_filter:{value:new g({getKey:function(i){return i.ufrag},isLessThanOrEqualTo:function(i,e){return i.revision<=e.revision}})},_ufrag:{writable:!0,value:null},ufrag:{enumerable:!0,get:function(){return this._ufrag}}})}return _.prototype.setUfrag=function(u){this._ufrag=u;var i=this._filter.toMap().get(u);return i?i.candidates:[]},_.prototype.update=function(u){u.candidates=u.candidates||[];var i=this._filter.toMap().get(u.ufrag),e=i?i.candidates:[];return this._filter.update(u)&&this._ufrag===u.ufrag?u.candidates.slice(e.length):[]},_})();return wi=m,wi}var ki,Sc;function Jl(){if(Sc)return ki;Sc=1;var g=Oe(),m=g.ICE_ACTIVITY_CHECK_PERIOD_MS,_=g.ICE_INACTIVITY_THRESHOLD_MS,u=(function(){function i(e,t){t=Object.assign({activityCheckPeriodMs:m,inactivityThresholdMs:_},t),Object.defineProperties(this,{_activityCheckPeriodMs:{value:t.activityCheckPeriodMs},_inactivityThresholdMs:{value:t.inactivityThresholdMs},_lastActivity:{value:null,writable:!0},_peerConnection:{value:e},_timer:{value:null,writable:!0},_onIceConnectionStateChanged:{value:null,writable:!0}})}return i.prototype._getActivePairStat=function(e){var t=Array.from(e.values()),r=t.find(function(n){return n.type==="candidate-pair"&&n.nominated});return r||{bytesReceived:0,timestamp:Math.round(new Date().getTime())}},i.prototype._getIceConnectionStats=function(){var e=this;return this._peerConnection.getStats().then(function(t){return e._getActivePairStat(t)}).catch(function(){return null})},i.prototype._scheduleInactivityCallback=function(e){var t=this;e&&this._onIceConnectionStateChanged===null?(this._onIceConnectionStateChanged=function(){t._peerConnection.iceConnectionState==="disconnected"&&e()},this._peerConnection.addEventListener?this._peerConnection.addEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged):this._peerConnection.oniceconnectionstatechange=this._onIceConnectionStateChanged):!e&&this._onIceConnectionStateChanged&&(this._peerConnection.removeEventListener?this._peerConnection.removeEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged):this._peerConnection.oniceconnectionstatechange=null,this._onIceConnectionStateChanged=null)},i.prototype.start=function(e){var t=this;this.stop(),this._timer=setInterval(function(){t._getIceConnectionStats().then(function(r){r&&((!t._lastActivity||t._lastActivity.bytesReceived!==r.bytesReceived)&&(t._lastActivity=r,t._scheduleInactivityCallback(null)),r.timestamp-t._lastActivity.timestamp>=t._inactivityThresholdMs&&(t._peerConnection.iceConnectionState==="disconnected"?e():t._onIceConnectionStateChanged===null&&t._scheduleInactivityCallback(e)))})},this._activityCheckPeriodMs)},i.prototype.stop=function(){this._scheduleInactivityCallback(null),this._timer!==null&&(clearInterval(this._timer),this._timer=null,this._lastActivity=null)},i})();return ki=u,ki}var Cr,Tc;function Xl(){if(Tc)return Cr;Tc=1;var g=Cr&&Cr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ne().EventEmitter,_=(function(u){g(i,u);function i(e){var t=u.call(this)||this;return Object.defineProperties(t,{_dataChannel:{value:e},_messageQueue:{value:[]}}),e.addEventListener("open",function(){t._messageQueue.splice(0).forEach(function(r){return t._publish(r)})}),e.addEventListener("message",function(r){var n=r.data;try{var a=JSON.parse(n);t.emit("message",a)}catch{}}),t.publish({type:"ready"}),t}return i.prototype._publish=function(e){var t=JSON.stringify(e);try{this._dataChannel.send(t)}catch{}},i.prototype.publish=function(e){var t=this._dataChannel;return t.readyState==="closing"||t.readyState==="closed"?!1:t.readyState==="connecting"?(this._messageQueue.push(e),!0):(this._publish(e),!0)},i})(m);return Cr=_,Cr}var Or,Pc;function Zl(){if(Pc)return Or;Pc=1;var g=Or&&Or.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=eu(),_=Xl(),u=(function(i){g(e,i);function e(t){var r=i.call(this,t.label,t.maxPacketLifeTime,t.maxRetransmits,t.ordered)||this;return Object.defineProperties(r,{_dataChannel:{value:t}}),t.binaryType="arraybuffer",t.addEventListener("message",function(n){r.emit("message",n.data)}),t.addEventListener("close",function(){r.emit("close")}),r}return e.prototype.stop=function(){this._dataChannel.close(),i.prototype.stop.call(this)},e.prototype.toDataTransport=function(){return new _(this._dataChannel)},e})(m);return Or=u,Or}var Rr,Ec;function ed(){if(Ec)return Rr;Ec=1;var g=Rr&&Rr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ys(),_=(function(u){g(i,u);function i(e,t){return u.call(this,e,t)||this}return i})(m);return Rr=_,Rr}var Si,Cc;function td(){if(Cc)return Si;Cc=1;var g=Yi().getMediaSections,m=(function(){function _(){Object.defineProperties(this,{_midsToTrackIds:{value:new Map,writable:!0}})}return _.prototype.match=function(u){return this._midsToTrackIds.get(u.transceiver.mid)||null},_.prototype.update=function(u){var i=g(u,"(audio|video)");this._midsToTrackIds=i.reduce(function(e,t){var r=t.match(/^a=mid:(.+)$/m)||[],n=t.match(/^a=msid:.+ (.+)$/m)||[],a=r[1],o=n[1];return a&&o?e.set(a,o):e},this._midsToTrackIds)},_})();return Si=m,Si}var Ti,Oc;function rd(){if(Oc)return Ti;Oc=1;var g=Lt().RTCSessionDescription,m=Yi(),_=m.createPtToCodecName,u=m.getMediaSections;function i(v){var p={type:v.type};return v.type!=="rollback"&&(p.sdp=e(v.sdp)),new g(p)}function e(v){var p=u(v),T=v.split(`\r
m=`)[0];return[T].concat(p.map(t)).join(`\r
`)}function t(v){var p=_(v);v=n(v,p),v=r(v);var T=a(p),M=T.get("rtx")||new Set,k=new Set,y=o(v,p,M,k),b=s(y,k),f=Array.from(k),h=["h264","vp8","vp9"],w=h.reduce(function(S,E){var q=T.get(E)||new Set;return Array.from(q).reduce(function(O,C){return b.has(C)?O:O.add(C)},S)},new Set);return w.forEach(function(S){if(f.length){var E=f.shift();v=c(v,E),v=d(v,E,S)}}),f.forEach(function(S){v=c(v,S),v=l(v,S)}),v}function r(v){for(var p=v.split(`\r
`),T=new Map,M=96,k=0;k<p.length;k++){var y=p[k].match(/^a=rtpmap:(\d+) ([^/]+)/);if(y){var b=parseInt(y[1],10),f=y[2].toLowerCase();if(T.has(b)&&T.get(b)!==f){for(;T.has(M)||M===b;)M++;var h=M;T.set(h,f),p[k]=p[k].replace("a=rtpmap:".concat(b),"a=rtpmap:".concat(h));for(var w=k+1;w<p.length;w++)p[w].match(new RegExp("^a=(fmtp|rtcp-fb):".concat(b,"\\b")))&&(p[w]=p[w].replace(new RegExp("^a=(fmtp|rtcp-fb):".concat(b,"\\b")),"a=$1:".concat(h)))}else T.set(b,f)}}return p.join(`\r
`)}function n(v,p){return Array.from(p.keys()).reduce(function(T,M){var k=new RegExp("^a=rtpmap:".concat(M," rtx.+$"),"gm");return(T.match(k)||[]).slice(p.get(M)==="rtx"?1:0).reduce(function(y,b){var f=new RegExp(`\r
`.concat(b)),h=new RegExp(`\r
a=fmtp:`.concat(M," apt=[0-9]+"));return y.replace(f,"").replace(h,"")},T)},v)}function a(v){var p=new Map;return v.forEach(function(T,M){var k=p.get(T)||new Set;return p.set(T,k.add(M))}),p}function o(v,p,T,M){return Array.from(T).reduce(function(k,y){var b=new RegExp("a=fmtp:".concat(y," apt=(\\d+)")),f=v.match(b);if(!f)return M.add(y),k;var h=Number.parseInt(f[1]);if(!p.has(h))return M.add(y),k;var w=p.get(h);return w==="rtx"?(M.add(y),k):k.set(y,h)},new Map)}function s(v,p){var T=Array.from(v).reduce(function(M,k){var y=k[0],b=k[1],f=M.get(b)||new Set;return M.set(b,f.add(y))},new Map);return Array.from(T).reduce(function(M,k){var y=k[0],b=Array.from(k[1]);return b.length>1?(b.forEach(function(f){p.add(f)}),M):M.set(y,b[0])},new Map)}function c(v,p){var T=new RegExp("a=fmtp:".concat(p,`.*\r
`),"gm");return v.replace(T,"")}function l(v,p){var T=new RegExp("a=rtpmap:".concat(p,`.*\r
`),"gm");return v.replace(T,"")}function d(v,p,T){return v.endsWith(`\r
`)?"".concat(v,"a=fmtp:").concat(p," apt=").concat(T,`\r
`):"".concat(v,`\r
a=fmtp:`).concat(p," apt=").concat(T)}return Ti=i,Ti}var lt,Rc;function nd(){if(Rc)return lt;Rc=1;var g=lt&&lt.__extends||(function(){var te=function(K,B){return te=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(W,G){W.__proto__=G}||function(W,G){for(var Q in G)Object.prototype.hasOwnProperty.call(G,Q)&&(W[Q]=G[Q])},te(K,B)};return function(K,B){if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");te(K,B);function W(){this.constructor=K}K.prototype=B===null?Object.create(B):(W.prototype=B.prototype,new W)}})(),m=lt&&lt.__read||function(te,K){var B=typeof Symbol=="function"&&te[Symbol.iterator];if(!B)return te;var W=B.call(te),G,Q=[],J;try{for(;(K===void 0||K-- >0)&&!(G=W.next()).done;)Q.push(G.value)}catch(oe){J={error:oe}}finally{try{G&&!G.done&&(B=W.return)&&B.call(W)}finally{if(J)throw J.error}}return Q},_=lt&&lt.__spreadArray||function(te,K,B){if(B||arguments.length===2)for(var W=0,G=K.length,Q;W<G;W++)(Q||!(W in K))&&(Q||(Q=Array.prototype.slice.call(K,0,W)),Q[W]=K[W]);return te.concat(Q||Array.prototype.slice.call(K))},u=vu(),i=Lt(),e=i.RTCIceCandidate,t=i.RTCPeerConnection,r=i.RTCSessionDescription,n=i.getStats,a=je(),o=Oe(),s=o.DEFAULT_ICE_GATHERING_TIMEOUT_MS,c=o.DEFAULT_LOG_LEVEL,l=o.DEFAULT_SESSION_TIMEOUT_SEC,d=o.iceRestartBackoffConfig,v=Yi(),p=v.addOrRewriteNewTrackIds,T=v.addOrRewriteTrackIds,M=v.createCodecMapForMediaSection,k=v.disableRtx,y=v.enableDtxForOpus,b=v.getMediaSections,f=v.removeUnreferencedCodecAttributes,h=v.removeSSRCAttributes,w=v.revertSimulcast,S=v.setCodecPreferences,E=v.setSimulcast,q=Mt(),O=ze(),C=O.MediaClientLocalDescFailedError,I=O.MediaClientRemoteDescFailedError,x=Ee(),A=x.buildLogLevels,R=x.isChromeScreenShareTrack,F=x.oncePerTick,V=x.defer,U=Yl(),j=Jl(),D=Zl(),H=ed(),$=jt(),re=Qe(),Y=td(),Z=rd(),ne=ht(),ie=a.guessBrowser(),be=ie==="chrome",ce=ie==="firefox",pe=ie==="safari",Te=0,ge={open:["closed","updating"],updating:["closed","open"],closed:[]},_e=(function(te){g(K,te);function K(B,W,G,Q){var J=te.call(this,"open",ge)||this;Q=Object.assign({enableDscp:!1,dummyAudioMediaStreamTrack:null,isChromeScreenShareTrack:R,iceServers:[],logLevel:c,offerOptions:{},revertSimulcast:w,sessionTimeout:l*1e3,setCodecPreferences:S,setSimulcast:E,Backoff:u,IceConnectionMonitor:j,RTCIceCandidate:e,RTCPeerConnection:t,RTCSessionDescription:r,Timeout:q},Q);var oe=se(Object.assign({},Q,Q.rtcConfiguration)),Se=A(Q.logLevel),Ce=Q.RTCPeerConnection;Q.enableDscp===!0&&(Q.chromeSpecificConstraints=Q.chromeSpecificConstraints||{},Q.chromeSpecificConstraints.optional=Q.chromeSpecificConstraints.optional||[],Q.chromeSpecificConstraints.optional.push({googDscp:!0}));var xe=Q.log?Q.log.createLog("webrtc",J):new re("webrtc",J,Se,Q.loggerName),Pe=new Ce(oe,{chromeSpecificConstraints:Q.chromeSpecificConstraints,applyCodecPreferences:function(we){return J._applyCodecPreferencesToTransceiver(we)}});Q.dummyAudioMediaStreamTrack&&Pe.addTrack(Q.dummyAudioMediaStreamTrack),Object.defineProperties(J,{_appliedTrackIdsToAttributes:{value:new Map,writable:!0},_dataChannels:{value:new Map},_dataTrackReceivers:{value:new Set},_descriptionRevision:{writable:!0,value:0},_didGenerateLocalCandidates:{writable:!0,value:!1},_dtlsTransport:{writable:!0,value:null},_enableDscp:{value:Q.enableDscp},_encodingParameters:{value:W},_isChromeScreenShareTrack:{value:Q.isChromeScreenShareTrack},_iceGatheringFailed:{value:!1,writable:!0},_iceGatheringTimeout:{value:new Q.Timeout(function(){return J._handleIceGatheringTimeout()},s,!1)},_iceRestartBackoff:{value:new Q.Backoff(d)},_instanceId:{value:++Te},_isIceConnectionInactive:{writable:!0,value:!1},_isIceLite:{writable:!0,value:!1},_isIceRestartBackoffInProgress:{writable:!0,value:!1},_isRestartingIce:{writable:!0,value:!1},_lastIceConnectionState:{writable:!0,value:null},_lastStableDescriptionRevision:{writable:!0,value:0},_localCandidates:{writable:!0,value:[]},_localCodecs:{value:new Set},_localCandidatesRevision:{writable:!0,value:1},_localDescriptionWithoutSimulcast:{writable:!0,value:null},_localDescription:{writable:!0,value:null},_localUfrag:{writable:!0,value:null},_log:{value:xe},_eventObserver:{value:Q.eventObserver},_remoteCodecMaps:{value:new Map},_rtpSenders:{value:new Map},_rtpNewSenders:{value:new Set},_iceConnectionMonitor:{value:new Q.IceConnectionMonitor(Pe)},_mediaTrackReceivers:{value:new Set},_needsAnswer:{writable:!0,value:!1},_negotiationRole:{writable:!0,value:null},_offerOptions:{writable:!0,value:Q.offerOptions},_onEncodingParametersChanged:{value:F(function(){J._needsAnswer||ve(J)})},_peerConnection:{value:Pe},_preferredAudioCodecs:{value:G.audio},_preferredVideoCodecs:{value:G.video},_shouldApplyDtx:{value:G.audio.every(function(we){var Me=we.codec;return Me!=="opus"})||G.audio.some(function(we){var Me=we.codec,Ve=we.dtx;return Me==="opus"&&Ve})},_queuedDescription:{writable:!0,value:null},_iceReconnectTimeout:{value:new Q.Timeout(function(){xe.debug("ICE reconnect timed out"),J.close()},Q.sessionTimeout,!1)},_recycledTransceivers:{value:{audio:[],video:[]}},_replaceTrackPromises:{value:new Map},_remoteCandidates:{writable:!0,value:new U},_setSimulcast:{value:Q.setSimulcast},_revertSimulcast:{value:Q.revertSimulcast},_setCodecPreferences:{value:Q.setCodecPreferences},_RTCIceCandidate:{value:Q.RTCIceCandidate},_RTCPeerConnection:{value:Q.RTCPeerConnection},_RTCSessionDescription:{value:Q.RTCSessionDescription},_shouldOffer:{writable:!0,value:!1},_shouldRestartIce:{writable:!0,value:!1},_trackIdsToAttributes:{value:new Map,writable:!0},_trackMatcher:{writable:!0,value:null},_mediaTrackSenderToPublisherHints:{value:new Map},id:{enumerable:!0,value:B}}),W.on("changed",J._onEncodingParametersChanged),ne.pc.signalingState(J.id,Pe.signalingState),ne.pc.iceGatheringState(J.id,Pe.iceGatheringState),ne.pc.iceConnectionState(J.id,Pe.iceConnectionState),ne.pc.connectionState(J.id,J.connectionState),Pe.addEventListener("connectionstatechange",J._handleConnectionStateChange.bind(J)),Pe.addEventListener("datachannel",J._handleDataChannelEvent.bind(J)),Pe.addEventListener("icecandidate",J._handleIceCandidateEvent.bind(J)),Pe.addEventListener("iceconnectionstatechange",J._handleIceConnectionStateChange.bind(J)),Pe.addEventListener("icegatheringstatechange",J._handleIceGatheringStateChange.bind(J)),Pe.addEventListener("signalingstatechange",J._handleSignalingStateChange.bind(J)),Pe.addEventListener("track",J._handleTrackEvent.bind(J));var Re=J;return J.on("stateChanged",function we(Me){Me==="closed"&&(Re.removeListener("stateChanged",we),Re._dataChannels.forEach(function(Ve,Ke){Re.removeDataTrackSender(Ke)}))}),J}return K.prototype.toString=function(){return"[PeerConnectionV2 #".concat(this._instanceId,": ").concat(this.id,"]")},K.prototype.setEffectiveAdaptiveSimulcast=function(B){this._log.debug("Setting setEffectiveAdaptiveSimulcast: ",B),this._preferredVideoCodecs.forEach(function(W){"adaptiveSimulcast"in W&&(W.adaptiveSimulcast=B)})},Object.defineProperty(K.prototype,"_shouldApplySimulcast",{get:function(){if(!be&&!pe)return!1;var B=this._preferredVideoCodecs.some(function(W){return W.codec.toLowerCase()==="vp8"&&W.simulcast&&W.adaptiveSimulcast!==!1});return B},enumerable:!1,configurable:!0}),Object.defineProperty(K.prototype,"connectionState",{get:function(){return this.iceConnectionState==="failed"?"failed":this._peerConnection.connectionState||this.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(K.prototype,"iceConnectionState",{get:function(){return this._isIceConnectionInactive&&this._peerConnection.iceConnectionState==="disconnected"||this._iceGatheringFailed?"failed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(K.prototype,"isApplicationSectionNegotiated",{get:function(){return this._peerConnection.signalingState!=="closed"?this._peerConnection.localDescription?b(this._peerConnection.localDescription.sdp,"application").length>0:!1:!0},enumerable:!1,configurable:!0}),Object.defineProperty(K.prototype,"_isAdaptiveSimulcastEnabled",{get:function(){var B=this._preferredVideoCodecs.find(function(W){return"adaptiveSimulcast"in W});return B&&B.adaptiveSimulcast===!0},enumerable:!1,configurable:!0}),K.prototype._maybeUpdateEncodings=function(B,W,G){if(G===void 0&&(G=!1),B.kind!=="video"||B.readyState==="ended")return!1;var Q=B.getSettings(),J=Q.height,oe=Q.width;if(typeof J!="number"||typeof oe!="number")return!1;var Se=a.guessBrowser();return Se==="safari"||Se==="chrome"&&this._isAdaptiveSimulcastEnabled?(this._updateEncodings(B,W,G),!0):!1},K.prototype._updateEncodings=function(B,W,G){if(this._isChromeScreenShareTrack(B)){var Q=[{scaleResolutionDownBy:1},{scaleResolutionDownBy:1}];W.forEach(function(we,Me){var Ve=Q[Me];Ve?(we.scaleResolutionDownBy=Ve.scaleResolutionDownBy,G&&delete we.active):(we.active=!1,delete we.scaleResolutionDownBy)})}else{var J=B.getSettings(),oe=J.width,Se=J.height,Ce=[{pixels:960*540,maxActiveLayers:3},{pixels:480*270,maxActiveLayers:2},{pixels:0,maxActiveLayers:1}],xe=oe*Se,Pe=Ce.find(function(we){return xe>=we.pixels}),Re=Math.min(W.length,Pe.maxActiveLayers);W.forEach(function(we,Me){var Ve=Me<Re;Ve?(we.scaleResolutionDownBy=1<<Re-Me-1,G&&(we.active=!0)):(we.active=!1,delete we.scaleResolutionDownBy)})}this._log.debug("_updateEncodings:",W.map(function(we,Me){var Ve=we.active,Ke=we.scaleResolutionDownBy;return"[".concat(Me,": ").concat(Ve,", ").concat(Ke||0,"]")}).join(", "))},K.prototype._addIceCandidate=function(B){var W=this;return Promise.resolve().then(function(){return ne.pc.iceCandidate(W.id,B,!0),B=new W._RTCIceCandidate(B),W._peerConnection.addIceCandidate(B)}).catch(function(G){W._log.warn("Failed to add RTCIceCandidate ".concat(B?'"'.concat(B.candidate,'"'):"null",": ")+G.message)})},K.prototype._addIceCandidates=function(B){return Promise.all(B.map(this._addIceCandidate,this)).then(function(){})},K.prototype._applyCodecPreferencesToTransceiver=function(B){if(!(!B||!B.receiver||!B.receiver.track)){var W=B.receiver.track.kind,G=W==="audio"?this._preferredAudioCodecs:this._preferredVideoCodecs;if(!(!G||G.length===0))try{var Q=RTCRtpReceiver.getCapabilities(W).codecs,J=this._sortCodecsByPreference(Q,G);B.setCodecPreferences(J)}catch(oe){this._log.warn("Failed to apply codec preferences:",oe)}}},K.prototype._sortCodecsByPreference=function(B,W){var G=[],Q=[],J=W.map(function(oe){return(typeof oe=="string"?oe:oe.codec).toLowerCase()});return B.forEach(function(oe){var Se=oe.mimeType.split("/")[1].toLowerCase(),Ce=J.indexOf(Se);Ce>=0?(G[Ce]||(G[Ce]=[]),G[Ce].push(oe)):Q.push(oe)}),G.flat().concat(Q)},K.prototype._addOrUpdateTransceiver=function(B){var W=this,G=N(this,B.kind);if(G&&G.sender){var Q=G.sender.track?G.sender.track.id:null;return Q&&this._log.warn("Reusing transceiver: ".concat(G.mid,"] ").concat(Q," => ").concat(B.id)),this._replaceTrackPromises.set(G,G.sender.replaceTrack(B).then(function(){G.direction="sendrecv"},function(){}).finally(function(){W._replaceTrackPromises.delete(G)})),G}var J=this._peerConnection.addTransceiver(B,{});return this._applyCodecPreferencesToTransceiver(J),J},K.prototype._checkIceBox=function(B){var W=ke(B);if(!W)return Promise.resolve();var G=this._remoteCandidates.setUfrag(W);return this._addIceCandidates(G)},K.prototype._answer=function(B){var W=this;return Promise.resolve().then(function(){return W._negotiationRole||(W._negotiationRole="answerer"),W._setRemoteDescription(B)}).catch(function(){throw new I}).then(function(){return W._peerConnection.createAnswer()}).then(function(G){ce?G=new W._RTCSessionDescription({sdp:k(G.sdp),type:G.type}):G=Z(G);var Q=h(G.sdp,["mslabel","label"]);if(W._shouldApplySimulcast){var J=Q;Q=W._setSimulcast(J,W._trackIdsToAttributes),Q=W._revertSimulcast(Q,J,B.sdp)}return Q=Q.replace(/42e015/g,"42e01f"),W._setLocalDescription({type:G.type,sdp:Q})}).then(function(){return W._checkIceBox(B)}).then(function(){return W._queuedDescription&&W._updateDescription(W._queuedDescription)}).then(function(){return W._queuedDescription=null,W._maybeReoffer(W._peerConnection.localDescription)}).catch(function(G){var Q=G instanceof I?G:new C;throw W._publishMediaWarning({message:"Failed to _answer",code:Q.code,error:G}),Q})},K.prototype._close=function(){return this._iceConnectionMonitor.stop(),this._peerConnection.signalingState!=="closed"?(this._peerConnection.close(),this._dtlsTransport&&!be&&ne.pc.dtlsTransportState(this.id,this._dtlsTransport.state),ne.pc.signalingState(this.id,this._peerConnection.signalingState),ne.pc.iceConnectionState(this.id,this._peerConnection.iceConnectionState),ne.pc.connectionState(this.id,this._peerConnection.connectionState),this.preempt("closed"),this._encodingParameters.removeListener("changed",this._onEncodingParametersChanged),!0):!1},K.prototype._handleConnectionStateChange=function(){ne.pc.connectionState(this.id,this.connectionState),this.emit("connectionStateChanged")},K.prototype._handleDataChannelEvent=function(B){var W=this,G=B.channel,Q=new D(G);this._dataTrackReceivers.add(Q),G.addEventListener("close",function(){W._dataTrackReceivers.delete(Q)}),this.emit("trackAdded",Q)},K.prototype._handleGlare=function(B){var W=this;return this._log.debug("Glare detected; rolling back"),this._isRestartingIce&&(this._log.debug("An ICE restart was in progress; we'll need to restart ICE again after rolling back"),this._isRestartingIce=!1,this._shouldRestartIce=!0),Promise.resolve().then(function(){return W._trackIdsToAttributes=new Map(W._appliedTrackIdsToAttributes),W._setLocalDescription({type:"rollback"})}).then(function(){return W._needsAnswer=!1,W._answer(B)}).then(function(G){return G?Promise.resolve():W._offer()})},K.prototype._publishMediaWarning=function(B){var W=B.message,G=B.code,Q=B.error,J=B.sdp;this._eventObserver.emit("event",{level:"warning",name:"error",group:"media",payload:{message:W,code:G,context:JSON.stringify({error:Q.message,sdp:J})}})},K.prototype._handleIceCandidateEvent=function(B){B.candidate&&(this._log.debug("Clearing ICE gathering timeout"),this._didGenerateLocalCandidates=!0,this._iceGatheringTimeout.clear(),this._localCandidates.push(B.candidate),ne.pc.iceCandidate(this.id,B.candidate));var W={ice:{candidates:this._isIceLite?[]:this._localCandidates.slice(),ufrag:this._localUfrag},id:this.id};B.candidate||(W.ice.complete=!0),this._isIceLite&&B.candidate||(W.ice.revision=this._localCandidatesRevision++,this.emit("candidates",W))},K.prototype._handleIceConnectionStateChange=function(){var B=this,W=this._peerConnection.iceConnectionState,G=["connected","completed"].includes(W),Q=this._log;Q.debug('ICE connection state is "'.concat(W,'"')),ne.pc.iceConnectionState(this.id,W),G&&(this._iceReconnectTimeout.clear(),this._iceRestartBackoff.reset()),this._lastIceConnectionState!=="failed"&&W==="failed"&&!this._shouldRestartIce&&!this._isRestartingIce?(Q.warn("ICE failed"),this._initiateIceRestartBackoff()):["disconnected","failed"].includes(this._lastIceConnectionState)&&G&&Q.debug("ICE reconnected"),W==="connected"?(this._isIceConnectionInactive=!1,this._iceConnectionMonitor.start(function(){B._iceConnectionMonitor.stop(),!B._shouldRestartIce&&!B._isRestartingIce&&(Q.warn("ICE Connection Monitor detected inactivity"),B._isIceConnectionInactive=!0,B._initiateIceRestartBackoff(),B.emit("iceConnectionStateChanged"),B.emit("connectionStateChanged"))})):["disconnected","completed"].includes(W)||(this._iceConnectionMonitor.stop(),this._isIceConnectionInactive=!1),this._lastIceConnectionState=W,this.emit("iceConnectionStateChanged")},K.prototype._handleIceGatheringTimeout=function(){this._log.warn("ICE failed to gather any local candidates"),this._iceGatheringFailed=!0,this._initiateIceRestartBackoff(),this.emit("iceConnectionStateChanged"),this.emit("connectionStateChanged")},K.prototype._handleIceGatheringStateChange=function(){var B=this._peerConnection.iceGatheringState;ne.pc.iceGatheringState(this.id,B);var W=this._log;W.debug('ICE gathering state is "'.concat(B,'"'));var G=this._iceGatheringTimeout,Q=G.delay,J=G.isSet;B==="gathering"&&!this._didGenerateLocalCandidates&&!J&&(W.debug("Starting ICE gathering timeout: ".concat(Q)),this._iceGatheringFailed=!1,this._iceGatheringTimeout.start())},K.prototype._handleSignalingStateChange=function(){ne.pc.signalingState(this.id,this._peerConnection.signalingState),this._peerConnection.signalingState==="stable"&&(this._appliedTrackIdsToAttributes=new Map(this._trackIdsToAttributes))},K.prototype._handleDtlsTransportStateChange=function(){var B=this._dtlsTransport;B&&(this._log.debug('DTLS transport state is "'.concat(B.state,'"')),ne.pc.dtlsTransportState(this.id,B.state))},K.prototype._handleSelectedCandidatePairChange=function(){var B,W=(B=this._dtlsTransport)===null||B===void 0?void 0:B.iceTransport;if(W&&typeof W.getSelectedCandidatePair=="function"){var G=W.getSelectedCandidatePair();G&&ne.pc.selectedCandidatePair(this.id,G)}},K.prototype._handleTrackEvent=function(B){var W=this,G=this._peerConnection.remoteDescription?this._peerConnection.remoteDescription.sdp:null;this._trackMatcher=this._trackMatcher||new Y,this._trackMatcher.update(G);var Q=B.track,J=this._trackMatcher.match(B)||Q.id,oe=new H(J,Q);this._mediaTrackReceivers.forEach(function(Se){Se.track.id===oe.track.id&&W._mediaTrackReceivers.delete(Se)}),this._mediaTrackReceivers.add(oe),Q.addEventListener?Q.addEventListener("ended",function(){return W._mediaTrackReceivers.delete(oe)}):Q.onended=function(){return W._mediaTrackReceivers.delete(oe)},this.emit("trackAdded",oe)},K.prototype._initiateIceRestart=function(){if(this._peerConnection.signalingState!=="closed"){var B=this._log;B.warn("Attempting to restart ICE"),this._didGenerateLocalCandidates=!1,this._isIceRestartBackoffInProgress=!1,this._shouldRestartIce=!0;var W=this._iceReconnectTimeout,G=W.delay,Q=W.isSet;Q||(B.debug("Starting ICE reconnect timeout: ".concat(G)),this._iceReconnectTimeout.start()),this.offer().catch(function(J){B.error("offer failed in _initiateIceRestart with: ".concat(J.message))})}},K.prototype._initiateIceRestartBackoff=function(){var B=this;this._peerConnection.signalingState==="closed"||this._isIceRestartBackoffInProgress||(this._log.warn("An ICE restart has been scheduled"),this._isIceRestartBackoffInProgress=!0,this._iceRestartBackoff.backoff(function(){return B._initiateIceRestart()}))},K.prototype._maybeReoffer=function(B){var W=this._shouldOffer;if(B&&B.sdp){var G=this._peerConnection.getSenders().filter(function(Ce){return Ce.track});W=["audio","video"].reduce(function(Ce,xe){var Pe=b(B.sdp,xe,"(sendrecv|sendonly)"),Re=G.filter(me.bind(null,xe));return Ce||Pe.length<Re.length},W);var Q=this._dataChannels.size>0,J=b(B.sdp,"application").length>0,oe=Q&&!J;W=W||oe}var Se=W?this._offer():Promise.resolve();return Se.then(function(){return W})},K.prototype._offer=function(){var B=this,W=Object.assign({},this._offerOptions);return this._needsAnswer=!0,this._shouldRestartIce&&(this._shouldRestartIce=!1,this._isRestartingIce=!0,W.iceRestart=!0),Promise.all(this._replaceTrackPromises.values()).then(function(){var G=B._peerConnection.getTransceivers();return G.forEach(function(Q){return B._applyCodecPreferencesToTransceiver(Q)}),B._peerConnection.createOffer(W)}).catch(function(G){var Q=new C;throw B._publishMediaWarning({message:"Failed to create offer",code:Q.code,error:G}),Q}).then(function(G){if(ce){var Q=k(G.sdp);Q=f(Q),G=new B._RTCSessionDescription({sdp:Q,type:G.type})}else G=Z(G);var J=h(G.sdp,["mslabel","label"]);return B._shouldOffer=!1,B._negotiationRole||(B._negotiationRole="offerer"),B._shouldApplySimulcast&&(B._localDescriptionWithoutSimulcast={type:"offer",sdp:J},J=B._setSimulcast(J,B._trackIdsToAttributes)),B._setLocalDescription({type:"offer",sdp:J})})},K.prototype._getMediaTrackSenderId=function(B){var W=Array.from(this._rtpSenders.keys()).find(function(G){var Q=G.track.id;return Q===B});return W?W.id:B},K.prototype._addOrRewriteLocalTrackIds=function(B){var W=this,G=this._peerConnection.getTransceivers(),Q=G.filter(function(Re){var we=Re.sender,Me=Re.stopped;return!Me&&we&&we.track}),J=Q.filter(function(Re){var we=Re.mid;return we}),oe=new Map(J.map(function(Re){var we=Re.mid,Me=Re.sender;return[we,W._getMediaTrackSenderId(Me.track.id)]})),Se=T(B.sdp,oe),Ce=Q.filter(function(Re){var we=Re.mid;return!we}),xe=new Map(["audio","video"].map(function(Re){return[Re,Ce.filter(function(we){var Me=we.sender;return Me.track.kind===Re}).map(function(we){var Me=we.sender;return W._getMediaTrackSenderId(Me.track.id)})]})),Pe=p(Se,oe,xe);return new this._RTCSessionDescription({sdp:Pe,type:B.type})},K.prototype._rollbackAndApplyOffer=function(B){var W=this;return this._setLocalDescription({type:"rollback"}).then(function(){return W._setLocalDescription(B)})},K.prototype._setLocalDescription=function(B){var W=this;return B.type!=="rollback"&&this._shouldApplyDtx&&(B=new this._RTCSessionDescription({sdp:y(B.sdp),type:B.type})),this._peerConnection.setLocalDescription(B).catch(function(G){W._log.warn('Calling setLocalDescription with an RTCSessionDescription of type "'.concat(B.type,'" failed with the error "').concat(G.message,'".'),G);var Q=new C,J={message:'Calling setLocalDescription with an RTCSessionDescription of type "'.concat(B.type,'" failed'),code:Q.code,error:G};throw B.sdp&&(W._log.warn("The SDP was ".concat(B.sdp)),J.sdp=B.sdp),W._publishMediaWarning(J),Q}).then(function(){B.type!=="rollback"&&(W._localDescription=W._addOrRewriteLocalTrackIds(B),W._shouldApplyDtx&&(W._localDescription=new W._RTCSessionDescription({sdp:y(W._localDescription.sdp,[]),type:W._localDescription.type})),W._localCandidates=[],B.type==="offer"?W._descriptionRevision++:B.type==="answer"&&(W._lastStableDescriptionRevision=W._descriptionRevision,fe(W)),W._localUfrag=ke(B),W.emit("description",W.getState()))})},K.prototype._setRemoteDescription=function(B){var W=this;return B.sdp&&(B.sdp=this._setCodecPreferences(B.sdp,this._preferredAudioCodecs,this._preferredVideoCodecs),this._shouldApplyDtx?B.sdp=y(B.sdp):B.sdp=y(B.sdp,[]),ce&&(B.sdp=L(B.sdp)),this._peerConnection.remoteDescription||(this._isIceLite=/a=ice-lite/.test(B.sdp))),B=new this._RTCSessionDescription(B),Promise.resolve().then(function(){if(B.type==="answer"&&W._localDescriptionWithoutSimulcast){var G=W._preferredVideoCodecs.find(function(oe){return"adaptiveSimulcast"in oe}),Q=!!G&&G.adaptiveSimulcast===!1,J=W._revertSimulcast(W._localDescription.sdp,W._localDescriptionWithoutSimulcast.sdp,B.sdp,Q);if(W._localDescriptionWithoutSimulcast=null,J!==W._localDescription.sdp)return W._rollbackAndApplyOffer({type:W._localDescription.type,sdp:J})}}).then(function(){return W._peerConnection.setRemoteDescription(B)}).then(function(){B.type==="answer"&&(W._isRestartingIce&&(W._log.debug("An ICE restart was in-progress and is now completed"),W._isRestartingIce=!1),fe(W))},function(G){throw W._log.warn('Calling setRemoteDescription with an RTCSessionDescription of type "'.concat(B.type,'" failed with the error "').concat(G.message,'".'),G),B.sdp&&W._log.warn("The SDP was ".concat(B.sdp)),G})},K.prototype._updateDescription=function(B){var W=this;switch(B.type){case"answer":case"pranswer":if(B.revision!==this._descriptionRevision||this._peerConnection.signalingState!=="have-local-offer")return Promise.resolve();this._descriptionRevision=B.revision;break;case"close":return this._close();case"create-offer":return B.revision<=this._lastStableDescriptionRevision?Promise.resolve():this._needsAnswer?(this._queuedDescription=B,Promise.resolve()):(this._descriptionRevision=B.revision,this._offer());case"offer":return B.revision<=this._lastStableDescriptionRevision||this._peerConnection.signalingState==="closed"?Promise.resolve():this._peerConnection.signalingState==="have-local-offer"?this._needsAnswer&&this._lastStableDescriptionRevision===0?(this._queuedDescription=B,Promise.resolve()):(this._descriptionRevision=B.revision,this._handleGlare(B)):(this._descriptionRevision=B.revision,this._answer(B).then(function(){}))}var G=B.revision;return Promise.resolve().then(function(){return W._setRemoteDescription(B)}).catch(function(Q){var J=new I;throw W._publishMediaWarning({message:'Calling setRemoteDescription with an RTCSessionDescription of type "'.concat(B.type,'" failed'),code:J.code,error:Q,sdp:B.sdp}),J}).then(function(){return W._lastStableDescriptionRevision=G,W._needsAnswer=!1,W._checkIceBox(B)}).then(function(){return W._queuedDescription&&W._updateDescription(W._queuedDescription)}).then(function(){return W._queuedDescription=null,W._maybeReoffer(W._peerConnection.localDescription).then(function(){})})},K.prototype._updateIce=function(B){var W=this._remoteCandidates.update(B);return this._addIceCandidates(W)},K.prototype.addDataTrackSender=function(B){if(!this._dataChannels.has(B))try{var W={ordered:B.ordered};B.maxPacketLifeTime!==null&&(W.maxPacketLifeTime=B.maxPacketLifeTime),B.maxRetransmits!==null&&(W.maxRetransmits=B.maxRetransmits);var G=this._peerConnection.createDataChannel(B.id,W);B.addDataChannel(G),this._dataChannels.set(B,G)}catch(Q){this._log.warn('Error creating an RTCDataChannel for DataTrack "'.concat(B.id,'": ').concat(Q.message))}},K.prototype._handleQueuedPublisherHints=function(){var B=this;this._peerConnection.signalingState==="stable"&&this._mediaTrackSenderToPublisherHints.forEach(function(W,G){var Q=W.deferred,J=W.encodings;B._mediaTrackSenderToPublisherHints.delete(G),B._setPublisherHint(G,J).then(function(oe){return Q.resolve(oe)}).catch(function(oe){return Q.reject(oe)})})},K.prototype._setPublisherHint=function(B,W){var G=this;if(ce)return Promise.resolve("COULD_NOT_APPLY_HINT");if(this._mediaTrackSenderToPublisherHints.has(B)){var Q=this._mediaTrackSenderToPublisherHints.get(B);Q.deferred.resolve("REQUEST_SKIPPED"),this._mediaTrackSenderToPublisherHints.delete(B)}var J=this._rtpSenders.get(B);if(!J)return this._log.warn("Could not apply publisher hint because RTCRtpSender was not found"),Promise.resolve("UNKNOWN_TRACK");if(this._peerConnection.signalingState==="closed")return this._log.warn('Could not apply publisher hint because signalingState was "closed"'),Promise.resolve("COULD_NOT_APPLY_HINT");if(this._peerConnection.signalingState!=="stable"){this._log.debug("Queuing up publisher hint because signalingState:",this._peerConnection.signalingState);var oe=V();return this._mediaTrackSenderToPublisherHints.set(B,{deferred:oe,encodings:W}),oe.promise}var Se=J.getParameters();return W!==null&&W.forEach(function(Ce){var xe=Ce.enabled,Pe=Ce.layer_index;Se.encodings.length>Pe?(G._log.debug("layer:".concat(Pe,", active:").concat(Se.encodings[Pe].active," => ").concat(xe)),Se.encodings[Pe].active=xe):G._log.warn("invalid layer:".concat(Pe,", active:").concat(xe))}),this._maybeUpdateEncodings(J.track,Se.encodings,W===null),J.setParameters(Se).then(function(){return"OK"}).catch(function(Ce){return G._log.error("Failed to apply publisher hints:",Ce),"COULD_NOT_APPLY_HINT"})},K.prototype.addMediaTrackSender=function(B){var W=this;if(!(this._peerConnection.signalingState==="closed"||this._rtpSenders.has(B))){var G=this._addOrUpdateTransceiver(B.track),Q=G.sender;B.addSender(Q,function(J){return W._setPublisherHint(B,J)}),this._rtpNewSenders.add(Q),this._rtpSenders.set(B,Q)}},K.prototype.close=function(){this._close()&&(this._descriptionRevision++,this._localDescription={type:"close"},this.emit("description",this.getState()))},K.prototype.getTrackReceivers=function(){return Array.from(this._dataTrackReceivers).concat(Array.from(this._mediaTrackReceivers))},K.prototype.getState=function(){if(!this._localDescription)return null;var B=this._localDescription.type==="answer"?this._lastStableDescriptionRevision:this._descriptionRevision,W={type:this._localDescription.type,revision:B};return this._localDescription.sdp&&(W.sdp=this._localDescription.sdp),{description:W,id:this.id}},K.prototype.offer=function(){var B=this;return this._needsAnswer||this._isRestartingIce?(this._shouldOffer=!0,Promise.resolve()):this.bracket("offering",function(W){B.transition("updating",W);var G=B._needsAnswer||B._isRestartingIce?Promise.resolve():B._offer();return G.then(function(){B.tryTransition("open",W)},function(Q){throw B.tryTransition("open",W),Q})})},K.prototype.removeDataTrackSender=function(B){var W=this._dataChannels.get(B);W&&(B.removeDataChannel(W),this._dataChannels.delete(B),W.close())},K.prototype.removeMediaTrackSender=function(B){var W=this._rtpSenders.get(B);if(W){if(this._peerConnection.signalingState!=="closed"&&this._peerConnection.removeTrack(W),B.removeSender(W),this._mediaTrackSenderToPublisherHints.has(B)){var G=this._mediaTrackSenderToPublisherHints.get(B);G.deferred.resolve("UNKNOWN_TRACK"),this._mediaTrackSenderToPublisherHints.delete(B)}this._rtpNewSenders.delete(W),this._rtpSenders.delete(B)}},K.prototype.setConfiguration=function(B){typeof this._peerConnection.setConfiguration=="function"&&this._peerConnection.setConfiguration(se(B))},K.prototype.setIceReconnectTimeout=function(B){return this._iceReconnectTimeout.setDelay(B),this._log.debug("Updated ICE reconnection timeout period:",this._iceReconnectTimeout.delay),this},K.prototype.update=function(B){var W=this;return this.bracket("updating",function(G){if(W.state==="closed")return Promise.resolve();W.transition("updating",G);var Q=[];return B.ice&&Q.push(W._updateIce(B.ice)),B.description&&Q.push(W._updateDescription(B.description)),Promise.all(Q).then(function(){W.tryTransition("open",G)},function(J){throw W.tryTransition("open",G),J})})},K.prototype.getStats=function(){var B=this;return n(this._peerConnection,{log:this._log}).then(function(W){return z(B,W)})},K})($);function he(te,K){var B=te._getMediaTrackSenderId(K.trackId);return Object.assign(K,{trackId:B})}function le(te,K){var B=_([],m(te._mediaTrackReceivers),!1).find(function(G){return G.track.id===K.trackId}),W=B?B.id:null;return Object.assign(K,{trackId:W})}function z(te,K){return Object.assign(K,{remoteAudioTrackStats:K.remoteAudioTrackStats.map(function(B){return le(te,B)}),remoteVideoTrackStats:K.remoteVideoTrackStats.map(function(B){return le(te,B)}),localAudioTrackStats:K.localAudioTrackStats.map(function(B){return he(te,B)}),localVideoTrackStats:K.localVideoTrackStats.map(function(B){return he(te,B)})})}function ke(te){if(te.sdp){var K=te.sdp.match(/^a=ice-ufrag:([a-zA-Z0-9+/]+)/m);if(K)return K[1]}return null}function se(te){return te===void 0&&(te={}),Object.assign({bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},te)}function me(te,K){var B=K.track;return B&&B.kind===te&&B.readyState!=="ended"}function L(te){return te.replace(/a=msid:[^ ]+ /g,"a=msid:- ")}function P(te,K){return!te.stopped&&!K._replaceTrackPromises.has(te)&&["inactive","recvonly"].includes(te.direction)}function N(te,K){var B={audio:te._preferredAudioCodecs.map(function(J){var oe=J.codec;return oe.toLowerCase()}),video:te._preferredVideoCodecs.map(function(J){var oe=J.codec;return oe.toLowerCase()})}[K],W=te._recycledTransceivers[K],G=B.find(function(J){return te._localCodecs.has(J)});if(!G)return W.shift();var Q=W.find(function(J){var oe=te._remoteCodecMaps.get(J.mid);return oe&&oe.has(G)});return Q&&W.splice(W.indexOf(Q),1),Q}function X(te){var K=te._peerConnection.localDescription;!K||!K.sdp||b(K.sdp).forEach(function(B){var W=M(B);W.forEach(function(G,Q){return te._localCodecs.add(Q)})})}function ee(te){var K=te._peerConnection.remoteDescription;!K||!K.sdp||b(K.sdp).forEach(function(B){var W=B.match(/^a=mid:(.+)$/m);if(!(!W||!W[1])){var G=W[1],Q=M(B);te._remoteCodecMaps.set(G,Q)}})}function ae(te){te._recycledTransceivers.audio=[],te._recycledTransceivers.video=[],te._peerConnection.getTransceivers().forEach(function(K){if(P(K,te)){var B=K.receiver.track;te._recycledTransceivers[B.kind].push(K)}})}function ue(te){var K,B=te._peerConnection.getSenders(),W=(K=B.find(function(Q){return Q.transport}))===null||K===void 0?void 0:K.transport;if(W&&!te._dtlsTransport&&(te._dtlsTransport=W,W.addEventListener("statechange",te._handleDtlsTransportStateChange.bind(te)),W.state&&te._handleDtlsTransportStateChange(),W.iceTransport&&typeof W.iceTransport.getSelectedCandidatePair=="function")){W.iceTransport.addEventListener("selectedcandidatepairchange",te._handleSelectedCandidatePairChange.bind(te));var G=W.iceTransport.getSelectedCandidatePair();G&&te._handleSelectedCandidatePairChange()}}function fe(te){ae(te),X(te),ee(te),ue(te),ve(te).then(function(){te._handleQueuedPublisherHints()})}function ve(te){var K=te._encodingParameters,B=K.maxAudioBitrate,W=K.maxVideoBitrate,G=new Map([["audio",B],["video",W]]),Q=[];return te._peerConnection.getSenders().filter(function(J){return J.track}).forEach(function(J){var oe=G.get(J.track.kind),Se=J.getParameters();oe===null||oe===0?Ie(Se):te._isChromeScreenShareTrack(J.track)?te._log.warn("Not setting maxBitrate for ".concat(J.track.kind," Track ").concat(J.track.id," because it appears to be screen share track: ").concat(J.track.label)):qe(Se,oe),!ce&&Se.encodings.length>0&&(J.track.kind==="audio"?Se.encodings[0].priority="high":te._isChromeScreenShareTrack(J.track)&&(Se.encodings[0].priority="medium"),te._enableDscp&&(Se.encodings[0].networkPriority="high"));var Ce=te._rtpNewSenders.has(J);te._maybeUpdateEncodings(J.track,Se.encodings,Ce),te._rtpNewSenders.delete(J);var xe=J.setParameters(Se).catch(function(Pe){te._log.warn("Error while setting encodings parameters for ".concat(J.track.kind," Track ").concat(J.track.id,": ").concat(Pe.message||Pe.name))});Q.push(xe)}),Promise.all(Q)}function Ie(te){Array.isArray(te.encodings)&&te.encodings.forEach(function(K){return delete K.maxBitrate})}function qe(te,K){ce?te.encodings=[{maxBitrate:K}]:te.encodings.forEach(function(B){B.maxBitrate=K})}return lt=_e,lt}var dt,Lc;function id(){if(Lc)return dt;Lc=1;var g=dt&&dt.__extends||(function(){var f=function(h,w){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var q in E)Object.prototype.hasOwnProperty.call(E,q)&&(S[q]=E[q])},f(h,w)};return function(h,w){if(typeof w!="function"&&w!==null)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");f(h,w);function S(){this.constructor=h}h.prototype=w===null?Object.create(w):(S.prototype=w.prototype,new S)}})(),m=dt&&dt.__read||function(f,h){var w=typeof Symbol=="function"&&f[Symbol.iterator];if(!w)return f;var S=w.call(f),E,q=[],O;try{for(;(h===void 0||h-- >0)&&!(E=S.next()).done;)q.push(E.value)}catch(C){O={error:C}}finally{try{E&&!E.done&&(w=S.return)&&w.call(S)}finally{if(O)throw O.error}}return q},_=dt&&dt.__spreadArray||function(f,h,w){if(w||arguments.length===2)for(var S=0,E=h.length,q;S<E;S++)(q||!(S in h))&&(q||(q=Array.prototype.slice.call(h,0,S)),q[S]=h[S]);return f.concat(q||Array.prototype.slice.call(h))},u=je().guessBrowser,i=nd(),e=Js(),t=zs(),r=Ee(),n=ze().MediaConnectionError,a=u()==="firefox",o=(function(f){g(h,f);function h(w,S,E){var q=f.call(this)||this;E=Object.assign({audioContextFactory:a?Cn():null,PeerConnectionV2:i},E);var O=E.audioContextFactory?E.audioContextFactory.getOrCreate(q):null,C=O?{offerToReceiveVideo:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:!0};return Object.defineProperties(q,{_audioContextFactory:{value:E.audioContextFactory},_closedPeerConnectionIds:{value:new Set},_configuration:{writable:!0,value:null},_configurationDeferred:{writable:!0,value:r.defer()},_connectionState:{value:"new",writable:!0},_dummyAudioTrackSender:{value:O?new e(s(O)):null},_encodingParameters:{value:w},_iceConnectionState:{writable:!0,value:"new"},_dataTrackSenders:{writable:!0,value:new Set},_lastConnectionState:{value:"new",writable:!0},_lastIceConnectionState:{writable:!0,value:"new"},_mediaTrackSenders:{writable:!0,value:new Set},_offerOptions:{value:C},_peerConnections:{value:new Map},_preferredCodecs:{value:S},_sessionTimeout:{value:null,writable:!0},_PeerConnectionV2:{value:E.PeerConnectionV2}}),q}return h.prototype.setEffectiveAdaptiveSimulcast=function(w){this._peerConnections.forEach(function(S){return S.setEffectiveAdaptiveSimulcast(w)}),this._preferredCodecs.video.forEach(function(S){"adaptiveSimulcast"in S&&(S.adaptiveSimulcast=w)})},Object.defineProperty(h.prototype,"connectionState",{get:function(){return this._connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"iceConnectionState",{get:function(){return this._iceConnectionState},enumerable:!1,configurable:!0}),h.prototype._closeAbsentPeerConnections=function(w){var S=new Set(w.map(function(E){return E.id}));return this._peerConnections.forEach(function(E){S.has(E.id)||E._close()}),this},h.prototype._getConfiguration=function(){return this._configurationDeferred.promise},h.prototype._getOrCreate=function(w,S){var E=this,q=this,O=this._peerConnections.get(w);if(!O){var C=this._PeerConnectionV2,I=Object.assign({dummyAudioMediaStreamTrack:this._dummyAudioTrackSender?this._dummyAudioTrackSender.track:null,offerOptions:this._offerOptions},this._sessionTimeout?{sessionTimeout:this._sessionTimeout}:{},S);try{O=new C(w,this._encodingParameters,this._preferredCodecs,I)}catch{throw new n}this._peerConnections.set(O.id,O),O.on("candidates",this.queue.bind(this,"candidates")),O.on("description",this.queue.bind(this,"description")),O.on("trackAdded",this.queue.bind(this,"trackAdded")),O.on("stateChanged",function x(A){A==="closed"&&(O.removeListener("stateChanged",x),q._dataTrackSenders.forEach(function(R){return O.removeDataTrackSender(R)}),q._mediaTrackSenders.forEach(function(R){return O.removeMediaTrackSender(R)}),q._peerConnections.delete(O.id),q._closedPeerConnectionIds.add(O.id),b(q),y(q))}),O.on("connectionStateChanged",function(){return b(E)}),O.on("iceConnectionStateChanged",function(){return y(E)}),this._dataTrackSenders.forEach(O.addDataTrackSender,O),this._mediaTrackSenders.forEach(O.addMediaTrackSender,O),y(this)}return O},h.prototype.close=function(){return this._peerConnections.forEach(function(w){w.close()}),this._dummyAudioTrackSender&&this._dummyAudioTrackSender.stop(),this._audioContextFactory&&this._audioContextFactory.release(this),y(this),this},h.prototype.createAndOffer=function(){var w=this;return this._getConfiguration().then(function(S){var E;do E=r.makeUUID();while(w._peerConnections.has(E));return w._getOrCreate(E,S)}).then(function(S){return S.offer()}).then(function(){return w})},h.prototype.getTrackReceivers=function(){return r.flatMap(this._peerConnections,function(w){return w.getTrackReceivers()})},h.prototype.getStates=function(){var w=[];return this._peerConnections.forEach(function(S){var E=S.getState();E&&w.push(E)}),w},h.prototype.setConfiguration=function(w){return this._configuration&&(this._configurationDeferred=r.defer(),this._peerConnections.forEach(function(S){S.setConfiguration(w)})),this._configuration=w,this._configurationDeferred.resolve(w),this},h.prototype.setIceReconnectTimeout=function(w){return this._sessionTimeout===null&&(this._peerConnections.forEach(function(S){S.setIceReconnectTimeout(w)}),this._sessionTimeout=w),this},h.prototype.setTrackSenders=function(w){var S=new Set(w.filter(function(O){return O.kind==="data"})),E=new Set(w.filter(function(O){return O&&(O.kind==="audio"||O.kind==="video")})),q=d(this,S,E);return this._dataTrackSenders=S,this._mediaTrackSenders=E,c(this,q),this},h.prototype.update=function(w,S){var E=this;return S===void 0&&(S=!1),S&&this._closeAbsentPeerConnections(w),this._getConfiguration().then(function(q){return Promise.all(w.map(function(O){if(E._closedPeerConnectionIds.has(O.id))return null;var C=E._getOrCreate(O.id,q);return C.update(O)}))}).then(function(){return E})},h.prototype.getStats=function(){var w=Array.from(this._peerConnections.values());return Promise.all(w.map(function(S){return S.getStats().then(function(E){return[S.id,E]})})).then(function(S){return new Map(S)})},h})(t);function s(f){var h=f.createMediaStreamDestination();return h.stream.getAudioTracks()[0]}function c(f,h){(h.data.add.size||h.data.remove.size||h.media.add.size||h.media.remove.size)&&f._peerConnections.forEach(function(w){h.data.remove.forEach(w.removeDataTrackSender,w),h.media.remove.forEach(w.removeMediaTrackSender,w),h.data.add.forEach(w.addDataTrackSender,w),h.media.add.forEach(w.addMediaTrackSender,w),(h.media.add.size||h.media.remove.size||h.data.add.size&&!w.isApplicationSectionNegotiated)&&w.offer()})}function l(f,h){var w=r.difference(h,f._dataTrackSenders),S=r.difference(f._dataTrackSenders,h);return{add:w,remove:S}}function d(f,h,w){return{data:l(f,h),media:v(f,w)}}function v(f,h){var w=r.difference(h,f._mediaTrackSenders),S=r.difference(f._mediaTrackSenders,h);return{add:w,remove:S}}var p={new:0,checking:1,connecting:2,connected:3,completed:4,disconnected:-1,failed:-2,closed:-3},T;function M(){return Object.keys(p).reduce(function(f,h){var w;return Object.assign(f,(w={},w[p[h]]=h,w))},{})}function k(f){return f.length?(T=T||M(),f.reduce(function(h,w){return T[Math.max(p[h],p[w])]})):"new"}function y(f){f._lastIceConnectionState=f.iceConnectionState,f._iceConnectionState=k(_([],m(f._peerConnections.values()),!1).map(function(h){return h.iceConnectionState})),f.iceConnectionState!==f._lastIceConnectionState&&f.emit("iceConnectionStateChanged")}function b(f){f._lastConnectionState=f.connectionState,f._connectionState=k(_([],m(f._peerConnections.values()),!1).map(function(h){return h.connectionState})),f.connectionState!==f._lastConnectionState&&f.emit("connectionStateChanged")}return dt=o,dt}var Lr,xc;function At(){if(xc)return Lr;xc=1;var g=Lr&&Lr.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=Ne(),_=0,u=(function(i){g(e,i);function e(t,r,n){var a=i.call(this)||this;return Object.defineProperties(a,{_instanceId:{value:_++},channel:{value:r},_log:{value:n.log.createLog("default",a)},_getReceiver:{value:t},_receiverPromise:{value:null,writable:!0},_transport:{value:null,writable:!0}}),a}return Object.defineProperty(e.prototype,"isSetup",{get:function(){return!!this._receiverPromise},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"[MediaSignaling #".concat(this._instanceId,":").concat(this.channel,"]")},e.prototype.setup=function(t){var r=this;this._teardown(),this._log.info("setting up msp transport for id:",t);var n=this._getReceiver(t).then(function(a){if(a.kind!=="data"&&r._log.error("Expected a DataTrackReceiver"),r._receiverPromise===n){try{r._transport=a.toDataTransport(),r.emit("ready",r._transport)}catch(o){r._log.error("Failed to toDataTransport: ".concat(o.message))}a.once("close",function(){return r._teardown()})}});this._receiverPromise=n},e.prototype._teardown=function(){this._transport&&(this._log.info("Tearing down"),this._transport=null,this._receiverPromise=null,this.emit("teardown"))},e})(m);return Lr=u,Lr}var xr,Mc;function ad(){if(Mc)return xr;Mc=1;var g=xr&&xr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=At(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this,e,"active_speaker",t)||this;return Object.defineProperties(r,{_loudestParticipantSid:{value:null,writable:!0}}),r.on("ready",function(n){n.on("message",function(a){a.type==="active_speaker"&&r._setLoudestParticipantSid(a.participant)})}),r}return Object.defineProperty(i.prototype,"loudestParticipantSid",{get:function(){return this._loudestParticipantSid},enumerable:!1,configurable:!0}),i.prototype._setLoudestParticipantSid=function(e){this.loudestParticipantSid!==e&&(this._loudestParticipantSid=e,this.emit("updated"))},i})(m);return xr=_,xr}var Mr,Ac;function od(){if(Ac)return Mr;Ac=1;var g=Mr&&Mr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=At(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this,e,"extension_transcriptions",t)||this;return r.on("ready",function(n){n.on("message",function(a){a.type==="extension_transcriptions"&&r.emit("transcription",a)})}),r}return i})(m);return Mr=_,Mr}var Pi,Ic;function cd(){if(Ic)return Pi;Ic=1;var g=(function(){function m(_,u,i,e){Object.defineProperties(this,{availableSend:{enumerable:!0,value:i},recv:{enumerable:!0,value:u},rtt:{enumerable:!0,value:e},send:{enumerable:!0,value:_}})}return m.of=function(_,u){var i=(u.timestamp-_.timestamp)/1e3,e=u.bytesSent-_.bytesSent,t=u.bytesReceived-_.bytesReceived,r=i>0?e/i*8:0,n=i>0?t/i*8:0,a=u.availableOutgoingBitrate,o=u.currentRoundTripTime;return new m(r,n,a,o)},m})();return Pi=g,Pi}var Ei,Dc;function sd(){if(Dc)return Ei;Dc=1;var g=cd(),m=(function(){function _(){Object.defineProperties(this,{lastReport:{enumerable:!0,value:new g(0,0),writable:!0},lastStats:{enumerable:!0,value:null,writable:!0}})}return _.prototype.next=function(u){var i=this.lastStats;if(this.lastStats=u,i){var e=i.id===u.id?g.of(i,u):new g(0,0);this.lastReport=e}return this.lastReport},_})();return Ei=m,Ei}var Ci,jc;function hu(){if(jc)return Ci;jc=1;function g(m){return m=m.filter(function(_){return typeof _=="number"}),m.length<1?void 0:m.reduce(function(_,u){return u+_})/m.length}return Ci=g,Ci}var Oi,Nc;function _u(){if(Nc)return Oi;Nc=1;var g=(function(){function m(_,u,i){Object.defineProperties(this,{id:{enumerable:!0,value:_},trackId:{enumerable:!0,value:u},bitrate:{enumerable:!0,value:i}})}return m})();return Oi=g,Oi}var Ri,qc;function mu(){if(qc)return Ri;qc=1;function g(m){return m.reduce(function(_,u){return typeof u=="number"?u+_:_},0)}return Ri=g,Ri}var Ar,Vc;function yu(){if(Vc)return Ar;Vc=1;var g=Ar&&Ar.__extends||(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),m=hu(),_=_u(),u=mu(),i=(function(e){g(t,e);function t(r,n,a,o,s,c,l){var d=e.call(this,r,n,a)||this,v=s>0?o/s:0;return Object.defineProperties(d,{deltaPacketsLost:{enumerable:!0,value:o},deltaPacketsReceived:{enumerable:!0,value:s},fractionLost:{enumerable:!0,value:c},jitter:{enumerable:!0,value:l},phonyFractionLost:{enumerable:!0,value:v}}),d}return t.of=function(r,n,a){if(n.id!==a.id)throw new Error("RTCStats IDs must match");var o=(a.timestamp-n.timestamp)/1e3,s=a.bytesReceived-n.bytesReceived,c=o>0?s/o*8:0,l=Math.max(a.packetsLost-n.packetsLost,0),d=a.packetsReceived-n.packetsReceived,v=a.fractionLost,p=a.jitter;return new t(n.id,r,c,l,d,v,p)},t.summarize=function(r){var n=r.map(function(c){return c.summarize()}),a=u(n.map(function(c){return c.bitrate})),o=m(n.map(function(c){return c.fractionLost})),s=m(n.map(function(c){return c.jitter}));return{bitrate:a,fractionLost:o,jitter:s}},t.prototype.summarize=function(){return{bitrate:this.bitrate,fractionLost:typeof this.fractionLost=="number"?this.fractionLost:this.phonyFractionLost,jitter:this.jitter}},t})(_);return Ar=i,Ar}var Ir,Fc;function gu(){if(Fc)return Ir;Fc=1;var g=Ir&&Ir.__extends||(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),m=hu(),_=_u(),u=mu(),i=(function(e){g(t,e);function t(r,n,a,o){var s=e.call(this,r,n,a)||this;return Object.defineProperties(s,{rtt:{enumerable:!0,value:o}}),s}return t.of=function(r,n,a,o){if(n.id!==a.id)throw new Error("RTCStats IDs must match");var s=(a.timestamp-n.timestamp)/1e3,c=a.bytesSent-n.bytesSent,l=s>0?c/s*8:0,d=o&&typeof o.roundTripTime=="number"?o.roundTripTime/1e3:void 0;return new t(n.id,r,l,d)},t.summarize=function(r){var n=u(r.map(function(o){return o.bitrate})),a=m(r.map(function(o){return o.rtt}));return{bitrate:n,rtt:a}},t})(_);return Ir=i,Ir}var Li,Bc;function ud(){if(Bc)return Li;Bc=1;var g=yu(),m=gu(),_=(function(){function u(i,e,t){Object.defineProperties(this,{ice:{enumerable:!0,value:i},audio:{enumerable:!0,value:e},video:{enumerable:!0,value:t}})}return u.prototype.summarize=function(){var i=this.audio.send.concat(this.video.send),e=m.summarize(i),t=this.audio.recv.concat(this.video.recv),r=g.summarize(t);return{ice:this.ice,send:e,recv:r,audio:{send:m.summarize(this.audio.send),recv:g.summarize(this.audio.recv)},video:{send:m.summarize(this.video.send),recv:g.summarize(this.video.recv)}}},u})();return Li=_,Li}var xi,Uc;function bu(){if(Uc)return xi;Uc=1;var g=(function(){function m(_,u,i){Object.defineProperties(this,{id:{enumerable:!0,value:_,writable:!0},trackId:{enumerable:!0,value:u,writable:!0},lastStats:{enumerable:!0,value:i,writable:!0}})}return m})();return xi=g,xi}var Dr,Wc;function ld(){if(Wc)return Dr;Wc=1;var g=Dr&&Dr.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=yu(),_=bu(),u=(function(i){g(e,i);function e(t,r){var n=i.call(this,r.id,t,r)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return e.prototype.next=function(t,r){var n=this.lastStats;this.lastStats=r,this.trackId=t;var a=m.of(t,n,r);return this.lastReport=a,a},e})(_);return Dr=u,Dr}var jr,Hc;function dd(){if(Hc)return jr;Hc=1;var g=jr&&jr.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=bu(),_=gu(),u=(function(i){g(e,i);function e(t,r){var n=i.call(this,r.id,t,r)||this;return Object.defineProperties(n,{lastReport:{enumerable:!0,value:null,writable:!0}}),n}return e.prototype.next=function(t,r,n){var a=this.lastStats;this.lastStats=r,this.trackId=t;var o=_.of(t,a,r,n);return this.lastReport=o,o},e})(m);return jr=u,jr}var ft,Qc;function fd(){if(Qc)return ft;Qc=1;var g=ft&&ft.__read||function(h,w){var S=typeof Symbol=="function"&&h[Symbol.iterator];if(!S)return h;var E=S.call(h),q,O=[],C;try{for(;(w===void 0||w-- >0)&&!(q=E.next()).done;)O.push(q.value)}catch(I){C={error:I}}finally{try{q&&!q.done&&(S=E.return)&&S.call(E)}finally{if(C)throw C.error}}return O},m=ft&&ft.__spreadArray||function(h,w,S){if(S||arguments.length===2)for(var E=0,q=w.length,O;E<q;E++)(O||!(E in w))&&(O||(O=Array.prototype.slice.call(w,0,E)),O[E]=w[E]);return h.concat(O||Array.prototype.slice.call(w))},_=ft&&ft.__values||function(h){var w=typeof Symbol=="function"&&Symbol.iterator,S=w&&h[w],E=0;if(S)return S.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&E>=h.length&&(h=void 0),{value:h&&h[E++],done:!h}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},u=je().guessBrowser,i=sd(),e=ud(),t=ld(),r=dd(),n=(function(){function h(w){Object.defineProperties(this,{pc:{enumerable:!0,value:w},ice:{enumerable:!0,value:new i},audio:{enumerable:!0,value:{send:new Map,recv:new Map}},video:{enumerable:!0,value:{send:new Map,recv:new Map}},lastReport:{enumerable:!0,value:null,writable:!0}})}return h.prototype.next=function(){var w=this,S=u()==="firefox"?b(this):f(this);return S.then(function(){var E=m([],g(w.audio.send.values()),!1),q=m([],g(w.video.send.values()),!1),O=m([],g(w.audio.recv.values()),!1),C=m([],g(w.video.recv.values()),!1),I=new e(w.ice.lastReport,{send:E.map(function(x){return x.lastReport}).filter(function(x){return x}),recv:O.map(function(x){return x.lastReport}).filter(function(x){return x})},{send:q.map(function(x){return x.lastReport}).filter(function(x){return x}),recv:C.map(function(x){return x.lastReport}).filter(function(x){return x})});return w.lastReport=I,I})},h})();function a(h){return Promise.all(h.map(function(w){var S=w.track.id;return w.getStats().then(function(E){var q,O;try{for(var C=_(E.values()),I=C.next();!I.done;I=C.next()){var x=I.value;x.type==="inbound-rtp"&&(x.id="".concat(S,"-").concat(x.id))}}catch(A){q={error:A}}finally{try{I&&!I.done&&(O=C.return)&&O.call(C)}finally{if(q)throw q.error}}return[S,E]})})).then(function(w){return new Map(w)})}function o(h,w,S,E,q){var O=w[E.mediaType];if(!q){var C=S.get(E.trackId);C&&(q=C.trackIdentifier)}if(O&&q){if(O.has(E.id))return O.get(E.id);var I=new h(q,E);O.set(E.id,I)}return null}function s(h){return{audio:h.audio.send,video:h.video.send}}function c(h){return{audio:h.audio.recv,video:h.video.recv}}function l(h,w,S,E){return o(r,s(h),w,S,E)}function d(h,w,S,E){return o(t,c(h),w,S,E)}function v(h){return{audio:new Set(h.audio.send.keys()),video:new Set(h.video.send.keys())}}function p(h){return{audio:new Set(h.audio.recv.keys()),video:new Set(h.video.recv.keys())}}function T(h,w,S,E){var q,O;try{for(var C=_(w.values()),I=C.next();!I.done;I=C.next()){var x=I.value;if(x.type==="outbound-rtp"&&!x.isRemote){if(u()!=="firefox"&&!x.trackId)continue;var A=S[x.mediaType];A&&A.delete(x.id);var R=l(h,w,x,E);if(R){var F=w.get(x.remoteId);R.next(E||R.trackId,x,F)}}}}catch(V){q={error:V}}finally{try{I&&!I.done&&(O=C.return)&&O.call(C)}finally{if(q)throw q.error}}}function M(h,w,S,E){var q,O;try{for(var C=_(w.values()),I=C.next();!I.done;I=C.next()){var x=I.value;if(x.type==="inbound-rtp"&&!x.isRemote){var A=S[x.mediaType];A&&A.delete(x.id);var R=d(h,w,x,E);R&&R.next(E||R.trackId,x)}}}catch(F){q={error:F}}finally{try{I&&!I.done&&(O=C.return)&&O.call(C)}finally{if(q)throw q.error}}}function k(h,w){var S=function(q){var O=h[q],C=w[q];C.forEach(function(I){return O.delete(I)})};for(var E in w)S(E)}function y(h,w){var S,E,q,O,C;try{for(var I=_(w.values()),x=I.next();!x.done;x=I.next()){var A=x.value;A.type==="transport"&&(C=w.get(A.selectedCandidatePairId))}}catch(V){S={error:V}}finally{try{x&&!x.done&&(E=I.return)&&E.call(I)}finally{if(S)throw S.error}}if(C){h.next(C);return}try{for(var R=_(w.values()),F=R.next();!F.done;F=R.next()){var A=F.value;A.type==="candidate-pair"&&A.nominated&&(!("selected"in A)||A.selected)&&h.next(A)}}catch(V){q={error:V}}finally{try{F&&!F.done&&(O=R.return)&&O.call(R)}finally{if(q)throw q.error}}}function b(h){var w=h.pc.getTransceivers().filter(function(E){return E.currentDirection&&E.currentDirection.match(/send/)&&E.sender.track}).map(function(E){return E.sender}),S=h.pc.getTransceivers().filter(function(E){return E.currentDirection&&E.currentDirection.match(/recv/)}).map(function(E){return E.receiver});return Promise.all([a(w),a(S),h.pc.getStats()]).then(function(E){var q=g(E,3),O=q[0],C=q[1],I=q[2],x=s(h),A=v(h);O.forEach(function(V,U){return T(h,V,A,U)}),k(x,A);var R=c(h),F=p(h);C.forEach(function(V,U){return M(h,V,F,U)}),k(R,F),y(h.ice,I)})}function f(h){return h.pc.getStats().then(function(w){var S=s(h),E=v(h);T(h,w,E),k(S,E);var q=c(h),O=p(h);M(h,w,O),k(q,O),y(h.ice,w)})}return ft=n,ft}var Ct,Gc;function pd(){if(Gc)return Ct;Gc=1;var g=Ct&&Ct.__extends||(function(){var t=function(r,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,o){a.__proto__=o}||function(a,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(a[s]=o[s])},t(r,n)};return function(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(r,n);function a(){this.constructor=r}r.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}})(),m=Ct&&Ct.__read||function(t,r){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var a=n.call(t),o,s=[],c;try{for(;(r===void 0||r-- >0)&&!(o=a.next()).done;)s.push(o.value)}catch(l){c={error:l}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(c)throw c.error}}return s},_=Ne(),u=fd(),i=(function(t){g(r,t);function r(n,a){var o=t.call(this)||this;return Object.defineProperties(o,{_factories:{value:new WeakMap},_manager:{value:n},_signaling:{value:a}}),a.on("updated",function(){return o.emit("updated")}),o}return Object.defineProperty(r.prototype,"level",{get:function(){return this._signaling.level},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"levels",{get:function(){return this._signaling.levels},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"remoteLevels",{get:function(){return this._signaling.remoteLevels},enumerable:!1,configurable:!0}),r.prototype.start=function(){var n=this;this.stop();var a=setTimeout(function(){n._timeout===a&&e(n).then(function(o){if(n._timeout===a){if(o.length){var s=m(o,1),c=s[0];n._signaling.put(c)}n.start()}})},200);this._timeout=a},r.prototype.stop=function(){clearTimeout(this._timeout),this._timeout=null},r})(_);function e(t){var r=t._manager._peerConnections?Array.from(t._manager._peerConnections.values()):[],n=r.map(function(s){return s._peerConnection}).filter(function(s){return s.signalingState!=="closed"}),a=n.map(function(s){if(t._factories.has(s))return t._factories.get(s);var c=new u(s);return t._factories.set(s,c),c}),o=a.map(function(s){return s.next().catch(function(){return null})});return Promise.all(o).then(function(s){return s.filter(function(c){return c}).map(function(c){return c.summarize()})})}return Ct=i,Ct}var Mi,$c;function vd(){if($c)return Mi;$c=1;var g=Ee().defer,m=(function(){function _(){Object.defineProperties(this,{_deferreds:{value:[]},_hasValue:{value:!1,writable:!0},_value:{value:null,writable:!0}})}return _.prototype.put=function(u){this._hasValue=!0,this._value=u;var i=this._deferreds.shift();return i&&i.resolve(u),this},_.prototype.take=function(){var u=this;if(this._hasValue&&!this._deferreds.length)return this._hasValue=!1,Promise.resolve(this._value);var i=g();return this._deferreds.push(i),i.promise.then(function(e){return u._hasValue=!1,e})},_})();return Mi=m,Mi}var Nr,zc;function hd(){if(zc)return Nr;zc=1;var g=Nr&&Nr.__extends||(function(){var r=function(n,a){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(o[c]=s[c])},r(n,a)};return function(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");r(n,a);function o(){this.constructor=n}n.prototype=a===null?Object.create(a):(o.prototype=a.prototype,new o)}})(),m=At(),_=vd(),u=Mt(),i=5e3,e=(function(r){g(n,r);function n(a,o,s){var c=r.call(this,a,"network_quality",s)||this;return Object.defineProperties(c,{_level:{value:null,writable:!0},_levels:{value:null,writable:!0},_remoteLevels:{value:new Map,writable:!0},_networkQualityInputs:{value:new _},_resendTimer:{value:new u(function(){c._resendTimer.setDelay(c._resendTimer.delay*1.5),c._sendNetworkQualityInputs()},i,!1)},_networkQualityReportLevels:{get:function(){return{reportLevel:o.local,remoteReportLevel:o.remote}}}}),c.on("ready",function(l){l.on("message",function(d){c._log.debug("Incoming: ",d),d.type==="network_quality"&&c._handleNetworkQualityMessage(d)})}),c._sendNetworkQualityInputs(),c}return Object.defineProperty(n.prototype,"level",{get:function(){return this._level},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"levels",{get:function(){return this._levels},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"remoteLevels",{get:function(){return this._remoteLevels},enumerable:!1,configurable:!0}),n.prototype._handleNetworkQualityMessage=function(a){var o=this,s=!1,c=null,l=a?a.local:null;typeof l=="number"?(c=l,this._levels=null):typeof l=="object"&&l&&(this._levels=l,c=typeof l.level=="number"?l.level:Math.min(l.audio.send,l.audio.recv,l.video.send,l.video.recv)),c!==null&&this.level!==c&&(this._level=c,s=!0),this._remoteLevels=a&&a.remotes?a.remotes.reduce(function(d,v){var p=o._remoteLevels.get(v.sid)||{};return p.level!==v.level&&(s=!0),d.set(v.sid,v)},new Map):this._remoteLevels,s&&this.emit("updated"),this._resendTimer.setDelay(i),this._resendTimer.isSet&&setTimeout(function(){return o._sendNetworkQualityInputs()},1e3)},n.prototype._sendNetworkQualityInputs=function(){var a=this;return this._resendTimer.clear(),this._networkQualityInputs.take().then(function(o){a._transport&&a._transport.publish(t(o,a._networkQualityReportLevels))}).finally(function(){a._resendTimer.start()})},n.prototype.put=function(a){this._networkQualityInputs.put(a)},n})(m);function t(r,n){return Object.assign({type:"network_quality"},r,n)}return Nr=e,Nr}var qr,Kc;function wu(){if(Kc)return qr;Kc=1;var g=qr&&qr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ne().EventEmitter,_=(function(u){g(i,u);function i(){var e=u.call(this)||this;return Object.defineProperties(e,{_isEnabled:{value:null,writable:!0},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}}}),e}return i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(e){return e=typeof e=="boolean"?e:!0,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this},i})(m);return qr=_,qr}var Vr,Yc;function _d(){if(Yc)return Vr;Yc=1;var g=Vr&&Vr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=wu(),_=(function(u){g(i,u);function i(){var e=u.call(this)||this;return Object.defineProperties(e,{_revision:{value:1,writable:!0}}),e}return i.prototype.update=function(e){return e.revision<this._revision?this:(this._revision=e.revision,this.enable(e.is_recording))},i})(m);return Vr=_,Vr}var Ot,Jc;function md(){if(Jc)return Ot;Jc=1;var g=Ot&&Ot.__awaiter||function(o,s,c,l){function d(v){return v instanceof c?v:new c(function(p){p(v)})}return new(c||(c=Promise))(function(v,p){function T(y){try{k(l.next(y))}catch(b){p(b)}}function M(y){try{k(l.throw(y))}catch(b){p(b)}}function k(y){y.done?v(y.value):d(y.value).then(T,M)}k((l=l.apply(o,s||[])).next())})},m=Ot&&Ot.__generator||function(o,s){var c={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},l,d,v,p=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return p.next=T(0),p.throw=T(1),p.return=T(2),typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function T(k){return function(y){return M([k,y])}}function M(k){if(l)throw new TypeError("Generator is already executing.");for(;p&&(p=0,k[0]&&(c=0)),c;)try{if(l=1,d&&(v=k[0]&2?d.return:k[0]?d.throw||((v=d.return)&&v.call(d),0):d.next)&&!(v=v.call(d,k[1])).done)return v;switch(d=0,v&&(k=[k[0]&2,v.value]),k[0]){case 0:case 1:v=k;break;case 4:return c.label++,{value:k[1],done:!1};case 5:c.label++,d=k[1],k=[0];continue;case 7:k=c.ops.pop(),c.trys.pop();continue;default:if(v=c.trys,!(v=v.length>0&&v[v.length-1])&&(k[0]===6||k[0]===2)){c=0;continue}if(k[0]===3&&(!v||k[1]>v[0]&&k[1]<v[3])){c.label=k[1];break}if(k[0]===6&&c.label<v[1]){c.label=v[1],v=k;break}if(v&&c.label<v[2]){c.label=v[2],c.ops.push(k);break}v[2]&&c.ops.pop(),c.trys.pop();continue}k=s.call(o,c)}catch(y){k=[6,y],d=0}finally{l=v=0}if(k[0]&5)throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}},_=pu(),u=nu(),i=Ee(),e=i.filterObject,t=i.flatMap,r=i.difference,n=ht(),a=(function(){function o(s,c,l){if(l===void 0&&(l={}),!s||typeof s.getStats!="function")throw new Error("StatsMonitor requires a stats source with getStats() method");if(!c)throw new Error("StatsMonitor requires a log instance");this._statsSource=s,this._log=c,this._publishIntervalMs=l.publishIntervalMs||1e4,this._collectionIntervalMs=l.collectionIntervalMs||1e3,this._collectionsPerPublish=Math.floor(this._publishIntervalMs/this._collectionIntervalMs),this._stallThreshold=.5,this._resumeThreshold=5,this._initializeState(),this._startStatsCollection()}return o.prototype._initializeState=function(){this._movingAverageDeltas=new Map,this._interval=null,this._statsCollectionCount=0,this._iceCandidatePublishToggle=!1,this._hasSeenActivePair=!1,this._lastNetworkType=null,this._lastQualityLimitationReasonByTrackSid=new Map,this._stalledTrackSids=new Set},o.prototype._startStatsCollection=function(){var s=this;if(this._interval){this._log.warn("StatsMonitor already started");return}this._interval=setInterval(function(){return g(s,void 0,void 0,function(){return m(this,function(c){switch(c.label){case 0:return[4,this._collectAndAnalyzeStats()];case 1:return c.sent(),[2]}})})},this._collectionIntervalMs),this._log.debug("StatsMonitor started")},o.prototype._stopStatsCollection=function(){this._interval&&(clearInterval(this._interval),this._interval=null),this._log.debug("StatsMonitor stopped")},o.prototype._collectAndAnalyzeStats=function(){return g(this,void 0,void 0,function(){var s,c,l;return m(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,this._statsSource.getStats()];case 1:return s=d.sent(),this._statsCollectionCount++,c=this._statsCollectionCount%this._collectionsPerPublish===0,c&&(this._iceCandidatePublishToggle=!this._iceCandidatePublishToggle),l=c&&this._iceCandidatePublishToggle,this._analyzeStats(s,c,l),[3,3];case 2:return d.sent(),[3,3];case 3:return[2]}})})},o.prototype._analyzeStats=function(s,c,l){var d=this;!s||s instanceof Map&&s.size===0||Array.isArray(s)&&s.length===0||s.forEach(function(v,p){d._checkNetworkTypeChanges(v),d._checkQualityLimitations(v.localVideoTrackStats),d._checkTrackStalls(v.remoteVideoTrackStats),c&&(d._publishStatsReport(p,v),l&&d._publishActiveIceCandidatePair(p,v))})},o.prototype._checkNetworkTypeChanges=function(s){var c=s.activeIceCandidatePair;if(!(!c||!c.localCandidate)){var l=c.localCandidate.networkType;if(l){if(!this._hasSeenActivePair){this._hasSeenActivePair=!0,this._lastNetworkType=l,n.network.typeChanged(l);return}this._lastNetworkType!==l&&(this._log.debug("Network type changed: ".concat(this._lastNetworkType," -> ").concat(l)),this._lastNetworkType=l,n.network.typeChanged(l))}}},o.prototype._checkQualityLimitations=function(s){var c=this;Array.isArray(s)&&s.forEach(function(l){var d=l.trackSid,v=l.qualityLimitationReason;if(!(!d||typeof v!="string")){var p=c._lastQualityLimitationReasonByTrackSid.get(d);p!==v&&(c._log.debug("Quality limitation reason changed for track ".concat(d,": ").concat(p||"none"," -> ").concat(v)),c._lastQualityLimitationReasonByTrackSid.set(d,v),n.quality.limitationChanged(d,v))}})},o.prototype._checkTrackStalls=function(s){var c=this;Array.isArray(s)&&s.forEach(function(l){var d=l.trackSid,v=l.frameRateReceived;if(v!==void 0){var p=typeof v=="number"&&!isNaN(v)?v:0,T=c._stalledTrackSids.has(d);!T&&p<c._stallThreshold?(c._stalledTrackSids.add(d),c._log.debug("Track ".concat(d," stalled: frame rate ").concat(p," below threshold ").concat(c._stallThreshold)),n.track.stalled(d,p,c._stallThreshold)):T&&p>=c._resumeThreshold&&(c._stalledTrackSids.delete(d),c._log.debug("Track ".concat(d," resumed: frame rate ").concat(p," above threshold ").concat(c._resumeThreshold)),n.track.resumed(d,p,c._resumeThreshold))}})},o.prototype._addLocalTrackMetrics=function(s,c){var l=c.framesEncoded,d=c.packetsSent,v=c.totalEncodeTime,p=c.totalPacketSendDelay,T=Object.assign({},s),M="".concat(s.trackSid,"+").concat(s.ssrc),k=this._movingAverageDeltas.get(M)||new Map;if(typeof v=="number"&&typeof l=="number"){var y=k.get("avgEncodeDelay")||new u;y.putSample(v*1e3,l),T.avgEncodeDelay=Math.round(y.get()),k.set("avgEncodeDelay",y)}if(typeof p=="number"&&typeof d=="number"){var b=k.get("avgPacketSendDelay")||new u;b.putSample(p*1e3,d),T.avgPacketSendDelay=Math.round(b.get()),k.set("avgPacketSendDelay",b)}return this._movingAverageDeltas.set(M,k),T},o.prototype._addRemoteTrackMetrics=function(s,c){var l=c.estimatedPlayoutTimestamp,d=c.framesDecoded,v=c.jitterBufferDelay,p=c.jitterBufferEmittedCount,T=c.totalDecodeTime,M=Object.assign({},s),k="".concat(s.trackSid,"+").concat(s.ssrc),y=this._movingAverageDeltas.get(k)||new Map;if(typeof l=="number"&&(M.estimatedPlayoutTimestamp=l),typeof d=="number"&&typeof T=="number"){var b=y.get("avgDecodeDelay")||new u;b.putSample(T*1e3,d),M.avgDecodeDelay=Math.round(b.get()),y.set("avgDecodeDelay",b)}if(typeof v=="number"&&typeof p=="number"){var f=y.get("avgJitterBufferDelay")||new u;f.putSample(v*1e3,p),M.avgJitterBufferDelay=Math.round(f.get()),y.set("avgJitterBufferDelay",f)}return this._movingAverageDeltas.set(k,y),M},o.prototype._cleanupMovingAverageDeltas=function(s){var c=this,l=t(["localAudioTrackStats","localVideoTrackStats","remoteAudioTrackStats","remoteVideoTrackStats"],function(v){return s[v].map(function(p){var T=p.ssrc,M=p.trackSid;return"".concat(M,"+").concat(T)})}),d=r(Array.from(this._movingAverageDeltas.keys()),l);d.forEach(function(v){return c._movingAverageDeltas.delete(v)})},o.prototype._publishStatsReport=function(s,c){var l=this,d=new _(s,c,!0);n.quality.statsReport({audioTrackStats:d.remoteAudioTrackStats.map(function(v,p){return l._addRemoteTrackMetrics(v,c.remoteAudioTrackStats[p])}),localAudioTrackStats:d.localAudioTrackStats.map(function(v,p){return l._addLocalTrackMetrics(v,c.localAudioTrackStats[p])}),localVideoTrackStats:d.localVideoTrackStats.map(function(v,p){return l._addLocalTrackMetrics(v,c.localVideoTrackStats[p])}),peerConnectionId:d.peerConnectionId,videoTrackStats:d.remoteVideoTrackStats.map(function(v,p){return l._addRemoteTrackMetrics(v,c.remoteVideoTrackStats[p])})}),this._cleanupMovingAverageDeltas(d)},o.prototype._publishActiveIceCandidatePair=function(s,c){var l=this._replaceNullsWithDefaults(c.activeIceCandidatePair,s);n.quality.iceCandidatePair(l)},o.prototype._replaceNullsWithDefaults=function(s,c){return s=Object.assign({availableIncomingBitrate:0,availableOutgoingBitrate:0,bytesReceived:0,bytesSent:0,consentRequestsSent:0,currentRoundTripTime:0,lastPacketReceivedTimestamp:0,lastPacketSentTimestamp:0,nominated:!1,peerConnectionId:c,priority:0,readable:!1,requestsReceived:0,requestsSent:0,responsesReceived:0,responsesSent:0,retransmissionsReceived:0,retransmissionsSent:0,state:"failed",totalRoundTripTime:0,transportId:"",writable:!1},e(s||{},null)),s.localCandidate=Object.assign({candidateType:"host",deleted:!1,ip:"",port:0,priority:0,protocol:"udp",url:""},e(s.localCandidate||{},null)),s.remoteCandidate=Object.assign({candidateType:"host",ip:"",port:0,priority:0,protocol:"udp",url:""},e(s.remoteCandidate||{},null)),s},o.prototype.cleanup=function(){this._stopStatsCollection(),this._movingAverageDeltas.clear(),this._lastQualityLimitationReasonByTrackSid.clear(),this._stalledTrackSids.clear()},o})();return Ot=a,Ot}var Fr,Xc;function ku(){if(Xc)return Fr;Xc=1;var g=Fr&&Fr.__extends||(function(){var v=function(p,T){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,k){M.__proto__=k}||function(M,k){for(var y in k)Object.prototype.hasOwnProperty.call(k,y)&&(M[y]=k[y])},v(p,T)};return function(p,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");v(p,T);function M(){this.constructor=p}p.prototype=T===null?Object.create(T):(M.prototype=T.prototype,new M)}})(),m=wu(),_=jt(),u=Mt(),i=Ee().buildLogLevels,e=Oe().DEFAULT_LOG_LEVEL,t=Qe(),r=ze(),n=r.MediaConnectionError,a=r.MediaDTLSTransportFailedError,o=r.SignalingConnectionDisconnectedError,s=0,c={connected:["reconnecting","disconnected"],reconnecting:["connected","disconnected"],disconnected:[]},l=(function(v){g(p,v);function p(T,M,k,y){var b=this;y=Object.assign({logLevel:e,RecordingSignaling:m,Timeout:u},y);var f=i(y.logLevel);b=v.call(this,"connected",c)||this;var h=y.RecordingSignaling,w=new y.Timeout(function(){b._disconnect(b._reconnectingError)},y.sessionTimeout,!1);return Object.defineProperties(b,{_instanceId:{value:s++},_log:{value:y.log?y.log.createLog("default",b):new t("default",b,f,y.loggerName)},_mediaConnectionIsReconnecting:{writable:!0,value:!1},_options:{value:y},_reconnectingError:{value:null,writable:!0},_sessionTimeout:{value:w},dominantSpeakerSid:{enumerable:!0,value:null,writable:!0},localParticipant:{enumerable:!0,value:T},name:{enumerable:!0,value:k},participants:{enumerable:!0,value:new Map},recording:{enumerable:!0,value:new h},sid:{enumerable:!0,value:M}}),b.on("connectionStateChanged",function(){b.connectionState==="failed"&&!["disconnected","failed"].includes(b.iceConnectionState)&&b._disconnect(new a)}),b.on("iceConnectionStateChanged",function(){return d(b)}),b.on("signalingConnectionStateChanged",function(){return d(b)}),setTimeout(function(){return d(b)}),b}return p.prototype._disconnect=function(T){return this.state!=="disconnected"?(this.preempt("disconnected",null,[T]),!0):!1},p.prototype.toString=function(){return"[RoomSignaling #".concat(this._instanceId,": ").concat(this.localParticipant?this.localParticipant.sid:"null","]")},p.prototype.connectParticipant=function(T){var M=this;return T.state==="disconnected"||this.participants.has(T.sid)?!1:(this.participants.set(T.sid,T),T.on("stateChanged",function k(y){y==="disconnected"&&(T.removeListener("stateChanged",k),M.participants.delete(T.sid),M.emit("participantDisconnected",T))}),this.emit("participantConnected",T),!0)},p.prototype.disconnect=function(){return this._disconnect()},p.prototype.setDominantSpeaker=function(T){this.dominantSpeakerSid=T,this.emit("dominantSpeakerChanged")},p})(_);function d(v){if(v.state==="disconnected"||v.signalingConnectionState==="disconnected"){v._sessionTimeout.clear();return}var p;v.signalingConnectionState==="reconnecting"?p=v.signalingConnectionState:v.iceConnectionState==="failed"?(v._mediaConnectionIsReconnecting=!0,p="reconnecting"):v.iceConnectionState==="new"||v.iceConnectionState==="checking"?p=v._mediaConnectionIsReconnecting?"reconnecting":"connected":(v._mediaConnectionIsReconnecting=!1,v._reconnectingError=null,v._sessionTimeout.clear(),p="connected"),p!==v.state&&(p==="reconnecting"?(v._reconnectingError=v.signalingConnectionState==="reconnecting"?new o:new n,v._sessionTimeout.start(),v.preempt(p,null,[v._reconnectingError])):v.preempt(p))}return Fr=l,Fr}var Ai,Zc;function yd(){if(Zc)return Ai;Zc=1;var g=(function(){function m(_){var u=_.actual,i=u===void 0?null:u,e=_.available,t=e===void 0?null:e,r=_.level,n=r===void 0?null:r;Object.defineProperties(this,{actual:{value:i,enumerable:!0},available:{value:t,enumerable:!0},level:{value:n,enumerable:!0}})}return m})();return Ai=g,Ai}var Ii,es;function gd(){if(es)return Ii;es=1;var g=(function(){function m(_){var u=_.fractionLost,i=u===void 0?null:u,e=_.level,t=e===void 0?null:e;Object.defineProperties(this,{fractionLost:{value:i,enumerable:!0},level:{value:t,enumerable:!0}})}return m})();return Ii=g,Ii}var Di,ts;function bd(){if(ts)return Di;ts=1;var g=(function(){function m(_){var u=_.jitter,i=u===void 0?null:u,e=_.rtt,t=e===void 0?null:e,r=_.level,n=r===void 0?null:r;Object.defineProperties(this,{jitter:{value:i,enumerable:!0},rtt:{value:t,enumerable:!0},level:{value:n,enumerable:!0}})}return m})();return Di=g,Di}var ji,rs;function Su(){if(rs)return ji;rs=1;var g=yd(),m=gd(),_=bd(),u=(function(){function i(e){var t=e.bandwidth,r=t===void 0?null:t,n=e.fractionLost,a=n===void 0?null:n,o=e.latency,s=o===void 0?null:o;Object.defineProperties(this,{bandwidth:{value:r?new g(r):null,enumerable:!0},fractionLost:{value:a?new m(a):null,enumerable:!0},latency:{value:s?new _(s):null,enumerable:!0}})}return i})();return ji=u,ji}var Br,ns;function wd(){if(ns)return Br;ns=1;var g=Br&&Br.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Su(),_=(function(u){g(i,u);function i(e){return u.call(this,e)||this}return i})(m);return Br=_,Br}var Ur,is;function kd(){if(is)return Ur;is=1;var g=Ur&&Ur.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Su(),_=(function(u){g(i,u);function i(e){return u.call(this,e)||this}return i})(m);return Ur=_,Ur}var Ni,as;function Tu(){if(as)return Ni;as=1;var g=wd(),m=kd(),_=(function(){function u(i){var e=i.send,t=i.recv,r=i.sendStats,n=r===void 0?null:r,a=i.recvStats,o=a===void 0?null:a;Object.defineProperties(this,{send:{value:e,enumerable:!0},recv:{value:t,enumerable:!0},sendStats:{value:n?new g(n):null,enumerable:!0},recvStats:{value:o?new m(o):null,enumerable:!0}})}return u})();return Ni=_,Ni}var Wr,os;function Sd(){if(os)return Wr;os=1;var g=Wr&&Wr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Tu(),_=(function(u){g(i,u);function i(e){return u.call(this,e)||this}return i})(m);return Wr=_,Wr}var Hr,cs;function Td(){if(cs)return Hr;cs=1;var g=Hr&&Hr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Tu(),_=(function(u){g(i,u);function i(e){return u.call(this,e)||this}return i})(m);return Hr=_,Hr}var qi,ss;function Pd(){if(ss)return qi;ss=1;var g=Sd(),m=Td(),_=(function(){function u(i){var e=i.level,t=i.audio,r=i.video;Object.defineProperties(this,{level:{value:e,enumerable:!0},audio:{value:t?new g(t):null,enumerable:!0},video:{value:r?new m(r):null,enumerable:!0}})}return u})();return qi=_,qi}var Qr,us;function Ji(){if(us)return Qr;us=1;var g=Qr&&Qr.__extends||(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),m=jt(),_=Pd(),u={connecting:["connected"],connected:["disconnected","reconnecting"],reconnecting:["connected","disconnected"],disconnected:[]},i=(function(e){g(t,e);function t(){var r=e.call(this,"connecting",u)||this;return Object.defineProperties(r,{_identity:{writable:!0,value:null},_networkQualityLevel:{value:null,writable:!0},_networkQualityStats:{value:null,writable:!0},_sid:{writable:!0,value:null},identity:{enumerable:!0,get:function(){return this._identity}},sid:{enumerable:!0,get:function(){return this._sid}},tracks:{enumerable:!0,value:new Map}}),r}return Object.defineProperty(t.prototype,"networkQualityLevel",{get:function(){return this._networkQualityLevel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"networkQualityStats",{get:function(){return this._networkQualityStats},enumerable:!1,configurable:!0}),t.prototype.addTrack=function(r){return this.tracks.set(r.id||r.sid,r),this.emit("trackAdded",r),this},t.prototype.disconnect=function(){return this.state!=="disconnected"?(this.preempt("disconnected"),!0):!1},t.prototype.removeTrack=function(r){var n=this.tracks.get(r.id||r.sid);return this.tracks.delete(r.id||r.sid),n&&this.emit("trackRemoved",r),n||null},t.prototype.setNetworkQualityLevel=function(r,n){this._networkQualityLevel!==r&&(this._networkQualityLevel=r,this._networkQualityStats=n&&(n.audio||n.video)?new _(n):null,this.emit("networkQualityLevelChanged"))},t.prototype.connect=function(r,n){return this.state==="connecting"||this.state==="reconnecting"?(this._sid||(this._sid=r),this._identity||(this._identity=n),this.preempt("connected"),!0):!1},t.prototype.reconnecting=function(){return this.state==="connecting"||this.state==="connected"?(this.preempt("reconnecting"),!0):!1},t})(m);return Qr=i,Qr}var Gr,ls;function Ed(){if(ls)return Gr;ls=1;var g=Gr&&Gr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ji(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this)||this;return r.connect(e,t),r}return i})(m);return Gr=_,Gr}var $r,ds;function Pu(){if(ds)return $r;ds=1;var g=$r&&$r.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ne().EventEmitter,_=(function(u){g(i,u);function i(e,t,r,n){var a=u.call(this)||this,o=null;return Object.defineProperties(a,{_error:{value:null,writable:!0},_isEnabled:{value:r,writable:!0},_priority:{value:n,writable:!0},_trackTransceiver:{value:null,writable:!0},_sid:{get:function(){return o},set:function(s){o===null&&(o=s)}},kind:{enumerable:!0,value:t},name:{enumerable:!0,value:e}}),a}return Object.defineProperty(i.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"priority",{get:function(){return this._priority},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sid",{get:function(){return this._sid},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trackTransceiver",{get:function(){return this._trackTransceiver},enumerable:!1,configurable:!0}),i.prototype.disable=function(){return this.enable(!1)},i.prototype.enable=function(e){return e=typeof e=="boolean"?e:!0,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this},i.prototype.setTrackTransceiver=function(e){return e=e||null,this.trackTransceiver!==e&&(this._trackTransceiver=e,this.emit("updated")),this},i.prototype.setSid=function(e){return this.sid===null&&(this._sid=e,this.emit("updated")),this},i})(m);return $r=_,$r}var zr,fs;function Cd(){if(fs)return zr;fs=1;var g=zr&&zr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Pu(),_=(function(u){g(i,u);function i(e,t,r,n,a,o){var s=u.call(this,t,r,n,a)||this;return Object.defineProperties(s,{_isSwitchedOff:{value:o,writable:!0}}),s.setSid(e),s}return Object.defineProperty(i.prototype,"isSubscribed",{get:function(){return!!this.trackTransceiver},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSwitchedOff",{get:function(){return this._isSwitchedOff},enumerable:!1,configurable:!0}),i.prototype.subscribeFailed=function(e){return this.error||(this._error=e,this.emit("updated")),this},i.prototype.setPriority=function(e){return this._priority!==e&&(this._priority=e,this.emit("updated")),this},i.prototype.setSwitchedOff=function(e){return this._isSwitchedOff!==e&&(this._isSwitchedOff=e,this.emit("updated")),this},i})(m);return zr=_,zr}var Kr,ps;function Od(){if(ps)return Kr;ps=1;var g=Kr&&Kr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Cd(),_=(function(u){g(i,u);function i(e,t){return u.call(this,e.sid,e.name,e.kind,e.enabled,e.priority,t)||this}return i.prototype.update=function(e){return this.enable(e.enabled),this.setPriority(e.priority),this},i})(m);return Kr=_,Kr}var Yr,vs;function Rd(){if(vs)return Yr;vs=1;var g=Yr&&Yr.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=Ed(),_=Od(),u=(function(i){g(e,i);function e(t,r,n,a,o,s){var c=i.call(this,t.sid,t.identity)||this;return s=Object.assign({RemoteTrackPublicationV2:_},s),Object.defineProperties(c,{_revision:{writable:!0,value:null},_RemoteTrackPublicationV2:{value:s.RemoteTrackPublicationV2},_getInitialTrackSwitchOffState:{value:r},updateSubscriberTrackPriority:{value:function(l,d){return n(l,d)}},updateTrackRenderHint:{value:function(l,d){return a(l,d)}},clearTrackHint:{value:function(l){return o(l)}},revision:{enumerable:!0,get:function(){return this._revision}}}),c.update(t)}return e.prototype._getOrCreateTrack=function(t){var r=this._RemoteTrackPublicationV2,n=this.tracks.get(t.sid);if(!n){var a=this._getInitialTrackSwitchOffState(t.sid);n=new r(t,a),this.addTrack(n)}return n},e.prototype.update=function(t){var r=this;if(this.revision!==null&&t.revision<=this.revision)return this;this._revision=t.revision;var n=new Set;switch(t.tracks.forEach(function(a){var o=r._getOrCreateTrack(a);o.update(a),n.add(o)}),this.tracks.forEach(function(a){n.has(a)||r.removeTrack(a)}),t.state){case"disconnected":this.disconnect();break;case"reconnecting":this.reconnecting();break;case"connected":this.connect(this.sid,this.identity);break}return this},e})(m);return Yr=u,Yr}var Jr,hs;function Ld(){if(hs)return Jr;hs=1;var g=Jr&&Jr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=At(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this,e,"track_priority",t)||this;return Object.defineProperties(r,{_enqueuedPriorityUpdates:{value:new Map}}),r.on("ready",function(n){Array.from(r._enqueuedPriorityUpdates.keys()).forEach(function(a){n.publish({type:"track_priority",track:a,subscribe:r._enqueuedPriorityUpdates.get(a)})})}),r}return i.prototype.sendTrackPriorityUpdate=function(e,t,r){if(t!=="subscribe")throw new Error("only subscribe priorities are supported, found: "+t);this._enqueuedPriorityUpdates.set(e,r),this._transport&&this._transport.publish({type:"track_priority",track:e,subscribe:r})},i})(m);return Jr=_,Jr}var Xr,_s;function xd(){if(_s)return Xr;_s=1;var g=Xr&&Xr.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=At(),_=(function(u){g(i,u);function i(e,t){var r=u.call(this,e,"track_switch_off",t)||this;return r.on("ready",function(n){n.on("message",function(a){a.type==="track_switch_off"&&r._setTrackSwitchOffUpdates(a.off||[],a.on||[])})}),r}return i.prototype._setTrackSwitchOffUpdates=function(e,t){this.emit("updated",e,t)},i})(m);return Xr=_,Xr}var Zr,ms;function Md(){if(ms)return Zr;ms=1;var g=Zr&&Zr.__extends||(function(){var r=function(n,a){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(o[c]=s[c])},r(n,a)};return function(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");r(n,a);function o(){this.constructor=n}n.prototype=a===null?Object.create(a):(o.prototype=a.prototype,new o)}})(),m=At(),_=Mt(),u=Ee().isDeepEqual,i=2e3,e=1,t=(function(r){g(n,r);function n(a,o){var s=r.call(this,a,"render_hints",o)||this;return Object.defineProperties(s,{_trackSidsToRenderHints:{value:new Map},_responseTimer:{value:new _(function(){s._sendAllHints(),s._responseTimer.setDelay(s._responseTimer.delay*2)},i,!1)}}),s.on("ready",function(c){c.on("message",function(l){s._log.debug("Incoming: ",l),l.type==="render_hints"?s._processHintResults(l&&l.subscriber&&l.subscriber.hints||[]):s._log.warn("Unknown message type: ",l.type)}),s._sendAllHints()}),s}return n.prototype._sendAllHints=function(){var a=this;Array.from(this._trackSidsToRenderHints.keys()).forEach(function(o){var s=a._trackSidsToRenderHints.get(o);s.renderDimensions&&(s.isDimensionDirty=!0),"enabled"in s&&(s.isEnabledDirty=!0)}),this._sendHints()},n.prototype._processHintResults=function(a){var o=this;this._responseTimer.clear(),this._responseTimer.setDelay(i),a.forEach(function(s){s.result!=="OK"&&o._log.debug("Server error processing hint:",s)}),this._sendHints()},n.prototype._sendHints=function(){var a=this;if(!(!this._transport||this._responseTimer.isSet)){var o=[];if(Array.from(this._trackSidsToRenderHints.keys()).forEach(function(c){var l=a._trackSidsToRenderHints.get(c);if(l.isEnabledDirty||l.isDimensionDirty){var d={track:c};l.isEnabledDirty&&(d.enabled=l.enabled,l.isEnabledDirty=!1),l.isDimensionDirty&&(d.render_dimensions=l.renderDimensions,l.isDimensionDirty=!1),o.push(d)}}),o.length>0){var s={type:"render_hints",subscriber:{id:e++,hints:o}};this._log.debug("Outgoing: ",s),this._transport.publish(s),this._responseTimer.start()}}},n.prototype.setTrackHint=function(a,o){var s=this._trackSidsToRenderHints.get(a)||{isEnabledDirty:!1,isDimensionDirty:!1};"enabled"in o&&s.enabled!==o.enabled&&(s.enabled=!!o.enabled,s.isEnabledDirty=!0),o.renderDimensions&&!u(o.renderDimensions,s.renderDimensions)&&(s.renderDimensions=o.renderDimensions,s.isDimensionDirty=!0),this._trackSidsToRenderHints.set(a,s),this._sendHints()},n.prototype.clearTrackHint=function(a){this._trackSidsToRenderHints.delete(a)},n})(m);return Zr=t,Zr}var en,ys;function Ad(){if(ys)return en;ys=1;var g=en&&en.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=At(),_=1,u=(function(i){g(e,i);function e(t,r){var n=i.call(this,t,"publisher_hints",r)||this;return n.on("ready",function(a){n._log.debug("publisher_hints transport ready:",a),a.on("message",function(o){n._log.debug("Incoming: ",o),o.type==="publisher_hints"?o.publisher&&o.publisher.hints&&o.publisher.id&&n._processPublisherHints(o.publisher.hints,o.publisher.id):n._log.warn("Unknown message type: ",o.type)})}),n}return e.prototype.sendTrackReplaced=function(t){var r=t.trackSid;if(this._transport){var n={type:"client_reset",track:r,id:_++};this._log.debug("Outgoing: ",n),this._transport.publish(n)}},e.prototype.sendHintResponse=function(t){var r=t.id,n=t.hints;if(this._transport){var a={type:"publisher_hints",id:r,hints:n};this._log.debug("Outgoing: ",a),this._transport.publish(a)}},e.prototype._processPublisherHints=function(t,r){try{this.emit("updated",t,r)}catch(n){this._log.error("error processing hints:",n)}},e})(m);return en=u,en}var Rt,gs;function Id(){if(gs)return Rt;gs=1;var g=Rt&&Rt.__extends||(function(){var x=function(A,R){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,V){F.__proto__=V}||function(F,V){for(var U in V)Object.prototype.hasOwnProperty.call(V,U)&&(F[U]=V[U])},x(A,R)};return function(A,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");x(A,R);function F(){this.constructor=A}A.prototype=R===null?Object.create(R):(F.prototype=R.prototype,new F)}})(),m=Rt&&Rt.__read||function(x,A){var R=typeof Symbol=="function"&&x[Symbol.iterator];if(!R)return x;var F=R.call(x),V,U=[],j;try{for(;(A===void 0||A-- >0)&&!(V=F.next()).done;)U.push(V.value)}catch(D){j={error:D}}finally{try{V&&!V.done&&(R=F.return)&&R.call(F)}finally{if(j)throw j.error}}return U},_=ad(),u=od(),i=pd(),e=hd(),t=_d(),r=md(),n=ku(),a=Rd(),o=Ld(),s=xd(),c=Md(),l=Ad(),d=Ee(),v=d.constants.DEFAULT_SESSION_TIMEOUT_SEC,p=d.createBandwidthProfilePayload,T=d.defer,M=d.flatMap,k=d.oncePerTick,y=ze().createTwilioError,b=1e4,f=1e3,h=(function(x){g(A,x);function A(R,F,V,U,j){var D=this;F.options=Object.assign({session_timeout:v},F.options),j=Object.assign({DominantSpeakerSignaling:_,TranscriptionSignaling:u,NetworkQualityMonitor:i,NetworkQualitySignaling:e,RecordingSignaling:t,RemoteParticipantV2:a,TrackPrioritySignaling:o,TrackSwitchOffSignaling:s,bandwidthProfile:null,sessionTimeout:F.options.session_timeout*1e3,statsPublishIntervalMs:b,statsCollectionIntervalMs:f},j),R.setBandwidthProfile(j.bandwidthProfile);var H=F.options,$=H.signaling_region,re=H.audio_processors,Y=re===void 0?[]:re;R.setSignalingRegion($),Y.includes("krisp")&&Y.push("rnnoise"),R.setAudioProcessors(Y),U.setIceReconnectTimeout(j.sessionTimeout),D=x.call(this,R,F.sid,F.name,j)||this;var Z=function(ie){return D._getTrackReceiver(ie)},ne=D._log;return Object.defineProperties(D,{_disconnectedParticipantRevisions:{value:new Map},_NetworkQualityMonitor:{value:j.NetworkQualityMonitor},_lastBandwidthProfileRevision:{value:R.bandwidthProfileRevision,writable:!0},_mediaStatesWarningsRevision:{value:0,writable:!0},_networkQualityMonitor:{value:null,writable:!0},_networkQualityConfiguration:{value:R.networkQualityConfiguration},_peerConnectionManager:{value:U},_published:{value:new Map},_publishedRevision:{value:0,writable:!0},_RemoteParticipantV2:{value:j.RemoteParticipantV2},_subscribed:{value:new Map},_subscribedRevision:{value:0,writable:!0},_subscriptionFailures:{value:new Map},_dominantSpeakerSignaling:{value:new j.DominantSpeakerSignaling(Z,{log:ne})},_transcriptionSignaling:{value:new j.TranscriptionSignaling(Z,{log:ne})},_networkQualitySignaling:{value:new j.NetworkQualitySignaling(Z,R.networkQualityConfiguration,{log:ne})},_renderHintsSignaling:{value:new c(Z,{log:ne})},_publisherHintsSignaling:{value:new l(Z,{log:ne})},_trackPrioritySignaling:{value:new j.TrackPrioritySignaling(Z,{log:ne})},_trackSwitchOffSignaling:{value:new j.TrackSwitchOffSignaling(Z,{log:ne})},_pendingSwitchOffStates:{value:new Map},_statsMonitor:{value:j.eventObserver&&j.insights?new r(D,ne,{publishIntervalMs:j.statsPublishIntervalMs,collectionIntervalMs:j.statsCollectionIntervalMs}):null},_transport:{value:V},_trackReceiverDeferreds:{value:new Map},mediaRegion:{enumerable:!0,value:F.options.media_region||null}}),D._initTrackSwitchOffSignaling(),D._initDominantSpeakerSignaling(),D._initTranscriptionSignaling(),D._initNetworkQualityMonitorSignaling(),D._initPublisherHintSignaling(),q(D,R),O(D,U),C(D,V),D._statsMonitor&&D.on("stateChanged",function(ie){ie==="disconnected"&&D._statsMonitor&&D._statsMonitor.cleanup()}),D._update(F),D._peerConnectionManager.setEffectiveAdaptiveSimulcast(D._publisherHintsSignaling.isSetup),D}return Object.defineProperty(A.prototype,"connectionState",{get:function(){return this._peerConnectionManager.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"signalingConnectionState",{get:function(){return this._transport.state==="syncing"?"reconnecting":this._transport.state},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"iceConnectionState",{get:function(){return this._peerConnectionManager.iceConnectionState},enumerable:!1,configurable:!0}),A.prototype._deleteTrackReceiverDeferred=function(R){return this._trackReceiverDeferreds.delete(R)},A.prototype._getOrCreateTrackReceiverDeferred=function(R){var F=this._trackReceiverDeferreds.get(R)||T(),V=this._peerConnectionManager.getTrackReceivers(),U=V.find(function(j){return j.id===R&&j.readyState!=="ended"});return U?F.resolve(U):this._trackReceiverDeferreds.set(R,F),F},A.prototype._addTrackReceiver=function(R){var F=this._getOrCreateTrackReceiverDeferred(R.id);return F.resolve(R),this},A.prototype._disconnect=function(R){var F=x.prototype._disconnect.call(this,R);return F&&(this._teardownNetworkQualityMonitor(),this._transport.disconnect(),this._peerConnectionManager.close()),this.localParticipant.tracks.forEach(function(V){V.publishFailed(R||new Error("LocalParticipant disconnected"))}),F},A.prototype._getTrackReceiver=function(R){var F=this;return this._getOrCreateTrackReceiverDeferred(R).promise.then(function(V){return F._deleteTrackReceiverDeferred(R),V})},A.prototype._getInitialTrackSwitchOffState=function(R){var F=this._pendingSwitchOffStates.get(R)||!1;return this._pendingSwitchOffStates.delete(R),F&&this._log.warn("[".concat(R,"] was initially switched off! ")),F},A.prototype._getTrackSidsToTrackSignalings=function(){var R=M(this.participants,function(F){return Array.from(F.tracks)});return new Map(R)},A.prototype._getOrCreateRemoteParticipant=function(R){var F=this,V=this._RemoteParticipantV2,U=this.participants.get(R.sid),j=this;return U||(U=new V(R,function(D){return F._getInitialTrackSwitchOffState(D)},function(D,H){return F._trackPrioritySignaling.sendTrackPriorityUpdate(D,"subscribe",H)},function(D,H){return F._renderHintsSignaling.setTrackHint(D,H)},function(D){return F._renderHintsSignaling.clearTrackHint(D)}),U.on("stateChanged",function D(H){H==="disconnected"&&(U.removeListener("stateChanged",D),j.participants.delete(U.sid),j._disconnectedParticipantRevisions.set(U.sid,U.revision))}),this.connectParticipant(U)),U},A.prototype._getState=function(){return{participant:this.localParticipant.getState()}},A.prototype._maybeAddBandwidthProfile=function(R){var F=this.localParticipant,V=F.bandwidthProfile,U=F.bandwidthProfileRevision;return V&&this._lastBandwidthProfileRevision<U?(this._lastBandwidthProfileRevision=U,Object.assign({bandwidth_profile:p(V)},R)):R},A.prototype._publishNewLocalParticipantState=function(){this._transport.publish(this._maybeAddBandwidthProfile(this._getState()))},A.prototype._publishPeerConnectionState=function(R){this._transport.publish(Object.assign({peer_connections:[R]},this._getState()))},A.prototype._update=function(R){var F=this;if(R.subscribed&&R.subscribed.revision>this._subscribedRevision){this._subscribedRevision=R.subscribed.revision,R.subscribed.tracks.forEach(function(j){j.id?(F._subscriptionFailures.delete(j.sid),F._subscribed.set(j.sid,j.id)):j.error&&!F._subscriptionFailures.has(j.sid)&&F._subscriptionFailures.set(j.sid,j.error)});var V=new Set(R.subscribed.tracks.filter(function(j){return!!j.id}).map(function(j){return j.sid}));this._subscribed.forEach(function(j,D){V.has(D)||F._subscribed.delete(D)})}var U=new Set;return(R.participants||[]).forEach(function(j){if(j.sid!==F.localParticipant.sid){var D=F._disconnectedParticipantRevisions.get(j.sid);if(!(D&&j.revision<=D)){D&&F._disconnectedParticipantRevisions.delete(j.sid);var H=F._getOrCreateRemoteParticipant(j);H.update(j),U.add(H)}}}),R.type==="synced"&&this.participants.forEach(function(j){U.has(j)||j.disconnect()}),I(this),R.peer_connections&&this._peerConnectionManager.update(R.peer_connections,R.type==="synced"),R.recording&&this.recording.update(R.recording),R.published&&R.published.revision>this._publishedRevision&&(this._publishedRevision=R.published.revision,R.published.tracks.forEach(function(j){j.sid&&F._published.set(j.id,j.sid)}),this.localParticipant.update(R.published)),R.participant&&this.localParticipant.connect(R.participant.sid,R.participant.identity),[this._dominantSpeakerSignaling,this._transcriptionSignaling,this._networkQualitySignaling,this._trackPrioritySignaling,this._trackSwitchOffSignaling,this._renderHintsSignaling,this._publisherHintsSignaling].forEach(function(j){var D=j.channel;!j.isSetup&&R.media_signaling&&R.media_signaling[D]&&R.media_signaling[D].transport&&R.media_signaling[D].transport.type==="data-channel"&&j.setup(R.media_signaling[D].transport.label)}),R.type==="warning"&&R.states&&R.states.revision>this._mediaStatesWarningsRevision&&(this._mediaStatesWarningsRevision=R.states.revision,this.localParticipant.updateMediaStates(R.states)),this},A.prototype._initPublisherHintSignaling=function(){var R=this;this._publisherHintsSignaling.on("updated",function(V,U){Promise.all(V.map(function(j){return R.localParticipant.setPublisherHint(j.track,j.encodings).then(function(D){return{track:j.track,result:D}})})).then(function(j){R._publisherHintsSignaling.sendHintResponse({id:U,hints:j})})});var F=function(V){V.kind==="video"&&V.trackTransceiver.on("replaced",function(){R._publisherHintsSignaling.sendTrackReplaced({trackSid:V.sid})})};Array.from(this.localParticipant.tracks.values()).forEach(function(V){return F(V)}),this.localParticipant.on("trackAdded",function(V){return F(V)})},A.prototype._initTrackSwitchOffSignaling=function(){var R=this;this._trackSwitchOffSignaling.on("updated",function(F,V){try{R._log.debug("received trackSwitch: ",{tracksOn:V,tracksOff:F});var U=new Map;V.forEach(function(j){return U.set(j,!0)}),F.forEach(function(j){U.get(j)&&R._log.warn("".concat(j," is DUPLICATED in both tracksOff and tracksOn list")),U.set(j,!1)}),R.participants.forEach(function(j){j.tracks.forEach(function(D){var H=U.get(D.sid);typeof H<"u"&&(D.setSwitchedOff(!H),U.delete(D.sid))})}),U.forEach(function(j,D){return R._pendingSwitchOffStates.set(D,!j)})}catch(j){R._log.error("error processing track switch off:",j)}})},A.prototype._initDominantSpeakerSignaling=function(){var R=this;this._dominantSpeakerSignaling.on("updated",function(){return R.setDominantSpeaker(R._dominantSpeakerSignaling.loudestParticipantSid)})},A.prototype._initTranscriptionSignaling=function(){var R=this;this._transcriptionSignaling.on("transcription",function(F){R.emit("transcription",F)})},A.prototype._initNetworkQualityMonitorSignaling=function(){var R=this;this._networkQualitySignaling.on("ready",function(){var F=new R._NetworkQualityMonitor(R._peerConnectionManager,R._networkQualitySignaling);R._networkQualityMonitor=F,F.on("updated",function(){R.iceConnectionState!=="failed"&&(R.localParticipant.setNetworkQualityLevel(F.level,F.levels),R.participants.forEach(function(V){var U=F.remoteLevels.get(V.sid);U&&V.setNetworkQualityLevel(U.level,U)}))}),F.start()}),this._networkQualitySignaling.on("teardown",function(){return R._teardownNetworkQualityMonitor()})},A.prototype._teardownNetworkQualityMonitor=function(){this._networkQualityMonitor&&(this._networkQualityMonitor.stop(),this._networkQualityMonitor=null)},A.prototype.getStats=function(){var R=this;return this._peerConnectionManager.getStats().then(function(F){return new Map(Array.from(F).map(function(V){var U=m(V,2),j=U[0],D=U[1];return[j,Object.assign({},D,{localAudioTrackStats:S(R,D.localAudioTrackStats),localVideoTrackStats:S(R,D.localVideoTrackStats),remoteAudioTrackStats:E(R,D.remoteAudioTrackStats),remoteVideoTrackStats:E(R,D.remoteVideoTrackStats)})]}))})},A})(n);function w(x,A){return A.reduce(function(R,F){var V=x.get(F.trackId);return V?[Object.assign({},F,{trackSid:V})].concat(R):R},[])}function S(x,A){return w(x._published,A)}function E(x,A){var R=new Map(Array.from(x._subscribed.entries()).map(function(F){var V=m(F,2),U=V[0],j=V[1];return[j,U]}));return w(R,A)}function q(x,A){var R=k(function(){x._publishNewLocalParticipantState()}),F=k(function(){var V=M(A.tracks,function(U){return U.trackTransceiver});x._peerConnectionManager.setTrackSenders(V)});A.on("trackAdded",F),A.on("trackRemoved",F),A.on("updated",R),x.on("stateChanged",function V(U){U==="disconnected"&&(A.removeListener("trackAdded",F),A.removeListener("trackRemoved",F),A.removeListener("updated",R),x.removeListener("stateChanged",V),A.disconnect())}),x.on("signalingConnectionStateChanged",function(){var V=x.localParticipant,U=x.signalingConnectionState,j=V.identity,D=V.sid;switch(U){case"connected":V.connect(D,j);break;case"reconnecting":V.reconnecting();break}})}function O(x,A){A.on("description",function(F){x._publishPeerConnectionState(F)}),A.dequeue("description"),A.on("candidates",function(F){x._publishPeerConnectionState(F)}),A.dequeue("candidates"),A.on("trackAdded",x._addTrackReceiver.bind(x)),A.dequeue("trackAdded"),A.getTrackReceivers().forEach(x._addTrackReceiver,x),A.on("connectionStateChanged",function(){x.emit("connectionStateChanged")}),A.on("iceConnectionStateChanged",function(){x.emit("iceConnectionStateChanged"),x.iceConnectionState==="failed"&&(x.localParticipant.networkQualityLevel!==null&&x.localParticipant.setNetworkQualityLevel(0),x.participants.forEach(function(R){R.networkQualityLevel!==null&&R.setNetworkQualityLevel(0)}))})}function C(x,A){A.on("message",x._update.bind(x)),A.on("stateChanged",function R(F,V){F==="disconnected"&&(x.state!=="disconnected"&&x._disconnect(V),A.removeListener("stateChanged",R)),x.emit("signalingConnectionStateChanged")})}function I(x){var A=x._getTrackSidsToTrackSignalings();x._subscriptionFailures.forEach(function(R,F){var V=A.get(F);V&&(x._subscriptionFailures.delete(F),V.subscribeFailed(y(R.code,R.message)))}),A.forEach(function(R){var F=x._subscribed.get(R.sid);(!F||R.isSubscribed&&R.trackTransceiver.id!==F)&&R.setTrackTransceiver(null),F&&x._getTrackReceiver(F).then(function(V){return R.setTrackTransceiver(V)})})}return Rt=h,Rt}var tn,bs;function Dd(){if(bs)return tn;bs=1;var g=tn&&tn.__extends||(function(){var C=function(I,x){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,R){A.__proto__=R}||function(A,R){for(var F in R)Object.prototype.hasOwnProperty.call(R,F)&&(A[F]=R[F])},C(I,x)};return function(I,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");C(I,x);function A(){this.constructor=I}I.prototype=x===null?Object.create(x):(A.prototype=x.prototype,new A)}})(),m=jt(),_=ru(),u=vu(),i=Oe().reconnectBackoffConfig,e=Mt(),t=Oe(),r=t.SDK_NAME,n=t.SDK_VERSION,a=t.SDP_FORMAT,o=Ee(),s=o.createBandwidthProfilePayload,c=o.createMediaSignalingPayload,l=o.createMediaWarningsPayload,d=o.createSubscribePayload,v=o.getUserAgent,p=o.isNonArrayObject,T=ze(),M=T.createTwilioError,k=T.RoomCompletedError,y=T.SignalingConnectionError,b=T.SignalingServerBusyError,f=1,h=2,w={connecting:["connected","disconnected"],connected:["disconnected","syncing"],syncing:["connected","disconnected"],disconnected:[]},S=(function(C){g(I,C);function I(x,A,R,F,V,U){var j=this;return U=Object.assign({Backoff:u,TwilioConnection:_,iceServers:null,trackPriority:!0,trackSwitchOff:!0,renderHints:!0,userAgent:v()},U),j=C.call(this,"connecting",w)||this,Object.defineProperties(j,{_accessToken:{value:A},_adaptiveSimulcast:{value:U.adaptiveSimulcast},_automaticSubscription:{value:U.automaticSubscription},_bandwidthProfile:{value:U.bandwidthProfile},_dominantSpeaker:{value:U.dominantSpeaker},_receiveTranscriptions:{value:U.receiveTranscriptions},_eventObserver:{value:U.eventObserver,writable:!1},_renderHints:{value:U.renderHints},_iceServersStatus:{value:Array.isArray(U.iceServers)?"overrode":"acquire"},_localParticipant:{value:R},_name:{value:x},_networkQuality:{value:p(U.networkQuality)||U.networkQuality},_notifyWarnings:{value:U.notifyWarnings},_options:{value:U},_peerConnectionManager:{value:F},_sessionTimer:{value:null,writable:!0},_sessionTimeoutMS:{value:0,writable:!0},_reconnectBackoff:{value:new U.Backoff(i)},_session:{value:null,writable:!0},_trackPriority:{value:U.trackPriority},_trackSwitchOff:{value:U.trackSwitchOff},_twilioConnection:{value:null,writable:!0},_updatesReceived:{value:[]},_updatesToSend:{value:[]},_userAgent:{value:U.userAgent},_wsServer:{value:V}}),O(j),j}return I.prototype._createConnectOrSyncOrDisconnectMessage=function(){if(this.state==="connected")return null;if(this.state==="disconnected")return{session:this._session,type:"disconnect",version:h};var x={connecting:"connect",syncing:"sync"}[this.state],A={name:this._name,participant:this._localParticipant.getState(),peer_connections:this._peerConnectionManager.getStates(),type:x,version:h};return A.type==="connect"?(A.ice_servers=this._iceServersStatus,A.publisher={name:r,sdk_version:n,user_agent:this._userAgent},this._bandwidthProfile&&(A.bandwidth_profile=s(this._bandwidthProfile)),this._notifyWarnings&&(A.participant.media_warnings=l(this._notifyWarnings)),A.media_signaling=c(this._dominantSpeaker,this._networkQuality,this._trackPriority,this._trackSwitchOff,this._adaptiveSimulcast,this._renderHints,this._receiveTranscriptions),A.subscribe=d(this._automaticSubscription),A.format=a,A.token=this._accessToken):A.type==="sync"?(A.session=this._session,A.token=this._accessToken):A.type==="update"&&(A.session=this._session),A},I.prototype._createIceMessage=function(){return{edge:"roaming",token:this._accessToken,type:"ice",version:f}},I.prototype._sendConnectOrSyncOrDisconnectMessage=function(){var x=this._createConnectOrSyncOrDisconnectMessage();x&&this._twilioConnection.sendMessage(x)},I.prototype.disconnect=function(x){return this.state!=="disconnected"?(this.preempt("disconnected",null,[x]),this._sendConnectOrSyncOrDisconnectMessage(),this._twilioConnection.close(),!0):!1},I.prototype.publish=function(x){switch(this.state){case"connected":return this._twilioConnection.sendMessage(Object.assign({session:this._session,type:"update",version:h},x)),!0;case"connecting":case"syncing":return this._updatesToSend.push(x),!0;default:return!1}},I.prototype.publishEvent=function(x,A,R,F){this._eventObserver.emit("event",{group:x,name:A,level:R,payload:F})},I.prototype.sync=function(){return this.state==="connected"?(this.preempt("syncing"),this._sendConnectOrSyncOrDisconnectMessage(),!0):!1},I.prototype._setSession=function(x,A){this._session=x,this._sessionTimeoutMS=A*1e3},I.prototype._getReconnectTimer=function(){var x=this;return this._sessionTimeoutMS===0?null:(this._sessionTimer||(this._sessionTimer=new e(function(){x._sessionTimer&&(x._sessionTimeoutMS=0)},this._sessionTimeoutMS)),new Promise(function(A){x._reconnectBackoff.backoff(A)}))},I.prototype._clearReconnectTimer=function(){this._reconnectBackoff.reset(),this._sessionTimer&&(this._sessionTimer.clear(),this._sessionTimer=null)},I})(m);function E(C){return Array.from(C.reduce(function(I,x){var A=I.get(x.id)||x;return(!A.description&&x.description||A.description&&x.description&&x.description.revision>A.description.revision)&&(A.description=x.description),(!A.ice&&x.ice||A.ice&&x.ice&&x.ice.revision>A.ice.revision)&&(A.ice=x.ice),I.set(A.id,A),I},new Map).values())}function q(C){return C.reduce(function(I,x){return(!I.participant&&x.participant||I.participant&&x.participant&&x.participant.revision>I.participant.revision)&&(I.participant=x.participant),!I.peer_connections&&x.peer_connections?I.peer_connections=E(x.peer_connections):I.peer_connections&&x.peer_connections&&(I.peer_connections=E(I.peer_connections.concat(x.peer_connections))),I},{})}function O(C){function I(){if(C.state!=="disconnected"){C._twilioConnection&&C._twilioConnection.removeListener("message",A);var j=C._iceServersStatus,D=C._options,H=C._wsServer,$=C.state,re=D.TwilioConnection,Y=new re(H,Object.assign({helloBody:$==="connecting"&&j==="acquire"?C._createIceMessage():C._createConnectOrSyncOrDisconnectMessage()},D));Y.once("close",function(Z){Z===re.CloseReason.LOCAL?x():x(new Error(Z))}),Y.on("message",A),C._twilioConnection=Y}}function x(j){if(C.state!=="disconnected"){if(!j){C.disconnect();return}var D=C._getReconnectTimer();if(!D){var H=j.message===_.CloseReason.BUSY?new b:new y;C.disconnect(H);return}C.state==="connected"&&C.preempt("syncing"),D.then(I)}}function A(j){if(C.state!=="disconnected"){if(j.type==="error"){C.disconnect(M(j.code,j.message));return}switch(C.state){case"connected":switch(j.type){case"connected":case"synced":case"update":case"warning":C.emit("message",j);return;case"disconnected":C.disconnect(j.status==="completed"?new k:null);return;default:return}case"connecting":switch(j.type){case"iced":C._options.onIced(j.ice_servers).then(function(){C._sendConnectOrSyncOrDisconnectMessage()});return;case"connected":C._setSession(j.session,j.options.session_timeout),C.emit("connected",j),C.preempt("connected");return;case"synced":case"update":C._updatesReceived.push(j);return;case"disconnected":C.disconnect(j.status==="completed"?new k:null);return;default:return}case"syncing":switch(j.type){case"connected":case"update":C._updatesReceived.push(j);return;case"synced":C._clearReconnectTimer(),C.emit("message",j),C.preempt("connected");return;case"disconnected":C.disconnect(j.status==="completed"?new k:null);return;default:return}default:return}}}C.on("stateChanged",function j(D){switch(D){case"connected":{var H=C._updatesToSend.splice(0);H.length&&C.publish(q(H)),C._updatesReceived.splice(0).forEach(function($){return C.emit("message",$)});return}case"disconnected":C._twilioConnection.removeListener("message",A),C.removeListener("stateChanged",j);return;case"syncing":return;default:return}});var R=C._options,F=C._iceServersStatus,V=R.iceServers,U=R.onIced;F==="overrode"?U(V).then(I):I()}return tn=S,tn}var Vi,ws;function jd(){if(ws)return Vi;ws=1;var g=$i(),m=id(),_=Id(),u=Dd(),i=ze(),e=i.SignalingConnectionDisconnectedError,t=i.SignalingIncomingMessageInvalidError,r=Ee(),n=r.flatMap,a=r.createRoomConnectingEventPayload;function o(s,c,l,d,v,p){p=Object.assign({PeerConnectionManager:m,RoomV2:_,Transport:u},p);var T=v.video[0]&&v.video[0].adaptiveSimulcast===!0,M=p.PeerConnectionManager,k=p.RoomV2,y=p.Transport,b=p.iceServers,f=p.log,h=new M(d,v,p),w=n(l.tracks,function(O){return[O.trackTransceiver]});h.setTrackSenders(w);var S=new Error("Canceled"),E,q=new g(function(O,C,I){var x=function(_e){return I()?(C(S),Promise.reject(S)):(f.debug("Got ICE servers:",_e),p.iceServers=_e,h.setConfiguration(p),h.createAndOffer().then(function(){if(I())throw C(S),S;f.debug("createAndOffer() succeeded."),h.dequeue("description")}).catch(function(he){throw f.error("createAndOffer() failed:",he),C(he),he}))},A=p.automaticSubscription,R=p.bandwidthProfile,F=p.dominantSpeaker,V=p.receiveTranscriptions,U=p.environment,j=p.eventObserver,D=p.loggerName,H=p.logLevel,$=p.name,re=p.networkMonitor,Y=p.networkQuality,Z=p.notifyWarnings,ne=p.realm,ie=p.sdpSemantics,be=!!R,ce=!!R,pe=!!R&&(p.clientTrackSwitchOffControl!=="disabled"||p.contentPreferencesMode!=="disabled"),Te=Object.assign({adaptiveSimulcast:T,automaticSubscription:A,dominantSpeaker:F,receiveTranscriptions:V,environment:U,eventObserver:j,loggerName:D,logLevel:H,networkMonitor:re,networkQuality:Y,notifyWarnings:Z,iceServers:b,onIced:x,realm:ne,renderHints:pe,sdpSemantics:ie,trackPriority:be,trackSwitchOff:ce},R?{bandwidthProfile:R}:{});E=new y($,s,l,h,c,Te);var ge=a(p);j.emit("event",ge),E.once("connected",function(_e){if(f.debug("Transport connected:",_e),I()){C(S);return}var he=_e.participant;if(!he){C(new t);return}O(new k(l,_e,E,h,p))}),E.once("stateChanged",function(_e,he){_e==="disconnected"?(E=null,C(he||new e)):f.debug("Transport state changed:",_e)})},function(){E&&(E.disconnect(),E=null)});return q.catch(function(){E&&(E.disconnect(),E=null),h.close()}),q}return Vi=o,Vi}var rn,ks;function Nd(){if(ks)return rn;ks=1;var g=rn&&rn.__extends||(function(){var u=function(i,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},u(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");u(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),m=Ji(),_=(function(u){g(i,u);function i(){var e=u.call(this)||this;return Object.defineProperties(e,{_publicationsToTrackSenders:{value:new Map},_trackSendersToPublications:{value:new Map}}),e}return i.prototype.addTrack=function(e,t,r,n){n===void 0&&(n=null);var a=this._createLocalTrackPublicationSignaling(e,t,r,n);return this._trackSendersToPublications.set(e,a),this._publicationsToTrackSenders.set(a,e),u.prototype.addTrack.call(this,a),this},i.prototype.getPublication=function(e){return this._trackSendersToPublications.get(e)||null},i.prototype.getSender=function(e){return this._publicationsToTrackSenders.get(e)||null},i.prototype.removeTrack=function(e){var t=this._trackSendersToPublications.get(e);if(!t)return null;this._trackSendersToPublications.delete(e),this._publicationsToTrackSenders.delete(t);var r=u.prototype.removeTrack.call(this,t);return r&&t.stop(),t},i})(m);return rn=_,rn}var nn,Ss;function qd(){if(Ss)return nn;Ss=1;var g=nn&&nn.__extends||(function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),m=Pu(),_=(function(i){g(e,i);function e(t,r,n){var a=this,o=t.clone();t.kind!=="data"&&(o.track.enabled=t.track.enabled),t=o;var s=t.kind==="data"?!0:t.track.enabled;return a=i.call(this,r,t.kind,s,n)||this,a.setTrackTransceiver(t),Object.defineProperties(a,{_updatedPriority:{value:n,writable:!0},id:{enumerable:!0,value:t.id}}),a}return Object.defineProperty(e.prototype,"updatedPriority",{get:function(){return this._updatedPriority},enumerable:!1,configurable:!0}),e.prototype.enable=function(t){return t=typeof t=="boolean"?t:!0,this.trackTransceiver.track.enabled=t,i.prototype.enable.call(this,t)},e.prototype.publishFailed=function(t){return u(this,t)&&this.emit("updated"),this},e.prototype.setPriority=function(t){return this._updatedPriority!==t&&(this._updatedPriority=t,this.emit("updated")),this},e.prototype.setSid=function(t){return this._error?this:i.prototype.setSid.call(this,t)},e.prototype.stop=function(){this.trackTransceiver.stop()},e})(m);function u(i,e){return i._sid!==null||i._error?!1:(i._error=e,!0)}return nn=_,nn}var an,Ts;function Vd(){if(Ts)return an;Ts=1;var g=an&&an.__extends||(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),m=qd(),_=js(),u=ze().createTwilioError,i=(function(e){g(t,e);function t(r,n,a,o,s){var c=e.call(this,r,n,a)||this;return Object.defineProperties(c,{_log:{value:s.log.createLog("default",c)},_mediaStates:{value:{recordings:null},writable:!0},_noiseCancellationVendor:{value:o}}),c}return t.prototype.getState=function(){var r={enabled:this.isEnabled,id:this.id,kind:this.kind,name:this.name,priority:this.updatedPriority};return this._noiseCancellationVendor&&(r.audio_processor=this._noiseCancellationVendor),r},t.prototype.toString=function(){return"[LocalTrackPublicationV2: ".concat(this.sid,"]")},t.prototype.update=function(r){switch(r.state){case"ready":this.setSid(r.sid);break;case"failed":{var n=r.error;this.publishFailed(u(n.code,n.message));break}}return this},t.prototype.updateMediaStates=function(r){if(!r||!r.recordings||this._mediaStates.recordings===r.recordings)return this;switch(this._mediaStates.recordings=r.recordings,this._mediaStates.recordings){case"OK":this._log.info("Warnings have cleared."),this.emit("warningsCleared");break;case"NO_MEDIA":this._log.warn("Recording media lost."),this.emit("warning",_.recordingMediaLost);break;default:this._log.warn("Unknown media state detected: ".concat(this._mediaStates.recordings));break}return this},t})(m);return an=i,an}var on,Ps;function Fd(){if(Ps)return on;Ps=1;var g=on&&on.__extends||(function(){var a=function(o,s){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,l){c.__proto__=l}||function(c,l){for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(c[d]=l[d])},a(o,s)};return function(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");a(o,s);function c(){this.constructor=o}o.prototype=s===null?Object.create(s):(c.prototype=s.prototype,new c)}})(),m=Nd(),_=Vd(),u=Oe().DEFAULT_LOG_LEVEL,i=Qe(),e=Ee(),t=e.buildLogLevels,r=e.isDeepEqual,n=(function(a){g(o,a);function o(s,c,l){var d=this;l=Object.assign({logLevel:u,LocalTrackPublicationV2:_},l),d=a.call(this)||this;var v=t(l.logLevel);return Object.defineProperties(d,{_bandwidthProfile:{value:null,writable:!0},_bandwidthProfileRevision:{value:0,writable:!0},_encodingParameters:{value:s},_removeListeners:{value:new Map},_LocalTrackPublicationV2:{value:l.LocalTrackPublicationV2},_log:{value:l.log?l.log.createLog("default",d):new i("default",d,v,l.loggerName)},_publishedRevision:{writable:!0,value:0},_revision:{writable:!0,value:1},_signalingRegion:{value:null,writable:!0},audioProcessors:{value:[],writable:!0},bandwidthProfile:{enumerable:!0,get:function(){return this._bandwidthProfile}},bandwidthProfileRevision:{enumerable:!0,get:function(){return this._bandwidthProfileRevision}},networkQualityConfiguration:{enumerable:!0,value:c},revision:{enumerable:!0,get:function(){return this._revision}},signalingRegion:{enumerable:!0,get:function(){return this._signalingRegion}}}),d}return o.prototype.toString=function(){return"[LocalParticipantSignaling: ".concat(this.sid,"]")},o.prototype.setSignalingRegion=function(s){this._signalingRegion||(this._signalingRegion=s)},o.prototype.setBandwidthProfile=function(s){r(this._bandwidthProfile,s)||(this._bandwidthProfile=JSON.parse(JSON.stringify(s)),this._bandwidthProfileRevision++,this.didUpdate())},o.prototype.setAudioProcessors=function(s){this.audioProcessors=s},o.prototype.getParameters=function(){return this._encodingParameters},o.prototype.setParameters=function(s){return this._encodingParameters.update(s),this},o.prototype.update=function(s){return this._publishedRevision>=s.revision?this:(this._publishedRevision=s.revision,s.tracks.forEach(function(c){var l=this.tracks.get(c.id);l&&l.update(c)},this),this)},o.prototype.updateMediaStates=function(s){return!s||!s.tracks?this:(Array.from(this.tracks.values()).forEach(function(c){var l=s.tracks[c.sid];l&&c.updateMediaStates(l)}),this)},o.prototype._createLocalTrackPublicationSignaling=function(s,c,l,d){return new this._LocalTrackPublicationV2(s,c,l,d,{log:this._log})},o.prototype.addTrack=function(s,c,l,d){var v=this;a.prototype.addTrack.call(this,s,c,l,d);var p=this.getPublication(s),T=p.isEnabled,M=p.updatedPriority,k=function(){(T!==p.isEnabled||M!==p.updatedPriority)&&(v.didUpdate(),T=p.isEnabled,M=p.updatedPriority)};return p.on("updated",k),this._removeListener(p),this._removeListeners.set(p,function(){return p.removeListener("updated",k)}),this.didUpdate(),this},o.prototype._removeListener=function(s){var c=this._removeListeners.get(s);c&&c()},o.prototype.getState=function(){return{revision:this.revision,tracks:Array.from(this.tracks.values()).map(function(s){return s.getState()})}},o.prototype.didUpdate=function(){this._revision++,this.emit("updated")},o.prototype.removeTrack=function(s){var c=a.prototype.removeTrack.call(this,s);return c&&(s.removeClone(c.trackTransceiver),this._removeListener(c),this.didUpdate()),c},o.prototype.setNetworkQualityConfiguration=function(s){this.networkQualityConfiguration.update(s)},o.prototype.setPublisherHint=function(s,c){var l=Array.from(this.tracks.values()).find(function(d){return d.sid===s});return l?l.trackTransceiver.setPublisherHint(c):(this._log.warn("track:".concat(s," not found")),Promise.resolve("UNKNOWN_TRACK"))},o})(m);return on=n,on}var cn,Es;function Bd(){if(Es)return cn;Es=1;var g=cn&&cn.__extends||(function(){var t=function(r,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,o){a.__proto__=o}||function(a,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(a[s]=o[s])},t(r,n)};return function(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(r,n);function a(){this.constructor=r}r.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}})(),m=Ji(),_=ku(),u=jt(),i={closed:["opening"],opening:["closed","open"],open:["closed","closing"],closing:["closed","open"]},e=(function(t){g(r,t);function r(){return t.call(this,"closed",i)||this}return r.prototype._close=function(n){return this.transition("closing",n),this.transition("closed",n),Promise.resolve(this)},r.prototype._connect=function(n,a,o,s,c){n.connect("PA00000000000000000000000000000000","test");var l="RM00000000000000000000000000000000",d=Promise.resolve(new _(n,l,c));return d.cancel=function(){},d},r.prototype._open=function(n){return this.transition("opening",n),this.transition("open",n),Promise.resolve(this)},r.prototype.close=function(){var n=this;return this.bracket("close",function(a){switch(n.state){case"closed":return n;case"open":return n._close(a);default:throw new Error('Unexpected Signaling state "'.concat(n.state,'"'))}})},r.prototype.connect=function(n,a,o,s,c){var l=this;return this.bracket("connect",function d(v){switch(l.state){case"closed":return l._open(v).then(d.bind(null,v));case"open":return l.releaseLockCompletely(v),l._connect(n,a,o,s,c);default:throw new Error('Unexpected Signaling state "'.concat(l.state,'"'))}})},r.prototype.createLocalParticipantSignaling=function(){return new m},r.prototype.open=function(){var n=this;return this.bracket("open",function(a){switch(n.state){case"closed":return n._open(a);case"open":return n;default:throw new Error('Unexpected Signaling state "'.concat(n.state,'"'))}})},r})(u);return cn=e,cn}var sn,Cs;function Ud(){if(Cs)return sn;Cs=1;var g=sn&&sn.__extends||(function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,a){n.__proto__=a}||function(n,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),m=jd(),_=Fd(),u=Bd(),i=(function(e){g(t,e);function t(r,n){var a=this;return n=Object.assign({createCancelableRoomSignalingPromise:m},n),a=e.call(this)||this,Object.defineProperties(a,{_createCancelableRoomSignalingPromise:{value:n.createCancelableRoomSignalingPromise},_options:{value:n},_wsServer:{value:r}}),a}return t.prototype._connect=function(r,n,a,o,s){return s=Object.assign({},this._options,s),this._createCancelableRoomSignalingPromise.bind(null,n,this._wsServer,r,a,o,s)},t.prototype.createLocalParticipantSignaling=function(r,n){return new _(r,n)},t})(u);return sn=i,sn}var Fi,Os;function Wd(){if(Os)return Fi;Os=1;var g=Lt().MediaStreamTrack,m=je(),_=m.guessBrowser,u=m.guessBrowserVersion,i=m.isCodecSupported,e=kl(),t=Sl(),r=Il(),n=au(),a=Dl(),o=Dt(),s=o.LocalAudioTrack,c=o.LocalDataTrack,l=o.LocalVideoTrack,d=jl(),v=$l(),p=Ud(),T=Ee(),M=T.asLocalTrack,k=T.buildLogLevels,y=T.createRoomConnectedEventPayload,b=T.filterObject,f=T.isNonArrayObject,h=Oe(),w=h.DEFAULT_ENVIRONMENT,S=h.DEFAULT_LOG_LEVEL,E=h.DEFAULT_LOGGER_NAME,q=h.DEFAULT_REALM,O=h.DEFAULT_REGION,C=h.WS_SERVER,I=h.SDK_NAME,x=h.SDK_VERSION,A=h.typeErrors,R=$i(),F=iu(),V=Qe(),U=ou().validateBandwidthProfile,j=ht(),D=_()==="safari"&&u(),H=0,$=!1,re=!1;if(D){var Y=D.major,Z=D.minor;re=Y<12||Y===12&&Z<1}var ne=new Set([{didWarn:!1,shouldDelete:!0,name:"abortOnIceServersTimeout"},{didWarn:!1,shouldDelete:!0,name:"dscpTagging",newName:"enableDscp"},{didWarn:!1,shouldDelete:!0,name:"iceServersTimeout"},{didWarn:!1,shouldDelete:!1,name:"eventListener",newName:"Video.Logger"},{didWarn:!1,shouldDelete:!1,name:"logLevel",newName:"Video.Logger"}]),ie=new Set([{didWarn:!1,shouldDelete:!1,name:"maxTracks",newName:"bandwidthProfile.video.clientTrackSwitchOffControl"},{didWarn:!1,shouldDelete:!1,name:"renderDimensions",newName:"bandwidthProfile.video.contentPreferencesMode"}]);function be(le,z){if(typeof z>"u"&&(z={}),!f(z))return R.reject(A.INVALID_TYPE("options","object"));var ke=z.Log||V,se=z.loggerName||E,me=z.logLevel||S,L=k(me),P="[connect #".concat(++H,"]"),N;try{N=new ke("default",P,L,se)}catch(oe){return R.reject(oe)}ce(z,N,ne);var X=z.preferredVideoCodecs==="auto";if(X&&(z.preferredVideoCodecs=[{codec:"VP8",simulcast:!0,adaptiveSimulcast:!0}]),z.maxVideoBitrate&&X)return N.error('ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'),R.reject(A.ILLEGAL_INVOKE("connect",'ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'));z=Object.assign({automaticSubscription:!0,dominantSpeaker:!1,enableDscp:!1,receiveTranscriptions:!1,environment:w,eventListener:null,insights:!0,LocalAudioTrack:s,LocalDataTrack:c,LocalParticipant:r,LocalVideoTrack:l,Log:ke,MediaStreamTrack:g,loggerName:se,logLevel:me,maxAudioBitrate:null,maxVideoBitrate:null,name:null,networkMonitor:!0,networkQuality:!1,preferredAudioCodecs:[],preferredVideoCodecs:[],realm:q,region:O,signaling:p},b(z));var ee={};typeof z.wsServerInsights=="string"&&(ee.gateway=z.wsServerInsights);var ae=z.insights?n:a,ue=new ae(le,I,x,z.environment,z.realm,ee),fe=C(z.environment,z.region),ve=Date.now(),Ie=new F(ue,ve,N,z.eventListener);if(z=Object.assign({eventObserver:Ie,wsServer:fe},z),z.log=N,re&&!$&&N.logLevel!=="error"&&N.logLevel!=="off"&&($=!0,N.warn(["Support for Safari 12.0 and below is limited because it does not support VP8.","This means you may experience codec issues in Group Rooms. You may also","experience codec issues in Peer-to-Peer (P2P) Rooms containing Android- or","iOS-based Participants who do not support H.264. However, P2P Rooms","with browser-based Participants should work. For more information, please","refer to this guide: https://www.twilio.com/docs/video/javascript-v2-developing-safari-11"].join(" "))),typeof le!="string")return R.reject(A.INVALID_TYPE("token","string"));z.insights&&ue&&j.configure({publisher:ue,log:N,connectTimestamp:ve});var qe=Object.assign({},z);if(delete qe.name,"tracks"in z){if(!Array.isArray(z.tracks))return R.reject(A.INVALID_TYPE("options.tracks","Array of LocalAudioTrack, LocalVideoTrack or MediaStreamTrack"));try{z.tracks=z.tracks.map(function(oe){return M(oe,qe)})}catch(oe){return R.reject(oe)}}var te=U(z.bandwidthProfile);if(te)return R.reject(te);z.clientTrackSwitchOffControl="disabled",z.contentPreferencesMode="disabled",z.bandwidthProfile&&(z.clientTrackSwitchOffControl="auto",z.contentPreferencesMode="auto",z.bandwidthProfile.video&&(ce(z.bandwidthProfile.video,N,ie),"maxTracks"in z.bandwidthProfile.video?z.clientTrackSwitchOffControl="disabled":z.bandwidthProfile.video.clientTrackSwitchOffControl==="manual"?z.clientTrackSwitchOffControl="manual":z.clientTrackSwitchOffControl="auto","renderDimensions"in z.bandwidthProfile.video?z.contentPreferencesMode="disabled":z.bandwidthProfile.video.contentPreferencesMode==="manual"?z.contentPreferencesMode="manual":z.contentPreferencesMode="auto"));var K=z.signaling,B=new K(z.wsServer,z);N.info("Connecting to a Room"),N.debug("Options:",z);var W=new t({maxAudioBitrate:z.maxAudioBitrate,maxVideoBitrate:z.maxVideoBitrate},X),G={audio:z.preferredAudioCodecs.map(he),video:z.preferredVideoCodecs.map(he)},Q=new d(f(z.networkQuality)?z.networkQuality:{});["audio","video"].forEach(function(oe){return G[oe].forEach(function(Se){var Ce=Se.codec;return i(Ce,oe).then(function(xe){return!xe&&N.warn("The preferred ".concat(oe,' codec "').concat(Ce,'" will be ignored as it is not supported by the browser.'))})})});var J=e(_e.bind(null,z),pe.bind(null,B,N,W,Q,z),ge.bind(null,le,z,B,W,G),Te.bind(null,z));return J.then(function(oe){ue.connect(oe.sid,oe.localParticipant.sid);var Se=y(z);return z.eventObserver.emit("event",Se),N.info("Connected to Room:",oe.toString()),N.info("Room name:",oe.name),N.debug("Room:",oe),oe.once("disconnected",function(){setTimeout(function(){return ue.disconnect()},50)}),oe},function(oe){setTimeout(function(){return ue.disconnect()},50),J._isCanceled?N.info("Attempt to connect to a Room was canceled"):N.info("Error while connecting to a Room:",oe)}),J}function ce(le,z,ke){ke.forEach(function(se){var me=se.didWarn,L=se.name,P=se.newName,N=se.shouldDelete;L in le&&typeof le[L]<"u"&&(P&&N&&(le[P]=le[L]),N&&delete le[L],!me&&!["error","off"].includes(z.level)&&(z.warn('The ConnectOptions "'.concat(L,'" is ').concat(P?'deprecated and scheduled for removal. Please use "'.concat(P,'" instead.'):"no longer applicable and will be ignored.")),se.didWarn=!0))})}function pe(le,z,ke,se,me,L){var P=le.createLocalParticipantSignaling(ke,se);return z.debug("Creating a new LocalParticipant:",P),new me.LocalParticipant(P,L,me)}function Te(le,z,ke){var se=new v(z,ke,le),me=le.log;return me.debug("Creating a new Room:",se),ke.on("stateChanged",function L(P){P==="disconnected"&&(me.info("Disconnected from Room:",se.toString()),ke.removeListener("stateChanged",L))}),se}function ge(le,z,ke,se,me,L){return z.log.debug("Creating a new RoomSignaling"),ke.connect(L._signaling,le,se,me,z)}function _e(le,z){var ke=le.log;return le.shouldStopLocalTracks=!le.tracks,le.shouldStopLocalTracks?ke.info("LocalTracks were not provided, so they will be acquired automatically before connecting to the Room. LocalTracks will be released if connecting to the Room fails or if the Room is disconnected"):(ke.info("Getting LocalTracks"),ke.debug("Options:",le)),le.createLocalTracks(le).then(function(me){var L=z(me);return L.catch(function(){le.shouldStopLocalTracks&&(ke.info("The automatically acquired LocalTracks will now be stopped"),me.forEach(function(N){N.stop()}))}),L})}function he(le){var z=typeof le=="string"?{codec:le}:le;switch(z.codec.toLowerCase()){case"opus":return Object.assign({dtx:!0},z);case"vp8":return Object.assign({simulcast:!1},z);default:return z}}return Fi=be,Fi}var Bi,Rs;function Ls(){if(Rs)return Bi;Rs=1;var g=Oe(),m=g.DEFAULT_LOG_LEVEL,_=g.DEFAULT_LOGGER_NAME;function u(t,r){r=Object.assign({loggerName:_,logLevel:m},r);var n={};n.loggerName=r.loggerName,n.logLevel=r.logLevel,delete r.loggerName,delete r.logLevel;var a=["getUserMedia","enumerateDevices","MediaStream","mapMediaElement","disposeMediaElement"];a.forEach(function(s){s in r&&(n[s]=r[s],delete r[s])});var o=r.createLocalTracks;return delete r.createLocalTracks,n[t]=Object.keys(r).length>0?r:!0,o(n).then(function(s){return s[0]})}function i(t){return u("audio",t)}function e(t){return u("video",t)}return Bi={audio:i,video:e},Bi}var Ui,xs;function Hd(){if(xs)return Ui;xs=1;var g=je(),m=g.guessBrowser,_=g.support,u=ln().getSdpFormat,i=xt(),e=i.isAndroid,t=i.isMobile,r=i.isNonChromiumEdge,n=i.rebrandedChromeBrowser,a=i.mobileWebKitBrowser,o=["crios","edg","edge","electron","headlesschrome"],s=["chrome","firefox"],c=["chrome","safari"],l=["edg"];function d(){var v=m();if(!v)return!1;var p=n(v),T=a(v),M=e()?s:c;return!!v&&_()&&u()==="unified"&&(!p||o.includes(p))&&!r(v)&&(!T||l.includes(T))&&(!t()||M.includes(v))}return Ui=d,Ui}var Wi=Tn.exports,Ms;function Qd(){if(Ms)return Tn.exports;Ms=1;var g=Wi&&Wi.__assign||function(){return g=Object.assign||function(l){for(var d,v=1,p=arguments.length;v<p;v++){d=arguments[v];for(var T in d)Object.prototype.hasOwnProperty.call(d,T)&&(l[T]=d[T])}return l},g.apply(this,arguments)};Object.defineProperty(Wi,"__esModule",{value:!0});var m=fl(),_=wl(),u={connect:Wd(),createLocalAudioTrack:Ls().audio,createLocalVideoTrack:Ls().video,isSupported:Hd()(),version:Is.version,Logger:As(),LocalAudioTrack:Dt().LocalAudioTrack,LocalDataTrack:Dt().LocalDataTrack,LocalVideoTrack:Dt().LocalVideoTrack};function i(l,d){var v=g({createLocalTracks:m.createLocalTracks},d);return u.connect(l,v)}function e(l){var d=g({createLocalTracks:m.createLocalTracks},l);return u.createLocalAudioTrack(d)}function t(l){var d=g({createLocalTracks:m.createLocalTracks},l);return u.createLocalVideoTrack(d)}var r=u.isSupported,n=u.version,a=u.Logger,o=u.LocalAudioTrack,s=u.LocalVideoTrack,c=u.LocalDataTrack;return Tn.exports={connect:i,createLocalAudioTrack:e,createLocalVideoTrack:t,createLocalTracks:m.createLocalTracks,runPreflight:_.runPreflight,isSupported:r,version:n,Logger:a,LocalAudioTrack:o,LocalVideoTrack:s,LocalDataTrack:c},Tn.exports}var Gd=Qd();const $d=Ru(Gd),zd="http://localhost:3000",En=Mu.create({baseURL:zd,headers:{"Content-Type":"application/json"}});En.interceptors.request.use(g=>{const m=localStorage.getItem("token");return m&&(g.headers.Authorization=`Bearer ${m}`),g});const Kd={getToken:async g=>(await En.post(`/api/consultations/${g}/video/token`)).data.data,startConsultation:async g=>(await En.post(`/api/consultations/${g}/video/start`,{enableRecording:!0})).data,endConsultation:async(g,m)=>(await En.post(`/api/consultations/${g}/video/end`,{notes:m})).data},Yd=un("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Jd=un("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Xd=un("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]),Zd=un("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),ef=un("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);function af(){const{consultationId:g}=Lu(),m=xu(),[_,u]=_t.useState(null),[i,e]=_t.useState([]),[t,r]=_t.useState(!0),[n,a]=_t.useState(!0),o=_t.useRef(null),s=_t.useRef(null);_t.useEffect(()=>(g&&c(),()=>{d()}),[g]);const c=async()=>{try{if(!g)return;const{token:M}=await Kd.getToken(g),k=await $d.connect(M,{name:`consultation-${g}`,audio:!0,video:{width:640}});u(k),l(k.localParticipant,o),k.participants.forEach(y=>{l(y,s)}),k.on("participantConnected",y=>{l(y,s)}),k.on("participantDisconnected",y=>{ta.info("Participant disconnected",{service:"video-consultation",consultationId:g,participantIdentity:y.identity})})}catch(M){ta.error("Failed to connect to video room",{service:"video-consultation",consultationId:g,error:M instanceof Error?M.message:String(M)}),alert("Failed to join video room."),m("/dashboard")}},l=(M,k)=>{M.tracks.forEach(y=>{if(y.isSubscribed){const b=y.track;k.current?.appendChild(b.attach())}}),M.on("trackSubscribed",y=>{k.current?.appendChild(y.attach())})},d=()=>{_?.disconnect(),u(null)},v=()=>{_?.localParticipant.audioTracks.forEach(M=>{t?M.track.disable():M.track.enable()}),r(!t)},p=()=>{_?.localParticipant.videoTracks.forEach(M=>{n?M.track.disable():M.track.enable()}),a(!n)},T=()=>{d(),m("/dashboard")};return Ue.jsxDEV("div",{className:"h-screen bg-gray-900 flex flex-col",children:Ue.jsxDEV("div",{className:"flex-1 relative",children:[Ue.jsxDEV("div",{ref:s,className:"absolute inset-0 w-full h-full [&>video]:w-full [&>video]:h-full [&>video]:object-cover"},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:118,columnNumber:17},this),Ue.jsxDEV("div",{ref:o,className:"absolute bottom-4 right-4 w-48 h-36 bg-black rounded-lg overflow-hidden border-2 border-white shadow-lg [&>video]:w-full [&>video]:h-full [&>video]:object-cover"},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:121,columnNumber:17},this),Ue.jsxDEV("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 flex gap-4",children:[Ue.jsxDEV("button",{onClick:v,className:`p-4 rounded-full ${t?"bg-gray-700":"bg-red-500"} text-white hover:opacity-80`,children:t?Ue.jsxDEV(Jd,{},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:126,columnNumber:43},this):Ue.jsxDEV(Yd,{},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:126,columnNumber:53},this)},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:125,columnNumber:21},this),Ue.jsxDEV("button",{onClick:p,className:`p-4 rounded-full ${n?"bg-gray-700":"bg-red-500"} text-white hover:opacity-80`,children:n?Ue.jsxDEV(ef,{},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:129,columnNumber:43},this):Ue.jsxDEV(Zd,{},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:129,columnNumber:59},this)},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:128,columnNumber:21},this),Ue.jsxDEV("button",{onClick:T,className:"p-4 rounded-full bg-red-600 text-white hover:bg-red-700",children:Ue.jsxDEV(Xd,{},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:132,columnNumber:25},this)},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:131,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:124,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:116,columnNumber:13},this)},void 0,!1,{fileName:"/Users/theophilusogieva/Desktop/MediMindPlus/MediMindPlus/web/src/pages/consultation/VideoRoom.tsx",lineNumber:115,columnNumber:9},this)}export{af as default};
//# sourceMappingURL=VideoRoom-DP7gVvIm.js.map
