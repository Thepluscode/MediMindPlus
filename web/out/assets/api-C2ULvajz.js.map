{"version":3,"file":"api-C2ULvajz.js","sources":["../../src/services/api.ts"],"sourcesContent":["import axios from 'axios';\n\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3000';\n\n// Shared authenticated API instance\nexport const api = axios.create({\n  baseURL: API_URL,\n  headers: { 'Content-Type': 'application/json' },\n});\n\napi.interceptors.request.use(\n  (config) => {\n    const token = localStorage.getItem('token');\n    if (token) config.headers.Authorization = `Bearer ${token}`;\n    return config;\n  },\n  (error) => Promise.reject(error)\n);\n\n// Response interceptor: auto-refresh token on 401, redirect to login if refresh fails\nlet isRefreshing = false;\nlet failedQueue: Array<{ resolve: (v: any) => void; reject: (e: any) => void }> = [];\n\nconst processQueue = (error: any, token: string | null = null) => {\n  failedQueue.forEach(p => error ? p.reject(error) : p.resolve(token));\n  failedQueue = [];\n};\n\napi.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n    if (error.response?.status === 401 && !originalRequest._retry) {\n      const refreshToken = localStorage.getItem('refreshToken');\n      if (!refreshToken) {\n        // No refresh token â€” clear session and redirect to login\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        window.location.href = '/login';\n        return Promise.reject(error);\n      }\n\n      if (isRefreshing) {\n        return new Promise((resolve, reject) => {\n          failedQueue.push({ resolve, reject });\n        }).then(token => {\n          originalRequest.headers.Authorization = `Bearer ${token}`;\n          return api(originalRequest);\n        });\n      }\n\n      originalRequest._retry = true;\n      isRefreshing = true;\n\n      try {\n        const res = await axios.post(`${API_URL}/api/auth/refresh-token`, { refreshToken });\n        const newToken = res.data.tokens?.accessToken || res.data.token;\n        if (!newToken) throw new Error('No token in refresh response');\n        localStorage.setItem('token', newToken);\n        if (res.data.tokens?.refreshToken) localStorage.setItem('refreshToken', res.data.tokens.refreshToken);\n        api.defaults.headers.common.Authorization = `Bearer ${newToken}`;\n        processQueue(null, newToken);\n        originalRequest.headers.Authorization = `Bearer ${newToken}`;\n        return api(originalRequest);\n      } catch (refreshError) {\n        processQueue(refreshError, null);\n        localStorage.removeItem('token');\n        localStorage.removeItem('refreshToken');\n        localStorage.removeItem('user');\n        window.location.href = '/login';\n        return Promise.reject(refreshError);\n      } finally {\n        isRefreshing = false;\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\n// Health Analysis\nexport const healthAnalysisService = {\n  getMetrics: (days = 30) => api.get(`/api/health-metrics?days=${days}`),\n  saveMetrics: (data: any) => api.post('/api/health-metrics', data),\n};\n\n// Analytics\nexport const analyticsService = {\n  getSummary: () => api.get('/api/analytics/summary'),\n  getForecast: (data: any) => api.post('/api/analytics/forecast', data),\n  detectAnomalies: (data: any) => api.post('/api/analytics/anomalies', data),\n  generateInsights: (healthData: any[]) => api.post('/api/analytics/insights', { healthData }),\n};\n\n// Settings\nexport const settingsService = {\n  getProfile: () => api.get('/api/settings/profile'),\n  updateProfile: (data: any) => api.put('/api/settings/profile', data),\n  changePassword: (data: any) => api.put('/api/settings/password', data),\n  getPrivacy: () => api.get('/api/settings/privacy/settings'),\n  updatePrivacy: (data: any) => api.put('/api/settings/privacy/settings', data),\n  exportData: () => api.get('/api/settings/privacy/export'),\n};\n\n// Wearables / Device Integration\nexport const wearableService = {\n  syncData: (userId: string, data: any) => api.post(`/api/wearable/${userId}/sync`, data),\n  getDevices: () => api.get(`/api/advanced/wearables/devices/${getUserId()}`),\n  connectDevice: (deviceType: string, manufacturer = 'Unknown') =>\n    api.post('/api/advanced/wearables/connect', { user_id: getUserId(), device_type: deviceType, manufacturer }),\n  disconnectDevice: (deviceId: string) => api.delete(`/api/advanced/wearables/devices/${deviceId}`).catch(() =>\n    api.delete(`/api/wearable/devices/${deviceId}`)),\n  getBiometrics: () => api.get(`/api/advanced/wearables/realtime/${getUserId()}`),\n  getBiometricData: (metric: string, hours = 24) =>\n    api.get(`/api/advanced/biometric/${metric}?hours=${hours}`),\n};\n\n// Consultations / Appointments\nconst getUserId = () => {\n  try { return JSON.parse(localStorage.getItem('user') || '{}')?.id || ''; } catch { return ''; }\n};\nexport const consultationService = {\n  book: (data: any) => api.post('/api/consultations/book', data),\n  getList: () => api.get(`/api/consultations/patient/${getUserId()}`),\n  getById: (id: string) => api.get(`/api/consultations/${id}`),\n  cancel: (id: string) => api.put(`/api/consultations/${id}/cancel`),\n};\n\n// Revolutionary Features\nexport const revolutionaryService = {\n  // Virtual Health Twin\n  getTwin: () => { const uid = getUserId(); return api.get(`/api/v1/health-twin/${uid}`); },\n  runSimulation: (data: any) => { const uid = getUserId(); return api.post(`/api/v1/health-twin/${uid}/simulate`, data); },\n  getTwinPredictions: () => { const uid = getUserId(); return api.get(`/api/v1/health-twin/${uid}/predictions`); },\n\n  // Longevity / Biological Age\n  getBiologicalAge: () => { const uid = getUserId(); return api.get(`/api/v1/longevity/${uid}/biological-age`); },\n  getLongevityProfile: () => { const uid = getUserId(); return api.get(`/api/v1/longevity/${uid}/profile`); },\n  getAgingHallmarks: () => { const uid = getUserId(); return api.get(`/api/v1/longevity/${uid}/aging-hallmarks`); },\n  getTherapies: () => { const uid = getUserId(); return api.get(`/api/v1/longevity/${uid}/therapies`); },\n\n  // Drug Interaction (via advanced features)\n  checkDrugInteractions: (data: any) => api.post('/api/advanced/drug-interactions', data),\n};\n\n// Radiologist\nexport const radiologistService = {\n  getMetrics: (range = 'month') => api.get(`/api/radiologist/metrics?range=${range}`),\n  getWorklist: () => api.get('/api/radiologist/worklist'),\n};\n\n// Payments\nexport const paymentService = {\n  createPaymentIntent: (consultationId: string, amount: number) =>\n    api.post('/api/payments/create-intent', { consultationId, amount }),\n  confirmPayment: (consultationId: string, paymentIntentId: string) =>\n    api.post('/api/payments/confirm', { consultationId, paymentIntentId }),\n};\n\n// Audit Logs (admin)\nexport const auditService = {\n  getLogs: (params?: { skip?: number; limit?: number; status?: string; action?: string }) =>\n    api.get('/api/audit/logs', { params }),\n  exportLogs: () => api.get('/api/audit/logs/export'),\n};\n\n// Dashboard\nexport const dashboardService = {\n  getDashboard: () => api.get('/api/dashboard'),\n  getWidgetData: (widgetId: string, timeRange?: string) =>\n    api.get(`/api/dashboard/${widgetId}/data${timeRange ? `?timeRange=${timeRange}` : ''}`),\n};\n\n// User Preferences (notifications, language, timezone, units)\nexport const preferencesService = {\n  get: () => api.get('/api/settings/preferences'),\n  update: (data: any) => api.put('/api/settings/preferences', data),\n};\n\n// Team Management\nexport const teamService = {\n  getMembers: () => api.get('/api/team/members'),\n  updateRole: (userId: string, role: string) => api.put(`/api/team/members/${userId}/role`, { role }),\n};\n\n// Reports\nexport const reportsService = {\n  getReports: () => api.get('/api/reports'),\n};\n"],"names":["API_URL","api","axios","config","token","error","isRefreshing","failedQueue","processQueue","p","response","originalRequest","refreshToken","resolve","reject","res","newToken","refreshError","healthAnalysisService","days","data","analyticsService","healthData","settingsService","wearableService","userId","getUserId","deviceType","manufacturer","deviceId","metric","hours","consultationService","id","revolutionaryService","uid","auditService","params","preferencesService","teamService","role","reportsService"],"mappings":"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"}